"use strict";var d_=Object.create;var Ji=Object.defineProperty;var lT=Object.getOwnPropertyDescriptor;var f_=Object.getOwnPropertyNames;var m_=Object.getPrototypeOf,h_=Object.prototype.hasOwnProperty;var g_=(n,e,t)=>e in n?Ji(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e)=>Ji(n,"name",{value:e,configurable:!0});var w=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),b_=(n,e)=>{for(var t in e)Ji(n,t,{get:e[t],enumerable:!0})},uT=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of f_(e))!h_.call(n,i)&&i!==t&&Ji(n,i,{get:()=>e[i],enumerable:!(r=lT(e,i))||r.enumerable});return n};var K=(n,e,t)=>(t=n!=null?d_(m_(n)):{},uT(e||!n||!n.__esModule?Ji(t,"default",{value:n,enumerable:!0}):t,n)),v_=n=>uT(Ji({},"__esModule",{value:!0}),n),x=(n,e,t,r)=>{for(var i=r>1?void 0:r?lT(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Ji(e,t,i),i};var m=(n,e,t)=>(g_(n,typeof e!="symbol"?e+"":e,t),t),y_=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var ns=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var rs=(n,e,t)=>(y_(n,e,"access private method"),t);var as=w(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.stringArray=zt.array=zt.func=zt.error=zt.number=zt.string=zt.boolean=void 0;function C_(n){return n===!0||n===!1}o(C_,"boolean");zt.boolean=C_;function TT(n){return typeof n=="string"||n instanceof String}o(TT,"string");zt.string=TT;function P_(n){return typeof n=="number"||n instanceof Number}o(P_,"number");zt.number=P_;function R_(n){return n instanceof Error}o(R_,"error");zt.error=R_;function A_(n){return typeof n=="function"}o(A_,"func");zt.func=A_;function kT(n){return Array.isArray(n)}o(kT,"array");zt.array=kT;function L_(n){return kT(n)&&n.every(e=>TT(e))}o(L_,"stringArray");zt.stringArray=L_});var nh=w(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.Message=le.NotificationType9=le.NotificationType8=le.NotificationType7=le.NotificationType6=le.NotificationType5=le.NotificationType4=le.NotificationType3=le.NotificationType2=le.NotificationType1=le.NotificationType0=le.NotificationType=le.RequestType9=le.RequestType8=le.RequestType7=le.RequestType6=le.RequestType5=le.RequestType4=le.RequestType3=le.RequestType2=le.RequestType1=le.RequestType=le.RequestType0=le.AbstractMessageSignature=le.ParameterStructures=le.ResponseError=le.ErrorCodes=void 0;var eo=as(),CT;(function(n){n.ParseError=-32700,n.InvalidRequest=-32600,n.MethodNotFound=-32601,n.InvalidParams=-32602,n.InternalError=-32603,n.jsonrpcReservedErrorRangeStart=-32099,n.serverErrorStart=-32099,n.MessageWriteError=-32099,n.MessageReadError=-32098,n.PendingResponseRejected=-32097,n.ConnectionInactive=-32096,n.ServerNotInitialized=-32002,n.UnknownErrorCode=-32001,n.jsonrpcReservedErrorRangeEnd=-32e3,n.serverErrorEnd=-32e3})(CT=le.ErrorCodes||(le.ErrorCodes={}));var Vl=class extends Error{constructor(e,t,r){super(t),this.code=eo.number(e)?e:CT.UnknownErrorCode,this.data=r,Object.setPrototypeOf(this,Vl.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}},um=Vl;o(Vl,"ResponseError");le.ResponseError=um;var cs=class{constructor(e){this.kind=e}static is(e){return e===cs.auto||e===cs.byName||e===cs.byPosition}toString(){return this.kind}},hn=cs;o(cs,"ParameterStructures");le.ParameterStructures=hn;hn.auto=new hn("auto");hn.byPosition=new hn("byPosition");hn.byName=new hn("byName");var Dm=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return hn.auto}},rt=Dm;o(Dm,"AbstractMessageSignature");le.AbstractMessageSignature=rt;var Nm=class extends rt{constructor(e){super(e,0)}},pm=Nm;o(Nm,"RequestType0");le.RequestType0=pm;var _m=class extends rt{constructor(e,t=hn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},dm=_m;o(_m,"RequestType");le.RequestType=dm;var Om=class extends rt{constructor(e,t=hn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},fm=Om;o(Om,"RequestType1");le.RequestType1=fm;var Mm=class extends rt{constructor(e){super(e,2)}},mm=Mm;o(Mm,"RequestType2");le.RequestType2=mm;var Um=class extends rt{constructor(e){super(e,3)}},hm=Um;o(Um,"RequestType3");le.RequestType3=hm;var qm=class extends rt{constructor(e){super(e,4)}},gm=qm;o(qm,"RequestType4");le.RequestType4=gm;var $m=class extends rt{constructor(e){super(e,5)}},bm=$m;o($m,"RequestType5");le.RequestType5=bm;var Wm=class extends rt{constructor(e){super(e,6)}},vm=Wm;o(Wm,"RequestType6");le.RequestType6=vm;var Bm=class extends rt{constructor(e){super(e,7)}},ym=Bm;o(Bm,"RequestType7");le.RequestType7=ym;var jm=class extends rt{constructor(e){super(e,8)}},Im=jm;o(jm,"RequestType8");le.RequestType8=Im;var Vm=class extends rt{constructor(e){super(e,9)}},xm=Vm;o(Vm,"RequestType9");le.RequestType9=xm;var Gm=class extends rt{constructor(e,t=hn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},Sm=Gm;o(Gm,"NotificationType");le.NotificationType=Sm;var Hm=class extends rt{constructor(e){super(e,0)}},Tm=Hm;o(Hm,"NotificationType0");le.NotificationType0=Tm;var zm=class extends rt{constructor(e,t=hn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},km=zm;o(zm,"NotificationType1");le.NotificationType1=km;var Km=class extends rt{constructor(e){super(e,2)}},Cm=Km;o(Km,"NotificationType2");le.NotificationType2=Cm;var Xm=class extends rt{constructor(e){super(e,3)}},Pm=Xm;o(Xm,"NotificationType3");le.NotificationType3=Pm;var Jm=class extends rt{constructor(e){super(e,4)}},Rm=Jm;o(Jm,"NotificationType4");le.NotificationType4=Rm;var Qm=class extends rt{constructor(e){super(e,5)}},Am=Qm;o(Qm,"NotificationType5");le.NotificationType5=Am;var Ym=class extends rt{constructor(e){super(e,6)}},Lm=Ym;o(Ym,"NotificationType6");le.NotificationType6=Lm;var Zm=class extends rt{constructor(e){super(e,7)}},Em=Zm;o(Zm,"NotificationType7");le.NotificationType7=Em;var eh=class extends rt{constructor(e){super(e,8)}},wm=eh;o(eh,"NotificationType8");le.NotificationType8=wm;var th=class extends rt{constructor(e){super(e,9)}},Fm=th;o(th,"NotificationType9");le.NotificationType9=Fm;var E_;(function(n){function e(i){let s=i;return s&&eo.string(s.method)&&(eo.string(s.id)||eo.number(s.id))}o(e,"isRequest"),n.isRequest=e;function t(i){let s=i;return s&&eo.string(s.method)&&i.id===void 0}o(t,"isNotification"),n.isNotification=t;function r(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(eo.string(s.id)||eo.number(s.id)||s.id===null)}o(r,"isResponse"),n.isResponse=r})(E_=le.Message||(le.Message={}))});var sh=w(Br=>{"use strict";var PT;Object.defineProperty(Br,"__esModule",{value:!0});Br.LRUCache=Br.LinkedMap=Br.Touch=void 0;var an;(function(n){n.None=0,n.First=1,n.AsOld=n.First,n.Last=2,n.AsNew=n.Last})(an=Br.Touch||(Br.Touch={}));var ih=class{constructor(){this[PT]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=an.None){let r=this._map.get(e);if(r)return t!==an.None&&this.touch(r,t),r.value}set(e,t,r=an.None){let i=this._map.get(e);if(i)i.value=t,r!==an.None&&this.touch(i,r);else{switch(i={key:e,value:t,next:void 0,previous:void 0},r){case an.None:this.addItemLast(i);break;case an.First:this.addItemFirst(i);break;case an.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let r=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return r}values(){let e=this._state,t=this._head,r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return r}entries(){let e=this._state,t=this._head,r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return r}[(PT=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,r=this.size;for(;t&&r>e;)this._map.delete(t.key),t=t.next,r--;this._head=t,this._size=r,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,r=e.previous;if(!t||!r)throw new Error("Invalid list");t.previous=r,r.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==an.First&&t!==an.Last)){if(t===an.First){if(e===this._head)return;let r=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(r.previous=i,i.next=r),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===an.Last){if(e===this._tail)return;let r=e.next,i=e.previous;e===this._head?(r.previous=void 0,this._head=r):(r.previous=i,i.next=r),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,r)=>{e.push([r,t])}),e}fromJSON(e){this.clear();for(let[t,r]of e)this.set(t,r)}},Gl=ih;o(ih,"LinkedMap");Br.LinkedMap=Gl;var oh=class extends Gl{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=an.AsNew){return super.get(e,t)}peek(e){return super.get(e,an.None)}set(e,t){return super.set(e,t,an.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}},rh=oh;o(oh,"LRUCache");Br.LRUCache=rh});var RT=w(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.Disposable=void 0;var w_;(function(n){function e(t){return{dispose:t}}o(e,"create"),n.create=e})(w_=Ua.Disposable||(Ua.Disposable={}))});var gi=w(lh=>{"use strict";Object.defineProperty(lh,"__esModule",{value:!0});var ah;function ch(){if(ah===void 0)throw new Error("No runtime abstraction layer installed");return ah}o(ch,"RAL");(function(n){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");ah=t}o(e,"install"),n.install=e})(ch||(ch={}));lh.default=ch});var ls=w(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.Emitter=to.Event=void 0;var F_=gi(),D_;(function(n){let e={dispose(){}};n.None=function(){return e}})(D_=to.Event||(to.Event={}));var ph=class{add(e,t=null,r){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(r)&&r.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let r=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else r=!0;if(r)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],r=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,a=r.length;s<a;s++)try{t.push(r[s].apply(i[s],e))}catch(c){(0,F_.default)().console.error(c)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},uh=ph;o(ph,"CallbackList");var zl=class{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,r)=>{this._callbacks||(this._callbacks=new uh),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=zl._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(r)&&r.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}},Hl=zl;o(zl,"Emitter");to.Emitter=Hl;Hl._noop=function(){}});var Xl=w(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.CancellationTokenSource=no.CancellationToken=void 0;var N_=gi(),__=as(),dh=ls(),fh;(function(n){n.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:dh.Event.None}),n.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:dh.Event.None});function e(t){let r=t;return r&&(r===n.None||r===n.Cancelled||__.boolean(r.isCancellationRequested)&&!!r.onCancellationRequested)}o(e,"is"),n.is=e})(fh=no.CancellationToken||(no.CancellationToken={}));var O_=Object.freeze(function(n,e){let t=(0,N_.default)().timer.setTimeout(n.bind(e),0);return{dispose(){t.dispose()}}}),hh=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?O_:(this._emitter||(this._emitter=new dh.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Kl=hh;o(hh,"MutableToken");var gh=class{get token(){return this._token||(this._token=new Kl),this._token}cancel(){this._token?this._token.cancel():this._token=fh.Cancelled}dispose(){this._token?this._token instanceof Kl&&this._token.dispose():this._token=fh.None}},mh=gh;o(gh,"CancellationTokenSource");no.CancellationTokenSource=mh});var AT=w(us=>{"use strict";Object.defineProperty(us,"__esModule",{value:!0});us.SharedArrayReceiverStrategy=us.SharedArraySenderStrategy=void 0;var M_=Xl(),qa;(function(n){n.Continue=0,n.Cancelled=1})(qa||(qa={}));var xh=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),r=new Int32Array(t,0,1);r[0]=qa.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let r=this.buffers.get(t);if(r===void 0)return;let i=new Int32Array(r,0,1);Atomics.store(i,0,qa.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}},bh=xh;o(xh,"SharedArraySenderStrategy");us.SharedArraySenderStrategy=bh;var Sh=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===qa.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},vh=Sh;o(Sh,"SharedArrayBufferCancellationToken");var Th=class{constructor(e){this.token=new vh(e)}cancel(){}dispose(){}},yh=Th;o(Th,"SharedArrayBufferCancellationTokenSource");var kh=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new M_.CancellationTokenSource:new yh(t)}},Ih=kh;o(kh,"SharedArrayReceiverStrategy");us.SharedArrayReceiverStrategy=Ih});var Rh=w(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});Jl.Semaphore=void 0;var U_=gi(),Ph=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,r)=>{this._waiting.push({thunk:e,resolve:t,reject:r}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,U_.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(r=>{this._active--,e.resolve(r),this.runNext()},r=>{this._active--,e.reject(r),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}},Ch=Ph;o(Ph,"Semaphore");Jl.Semaphore=Ch});var LT=w(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.ReadableStreamMessageReader=jr.AbstractMessageReader=jr.MessageReader=void 0;var Lh=gi(),ps=as(),Ah=ls(),q_=Rh(),$_;(function(n){function e(t){let r=t;return r&&ps.func(r.listen)&&ps.func(r.dispose)&&ps.func(r.onError)&&ps.func(r.onClose)&&ps.func(r.onPartialMessage)}o(e,"is"),n.is=e})($_=jr.MessageReader||(jr.MessageReader={}));var Fh=class{constructor(){this.errorEmitter=new Ah.Emitter,this.closeEmitter=new Ah.Emitter,this.partialMessageEmitter=new Ah.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${ps.string(e.message)?e.message:"unknown"}`)}},Ql=Fh;o(Fh,"AbstractMessageReader");jr.AbstractMessageReader=Ql;var Eh;(function(n){function e(t){let r,i,s,a=new Map,c,l=new Map;if(t===void 0||typeof t=="string")r=t??"utf-8";else{if(r=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,a.set(s.name,s)),t.contentDecoders!==void 0)for(let u of t.contentDecoders)a.set(u.name,u);if(t.contentTypeDecoder!==void 0&&(c=t.contentTypeDecoder,l.set(c.name,c)),t.contentTypeDecoders!==void 0)for(let u of t.contentTypeDecoders)l.set(u.name,u)}return c===void 0&&(c=(0,Lh.default)().applicationJson.decoder,l.set(c.name,c)),{charset:r,contentDecoder:s,contentDecoders:a,contentTypeDecoder:c,contentTypeDecoders:l}}o(e,"fromOptions"),n.fromOptions=e})(Eh||(Eh={}));var Dh=class extends Ql{constructor(e,t){super(),this.readable=e,this.options=Eh.fromOptions(t),this.buffer=(0,Lh.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new q_.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(r=>{this.onData(r)});return this.readable.onError(r=>this.fireError(r)),this.readable.onClose(()=>this.fireClose()),t}onData(e){for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let r=this.buffer.tryReadHeaders(!0);if(!r)return;let i=r.get("content-length");if(!i){this.fireError(new Error("Header must provide a Content-Length property."));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error("Content-Length value must be a number."));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let r=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(r,this.options);this.callback(i)}).catch(r=>{this.fireError(r)})}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,Lh.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}},wh=Dh;o(Dh,"ReadableStreamMessageReader");jr.ReadableStreamMessageReader=wh});var DT=w(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.WriteableStreamMessageWriter=Vr.AbstractMessageWriter=Vr.MessageWriter=void 0;var ET=gi(),$a=as(),W_=Rh(),wT=ls(),B_="Content-Length: ",FT=`\r
`,j_;(function(n){function e(t){let r=t;return r&&$a.func(r.dispose)&&$a.func(r.onClose)&&$a.func(r.onError)&&$a.func(r.write)}o(e,"is"),n.is=e})(j_=Vr.MessageWriter||(Vr.MessageWriter={}));var Oh=class{constructor(){this.errorEmitter=new wT.Emitter,this.closeEmitter=new wT.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,r){this.errorEmitter.fire([this.asError(e),t,r])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${$a.string(e.message)?e.message:"unknown"}`)}},Yl=Oh;o(Oh,"AbstractMessageWriter");Vr.AbstractMessageWriter=Yl;var Nh;(function(n){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,ET.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,ET.default)().applicationJson.encoder}}o(e,"fromOptions"),n.fromOptions=e})(Nh||(Nh={}));var Mh=class extends Yl{constructor(e,t){super(),this.writable=e,this.options=Nh.fromOptions(t),this.errorCount=0,this.writeSemaphore=new W_.Semaphore(1),this.writable.onError(r=>this.fireError(r)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(r=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(r):r).then(r=>{let i=[];return i.push(B_,r.byteLength.toString(),FT),i.push(FT),this.doWrite(e,i,r)},r=>{throw this.fireError(r),r}))}async doWrite(e,t,r){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(r)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}},_h=Mh;o(Mh,"WriteableStreamMessageWriter");Vr.WriteableStreamMessageWriter=_h});var NT=w(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.AbstractMessageBuffer=void 0;var V_=13,G_=10,H_=`\r
`,qh=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,r=0,i=0,s=0;e:for(;r<this._chunks.length;){let u=this._chunks[r];i=0;t:for(;i<u.length;){switch(u[i]){case V_:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case G_:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=u.byteLength,r++}if(t!==4)return;let a=this._read(s+i),c=new Map,l=this.toString(a,"ascii").split(H_);if(l.length<2)return c;for(let u=0;u<l.length-2;u++){let p=l[u],d=p.indexOf(":");if(d===-1)throw new Error("Message header must separate key and value using :");let f=p.substr(0,d),g=p.substr(d+1).trim();c.set(e?f.toLowerCase():f,g)}return c}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],a=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,a}let t=this.allocNative(e),r=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let a=s.slice(0,e);t.set(a,r),r+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,r),r+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}},Uh=qh;o(qh,"AbstractMessageBuffer");Zl.AbstractMessageBuffer=Uh});var WT=w(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.createMessageConnection=se.ConnectionOptions=se.MessageStrategy=se.CancellationStrategy=se.CancellationSenderStrategy=se.CancellationReceiverStrategy=se.RequestCancellationReceiverStrategy=se.IdCancellationReceiverStrategy=se.ConnectionStrategy=se.ConnectionError=se.ConnectionErrors=se.LogTraceNotification=se.SetTraceNotification=se.TraceFormat=se.TraceValues=se.Trace=se.NullLogger=se.ProgressType=se.ProgressToken=void 0;var _T=gi(),ut=as(),ve=nh(),OT=sh(),Wa=ls(),$h=Xl(),ja;(function(n){n.type=new ve.NotificationType("$/cancelRequest")})(ja||(ja={}));var MT;(function(n){function e(t){return typeof t=="string"||typeof t=="number"}o(e,"is"),n.is=e})(MT=se.ProgressToken||(se.ProgressToken={}));var Ba;(function(n){n.type=new ve.NotificationType("$/progress")})(Ba||(Ba={}));var Xh=class{constructor(){}},Wh=Xh;o(Xh,"ProgressType");se.ProgressType=Wh;var Bh;(function(n){function e(t){return ut.func(t)}o(e,"is"),n.is=e})(Bh||(Bh={}));se.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Ke;(function(n){n[n.Off=0]="Off",n[n.Messages=1]="Messages",n[n.Compact=2]="Compact",n[n.Verbose=3]="Verbose"})(Ke=se.Trace||(se.Trace={}));var z_;(function(n){n.Off="off",n.Messages="messages",n.Compact="compact",n.Verbose="verbose"})(z_=se.TraceValues||(se.TraceValues={}));(function(n){function e(r){if(!ut.string(r))return n.Off;switch(r=r.toLowerCase(),r){case"off":return n.Off;case"messages":return n.Messages;case"compact":return n.Compact;case"verbose":return n.Verbose;default:return n.Off}}o(e,"fromString"),n.fromString=e;function t(r){switch(r){case n.Off:return"off";case n.Messages:return"messages";case n.Compact:return"compact";case n.Verbose:return"verbose";default:return"off"}}o(t,"toString"),n.toString=t})(Ke=se.Trace||(se.Trace={}));var Jn;(function(n){n.Text="text",n.JSON="json"})(Jn=se.TraceFormat||(se.TraceFormat={}));(function(n){function e(t){return ut.string(t)?(t=t.toLowerCase(),t==="json"?n.JSON:n.Text):n.Text}o(e,"fromString"),n.fromString=e})(Jn=se.TraceFormat||(se.TraceFormat={}));var UT;(function(n){n.type=new ve.NotificationType("$/setTrace")})(UT=se.SetTraceNotification||(se.SetTraceNotification={}));var jh;(function(n){n.type=new ve.NotificationType("$/logTrace")})(jh=se.LogTraceNotification||(se.LogTraceNotification={}));var eu;(function(n){n[n.Closed=1]="Closed",n[n.Disposed=2]="Disposed",n[n.AlreadyListening=3]="AlreadyListening"})(eu=se.ConnectionErrors||(se.ConnectionErrors={}));var tu=class extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,tu.prototype)}},ds=tu;o(tu,"ConnectionError");se.ConnectionError=ds;var qT;(function(n){function e(t){let r=t;return r&&ut.func(r.cancelUndispatched)}o(e,"is"),n.is=e})(qT=se.ConnectionStrategy||(se.ConnectionStrategy={}));var Hh;(function(n){function e(t){let r=t;return r&&(r.kind===void 0||r.kind==="id")&&ut.func(r.createCancellationTokenSource)&&(r.dispose===void 0||ut.func(r.dispose))}o(e,"is"),n.is=e})(Hh=se.IdCancellationReceiverStrategy||(se.IdCancellationReceiverStrategy={}));var $T;(function(n){function e(t){let r=t;return r&&r.kind==="request"&&ut.func(r.createCancellationTokenSource)&&(r.dispose===void 0||ut.func(r.dispose))}o(e,"is"),n.is=e})($T=se.RequestCancellationReceiverStrategy||(se.RequestCancellationReceiverStrategy={}));var Vh;(function(n){n.Message=Object.freeze({createCancellationTokenSource(t){return new $h.CancellationTokenSource}});function e(t){return Hh.is(t)||$T.is(t)}o(e,"is"),n.is=e})(Vh=se.CancellationReceiverStrategy||(se.CancellationReceiverStrategy={}));var Gh;(function(n){n.Message=Object.freeze({sendCancellation(t,r){return t.sendNotification(ja.type,{id:r})},cleanup(t){}});function e(t){let r=t;return r&&ut.func(r.sendCancellation)&&ut.func(r.cleanup)}o(e,"is"),n.is=e})(Gh=se.CancellationSenderStrategy||(se.CancellationSenderStrategy={}));var zh;(function(n){n.Message=Object.freeze({receiver:Vh.Message,sender:Gh.Message});function e(t){let r=t;return r&&Vh.is(r.receiver)&&Gh.is(r.sender)}o(e,"is"),n.is=e})(zh=se.CancellationStrategy||(se.CancellationStrategy={}));var Kh;(function(n){function e(t){let r=t;return r&&ut.func(r.handleMessage)}o(e,"is"),n.is=e})(Kh=se.MessageStrategy||(se.MessageStrategy={}));var K_;(function(n){function e(t){let r=t;return r&&(zh.is(r.cancellationStrategy)||qT.is(r.connectionStrategy)||Kh.is(r.messageStrategy))}o(e,"is"),n.is=e})(K_=se.ConnectionOptions||(se.ConnectionOptions={}));var Qn;(function(n){n[n.New=1]="New",n[n.Listening=2]="Listening",n[n.Closed=3]="Closed",n[n.Disposed=4]="Disposed"})(Qn||(Qn={}));function X_(n,e,t,r){let i=t!==void 0?t:se.NullLogger,s=0,a=0,c=0,l="2.0",u,p=new Map,d,f=new Map,g=new Map,h,T=new OT.LinkedMap,S=new Map,C=new Set,L=new Map,A=Ke.Off,W=Jn.Text,O,j=Qn.New,J=new Wa.Emitter,ie=new Wa.Emitter,z=new Wa.Emitter,M=new Wa.Emitter,B=new Wa.Emitter,Y=r&&r.cancellationStrategy?r.cancellationStrategy:zh.Message;function ae(I){if(I===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+I.toString()}o(ae,"createRequestQueueKey");function de(I){return I===null?"res-unknown-"+(++c).toString():"res-"+I.toString()}o(de,"createResponseQueueKey");function He(){return"not-"+(++a).toString()}o(He,"createNotificationQueueKey");function Je(I,q){ve.Message.isRequest(q)?I.set(ae(q.id),q):ve.Message.isResponse(q)?I.set(de(q.id),q):I.set(He(),q)}o(Je,"addMessageToQueue");function _(I){}o(_,"cancelUndispatched");function Ue(){return j===Qn.Listening}o(Ue,"isListening");function at(){return j===Qn.Closed}o(at,"isClosed");function nt(){return j===Qn.Disposed}o(nt,"isDisposed");function v(){(j===Qn.New||j===Qn.Listening)&&(j=Qn.Closed,ie.fire(void 0))}o(v,"closeHandler");function Hn(I){J.fire([I,void 0,void 0])}o(Hn,"readErrorHandler");function pi(I){J.fire(I)}o(pi,"writeErrorHandler"),n.onClose(v),n.onError(Hn),e.onClose(v),e.onError(pi);function di(){h||T.size===0||(h=(0,_T.default)().timer.setImmediate(()=>{h=void 0,ct()}))}o(di,"triggerMessageQueue");function qr(I){ve.Message.isRequest(I)?Hi(I):ve.Message.isNotification(I)?wa(I):ve.Message.isResponse(I)?Ko(I):zi(I)}o(qr,"handleMessage");function ct(){if(T.size===0)return;let I=T.shift();try{let q=r?.messageStrategy;Kh.is(q)?q.handleMessage(I,qr):qr(I)}finally{di()}}o(ct,"processMessageQueue");let Gi=o(I=>{try{if(ve.Message.isNotification(I)&&I.method===ja.type.method){let q=I.params.id,X=ae(q),ee=T.get(X);if(ve.Message.isRequest(ee)){let me=r?.connectionStrategy,Le=me&&me.cancelUndispatched?me.cancelUndispatched(ee,_):void 0;if(Le&&(Le.error!==void 0||Le.result!==void 0)){T.delete(X),L.delete(q),Le.id=ee.id,fi(Le,I.method,Date.now()),e.write(Le).catch(()=>i.error("Sending response for canceled message failed."));return}}let ke=L.get(q);if(ke!==void 0){ke.cancel(),Ki(I);return}else C.add(q)}Je(T,I)}finally{di()}},"callback");function Hi(I){if(nt())return;function q(Ie,Re,fe){let Ye={jsonrpc:l,id:I.id};Ie instanceof ve.ResponseError?Ye.error=Ie.toJson():Ye.result=Ie===void 0?null:Ie,fi(Ye,Re,fe),e.write(Ye).catch(()=>i.error("Sending response failed."))}o(q,"reply");function X(Ie,Re,fe){let Ye={jsonrpc:l,id:I.id,error:Ie.toJson()};fi(Ye,Re,fe),e.write(Ye).catch(()=>i.error("Sending response failed."))}o(X,"replyError");function ee(Ie,Re,fe){Ie===void 0&&(Ie=null);let Ye={jsonrpc:l,id:I.id,result:Ie};fi(Ye,Re,fe),e.write(Ye).catch(()=>i.error("Sending response failed."))}o(ee,"replySuccess"),Da(I);let ke=p.get(I.method),me,Le;ke&&(me=ke.type,Le=ke.handler);let qe=Date.now();if(Le||u){let Ie=I.id??String(Date.now()),Re=Hh.is(Y.receiver)?Y.receiver.createCancellationTokenSource(Ie):Y.receiver.createCancellationTokenSource(I);I.id!==null&&C.has(I.id)&&Re.cancel(),I.id!==null&&L.set(Ie,Re);try{let fe;if(Le)if(I.params===void 0){if(me!==void 0&&me.numberOfParams!==0){X(new ve.ResponseError(ve.ErrorCodes.InvalidParams,`Request ${I.method} defines ${me.numberOfParams} params but received none.`),I.method,qe);return}fe=Le(Re.token)}else if(Array.isArray(I.params)){if(me!==void 0&&me.parameterStructures===ve.ParameterStructures.byName){X(new ve.ResponseError(ve.ErrorCodes.InvalidParams,`Request ${I.method} defines parameters by name but received parameters by position`),I.method,qe);return}fe=Le(...I.params,Re.token)}else{if(me!==void 0&&me.parameterStructures===ve.ParameterStructures.byPosition){X(new ve.ResponseError(ve.ErrorCodes.InvalidParams,`Request ${I.method} defines parameters by position but received parameters by name`),I.method,qe);return}fe=Le(I.params,Re.token)}else u&&(fe=u(I.method,I.params,Re.token));let Ye=fe;fe?Ye.then?Ye.then(lt=>{L.delete(Ie),q(lt,I.method,qe)},lt=>{L.delete(Ie),lt instanceof ve.ResponseError?X(lt,I.method,qe):lt&&ut.string(lt.message)?X(new ve.ResponseError(ve.ErrorCodes.InternalError,`Request ${I.method} failed with message: ${lt.message}`),I.method,qe):X(new ve.ResponseError(ve.ErrorCodes.InternalError,`Request ${I.method} failed unexpectedly without providing any details.`),I.method,qe)}):(L.delete(Ie),q(fe,I.method,qe)):(L.delete(Ie),ee(fe,I.method,qe))}catch(fe){L.delete(Ie),fe instanceof ve.ResponseError?q(fe,I.method,qe):fe&&ut.string(fe.message)?X(new ve.ResponseError(ve.ErrorCodes.InternalError,`Request ${I.method} failed with message: ${fe.message}`),I.method,qe):X(new ve.ResponseError(ve.ErrorCodes.InternalError,`Request ${I.method} failed unexpectedly without providing any details.`),I.method,qe)}}else X(new ve.ResponseError(ve.ErrorCodes.MethodNotFound,`Unhandled method ${I.method}`),I.method,qe)}o(Hi,"handleRequest");function Ko(I){if(!nt())if(I.id===null)I.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(I.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let q=I.id,X=S.get(q);if(Jo(I,X),X!==void 0){S.delete(q);try{if(I.error){let ee=I.error;X.reject(new ve.ResponseError(ee.code,ee.message,ee.data))}else if(I.result!==void 0)X.resolve(I.result);else throw new Error("Should never happen.")}catch(ee){ee.message?i.error(`Response handler '${X.method}' failed with message: ${ee.message}`):i.error(`Response handler '${X.method}' failed unexpectedly.`)}}}}o(Ko,"handleResponse");function wa(I){if(nt())return;let q,X;if(I.method===ja.type.method){let ee=I.params.id;C.delete(ee),Ki(I);return}else{let ee=f.get(I.method);ee&&(X=ee.handler,q=ee.type)}if(X||d)try{if(Ki(I),X)if(I.params===void 0)q!==void 0&&q.numberOfParams!==0&&q.parameterStructures!==ve.ParameterStructures.byName&&i.error(`Notification ${I.method} defines ${q.numberOfParams} params but received none.`),X();else if(Array.isArray(I.params)){let ee=I.params;I.method===Ba.type.method&&ee.length===2&&MT.is(ee[0])?X({token:ee[0],value:ee[1]}):(q!==void 0&&(q.parameterStructures===ve.ParameterStructures.byName&&i.error(`Notification ${I.method} defines parameters by name but received parameters by position`),q.numberOfParams!==I.params.length&&i.error(`Notification ${I.method} defines ${q.numberOfParams} params but received ${ee.length} arguments`)),X(...ee))}else q!==void 0&&q.parameterStructures===ve.ParameterStructures.byPosition&&i.error(`Notification ${I.method} defines parameters by position but received parameters by name`),X(I.params);else d&&d(I.method,I.params)}catch(ee){ee.message?i.error(`Notification handler '${I.method}' failed with message: ${ee.message}`):i.error(`Notification handler '${I.method}' failed unexpectedly.`)}else z.fire(I)}o(wa,"handleNotification");function zi(I){if(!I){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(I,null,4)}`);let q=I;if(ut.string(q.id)||ut.number(q.id)){let X=q.id,ee=S.get(X);ee&&ee.reject(new Error("The received response has neither a result nor an error property."))}}o(zi,"handleInvalidMessage");function Fn(I){if(I!=null)switch(A){case Ke.Verbose:return JSON.stringify(I,null,4);case Ke.Compact:return JSON.stringify(I);default:return}}o(Fn,"stringifyTrace");function Fa(I){if(!(A===Ke.Off||!O))if(W===Jn.Text){let q;(A===Ke.Verbose||A===Ke.Compact)&&I.params&&(q=`Params: ${Fn(I.params)}

`),O.log(`Sending request '${I.method} - (${I.id})'.`,q)}else zn("send-request",I)}o(Fa,"traceSendingRequest");function Xo(I){if(!(A===Ke.Off||!O))if(W===Jn.Text){let q;(A===Ke.Verbose||A===Ke.Compact)&&(I.params?q=`Params: ${Fn(I.params)}

`:q=`No parameters provided.

`),O.log(`Sending notification '${I.method}'.`,q)}else zn("send-notification",I)}o(Xo,"traceSendingNotification");function fi(I,q,X){if(!(A===Ke.Off||!O))if(W===Jn.Text){let ee;(A===Ke.Verbose||A===Ke.Compact)&&(I.error&&I.error.data?ee=`Error data: ${Fn(I.error.data)}

`:I.result?ee=`Result: ${Fn(I.result)}

`:I.error===void 0&&(ee=`No result returned.

`)),O.log(`Sending response '${q} - (${I.id})'. Processing request took ${Date.now()-X}ms`,ee)}else zn("send-response",I)}o(fi,"traceSendingResponse");function Da(I){if(!(A===Ke.Off||!O))if(W===Jn.Text){let q;(A===Ke.Verbose||A===Ke.Compact)&&I.params&&(q=`Params: ${Fn(I.params)}

`),O.log(`Received request '${I.method} - (${I.id})'.`,q)}else zn("receive-request",I)}o(Da,"traceReceivedRequest");function Ki(I){if(!(A===Ke.Off||!O||I.method===jh.type.method))if(W===Jn.Text){let q;(A===Ke.Verbose||A===Ke.Compact)&&(I.params?q=`Params: ${Fn(I.params)}

`:q=`No parameters provided.

`),O.log(`Received notification '${I.method}'.`,q)}else zn("receive-notification",I)}o(Ki,"traceReceivedNotification");function Jo(I,q){if(!(A===Ke.Off||!O))if(W===Jn.Text){let X;if((A===Ke.Verbose||A===Ke.Compact)&&(I.error&&I.error.data?X=`Error data: ${Fn(I.error.data)}

`:I.result?X=`Result: ${Fn(I.result)}

`:I.error===void 0&&(X=`No result returned.

`)),q){let ee=I.error?` Request failed: ${I.error.message} (${I.error.code}).`:"";O.log(`Received response '${q.method} - (${I.id})' in ${Date.now()-q.timerStart}ms.${ee}`,X)}else O.log(`Received response ${I.id} without active response promise.`,X)}else zn("receive-response",I)}o(Jo,"traceReceivedResponse");function zn(I,q){if(!O||A===Ke.Off)return;let X={isLSPMessage:!0,type:I,message:q,timestamp:Date.now()};O.log(X)}o(zn,"logLSPMessage");function fr(){if(at())throw new ds(eu.Closed,"Connection is closed.");if(nt())throw new ds(eu.Disposed,"Connection is disposed.")}o(fr,"throwIfClosedOrDisposed");function Na(){if(Ue())throw new ds(eu.AlreadyListening,"Connection is already listening")}o(Na,"throwIfListening");function Qo(){if(!Ue())throw new Error("Call listen() first.")}o(Qo,"throwIfNotListening");function Dn(I){return I===void 0?null:I}o(Dn,"undefinedToNull");function Yo(I){if(I!==null)return I}o(Yo,"nullToUndefined");function Zo(I){return I!=null&&!Array.isArray(I)&&typeof I=="object"}o(Zo,"isNamedParam");function Xi(I,q){switch(I){case ve.ParameterStructures.auto:return Zo(q)?Yo(q):[Dn(q)];case ve.ParameterStructures.byName:if(!Zo(q))throw new Error("Received parameters by name but param is not an object literal.");return Yo(q);case ve.ParameterStructures.byPosition:return[Dn(q)];default:throw new Error(`Unknown parameter structure ${I.toString()}`)}}o(Xi,"computeSingleParam");function es(I,q){let X,ee=I.numberOfParams;switch(ee){case 0:X=void 0;break;case 1:X=Xi(I.parameterStructures,q[0]);break;default:X=[];for(let ke=0;ke<q.length&&ke<ee;ke++)X.push(Dn(q[ke]));if(q.length<ee)for(let ke=q.length;ke<ee;ke++)X.push(null);break}return X}o(es,"computeMessageParams");let mr={sendNotification:(I,...q)=>{fr();let X,ee;if(ut.string(I)){X=I;let me=q[0],Le=0,qe=ve.ParameterStructures.auto;ve.ParameterStructures.is(me)&&(Le=1,qe=me);let Ie=q.length,Re=Ie-Le;switch(Re){case 0:ee=void 0;break;case 1:ee=Xi(qe,q[Le]);break;default:if(qe===ve.ParameterStructures.byName)throw new Error(`Received ${Re} parameters for 'by Name' notification parameter structure.`);ee=q.slice(Le,Ie).map(fe=>Dn(fe));break}}else{let me=q;X=I.method,ee=es(I,me)}let ke={jsonrpc:l,method:X,params:ee};return Xo(ke),e.write(ke).catch(me=>{throw i.error("Sending notification failed."),me})},onNotification:(I,q)=>{fr();let X;return ut.func(I)?d=I:q&&(ut.string(I)?(X=I,f.set(I,{type:void 0,handler:q})):(X=I.method,f.set(I.method,{type:I,handler:q}))),{dispose:()=>{X!==void 0?f.delete(X):d=void 0}}},onProgress:(I,q,X)=>{if(g.has(q))throw new Error(`Progress handler for token ${q} already registered`);return g.set(q,X),{dispose:()=>{g.delete(q)}}},sendProgress:(I,q,X)=>mr.sendNotification(Ba.type,{token:q,value:X}),onUnhandledProgress:M.event,sendRequest:(I,...q)=>{fr(),Qo();let X,ee,ke;if(ut.string(I)){X=I;let Ie=q[0],Re=q[q.length-1],fe=0,Ye=ve.ParameterStructures.auto;ve.ParameterStructures.is(Ie)&&(fe=1,Ye=Ie);let lt=q.length;$h.CancellationToken.is(Re)&&(lt=lt-1,ke=Re);let Nn=lt-fe;switch(Nn){case 0:ee=void 0;break;case 1:ee=Xi(Ye,q[fe]);break;default:if(Ye===ve.ParameterStructures.byName)throw new Error(`Received ${Nn} parameters for 'by Name' request parameter structure.`);ee=q.slice(fe,lt).map(U=>Dn(U));break}}else{let Ie=q;X=I.method,ee=es(I,Ie);let Re=I.numberOfParams;ke=$h.CancellationToken.is(Ie[Re])?Ie[Re]:void 0}let me=s++,Le;ke&&(Le=ke.onCancellationRequested(()=>{let Ie=Y.sender.sendCancellation(mr,me);return Ie===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${me}`),Promise.resolve()):Ie.catch(()=>{i.log(`Sending cancellation messages for id ${me} failed`)})}));let qe={jsonrpc:l,id:me,method:X,params:ee};return Fa(qe),typeof Y.sender.enableCancellation=="function"&&Y.sender.enableCancellation(qe),new Promise(async(Ie,Re)=>{let fe=o(Nn=>{Ie(Nn),Y.sender.cleanup(me),Le?.dispose()},"resolveWithCleanup"),Ye=o(Nn=>{Re(Nn),Y.sender.cleanup(me),Le?.dispose()},"rejectWithCleanup"),lt={method:X,timerStart:Date.now(),resolve:fe,reject:Ye};try{await e.write(qe),S.set(me,lt)}catch(Nn){throw i.error("Sending request failed."),lt.reject(new ve.ResponseError(ve.ErrorCodes.MessageWriteError,Nn.message?Nn.message:"Unknown reason")),Nn}})},onRequest:(I,q)=>{fr();let X=null;return Bh.is(I)?(X=void 0,u=I):ut.string(I)?(X=null,q!==void 0&&(X=I,p.set(I,{handler:q,type:void 0}))):q!==void 0&&(X=I.method,p.set(I.method,{type:I,handler:q})),{dispose:()=>{X!==null&&(X!==void 0?p.delete(X):u=void 0)}}},hasPendingResponse:()=>S.size>0,trace:async(I,q,X)=>{let ee=!1,ke=Jn.Text;X!==void 0&&(ut.boolean(X)?ee=X:(ee=X.sendNotification||!1,ke=X.traceFormat||Jn.Text)),A=I,W=ke,A===Ke.Off?O=void 0:O=q,ee&&!at()&&!nt()&&await mr.sendNotification(UT.type,{value:Ke.toString(I)})},onError:J.event,onClose:ie.event,onUnhandledNotification:z.event,onDispose:B.event,end:()=>{e.end()},dispose:()=>{if(nt())return;j=Qn.Disposed,B.fire(void 0);let I=new ve.ResponseError(ve.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let q of S.values())q.reject(I);S=new Map,L=new Map,C=new Set,T=new OT.LinkedMap,ut.func(e.dispose)&&e.dispose(),ut.func(n.dispose)&&n.dispose()},listen:()=>{fr(),Na(),j=Qn.Listening,n.listen(Gi)},inspect:()=>{(0,_T.default)().console.log("inspect")}};return mr.onNotification(jh.type,I=>{if(A===Ke.Off||!O)return;let q=A===Ke.Verbose||A===Ke.Compact;O.log(I.message,q?I.verbose:void 0)}),mr.onNotification(Ba.type,I=>{let q=g.get(I.token);q?q(I.value):M.fire(I)}),mr}o(X_,"createMessageConnection");se.createMessageConnection=X_});var nu=w(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.ProgressType=V.ProgressToken=V.createMessageConnection=V.NullLogger=V.ConnectionOptions=V.ConnectionStrategy=V.AbstractMessageBuffer=V.WriteableStreamMessageWriter=V.AbstractMessageWriter=V.MessageWriter=V.ReadableStreamMessageReader=V.AbstractMessageReader=V.MessageReader=V.SharedArrayReceiverStrategy=V.SharedArraySenderStrategy=V.CancellationToken=V.CancellationTokenSource=V.Emitter=V.Event=V.Disposable=V.LRUCache=V.Touch=V.LinkedMap=V.ParameterStructures=V.NotificationType9=V.NotificationType8=V.NotificationType7=V.NotificationType6=V.NotificationType5=V.NotificationType4=V.NotificationType3=V.NotificationType2=V.NotificationType1=V.NotificationType0=V.NotificationType=V.ErrorCodes=V.ResponseError=V.RequestType9=V.RequestType8=V.RequestType7=V.RequestType6=V.RequestType5=V.RequestType4=V.RequestType3=V.RequestType2=V.RequestType1=V.RequestType0=V.RequestType=V.Message=V.RAL=void 0;V.MessageStrategy=V.CancellationStrategy=V.CancellationSenderStrategy=V.CancellationReceiverStrategy=V.ConnectionError=V.ConnectionErrors=V.LogTraceNotification=V.SetTraceNotification=V.TraceFormat=V.TraceValues=V.Trace=void 0;var et=nh();Object.defineProperty(V,"Message",{enumerable:!0,get:function(){return et.Message}});Object.defineProperty(V,"RequestType",{enumerable:!0,get:function(){return et.RequestType}});Object.defineProperty(V,"RequestType0",{enumerable:!0,get:function(){return et.RequestType0}});Object.defineProperty(V,"RequestType1",{enumerable:!0,get:function(){return et.RequestType1}});Object.defineProperty(V,"RequestType2",{enumerable:!0,get:function(){return et.RequestType2}});Object.defineProperty(V,"RequestType3",{enumerable:!0,get:function(){return et.RequestType3}});Object.defineProperty(V,"RequestType4",{enumerable:!0,get:function(){return et.RequestType4}});Object.defineProperty(V,"RequestType5",{enumerable:!0,get:function(){return et.RequestType5}});Object.defineProperty(V,"RequestType6",{enumerable:!0,get:function(){return et.RequestType6}});Object.defineProperty(V,"RequestType7",{enumerable:!0,get:function(){return et.RequestType7}});Object.defineProperty(V,"RequestType8",{enumerable:!0,get:function(){return et.RequestType8}});Object.defineProperty(V,"RequestType9",{enumerable:!0,get:function(){return et.RequestType9}});Object.defineProperty(V,"ResponseError",{enumerable:!0,get:function(){return et.ResponseError}});Object.defineProperty(V,"ErrorCodes",{enumerable:!0,get:function(){return et.ErrorCodes}});Object.defineProperty(V,"NotificationType",{enumerable:!0,get:function(){return et.NotificationType}});Object.defineProperty(V,"NotificationType0",{enumerable:!0,get:function(){return et.NotificationType0}});Object.defineProperty(V,"NotificationType1",{enumerable:!0,get:function(){return et.NotificationType1}});Object.defineProperty(V,"NotificationType2",{enumerable:!0,get:function(){return et.NotificationType2}});Object.defineProperty(V,"NotificationType3",{enumerable:!0,get:function(){return et.NotificationType3}});Object.defineProperty(V,"NotificationType4",{enumerable:!0,get:function(){return et.NotificationType4}});Object.defineProperty(V,"NotificationType5",{enumerable:!0,get:function(){return et.NotificationType5}});Object.defineProperty(V,"NotificationType6",{enumerable:!0,get:function(){return et.NotificationType6}});Object.defineProperty(V,"NotificationType7",{enumerable:!0,get:function(){return et.NotificationType7}});Object.defineProperty(V,"NotificationType8",{enumerable:!0,get:function(){return et.NotificationType8}});Object.defineProperty(V,"NotificationType9",{enumerable:!0,get:function(){return et.NotificationType9}});Object.defineProperty(V,"ParameterStructures",{enumerable:!0,get:function(){return et.ParameterStructures}});var Jh=sh();Object.defineProperty(V,"LinkedMap",{enumerable:!0,get:function(){return Jh.LinkedMap}});Object.defineProperty(V,"LRUCache",{enumerable:!0,get:function(){return Jh.LRUCache}});Object.defineProperty(V,"Touch",{enumerable:!0,get:function(){return Jh.Touch}});var J_=RT();Object.defineProperty(V,"Disposable",{enumerable:!0,get:function(){return J_.Disposable}});var BT=ls();Object.defineProperty(V,"Event",{enumerable:!0,get:function(){return BT.Event}});Object.defineProperty(V,"Emitter",{enumerable:!0,get:function(){return BT.Emitter}});var jT=Xl();Object.defineProperty(V,"CancellationTokenSource",{enumerable:!0,get:function(){return jT.CancellationTokenSource}});Object.defineProperty(V,"CancellationToken",{enumerable:!0,get:function(){return jT.CancellationToken}});var VT=AT();Object.defineProperty(V,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return VT.SharedArraySenderStrategy}});Object.defineProperty(V,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return VT.SharedArrayReceiverStrategy}});var Qh=LT();Object.defineProperty(V,"MessageReader",{enumerable:!0,get:function(){return Qh.MessageReader}});Object.defineProperty(V,"AbstractMessageReader",{enumerable:!0,get:function(){return Qh.AbstractMessageReader}});Object.defineProperty(V,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Qh.ReadableStreamMessageReader}});var Yh=DT();Object.defineProperty(V,"MessageWriter",{enumerable:!0,get:function(){return Yh.MessageWriter}});Object.defineProperty(V,"AbstractMessageWriter",{enumerable:!0,get:function(){return Yh.AbstractMessageWriter}});Object.defineProperty(V,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Yh.WriteableStreamMessageWriter}});var Q_=NT();Object.defineProperty(V,"AbstractMessageBuffer",{enumerable:!0,get:function(){return Q_.AbstractMessageBuffer}});var Wt=WT();Object.defineProperty(V,"ConnectionStrategy",{enumerable:!0,get:function(){return Wt.ConnectionStrategy}});Object.defineProperty(V,"ConnectionOptions",{enumerable:!0,get:function(){return Wt.ConnectionOptions}});Object.defineProperty(V,"NullLogger",{enumerable:!0,get:function(){return Wt.NullLogger}});Object.defineProperty(V,"createMessageConnection",{enumerable:!0,get:function(){return Wt.createMessageConnection}});Object.defineProperty(V,"ProgressToken",{enumerable:!0,get:function(){return Wt.ProgressToken}});Object.defineProperty(V,"ProgressType",{enumerable:!0,get:function(){return Wt.ProgressType}});Object.defineProperty(V,"Trace",{enumerable:!0,get:function(){return Wt.Trace}});Object.defineProperty(V,"TraceValues",{enumerable:!0,get:function(){return Wt.TraceValues}});Object.defineProperty(V,"TraceFormat",{enumerable:!0,get:function(){return Wt.TraceFormat}});Object.defineProperty(V,"SetTraceNotification",{enumerable:!0,get:function(){return Wt.SetTraceNotification}});Object.defineProperty(V,"LogTraceNotification",{enumerable:!0,get:function(){return Wt.LogTraceNotification}});Object.defineProperty(V,"ConnectionErrors",{enumerable:!0,get:function(){return Wt.ConnectionErrors}});Object.defineProperty(V,"ConnectionError",{enumerable:!0,get:function(){return Wt.ConnectionError}});Object.defineProperty(V,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Wt.CancellationReceiverStrategy}});Object.defineProperty(V,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Wt.CancellationSenderStrategy}});Object.defineProperty(V,"CancellationStrategy",{enumerable:!0,get:function(){return Wt.CancellationStrategy}});Object.defineProperty(V,"MessageStrategy",{enumerable:!0,get:function(){return Wt.MessageStrategy}});var Y_=gi();V.RAL=Y_.default});var zT=w(ng=>{"use strict";Object.defineProperty(ng,"__esModule",{value:!0});var GT=require("util"),Gr=nu(),iu=class extends Gr.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return iu.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new GT.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}},ru=iu;o(iu,"MessageBuffer");ru.emptyBuffer=Buffer.allocUnsafe(0);var rg=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Gr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Gr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Gr.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Gr.Disposable.create(()=>this.stream.off("data",e))}},Zh=rg;o(rg,"ReadableStreamWrapper");var ig=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Gr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Gr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Gr.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((r,i)=>{let s=o(a=>{a==null?r():i(a)},"callback");typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},eg=ig;o(ig,"WritableStreamWrapper");var HT=Object.freeze({messageBuffer:Object.freeze({create:n=>new ru(n)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(n,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(n,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(n,e)=>{try{return n instanceof Buffer?Promise.resolve(JSON.parse(n.toString(e.charset))):Promise.resolve(JSON.parse(new GT.TextDecoder(e.charset).decode(n)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:n=>new Zh(n),asWritableStream:n=>new eg(n)}),console,timer:Object.freeze({setTimeout(n,e,...t){let r=setTimeout(n,e,...t);return{dispose:()=>clearTimeout(r)}},setImmediate(n,...e){let t=setImmediate(n,...e);return{dispose:()=>clearImmediate(t)}},setInterval(n,e,...t){let r=setInterval(n,e,...t);return{dispose:()=>clearInterval(r)}}})});function tg(){return HT}o(tg,"RIL");(function(n){function e(){Gr.RAL.install(HT)}o(e,"install"),n.install=e})(tg||(tg={}));ng.default=tg});var oo=w(De=>{"use strict";var Z_=De&&De.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),eO=De&&De.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Z_(e,n,t)};Object.defineProperty(De,"__esModule",{value:!0});De.createMessageConnection=De.createServerSocketTransport=De.createClientSocketTransport=De.createServerPipeTransport=De.createClientPipeTransport=De.generateRandomPipeName=De.StreamMessageWriter=De.StreamMessageReader=De.SocketMessageWriter=De.SocketMessageReader=De.PortMessageWriter=De.PortMessageReader=De.IPCMessageWriter=De.IPCMessageReader=void 0;var fs=zT();fs.default.install();var KT=require("path"),tO=require("os"),nO=require("crypto"),au=require("net"),Sn=nu();eO(nu(),De);var lg=class extends Sn.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",r=>this.fireError(r)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),Sn.Disposable.create(()=>this.process.off("message",e))}},og=lg;o(lg,"IPCMessageReader");De.IPCMessageReader=og;var ug=class extends Sn.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",r=>this.fireError(r)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}},sg=ug;o(ug,"IPCMessageWriter");De.IPCMessageWriter=sg;var pg=class extends Sn.AbstractMessageReader{constructor(e){super(),this.onData=new Sn.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}},ag=pg;o(pg,"PortMessageReader");De.PortMessageReader=ag;var dg=class extends Sn.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}},cg=dg;o(dg,"PortMessageWriter");De.PortMessageWriter=cg;var fg=class extends Sn.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,fs.default)().stream.asReadableStream(e),t)}},ro=fg;o(fg,"SocketMessageReader");De.SocketMessageReader=ro;var mg=class extends Sn.WriteableStreamMessageWriter{constructor(e,t){super((0,fs.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}},io=mg;o(mg,"SocketMessageWriter");De.SocketMessageWriter=io;var hg=class extends Sn.ReadableStreamMessageReader{constructor(e,t){super((0,fs.default)().stream.asReadableStream(e),t)}},ou=hg;o(hg,"StreamMessageReader");De.StreamMessageReader=ou;var gg=class extends Sn.WriteableStreamMessageWriter{constructor(e,t){super((0,fs.default)().stream.asWritableStream(e),t)}},su=gg;o(gg,"StreamMessageWriter");De.StreamMessageWriter=su;var XT=process.env.XDG_RUNTIME_DIR,rO=new Map([["linux",107],["darwin",103]]);function iO(){let n=(0,nO.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${n}-sock`;let e;XT?e=KT.join(XT,`vscode-ipc-${n}.sock`):e=KT.join(tO.tmpdir(),`vscode-${n}.sock`);let t=rO.get(process.platform);return t!==void 0&&e.length>t&&(0,fs.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}o(iO,"generateRandomPipeName");De.generateRandomPipeName=iO;function oO(n,e="utf-8"){let t,r=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let a=(0,au.createServer)(c=>{a.close(),t([new ro(c,e),new io(c,e)])});a.on("error",s),a.listen(n,()=>{a.removeListener("error",s),i({onConnected:()=>r})})})}o(oO,"createClientPipeTransport");De.createClientPipeTransport=oO;function sO(n,e="utf-8"){let t=(0,au.createConnection)(n);return[new ro(t,e),new io(t,e)]}o(sO,"createServerPipeTransport");De.createServerPipeTransport=sO;function aO(n,e="utf-8"){let t,r=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let a=(0,au.createServer)(c=>{a.close(),t([new ro(c,e),new io(c,e)])});a.on("error",s),a.listen(n,"127.0.0.1",()=>{a.removeListener("error",s),i({onConnected:()=>r})})})}o(aO,"createClientSocketTransport");De.createClientSocketTransport=aO;function cO(n,e="utf-8"){let t=(0,au.createConnection)(n,"127.0.0.1");return[new ro(t,e),new io(t,e)]}o(cO,"createServerSocketTransport");De.createServerSocketTransport=cO;function lO(n){let e=n;return e.read!==void 0&&e.addListener!==void 0}o(lO,"isReadableStream");function uO(n){let e=n;return e.write!==void 0&&e.addListener!==void 0}o(uO,"isWritableStream");function pO(n,e,t,r){t||(t=Sn.NullLogger);let i=lO(n)?new ou(n):n,s=uO(e)?new su(e):e;return Sn.ConnectionStrategy.is(r)&&(r={connectionStrategy:r}),(0,Sn.createMessageConnection)(i,s,t,r)}o(pO,"createMessageConnection");De.createMessageConnection=pO});var bg=w((IX,JT)=>{"use strict";JT.exports=oo()});var lu=w((QT,cu)=>{(function(n){if(typeof cu=="object"&&typeof cu.exports=="object"){var e=n(require,QT);e!==void 0&&(cu.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],n)})(function(n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.WorkspaceFolder=e.InlayHint=e.InlayHintLabelPart=e.InlayHintKind=e.InlineValueContext=e.InlineValueEvaluatableExpression=e.InlineValueVariableLookup=e.InlineValueText=e.SemanticTokens=e.SemanticTokenModifiers=e.SemanticTokenTypes=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionTriggerKind=e.CodeActionKind=e.DocumentSymbol=e.WorkspaceSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.CompletionItemLabelDetails=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=e.URI=e.DocumentUri=void 0;var t;(function(y){function D(N){return typeof N=="string"}o(D,"is"),y.is=D})(t=e.DocumentUri||(e.DocumentUri={}));var r;(function(y){function D(N){return typeof N=="string"}o(D,"is"),y.is=D})(r=e.URI||(e.URI={}));var i;(function(y){y.MIN_VALUE=-2147483648,y.MAX_VALUE=2147483647;function D(N){return typeof N=="number"&&y.MIN_VALUE<=N&&N<=y.MAX_VALUE}o(D,"is"),y.is=D})(i=e.integer||(e.integer={}));var s;(function(y){y.MIN_VALUE=0,y.MAX_VALUE=2147483647;function D(N){return typeof N=="number"&&y.MIN_VALUE<=N&&N<=y.MAX_VALUE}o(D,"is"),y.is=D})(s=e.uinteger||(e.uinteger={}));var a;(function(y){function D(P,b){return P===Number.MAX_VALUE&&(P=s.MAX_VALUE),b===Number.MAX_VALUE&&(b=s.MAX_VALUE),{line:P,character:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&U.uinteger(b.line)&&U.uinteger(b.character)}o(N,"is"),y.is=N})(a=e.Position||(e.Position={}));var c;(function(y){function D(P,b,$,H){if(U.uinteger(P)&&U.uinteger(b)&&U.uinteger($)&&U.uinteger(H))return{start:a.create(P,b),end:a.create($,H)};if(a.is(P)&&a.is(b))return{start:P,end:b};throw new Error("Range#create called with invalid arguments[".concat(P,", ").concat(b,", ").concat($,", ").concat(H,"]"))}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&a.is(b.start)&&a.is(b.end)}o(N,"is"),y.is=N})(c=e.Range||(e.Range={}));var l;(function(y){function D(P,b){return{uri:P,range:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&c.is(b.range)&&(U.string(b.uri)||U.undefined(b.uri))}o(N,"is"),y.is=N})(l=e.Location||(e.Location={}));var u;(function(y){function D(P,b,$,H){return{targetUri:P,targetRange:b,targetSelectionRange:$,originSelectionRange:H}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&c.is(b.targetRange)&&U.string(b.targetUri)&&c.is(b.targetSelectionRange)&&(c.is(b.originSelectionRange)||U.undefined(b.originSelectionRange))}o(N,"is"),y.is=N})(u=e.LocationLink||(e.LocationLink={}));var p;(function(y){function D(P,b,$,H){return{red:P,green:b,blue:$,alpha:H}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&U.numberRange(b.red,0,1)&&U.numberRange(b.green,0,1)&&U.numberRange(b.blue,0,1)&&U.numberRange(b.alpha,0,1)}o(N,"is"),y.is=N})(p=e.Color||(e.Color={}));var d;(function(y){function D(P,b){return{range:P,color:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&c.is(b.range)&&p.is(b.color)}o(N,"is"),y.is=N})(d=e.ColorInformation||(e.ColorInformation={}));var f;(function(y){function D(P,b,$){return{label:P,textEdit:b,additionalTextEdits:$}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&U.string(b.label)&&(U.undefined(b.textEdit)||O.is(b))&&(U.undefined(b.additionalTextEdits)||U.typedArray(b.additionalTextEdits,O.is))}o(N,"is"),y.is=N})(f=e.ColorPresentation||(e.ColorPresentation={}));var g;(function(y){y.Comment="comment",y.Imports="imports",y.Region="region"})(g=e.FoldingRangeKind||(e.FoldingRangeKind={}));var h;(function(y){function D(P,b,$,H,Se,ft){var Ze={startLine:P,endLine:b};return U.defined($)&&(Ze.startCharacter=$),U.defined(H)&&(Ze.endCharacter=H),U.defined(Se)&&(Ze.kind=Se),U.defined(ft)&&(Ze.collapsedText=ft),Ze}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&U.uinteger(b.startLine)&&U.uinteger(b.startLine)&&(U.undefined(b.startCharacter)||U.uinteger(b.startCharacter))&&(U.undefined(b.endCharacter)||U.uinteger(b.endCharacter))&&(U.undefined(b.kind)||U.string(b.kind))}o(N,"is"),y.is=N})(h=e.FoldingRange||(e.FoldingRange={}));var T;(function(y){function D(P,b){return{location:P,message:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&l.is(b.location)&&U.string(b.message)}o(N,"is"),y.is=N})(T=e.DiagnosticRelatedInformation||(e.DiagnosticRelatedInformation={}));var S;(function(y){y.Error=1,y.Warning=2,y.Information=3,y.Hint=4})(S=e.DiagnosticSeverity||(e.DiagnosticSeverity={}));var C;(function(y){y.Unnecessary=1,y.Deprecated=2})(C=e.DiagnosticTag||(e.DiagnosticTag={}));var L;(function(y){function D(N){var P=N;return U.objectLiteral(P)&&U.string(P.href)}o(D,"is"),y.is=D})(L=e.CodeDescription||(e.CodeDescription={}));var A;(function(y){function D(P,b,$,H,Se,ft){var Ze={range:P,message:b};return U.defined($)&&(Ze.severity=$),U.defined(H)&&(Ze.code=H),U.defined(Se)&&(Ze.source=Se),U.defined(ft)&&(Ze.relatedInformation=ft),Ze}o(D,"create"),y.create=D;function N(P){var b,$=P;return U.defined($)&&c.is($.range)&&U.string($.message)&&(U.number($.severity)||U.undefined($.severity))&&(U.integer($.code)||U.string($.code)||U.undefined($.code))&&(U.undefined($.codeDescription)||U.string((b=$.codeDescription)===null||b===void 0?void 0:b.href))&&(U.string($.source)||U.undefined($.source))&&(U.undefined($.relatedInformation)||U.typedArray($.relatedInformation,T.is))}o(N,"is"),y.is=N})(A=e.Diagnostic||(e.Diagnostic={}));var W;(function(y){function D(P,b){for(var $=[],H=2;H<arguments.length;H++)$[H-2]=arguments[H];var Se={title:P,command:b};return U.defined($)&&$.length>0&&(Se.arguments=$),Se}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&U.string(b.title)&&U.string(b.command)}o(N,"is"),y.is=N})(W=e.Command||(e.Command={}));var O;(function(y){function D($,H){return{range:$,newText:H}}o(D,"replace"),y.replace=D;function N($,H){return{range:{start:$,end:$},newText:H}}o(N,"insert"),y.insert=N;function P($){return{range:$,newText:""}}o(P,"del"),y.del=P;function b($){var H=$;return U.objectLiteral(H)&&U.string(H.newText)&&c.is(H.range)}o(b,"is"),y.is=b})(O=e.TextEdit||(e.TextEdit={}));var j;(function(y){function D(P,b,$){var H={label:P};return b!==void 0&&(H.needsConfirmation=b),$!==void 0&&(H.description=$),H}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&U.string(b.label)&&(U.boolean(b.needsConfirmation)||b.needsConfirmation===void 0)&&(U.string(b.description)||b.description===void 0)}o(N,"is"),y.is=N})(j=e.ChangeAnnotation||(e.ChangeAnnotation={}));var J;(function(y){function D(N){var P=N;return U.string(P)}o(D,"is"),y.is=D})(J=e.ChangeAnnotationIdentifier||(e.ChangeAnnotationIdentifier={}));var ie;(function(y){function D($,H,Se){return{range:$,newText:H,annotationId:Se}}o(D,"replace"),y.replace=D;function N($,H,Se){return{range:{start:$,end:$},newText:H,annotationId:Se}}o(N,"insert"),y.insert=N;function P($,H){return{range:$,newText:"",annotationId:H}}o(P,"del"),y.del=P;function b($){var H=$;return O.is(H)&&(j.is(H.annotationId)||J.is(H.annotationId))}o(b,"is"),y.is=b})(ie=e.AnnotatedTextEdit||(e.AnnotatedTextEdit={}));var z;(function(y){function D(P,b){return{textDocument:P,edits:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&at.is(b.textDocument)&&Array.isArray(b.edits)}o(N,"is"),y.is=N})(z=e.TextDocumentEdit||(e.TextDocumentEdit={}));var M;(function(y){function D(P,b,$){var H={kind:"create",uri:P};return b!==void 0&&(b.overwrite!==void 0||b.ignoreIfExists!==void 0)&&(H.options=b),$!==void 0&&(H.annotationId=$),H}o(D,"create"),y.create=D;function N(P){var b=P;return b&&b.kind==="create"&&U.string(b.uri)&&(b.options===void 0||(b.options.overwrite===void 0||U.boolean(b.options.overwrite))&&(b.options.ignoreIfExists===void 0||U.boolean(b.options.ignoreIfExists)))&&(b.annotationId===void 0||J.is(b.annotationId))}o(N,"is"),y.is=N})(M=e.CreateFile||(e.CreateFile={}));var B;(function(y){function D(P,b,$,H){var Se={kind:"rename",oldUri:P,newUri:b};return $!==void 0&&($.overwrite!==void 0||$.ignoreIfExists!==void 0)&&(Se.options=$),H!==void 0&&(Se.annotationId=H),Se}o(D,"create"),y.create=D;function N(P){var b=P;return b&&b.kind==="rename"&&U.string(b.oldUri)&&U.string(b.newUri)&&(b.options===void 0||(b.options.overwrite===void 0||U.boolean(b.options.overwrite))&&(b.options.ignoreIfExists===void 0||U.boolean(b.options.ignoreIfExists)))&&(b.annotationId===void 0||J.is(b.annotationId))}o(N,"is"),y.is=N})(B=e.RenameFile||(e.RenameFile={}));var Y;(function(y){function D(P,b,$){var H={kind:"delete",uri:P};return b!==void 0&&(b.recursive!==void 0||b.ignoreIfNotExists!==void 0)&&(H.options=b),$!==void 0&&(H.annotationId=$),H}o(D,"create"),y.create=D;function N(P){var b=P;return b&&b.kind==="delete"&&U.string(b.uri)&&(b.options===void 0||(b.options.recursive===void 0||U.boolean(b.options.recursive))&&(b.options.ignoreIfNotExists===void 0||U.boolean(b.options.ignoreIfNotExists)))&&(b.annotationId===void 0||J.is(b.annotationId))}o(N,"is"),y.is=N})(Y=e.DeleteFile||(e.DeleteFile={}));var ae;(function(y){function D(N){var P=N;return P&&(P.changes!==void 0||P.documentChanges!==void 0)&&(P.documentChanges===void 0||P.documentChanges.every(function(b){return U.string(b.kind)?M.is(b)||B.is(b)||Y.is(b):z.is(b)}))}o(D,"is"),y.is=D})(ae=e.WorkspaceEdit||(e.WorkspaceEdit={}));var de=function(){function y(D,N){this.edits=D,this.changeAnnotations=N}return o(y,"TextEditChangeImpl"),y.prototype.insert=function(D,N,P){var b,$;if(P===void 0?b=O.insert(D,N):J.is(P)?($=P,b=ie.insert(D,N,P)):(this.assertChangeAnnotations(this.changeAnnotations),$=this.changeAnnotations.manage(P),b=ie.insert(D,N,$)),this.edits.push(b),$!==void 0)return $},y.prototype.replace=function(D,N,P){var b,$;if(P===void 0?b=O.replace(D,N):J.is(P)?($=P,b=ie.replace(D,N,P)):(this.assertChangeAnnotations(this.changeAnnotations),$=this.changeAnnotations.manage(P),b=ie.replace(D,N,$)),this.edits.push(b),$!==void 0)return $},y.prototype.delete=function(D,N){var P,b;if(N===void 0?P=O.del(D):J.is(N)?(b=N,P=ie.del(D,N)):(this.assertChangeAnnotations(this.changeAnnotations),b=this.changeAnnotations.manage(N),P=ie.del(D,b)),this.edits.push(P),b!==void 0)return b},y.prototype.add=function(D){this.edits.push(D)},y.prototype.all=function(){return this.edits},y.prototype.clear=function(){this.edits.splice(0,this.edits.length)},y.prototype.assertChangeAnnotations=function(D){if(D===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},y}(),He=function(){function y(D){this._annotations=D===void 0?Object.create(null):D,this._counter=0,this._size=0}return o(y,"ChangeAnnotations"),y.prototype.all=function(){return this._annotations},Object.defineProperty(y.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),y.prototype.manage=function(D,N){var P;if(J.is(D)?P=D:(P=this.nextId(),N=D),this._annotations[P]!==void 0)throw new Error("Id ".concat(P," is already in use."));if(N===void 0)throw new Error("No annotation provided for id ".concat(P));return this._annotations[P]=N,this._size++,P},y.prototype.nextId=function(){return this._counter++,this._counter.toString()},y}(),Je=function(){function y(D){var N=this;this._textEditChanges=Object.create(null),D!==void 0?(this._workspaceEdit=D,D.documentChanges?(this._changeAnnotations=new He(D.changeAnnotations),D.changeAnnotations=this._changeAnnotations.all(),D.documentChanges.forEach(function(P){if(z.is(P)){var b=new de(P.edits,N._changeAnnotations);N._textEditChanges[P.textDocument.uri]=b}})):D.changes&&Object.keys(D.changes).forEach(function(P){var b=new de(D.changes[P]);N._textEditChanges[P]=b})):this._workspaceEdit={}}return o(y,"WorkspaceChange"),Object.defineProperty(y.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),y.prototype.getTextEditChange=function(D){if(at.is(D)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var N={uri:D.uri,version:D.version},P=this._textEditChanges[N.uri];if(!P){var b=[],$={textDocument:N,edits:b};this._workspaceEdit.documentChanges.push($),P=new de(b,this._changeAnnotations),this._textEditChanges[N.uri]=P}return P}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var P=this._textEditChanges[D];if(!P){var b=[];this._workspaceEdit.changes[D]=b,P=new de(b),this._textEditChanges[D]=P}return P}},y.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new He,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},y.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},y.prototype.createFile=function(D,N,P){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var b;j.is(N)||J.is(N)?b=N:P=N;var $,H;if(b===void 0?$=M.create(D,P):(H=J.is(b)?b:this._changeAnnotations.manage(b),$=M.create(D,P,H)),this._workspaceEdit.documentChanges.push($),H!==void 0)return H},y.prototype.renameFile=function(D,N,P,b){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var $;j.is(P)||J.is(P)?$=P:b=P;var H,Se;if($===void 0?H=B.create(D,N,b):(Se=J.is($)?$:this._changeAnnotations.manage($),H=B.create(D,N,b,Se)),this._workspaceEdit.documentChanges.push(H),Se!==void 0)return Se},y.prototype.deleteFile=function(D,N,P){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var b;j.is(N)||J.is(N)?b=N:P=N;var $,H;if(b===void 0?$=Y.create(D,P):(H=J.is(b)?b:this._changeAnnotations.manage(b),$=Y.create(D,P,H)),this._workspaceEdit.documentChanges.push($),H!==void 0)return H},y}();e.WorkspaceChange=Je;var _;(function(y){function D(P){return{uri:P}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&U.string(b.uri)}o(N,"is"),y.is=N})(_=e.TextDocumentIdentifier||(e.TextDocumentIdentifier={}));var Ue;(function(y){function D(P,b){return{uri:P,version:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&U.string(b.uri)&&U.integer(b.version)}o(N,"is"),y.is=N})(Ue=e.VersionedTextDocumentIdentifier||(e.VersionedTextDocumentIdentifier={}));var at;(function(y){function D(P,b){return{uri:P,version:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&U.string(b.uri)&&(b.version===null||U.integer(b.version))}o(N,"is"),y.is=N})(at=e.OptionalVersionedTextDocumentIdentifier||(e.OptionalVersionedTextDocumentIdentifier={}));var nt;(function(y){function D(P,b,$,H){return{uri:P,languageId:b,version:$,text:H}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&U.string(b.uri)&&U.string(b.languageId)&&U.integer(b.version)&&U.string(b.text)}o(N,"is"),y.is=N})(nt=e.TextDocumentItem||(e.TextDocumentItem={}));var v;(function(y){y.PlainText="plaintext",y.Markdown="markdown";function D(N){var P=N;return P===y.PlainText||P===y.Markdown}o(D,"is"),y.is=D})(v=e.MarkupKind||(e.MarkupKind={}));var Hn;(function(y){function D(N){var P=N;return U.objectLiteral(N)&&v.is(P.kind)&&U.string(P.value)}o(D,"is"),y.is=D})(Hn=e.MarkupContent||(e.MarkupContent={}));var pi;(function(y){y.Text=1,y.Method=2,y.Function=3,y.Constructor=4,y.Field=5,y.Variable=6,y.Class=7,y.Interface=8,y.Module=9,y.Property=10,y.Unit=11,y.Value=12,y.Enum=13,y.Keyword=14,y.Snippet=15,y.Color=16,y.File=17,y.Reference=18,y.Folder=19,y.EnumMember=20,y.Constant=21,y.Struct=22,y.Event=23,y.Operator=24,y.TypeParameter=25})(pi=e.CompletionItemKind||(e.CompletionItemKind={}));var di;(function(y){y.PlainText=1,y.Snippet=2})(di=e.InsertTextFormat||(e.InsertTextFormat={}));var qr;(function(y){y.Deprecated=1})(qr=e.CompletionItemTag||(e.CompletionItemTag={}));var ct;(function(y){function D(P,b,$){return{newText:P,insert:b,replace:$}}o(D,"create"),y.create=D;function N(P){var b=P;return b&&U.string(b.newText)&&c.is(b.insert)&&c.is(b.replace)}o(N,"is"),y.is=N})(ct=e.InsertReplaceEdit||(e.InsertReplaceEdit={}));var Gi;(function(y){y.asIs=1,y.adjustIndentation=2})(Gi=e.InsertTextMode||(e.InsertTextMode={}));var Hi;(function(y){function D(N){var P=N;return P&&(U.string(P.detail)||P.detail===void 0)&&(U.string(P.description)||P.description===void 0)}o(D,"is"),y.is=D})(Hi=e.CompletionItemLabelDetails||(e.CompletionItemLabelDetails={}));var Ko;(function(y){function D(N){return{label:N}}o(D,"create"),y.create=D})(Ko=e.CompletionItem||(e.CompletionItem={}));var wa;(function(y){function D(N,P){return{items:N||[],isIncomplete:!!P}}o(D,"create"),y.create=D})(wa=e.CompletionList||(e.CompletionList={}));var zi;(function(y){function D(P){return P.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}o(D,"fromPlainText"),y.fromPlainText=D;function N(P){var b=P;return U.string(b)||U.objectLiteral(b)&&U.string(b.language)&&U.string(b.value)}o(N,"is"),y.is=N})(zi=e.MarkedString||(e.MarkedString={}));var Fn;(function(y){function D(N){var P=N;return!!P&&U.objectLiteral(P)&&(Hn.is(P.contents)||zi.is(P.contents)||U.typedArray(P.contents,zi.is))&&(N.range===void 0||c.is(N.range))}o(D,"is"),y.is=D})(Fn=e.Hover||(e.Hover={}));var Fa;(function(y){function D(N,P){return P?{label:N,documentation:P}:{label:N}}o(D,"create"),y.create=D})(Fa=e.ParameterInformation||(e.ParameterInformation={}));var Xo;(function(y){function D(N,P){for(var b=[],$=2;$<arguments.length;$++)b[$-2]=arguments[$];var H={label:N};return U.defined(P)&&(H.documentation=P),U.defined(b)?H.parameters=b:H.parameters=[],H}o(D,"create"),y.create=D})(Xo=e.SignatureInformation||(e.SignatureInformation={}));var fi;(function(y){y.Text=1,y.Read=2,y.Write=3})(fi=e.DocumentHighlightKind||(e.DocumentHighlightKind={}));var Da;(function(y){function D(N,P){var b={range:N};return U.number(P)&&(b.kind=P),b}o(D,"create"),y.create=D})(Da=e.DocumentHighlight||(e.DocumentHighlight={}));var Ki;(function(y){y.File=1,y.Module=2,y.Namespace=3,y.Package=4,y.Class=5,y.Method=6,y.Property=7,y.Field=8,y.Constructor=9,y.Enum=10,y.Interface=11,y.Function=12,y.Variable=13,y.Constant=14,y.String=15,y.Number=16,y.Boolean=17,y.Array=18,y.Object=19,y.Key=20,y.Null=21,y.EnumMember=22,y.Struct=23,y.Event=24,y.Operator=25,y.TypeParameter=26})(Ki=e.SymbolKind||(e.SymbolKind={}));var Jo;(function(y){y.Deprecated=1})(Jo=e.SymbolTag||(e.SymbolTag={}));var zn;(function(y){function D(N,P,b,$,H){var Se={name:N,kind:P,location:{uri:$,range:b}};return H&&(Se.containerName=H),Se}o(D,"create"),y.create=D})(zn=e.SymbolInformation||(e.SymbolInformation={}));var fr;(function(y){function D(N,P,b,$){return $!==void 0?{name:N,kind:P,location:{uri:b,range:$}}:{name:N,kind:P,location:{uri:b}}}o(D,"create"),y.create=D})(fr=e.WorkspaceSymbol||(e.WorkspaceSymbol={}));var Na;(function(y){function D(P,b,$,H,Se,ft){var Ze={name:P,detail:b,kind:$,range:H,selectionRange:Se};return ft!==void 0&&(Ze.children=ft),Ze}o(D,"create"),y.create=D;function N(P){var b=P;return b&&U.string(b.name)&&U.number(b.kind)&&c.is(b.range)&&c.is(b.selectionRange)&&(b.detail===void 0||U.string(b.detail))&&(b.deprecated===void 0||U.boolean(b.deprecated))&&(b.children===void 0||Array.isArray(b.children))&&(b.tags===void 0||Array.isArray(b.tags))}o(N,"is"),y.is=N})(Na=e.DocumentSymbol||(e.DocumentSymbol={}));var Qo;(function(y){y.Empty="",y.QuickFix="quickfix",y.Refactor="refactor",y.RefactorExtract="refactor.extract",y.RefactorInline="refactor.inline",y.RefactorRewrite="refactor.rewrite",y.Source="source",y.SourceOrganizeImports="source.organizeImports",y.SourceFixAll="source.fixAll"})(Qo=e.CodeActionKind||(e.CodeActionKind={}));var Dn;(function(y){y.Invoked=1,y.Automatic=2})(Dn=e.CodeActionTriggerKind||(e.CodeActionTriggerKind={}));var Yo;(function(y){function D(P,b,$){var H={diagnostics:P};return b!=null&&(H.only=b),$!=null&&(H.triggerKind=$),H}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&U.typedArray(b.diagnostics,A.is)&&(b.only===void 0||U.typedArray(b.only,U.string))&&(b.triggerKind===void 0||b.triggerKind===Dn.Invoked||b.triggerKind===Dn.Automatic)}o(N,"is"),y.is=N})(Yo=e.CodeActionContext||(e.CodeActionContext={}));var Zo;(function(y){function D(P,b,$){var H={title:P},Se=!0;return typeof b=="string"?(Se=!1,H.kind=b):W.is(b)?H.command=b:H.edit=b,Se&&$!==void 0&&(H.kind=$),H}o(D,"create"),y.create=D;function N(P){var b=P;return b&&U.string(b.title)&&(b.diagnostics===void 0||U.typedArray(b.diagnostics,A.is))&&(b.kind===void 0||U.string(b.kind))&&(b.edit!==void 0||b.command!==void 0)&&(b.command===void 0||W.is(b.command))&&(b.isPreferred===void 0||U.boolean(b.isPreferred))&&(b.edit===void 0||ae.is(b.edit))}o(N,"is"),y.is=N})(Zo=e.CodeAction||(e.CodeAction={}));var Xi;(function(y){function D(P,b){var $={range:P};return U.defined(b)&&($.data=b),$}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&c.is(b.range)&&(U.undefined(b.command)||W.is(b.command))}o(N,"is"),y.is=N})(Xi=e.CodeLens||(e.CodeLens={}));var es;(function(y){function D(P,b){return{tabSize:P,insertSpaces:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&U.uinteger(b.tabSize)&&U.boolean(b.insertSpaces)}o(N,"is"),y.is=N})(es=e.FormattingOptions||(e.FormattingOptions={}));var mr;(function(y){function D(P,b,$){return{range:P,target:b,data:$}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&c.is(b.range)&&(U.undefined(b.target)||U.string(b.target))}o(N,"is"),y.is=N})(mr=e.DocumentLink||(e.DocumentLink={}));var I;(function(y){function D(P,b){return{range:P,parent:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&c.is(b.range)&&(b.parent===void 0||y.is(b.parent))}o(N,"is"),y.is=N})(I=e.SelectionRange||(e.SelectionRange={}));var q;(function(y){y.namespace="namespace",y.type="type",y.class="class",y.enum="enum",y.interface="interface",y.struct="struct",y.typeParameter="typeParameter",y.parameter="parameter",y.variable="variable",y.property="property",y.enumMember="enumMember",y.event="event",y.function="function",y.method="method",y.macro="macro",y.keyword="keyword",y.modifier="modifier",y.comment="comment",y.string="string",y.number="number",y.regexp="regexp",y.operator="operator",y.decorator="decorator"})(q=e.SemanticTokenTypes||(e.SemanticTokenTypes={}));var X;(function(y){y.declaration="declaration",y.definition="definition",y.readonly="readonly",y.static="static",y.deprecated="deprecated",y.abstract="abstract",y.async="async",y.modification="modification",y.documentation="documentation",y.defaultLibrary="defaultLibrary"})(X=e.SemanticTokenModifiers||(e.SemanticTokenModifiers={}));var ee;(function(y){function D(N){var P=N;return U.objectLiteral(P)&&(P.resultId===void 0||typeof P.resultId=="string")&&Array.isArray(P.data)&&(P.data.length===0||typeof P.data[0]=="number")}o(D,"is"),y.is=D})(ee=e.SemanticTokens||(e.SemanticTokens={}));var ke;(function(y){function D(P,b){return{range:P,text:b}}o(D,"create"),y.create=D;function N(P){var b=P;return b!=null&&c.is(b.range)&&U.string(b.text)}o(N,"is"),y.is=N})(ke=e.InlineValueText||(e.InlineValueText={}));var me;(function(y){function D(P,b,$){return{range:P,variableName:b,caseSensitiveLookup:$}}o(D,"create"),y.create=D;function N(P){var b=P;return b!=null&&c.is(b.range)&&U.boolean(b.caseSensitiveLookup)&&(U.string(b.variableName)||b.variableName===void 0)}o(N,"is"),y.is=N})(me=e.InlineValueVariableLookup||(e.InlineValueVariableLookup={}));var Le;(function(y){function D(P,b){return{range:P,expression:b}}o(D,"create"),y.create=D;function N(P){var b=P;return b!=null&&c.is(b.range)&&(U.string(b.expression)||b.expression===void 0)}o(N,"is"),y.is=N})(Le=e.InlineValueEvaluatableExpression||(e.InlineValueEvaluatableExpression={}));var qe;(function(y){function D(P,b){return{frameId:P,stoppedLocation:b}}o(D,"create"),y.create=D;function N(P){var b=P;return U.defined(b)&&c.is(P.stoppedLocation)}o(N,"is"),y.is=N})(qe=e.InlineValueContext||(e.InlineValueContext={}));var Ie;(function(y){y.Type=1,y.Parameter=2;function D(N){return N===1||N===2}o(D,"is"),y.is=D})(Ie=e.InlayHintKind||(e.InlayHintKind={}));var Re;(function(y){function D(P){return{value:P}}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&(b.tooltip===void 0||U.string(b.tooltip)||Hn.is(b.tooltip))&&(b.location===void 0||l.is(b.location))&&(b.command===void 0||W.is(b.command))}o(N,"is"),y.is=N})(Re=e.InlayHintLabelPart||(e.InlayHintLabelPart={}));var fe;(function(y){function D(P,b,$){var H={position:P,label:b};return $!==void 0&&(H.kind=$),H}o(D,"create"),y.create=D;function N(P){var b=P;return U.objectLiteral(b)&&a.is(b.position)&&(U.string(b.label)||U.typedArray(b.label,Re.is))&&(b.kind===void 0||Ie.is(b.kind))&&b.textEdits===void 0||U.typedArray(b.textEdits,O.is)&&(b.tooltip===void 0||U.string(b.tooltip)||Hn.is(b.tooltip))&&(b.paddingLeft===void 0||U.boolean(b.paddingLeft))&&(b.paddingRight===void 0||U.boolean(b.paddingRight))}o(N,"is"),y.is=N})(fe=e.InlayHint||(e.InlayHint={}));var Ye;(function(y){function D(N){var P=N;return U.objectLiteral(P)&&r.is(P.uri)&&U.string(P.name)}o(D,"is"),y.is=D})(Ye=e.WorkspaceFolder||(e.WorkspaceFolder={})),e.EOL=[`
`,`\r
`,"\r"];var lt;(function(y){function D($,H,Se,ft){return new Nn($,H,Se,ft)}o(D,"create"),y.create=D;function N($){var H=$;return!!(U.defined(H)&&U.string(H.uri)&&(U.undefined(H.languageId)||U.string(H.languageId))&&U.uinteger(H.lineCount)&&U.func(H.getText)&&U.func(H.positionAt)&&U.func(H.offsetAt))}o(N,"is"),y.is=N;function P($,H){for(var Se=$.getText(),ft=b(H,function(ts,Nl){var cT=ts.range.start.line-Nl.range.start.line;return cT===0?ts.range.start.character-Nl.range.start.character:cT}),Ze=Se.length,Kn=ft.length-1;Kn>=0;Kn--){var Xn=ft[Kn],$r=$.offsetAt(Xn.range.start),Fe=$.offsetAt(Xn.range.end);if(Fe<=Ze)Se=Se.substring(0,$r)+Xn.newText+Se.substring(Fe,Se.length);else throw new Error("Overlapping edit");Ze=$r}return Se}o(P,"applyEdits"),y.applyEdits=P;function b($,H){if($.length<=1)return $;var Se=$.length/2|0,ft=$.slice(0,Se),Ze=$.slice(Se);b(ft,H),b(Ze,H);for(var Kn=0,Xn=0,$r=0;Kn<ft.length&&Xn<Ze.length;){var Fe=H(ft[Kn],Ze[Xn]);Fe<=0?$[$r++]=ft[Kn++]:$[$r++]=Ze[Xn++]}for(;Kn<ft.length;)$[$r++]=ft[Kn++];for(;Xn<Ze.length;)$[$r++]=Ze[Xn++];return $}o(b,"mergeSort")})(lt=e.TextDocument||(e.TextDocument={}));var Nn=function(){function y(D,N,P,b){this._uri=D,this._languageId=N,this._version=P,this._content=b,this._lineOffsets=void 0}return o(y,"FullTextDocument"),Object.defineProperty(y.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),y.prototype.getText=function(D){if(D){var N=this.offsetAt(D.start),P=this.offsetAt(D.end);return this._content.substring(N,P)}return this._content},y.prototype.update=function(D,N){this._content=D.text,this._version=N,this._lineOffsets=void 0},y.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var D=[],N=this._content,P=!0,b=0;b<N.length;b++){P&&(D.push(b),P=!1);var $=N.charAt(b);P=$==="\r"||$===`
`,$==="\r"&&b+1<N.length&&N.charAt(b+1)===`
`&&b++}P&&N.length>0&&D.push(N.length),this._lineOffsets=D}return this._lineOffsets},y.prototype.positionAt=function(D){D=Math.max(Math.min(D,this._content.length),0);var N=this.getLineOffsets(),P=0,b=N.length;if(b===0)return a.create(0,D);for(;P<b;){var $=Math.floor((P+b)/2);N[$]>D?b=$:P=$+1}var H=P-1;return a.create(H,D-N[H])},y.prototype.offsetAt=function(D){var N=this.getLineOffsets();if(D.line>=N.length)return this._content.length;if(D.line<0)return 0;var P=N[D.line],b=D.line+1<N.length?N[D.line+1]:this._content.length;return Math.max(Math.min(P+D.character,b),P)},Object.defineProperty(y.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),y}(),U;(function(y){var D=Object.prototype.toString;function N(Fe){return typeof Fe<"u"}o(N,"defined"),y.defined=N;function P(Fe){return typeof Fe>"u"}o(P,"undefined"),y.undefined=P;function b(Fe){return Fe===!0||Fe===!1}o(b,"boolean"),y.boolean=b;function $(Fe){return D.call(Fe)==="[object String]"}o($,"string"),y.string=$;function H(Fe){return D.call(Fe)==="[object Number]"}o(H,"number"),y.number=H;function Se(Fe,ts,Nl){return D.call(Fe)==="[object Number]"&&ts<=Fe&&Fe<=Nl}o(Se,"numberRange"),y.numberRange=Se;function ft(Fe){return D.call(Fe)==="[object Number]"&&-2147483648<=Fe&&Fe<=2147483647}o(ft,"integer"),y.integer=ft;function Ze(Fe){return D.call(Fe)==="[object Number]"&&0<=Fe&&Fe<=2147483647}o(Ze,"uinteger"),y.uinteger=Ze;function Kn(Fe){return D.call(Fe)==="[object Function]"}o(Kn,"func"),y.func=Kn;function Xn(Fe){return Fe!==null&&typeof Fe=="object"}o(Xn,"objectLiteral"),y.objectLiteral=Xn;function $r(Fe,ts){return Array.isArray(Fe)&&Fe.every(ts)}o($r,"typedArray"),y.typedArray=$r})(U||(U={}))})});var pt=w(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.ProtocolNotificationType=cn.ProtocolNotificationType0=cn.ProtocolRequestType=cn.ProtocolRequestType0=cn.RegistrationType=cn.MessageDirection=void 0;var ms=oo(),dO;(function(n){n.clientToServer="clientToServer",n.serverToClient="serverToClient",n.both="both"})(dO=cn.MessageDirection||(cn.MessageDirection={}));var Tg=class{constructor(e){this.method=e}},vg=Tg;o(Tg,"RegistrationType");cn.RegistrationType=vg;var kg=class extends ms.RequestType0{constructor(e){super(e)}},yg=kg;o(kg,"ProtocolRequestType0");cn.ProtocolRequestType0=yg;var Cg=class extends ms.RequestType{constructor(e){super(e,ms.ParameterStructures.byName)}},Ig=Cg;o(Cg,"ProtocolRequestType");cn.ProtocolRequestType=Ig;var Pg=class extends ms.NotificationType0{constructor(e){super(e)}},xg=Pg;o(Pg,"ProtocolNotificationType0");cn.ProtocolNotificationType0=xg;var Rg=class extends ms.NotificationType{constructor(e){super(e,ms.ParameterStructures.byName)}},Sg=Rg;o(Rg,"ProtocolNotificationType");cn.ProtocolNotificationType=Sg});var uu=w(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.objectLiteral=Tt.typedArray=Tt.stringArray=Tt.array=Tt.func=Tt.error=Tt.number=Tt.string=Tt.boolean=void 0;function fO(n){return n===!0||n===!1}o(fO,"boolean");Tt.boolean=fO;function YT(n){return typeof n=="string"||n instanceof String}o(YT,"string");Tt.string=YT;function mO(n){return typeof n=="number"||n instanceof Number}o(mO,"number");Tt.number=mO;function hO(n){return n instanceof Error}o(hO,"error");Tt.error=hO;function gO(n){return typeof n=="function"}o(gO,"func");Tt.func=gO;function ZT(n){return Array.isArray(n)}o(ZT,"array");Tt.array=ZT;function bO(n){return ZT(n)&&n.every(e=>YT(e))}o(bO,"stringArray");Tt.stringArray=bO;function vO(n,e){return Array.isArray(n)&&n.every(e)}o(vO,"typedArray");Tt.typedArray=vO;function yO(n){return n!==null&&typeof n=="object"}o(yO,"objectLiteral");Tt.objectLiteral=yO});var tk=w(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.ImplementationRequest=void 0;var ek=pt(),IO;(function(n){n.method="textDocument/implementation",n.messageDirection=ek.MessageDirection.clientToServer,n.type=new ek.ProtocolRequestType(n.method)})(IO=Va.ImplementationRequest||(Va.ImplementationRequest={}))});var rk=w(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.TypeDefinitionRequest=void 0;var nk=pt(),xO;(function(n){n.method="textDocument/typeDefinition",n.messageDirection=nk.MessageDirection.clientToServer,n.type=new nk.ProtocolRequestType(n.method)})(xO=Ga.TypeDefinitionRequest||(Ga.TypeDefinitionRequest={}))});var ik=w(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});bi.DidChangeWorkspaceFoldersNotification=bi.WorkspaceFoldersRequest=void 0;var pu=pt(),SO;(function(n){n.method="workspace/workspaceFolders",n.messageDirection=pu.MessageDirection.serverToClient,n.type=new pu.ProtocolRequestType0(n.method)})(SO=bi.WorkspaceFoldersRequest||(bi.WorkspaceFoldersRequest={}));var TO;(function(n){n.method="workspace/didChangeWorkspaceFolders",n.messageDirection=pu.MessageDirection.clientToServer,n.type=new pu.ProtocolNotificationType(n.method)})(TO=bi.DidChangeWorkspaceFoldersNotification||(bi.DidChangeWorkspaceFoldersNotification={}))});var sk=w(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.ConfigurationRequest=void 0;var ok=pt(),kO;(function(n){n.method="workspace/configuration",n.messageDirection=ok.MessageDirection.serverToClient,n.type=new ok.ProtocolRequestType(n.method)})(kO=Ha.ConfigurationRequest||(Ha.ConfigurationRequest={}))});var ak=w(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.ColorPresentationRequest=vi.DocumentColorRequest=void 0;var du=pt(),CO;(function(n){n.method="textDocument/documentColor",n.messageDirection=du.MessageDirection.clientToServer,n.type=new du.ProtocolRequestType(n.method)})(CO=vi.DocumentColorRequest||(vi.DocumentColorRequest={}));var PO;(function(n){n.method="textDocument/colorPresentation",n.messageDirection=du.MessageDirection.clientToServer,n.type=new du.ProtocolRequestType(n.method)})(PO=vi.ColorPresentationRequest||(vi.ColorPresentationRequest={}))});var lk=w(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.FoldingRangeRequest=void 0;var ck=pt(),RO;(function(n){n.method="textDocument/foldingRange",n.messageDirection=ck.MessageDirection.clientToServer,n.type=new ck.ProtocolRequestType(n.method)})(RO=za.FoldingRangeRequest||(za.FoldingRangeRequest={}))});var pk=w(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});Ka.DeclarationRequest=void 0;var uk=pt(),AO;(function(n){n.method="textDocument/declaration",n.messageDirection=uk.MessageDirection.clientToServer,n.type=new uk.ProtocolRequestType(n.method)})(AO=Ka.DeclarationRequest||(Ka.DeclarationRequest={}))});var fk=w(Xa=>{"use strict";Object.defineProperty(Xa,"__esModule",{value:!0});Xa.SelectionRangeRequest=void 0;var dk=pt(),LO;(function(n){n.method="textDocument/selectionRange",n.messageDirection=dk.MessageDirection.clientToServer,n.type=new dk.ProtocolRequestType(n.method)})(LO=Xa.SelectionRangeRequest||(Xa.SelectionRangeRequest={}))});var mk=w(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.WorkDoneProgressCancelNotification=Yn.WorkDoneProgressCreateRequest=Yn.WorkDoneProgress=void 0;var EO=oo(),fu=pt(),wO;(function(n){n.type=new EO.ProgressType;function e(t){return t===n.type}o(e,"is"),n.is=e})(wO=Yn.WorkDoneProgress||(Yn.WorkDoneProgress={}));var FO;(function(n){n.method="window/workDoneProgress/create",n.messageDirection=fu.MessageDirection.serverToClient,n.type=new fu.ProtocolRequestType(n.method)})(FO=Yn.WorkDoneProgressCreateRequest||(Yn.WorkDoneProgressCreateRequest={}));var DO;(function(n){n.method="window/workDoneProgress/cancel",n.messageDirection=fu.MessageDirection.clientToServer,n.type=new fu.ProtocolNotificationType(n.method)})(DO=Yn.WorkDoneProgressCancelNotification||(Yn.WorkDoneProgressCancelNotification={}))});var hk=w(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.CallHierarchyOutgoingCallsRequest=Zn.CallHierarchyIncomingCallsRequest=Zn.CallHierarchyPrepareRequest=void 0;var hs=pt(),NO;(function(n){n.method="textDocument/prepareCallHierarchy",n.messageDirection=hs.MessageDirection.clientToServer,n.type=new hs.ProtocolRequestType(n.method)})(NO=Zn.CallHierarchyPrepareRequest||(Zn.CallHierarchyPrepareRequest={}));var _O;(function(n){n.method="callHierarchy/incomingCalls",n.messageDirection=hs.MessageDirection.clientToServer,n.type=new hs.ProtocolRequestType(n.method)})(_O=Zn.CallHierarchyIncomingCallsRequest||(Zn.CallHierarchyIncomingCallsRequest={}));var OO;(function(n){n.method="callHierarchy/outgoingCalls",n.messageDirection=hs.MessageDirection.clientToServer,n.type=new hs.ProtocolRequestType(n.method)})(OO=Zn.CallHierarchyOutgoingCallsRequest||(Zn.CallHierarchyOutgoingCallsRequest={}))});var gk=w(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.SemanticTokensRefreshRequest=kt.SemanticTokensRangeRequest=kt.SemanticTokensDeltaRequest=kt.SemanticTokensRequest=kt.SemanticTokensRegistrationType=kt.TokenFormat=void 0;var Hr=pt(),MO;(function(n){n.Relative="relative"})(MO=kt.TokenFormat||(kt.TokenFormat={}));var mu;(function(n){n.method="textDocument/semanticTokens",n.type=new Hr.RegistrationType(n.method)})(mu=kt.SemanticTokensRegistrationType||(kt.SemanticTokensRegistrationType={}));var UO;(function(n){n.method="textDocument/semanticTokens/full",n.messageDirection=Hr.MessageDirection.clientToServer,n.type=new Hr.ProtocolRequestType(n.method),n.registrationMethod=mu.method})(UO=kt.SemanticTokensRequest||(kt.SemanticTokensRequest={}));var qO;(function(n){n.method="textDocument/semanticTokens/full/delta",n.messageDirection=Hr.MessageDirection.clientToServer,n.type=new Hr.ProtocolRequestType(n.method),n.registrationMethod=mu.method})(qO=kt.SemanticTokensDeltaRequest||(kt.SemanticTokensDeltaRequest={}));var $O;(function(n){n.method="textDocument/semanticTokens/range",n.messageDirection=Hr.MessageDirection.clientToServer,n.type=new Hr.ProtocolRequestType(n.method),n.registrationMethod=mu.method})($O=kt.SemanticTokensRangeRequest||(kt.SemanticTokensRangeRequest={}));var WO;(function(n){n.method="workspace/semanticTokens/refresh",n.messageDirection=Hr.MessageDirection.serverToClient,n.type=new Hr.ProtocolRequestType0(n.method)})(WO=kt.SemanticTokensRefreshRequest||(kt.SemanticTokensRefreshRequest={}))});var vk=w(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});Ja.ShowDocumentRequest=void 0;var bk=pt(),BO;(function(n){n.method="window/showDocument",n.messageDirection=bk.MessageDirection.serverToClient,n.type=new bk.ProtocolRequestType(n.method)})(BO=Ja.ShowDocumentRequest||(Ja.ShowDocumentRequest={}))});var Ik=w(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.LinkedEditingRangeRequest=void 0;var yk=pt(),jO;(function(n){n.method="textDocument/linkedEditingRange",n.messageDirection=yk.MessageDirection.clientToServer,n.type=new yk.ProtocolRequestType(n.method)})(jO=Qa.LinkedEditingRangeRequest||(Qa.LinkedEditingRangeRequest={}))});var xk=w(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.WillDeleteFilesRequest=dt.DidDeleteFilesNotification=dt.DidRenameFilesNotification=dt.WillRenameFilesRequest=dt.DidCreateFilesNotification=dt.WillCreateFilesRequest=dt.FileOperationPatternKind=void 0;var _n=pt(),VO;(function(n){n.file="file",n.folder="folder"})(VO=dt.FileOperationPatternKind||(dt.FileOperationPatternKind={}));var GO;(function(n){n.method="workspace/willCreateFiles",n.messageDirection=_n.MessageDirection.clientToServer,n.type=new _n.ProtocolRequestType(n.method)})(GO=dt.WillCreateFilesRequest||(dt.WillCreateFilesRequest={}));var HO;(function(n){n.method="workspace/didCreateFiles",n.messageDirection=_n.MessageDirection.clientToServer,n.type=new _n.ProtocolNotificationType(n.method)})(HO=dt.DidCreateFilesNotification||(dt.DidCreateFilesNotification={}));var zO;(function(n){n.method="workspace/willRenameFiles",n.messageDirection=_n.MessageDirection.clientToServer,n.type=new _n.ProtocolRequestType(n.method)})(zO=dt.WillRenameFilesRequest||(dt.WillRenameFilesRequest={}));var KO;(function(n){n.method="workspace/didRenameFiles",n.messageDirection=_n.MessageDirection.clientToServer,n.type=new _n.ProtocolNotificationType(n.method)})(KO=dt.DidRenameFilesNotification||(dt.DidRenameFilesNotification={}));var XO;(function(n){n.method="workspace/didDeleteFiles",n.messageDirection=_n.MessageDirection.clientToServer,n.type=new _n.ProtocolNotificationType(n.method)})(XO=dt.DidDeleteFilesNotification||(dt.DidDeleteFilesNotification={}));var JO;(function(n){n.method="workspace/willDeleteFiles",n.messageDirection=_n.MessageDirection.clientToServer,n.type=new _n.ProtocolRequestType(n.method)})(JO=dt.WillDeleteFilesRequest||(dt.WillDeleteFilesRequest={}))});var Tk=w(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.MonikerRequest=er.MonikerKind=er.UniquenessLevel=void 0;var Sk=pt(),QO;(function(n){n.document="document",n.project="project",n.group="group",n.scheme="scheme",n.global="global"})(QO=er.UniquenessLevel||(er.UniquenessLevel={}));var YO;(function(n){n.$import="import",n.$export="export",n.local="local"})(YO=er.MonikerKind||(er.MonikerKind={}));var ZO;(function(n){n.method="textDocument/moniker",n.messageDirection=Sk.MessageDirection.clientToServer,n.type=new Sk.ProtocolRequestType(n.method)})(ZO=er.MonikerRequest||(er.MonikerRequest={}))});var kk=w(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.TypeHierarchySubtypesRequest=tr.TypeHierarchySupertypesRequest=tr.TypeHierarchyPrepareRequest=void 0;var gs=pt(),eM;(function(n){n.method="textDocument/prepareTypeHierarchy",n.messageDirection=gs.MessageDirection.clientToServer,n.type=new gs.ProtocolRequestType(n.method)})(eM=tr.TypeHierarchyPrepareRequest||(tr.TypeHierarchyPrepareRequest={}));var tM;(function(n){n.method="typeHierarchy/supertypes",n.messageDirection=gs.MessageDirection.clientToServer,n.type=new gs.ProtocolRequestType(n.method)})(tM=tr.TypeHierarchySupertypesRequest||(tr.TypeHierarchySupertypesRequest={}));var nM;(function(n){n.method="typeHierarchy/subtypes",n.messageDirection=gs.MessageDirection.clientToServer,n.type=new gs.ProtocolRequestType(n.method)})(nM=tr.TypeHierarchySubtypesRequest||(tr.TypeHierarchySubtypesRequest={}))});var Ck=w(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.InlineValueRefreshRequest=yi.InlineValueRequest=void 0;var hu=pt(),rM;(function(n){n.method="textDocument/inlineValue",n.messageDirection=hu.MessageDirection.clientToServer,n.type=new hu.ProtocolRequestType(n.method)})(rM=yi.InlineValueRequest||(yi.InlineValueRequest={}));var iM;(function(n){n.method="workspace/inlineValue/refresh",n.messageDirection=hu.MessageDirection.serverToClient,n.type=new hu.ProtocolRequestType0(n.method)})(iM=yi.InlineValueRefreshRequest||(yi.InlineValueRefreshRequest={}))});var Pk=w(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.InlayHintRefreshRequest=nr.InlayHintResolveRequest=nr.InlayHintRequest=void 0;var bs=pt(),oM;(function(n){n.method="textDocument/inlayHint",n.messageDirection=bs.MessageDirection.clientToServer,n.type=new bs.ProtocolRequestType(n.method)})(oM=nr.InlayHintRequest||(nr.InlayHintRequest={}));var sM;(function(n){n.method="inlayHint/resolve",n.messageDirection=bs.MessageDirection.clientToServer,n.type=new bs.ProtocolRequestType(n.method)})(sM=nr.InlayHintResolveRequest||(nr.InlayHintResolveRequest={}));var aM;(function(n){n.method="workspace/inlayHint/refresh",n.messageDirection=bs.MessageDirection.serverToClient,n.type=new bs.ProtocolRequestType0(n.method)})(aM=nr.InlayHintRefreshRequest||(nr.InlayHintRefreshRequest={}))});var Ak=w(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.DiagnosticRefreshRequest=Bt.WorkspaceDiagnosticRequest=Bt.DocumentDiagnosticRequest=Bt.DocumentDiagnosticReportKind=Bt.DiagnosticServerCancellationData=void 0;var Rk=oo(),cM=uu(),vs=pt(),lM;(function(n){function e(t){let r=t;return r&&cM.boolean(r.retriggerRequest)}o(e,"is"),n.is=e})(lM=Bt.DiagnosticServerCancellationData||(Bt.DiagnosticServerCancellationData={}));var uM;(function(n){n.Full="full",n.Unchanged="unchanged"})(uM=Bt.DocumentDiagnosticReportKind||(Bt.DocumentDiagnosticReportKind={}));var pM;(function(n){n.method="textDocument/diagnostic",n.messageDirection=vs.MessageDirection.clientToServer,n.type=new vs.ProtocolRequestType(n.method),n.partialResult=new Rk.ProgressType})(pM=Bt.DocumentDiagnosticRequest||(Bt.DocumentDiagnosticRequest={}));var dM;(function(n){n.method="workspace/diagnostic",n.messageDirection=vs.MessageDirection.clientToServer,n.type=new vs.ProtocolRequestType(n.method),n.partialResult=new Rk.ProgressType})(dM=Bt.WorkspaceDiagnosticRequest||(Bt.WorkspaceDiagnosticRequest={}));var fM;(function(n){n.method="workspace/diagnostic/refresh",n.messageDirection=vs.MessageDirection.serverToClient,n.type=new vs.ProtocolRequestType0(n.method)})(fM=Bt.DiagnosticRefreshRequest||(Bt.DiagnosticRefreshRequest={}))});var wk=w(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.DidCloseNotebookDocumentNotification=_e.DidSaveNotebookDocumentNotification=_e.DidChangeNotebookDocumentNotification=_e.NotebookCellArrayChange=_e.DidOpenNotebookDocumentNotification=_e.NotebookDocumentSyncRegistrationType=_e.NotebookDocument=_e.NotebookCell=_e.ExecutionSummary=_e.NotebookCellKind=void 0;var Ya=lu(),rr=uu(),gr=pt(),Lk;(function(n){n.Markup=1,n.Code=2;function e(t){return t===1||t===2}o(e,"is"),n.is=e})(Lk=_e.NotebookCellKind||(_e.NotebookCellKind={}));var Ek;(function(n){function e(i,s){let a={executionOrder:i};return(s===!0||s===!1)&&(a.success=s),a}o(e,"create"),n.create=e;function t(i){let s=i;return rr.objectLiteral(s)&&Ya.uinteger.is(s.executionOrder)&&(s.success===void 0||rr.boolean(s.success))}o(t,"is"),n.is=t;function r(i,s){return i===s?!0:i==null||s===null||s===void 0?!1:i.executionOrder===s.executionOrder&&i.success===s.success}o(r,"equals"),n.equals=r})(Ek=_e.ExecutionSummary||(_e.ExecutionSummary={}));var Ag;(function(n){function e(s,a){return{kind:s,document:a}}o(e,"create"),n.create=e;function t(s){let a=s;return rr.objectLiteral(a)&&Lk.is(a.kind)&&Ya.DocumentUri.is(a.document)&&(a.metadata===void 0||rr.objectLiteral(a.metadata))}o(t,"is"),n.is=t;function r(s,a){let c=new Set;return s.document!==a.document&&c.add("document"),s.kind!==a.kind&&c.add("kind"),s.executionSummary!==a.executionSummary&&c.add("executionSummary"),(s.metadata!==void 0||a.metadata!==void 0)&&!i(s.metadata,a.metadata)&&c.add("metadata"),(s.executionSummary!==void 0||a.executionSummary!==void 0)&&!Ek.equals(s.executionSummary,a.executionSummary)&&c.add("executionSummary"),c}o(r,"diff"),n.diff=r;function i(s,a){if(s===a)return!0;if(s==null||a===null||a===void 0||typeof s!=typeof a||typeof s!="object")return!1;let c=Array.isArray(s),l=Array.isArray(a);if(c!==l)return!1;if(c&&l){if(s.length!==a.length)return!1;for(let u=0;u<s.length;u++)if(!i(s[u],a[u]))return!1}if(rr.objectLiteral(s)&&rr.objectLiteral(a)){let u=Object.keys(s),p=Object.keys(a);if(u.length!==p.length||(u.sort(),p.sort(),!i(u,p)))return!1;for(let d=0;d<u.length;d++){let f=u[d];if(!i(s[f],a[f]))return!1}}return!0}o(i,"equalsMetadata")})(Ag=_e.NotebookCell||(_e.NotebookCell={}));var mM;(function(n){function e(r,i,s,a){return{uri:r,notebookType:i,version:s,cells:a}}o(e,"create"),n.create=e;function t(r){let i=r;return rr.objectLiteral(i)&&rr.string(i.uri)&&Ya.integer.is(i.version)&&rr.typedArray(i.cells,Ag.is)}o(t,"is"),n.is=t})(mM=_e.NotebookDocument||(_e.NotebookDocument={}));var Za;(function(n){n.method="notebookDocument/sync",n.messageDirection=gr.MessageDirection.clientToServer,n.type=new gr.RegistrationType(n.method)})(Za=_e.NotebookDocumentSyncRegistrationType||(_e.NotebookDocumentSyncRegistrationType={}));var hM;(function(n){n.method="notebookDocument/didOpen",n.messageDirection=gr.MessageDirection.clientToServer,n.type=new gr.ProtocolNotificationType(n.method),n.registrationMethod=Za.method})(hM=_e.DidOpenNotebookDocumentNotification||(_e.DidOpenNotebookDocumentNotification={}));var gM;(function(n){function e(r){let i=r;return rr.objectLiteral(i)&&Ya.uinteger.is(i.start)&&Ya.uinteger.is(i.deleteCount)&&(i.cells===void 0||rr.typedArray(i.cells,Ag.is))}o(e,"is"),n.is=e;function t(r,i,s){let a={start:r,deleteCount:i};return s!==void 0&&(a.cells=s),a}o(t,"create"),n.create=t})(gM=_e.NotebookCellArrayChange||(_e.NotebookCellArrayChange={}));var bM;(function(n){n.method="notebookDocument/didChange",n.messageDirection=gr.MessageDirection.clientToServer,n.type=new gr.ProtocolNotificationType(n.method),n.registrationMethod=Za.method})(bM=_e.DidChangeNotebookDocumentNotification||(_e.DidChangeNotebookDocumentNotification={}));var vM;(function(n){n.method="notebookDocument/didSave",n.messageDirection=gr.MessageDirection.clientToServer,n.type=new gr.ProtocolNotificationType(n.method),n.registrationMethod=Za.method})(vM=_e.DidSaveNotebookDocumentNotification||(_e.DidSaveNotebookDocumentNotification={}));var yM;(function(n){n.method="notebookDocument/didClose",n.messageDirection=gr.MessageDirection.clientToServer,n.type=new gr.ProtocolNotificationType(n.method),n.registrationMethod=Za.method})(yM=_e.DidCloseNotebookDocumentNotification||(_e.DidCloseNotebookDocumentNotification={}))});var $k=w(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.WorkspaceSymbolRequest=k.CodeActionResolveRequest=k.CodeActionRequest=k.DocumentSymbolRequest=k.DocumentHighlightRequest=k.ReferencesRequest=k.DefinitionRequest=k.SignatureHelpRequest=k.SignatureHelpTriggerKind=k.HoverRequest=k.CompletionResolveRequest=k.CompletionRequest=k.CompletionTriggerKind=k.PublishDiagnosticsNotification=k.WatchKind=k.RelativePattern=k.FileChangeType=k.DidChangeWatchedFilesNotification=k.WillSaveTextDocumentWaitUntilRequest=k.WillSaveTextDocumentNotification=k.TextDocumentSaveReason=k.DidSaveTextDocumentNotification=k.DidCloseTextDocumentNotification=k.DidChangeTextDocumentNotification=k.TextDocumentContentChangeEvent=k.DidOpenTextDocumentNotification=k.TextDocumentSyncKind=k.TelemetryEventNotification=k.LogMessageNotification=k.ShowMessageRequest=k.ShowMessageNotification=k.MessageType=k.DidChangeConfigurationNotification=k.ExitNotification=k.ShutdownRequest=k.InitializedNotification=k.InitializeErrorCodes=k.InitializeRequest=k.WorkDoneProgressOptions=k.TextDocumentRegistrationOptions=k.StaticRegistrationOptions=k.PositionEncodingKind=k.FailureHandlingKind=k.ResourceOperationKind=k.UnregistrationRequest=k.RegistrationRequest=k.DocumentSelector=k.NotebookCellTextDocumentFilter=k.NotebookDocumentFilter=k.TextDocumentFilter=void 0;k.TypeHierarchySubtypesRequest=k.TypeHierarchyPrepareRequest=k.MonikerRequest=k.MonikerKind=k.UniquenessLevel=k.WillDeleteFilesRequest=k.DidDeleteFilesNotification=k.WillRenameFilesRequest=k.DidRenameFilesNotification=k.WillCreateFilesRequest=k.DidCreateFilesNotification=k.FileOperationPatternKind=k.LinkedEditingRangeRequest=k.ShowDocumentRequest=k.SemanticTokensRegistrationType=k.SemanticTokensRefreshRequest=k.SemanticTokensRangeRequest=k.SemanticTokensDeltaRequest=k.SemanticTokensRequest=k.TokenFormat=k.CallHierarchyPrepareRequest=k.CallHierarchyOutgoingCallsRequest=k.CallHierarchyIncomingCallsRequest=k.WorkDoneProgressCancelNotification=k.WorkDoneProgressCreateRequest=k.WorkDoneProgress=k.SelectionRangeRequest=k.DeclarationRequest=k.FoldingRangeRequest=k.ColorPresentationRequest=k.DocumentColorRequest=k.ConfigurationRequest=k.DidChangeWorkspaceFoldersNotification=k.WorkspaceFoldersRequest=k.TypeDefinitionRequest=k.ImplementationRequest=k.ApplyWorkspaceEditRequest=k.ExecuteCommandRequest=k.PrepareRenameRequest=k.RenameRequest=k.PrepareSupportDefaultBehavior=k.DocumentOnTypeFormattingRequest=k.DocumentRangeFormattingRequest=k.DocumentFormattingRequest=k.DocumentLinkResolveRequest=k.DocumentLinkRequest=k.CodeLensRefreshRequest=k.CodeLensResolveRequest=k.CodeLensRequest=k.WorkspaceSymbolResolveRequest=void 0;k.DidCloseNotebookDocumentNotification=k.DidSaveNotebookDocumentNotification=k.DidChangeNotebookDocumentNotification=k.NotebookCellArrayChange=k.DidOpenNotebookDocumentNotification=k.NotebookDocumentSyncRegistrationType=k.NotebookDocument=k.NotebookCell=k.ExecutionSummary=k.NotebookCellKind=k.DiagnosticRefreshRequest=k.WorkspaceDiagnosticRequest=k.DocumentDiagnosticRequest=k.DocumentDiagnosticReportKind=k.DiagnosticServerCancellationData=k.InlayHintRefreshRequest=k.InlayHintResolveRequest=k.InlayHintRequest=k.InlineValueRefreshRequest=k.InlineValueRequest=k.TypeHierarchySupertypesRequest=void 0;var te=pt(),Fk=lu(),jt=uu(),IM=tk();Object.defineProperty(k,"ImplementationRequest",{enumerable:!0,get:function(){return IM.ImplementationRequest}});var xM=rk();Object.defineProperty(k,"TypeDefinitionRequest",{enumerable:!0,get:function(){return xM.TypeDefinitionRequest}});var Dk=ik();Object.defineProperty(k,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return Dk.WorkspaceFoldersRequest}});Object.defineProperty(k,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return Dk.DidChangeWorkspaceFoldersNotification}});var SM=sk();Object.defineProperty(k,"ConfigurationRequest",{enumerable:!0,get:function(){return SM.ConfigurationRequest}});var Nk=ak();Object.defineProperty(k,"DocumentColorRequest",{enumerable:!0,get:function(){return Nk.DocumentColorRequest}});Object.defineProperty(k,"ColorPresentationRequest",{enumerable:!0,get:function(){return Nk.ColorPresentationRequest}});var TM=lk();Object.defineProperty(k,"FoldingRangeRequest",{enumerable:!0,get:function(){return TM.FoldingRangeRequest}});var kM=pk();Object.defineProperty(k,"DeclarationRequest",{enumerable:!0,get:function(){return kM.DeclarationRequest}});var CM=fk();Object.defineProperty(k,"SelectionRangeRequest",{enumerable:!0,get:function(){return CM.SelectionRangeRequest}});var Lg=mk();Object.defineProperty(k,"WorkDoneProgress",{enumerable:!0,get:function(){return Lg.WorkDoneProgress}});Object.defineProperty(k,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return Lg.WorkDoneProgressCreateRequest}});Object.defineProperty(k,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return Lg.WorkDoneProgressCancelNotification}});var Eg=hk();Object.defineProperty(k,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return Eg.CallHierarchyIncomingCallsRequest}});Object.defineProperty(k,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return Eg.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(k,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return Eg.CallHierarchyPrepareRequest}});var ys=gk();Object.defineProperty(k,"TokenFormat",{enumerable:!0,get:function(){return ys.TokenFormat}});Object.defineProperty(k,"SemanticTokensRequest",{enumerable:!0,get:function(){return ys.SemanticTokensRequest}});Object.defineProperty(k,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return ys.SemanticTokensDeltaRequest}});Object.defineProperty(k,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return ys.SemanticTokensRangeRequest}});Object.defineProperty(k,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return ys.SemanticTokensRefreshRequest}});Object.defineProperty(k,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return ys.SemanticTokensRegistrationType}});var PM=vk();Object.defineProperty(k,"ShowDocumentRequest",{enumerable:!0,get:function(){return PM.ShowDocumentRequest}});var RM=Ik();Object.defineProperty(k,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return RM.LinkedEditingRangeRequest}});var so=xk();Object.defineProperty(k,"FileOperationPatternKind",{enumerable:!0,get:function(){return so.FileOperationPatternKind}});Object.defineProperty(k,"DidCreateFilesNotification",{enumerable:!0,get:function(){return so.DidCreateFilesNotification}});Object.defineProperty(k,"WillCreateFilesRequest",{enumerable:!0,get:function(){return so.WillCreateFilesRequest}});Object.defineProperty(k,"DidRenameFilesNotification",{enumerable:!0,get:function(){return so.DidRenameFilesNotification}});Object.defineProperty(k,"WillRenameFilesRequest",{enumerable:!0,get:function(){return so.WillRenameFilesRequest}});Object.defineProperty(k,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return so.DidDeleteFilesNotification}});Object.defineProperty(k,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return so.WillDeleteFilesRequest}});var wg=Tk();Object.defineProperty(k,"UniquenessLevel",{enumerable:!0,get:function(){return wg.UniquenessLevel}});Object.defineProperty(k,"MonikerKind",{enumerable:!0,get:function(){return wg.MonikerKind}});Object.defineProperty(k,"MonikerRequest",{enumerable:!0,get:function(){return wg.MonikerRequest}});var Fg=kk();Object.defineProperty(k,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return Fg.TypeHierarchyPrepareRequest}});Object.defineProperty(k,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return Fg.TypeHierarchySubtypesRequest}});Object.defineProperty(k,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return Fg.TypeHierarchySupertypesRequest}});var _k=Ck();Object.defineProperty(k,"InlineValueRequest",{enumerable:!0,get:function(){return _k.InlineValueRequest}});Object.defineProperty(k,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return _k.InlineValueRefreshRequest}});var Dg=Pk();Object.defineProperty(k,"InlayHintRequest",{enumerable:!0,get:function(){return Dg.InlayHintRequest}});Object.defineProperty(k,"InlayHintResolveRequest",{enumerable:!0,get:function(){return Dg.InlayHintResolveRequest}});Object.defineProperty(k,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return Dg.InlayHintRefreshRequest}});var ec=Ak();Object.defineProperty(k,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return ec.DiagnosticServerCancellationData}});Object.defineProperty(k,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return ec.DocumentDiagnosticReportKind}});Object.defineProperty(k,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return ec.DocumentDiagnosticRequest}});Object.defineProperty(k,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return ec.WorkspaceDiagnosticRequest}});Object.defineProperty(k,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return ec.DiagnosticRefreshRequest}});var br=wk();Object.defineProperty(k,"NotebookCellKind",{enumerable:!0,get:function(){return br.NotebookCellKind}});Object.defineProperty(k,"ExecutionSummary",{enumerable:!0,get:function(){return br.ExecutionSummary}});Object.defineProperty(k,"NotebookCell",{enumerable:!0,get:function(){return br.NotebookCell}});Object.defineProperty(k,"NotebookDocument",{enumerable:!0,get:function(){return br.NotebookDocument}});Object.defineProperty(k,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return br.NotebookDocumentSyncRegistrationType}});Object.defineProperty(k,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return br.DidOpenNotebookDocumentNotification}});Object.defineProperty(k,"NotebookCellArrayChange",{enumerable:!0,get:function(){return br.NotebookCellArrayChange}});Object.defineProperty(k,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return br.DidChangeNotebookDocumentNotification}});Object.defineProperty(k,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return br.DidSaveNotebookDocumentNotification}});Object.defineProperty(k,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return br.DidCloseNotebookDocumentNotification}});var Ok;(function(n){function e(t){let r=t;return jt.string(r.language)||jt.string(r.scheme)||jt.string(r.pattern)}o(e,"is"),n.is=e})(Ok=k.TextDocumentFilter||(k.TextDocumentFilter={}));var Mk;(function(n){function e(t){let r=t;return jt.objectLiteral(r)&&(jt.string(r.notebookType)||jt.string(r.scheme)||jt.string(r.pattern))}o(e,"is"),n.is=e})(Mk=k.NotebookDocumentFilter||(k.NotebookDocumentFilter={}));var Uk;(function(n){function e(t){let r=t;return jt.objectLiteral(r)&&(jt.string(r.notebook)||Mk.is(r.notebook))&&(r.language===void 0||jt.string(r.language))}o(e,"is"),n.is=e})(Uk=k.NotebookCellTextDocumentFilter||(k.NotebookCellTextDocumentFilter={}));var qk;(function(n){function e(t){if(!Array.isArray(t))return!1;for(let r of t)if(!jt.string(r)&&!Ok.is(r)&&!Uk.is(r))return!1;return!0}o(e,"is"),n.is=e})(qk=k.DocumentSelector||(k.DocumentSelector={}));var AM;(function(n){n.method="client/registerCapability",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolRequestType(n.method)})(AM=k.RegistrationRequest||(k.RegistrationRequest={}));var LM;(function(n){n.method="client/unregisterCapability",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolRequestType(n.method)})(LM=k.UnregistrationRequest||(k.UnregistrationRequest={}));var EM;(function(n){n.Create="create",n.Rename="rename",n.Delete="delete"})(EM=k.ResourceOperationKind||(k.ResourceOperationKind={}));var wM;(function(n){n.Abort="abort",n.Transactional="transactional",n.TextOnlyTransactional="textOnlyTransactional",n.Undo="undo"})(wM=k.FailureHandlingKind||(k.FailureHandlingKind={}));var FM;(function(n){n.UTF8="utf-8",n.UTF16="utf-16",n.UTF32="utf-32"})(FM=k.PositionEncodingKind||(k.PositionEncodingKind={}));var DM;(function(n){function e(t){let r=t;return r&&jt.string(r.id)&&r.id.length>0}o(e,"hasId"),n.hasId=e})(DM=k.StaticRegistrationOptions||(k.StaticRegistrationOptions={}));var NM;(function(n){function e(t){let r=t;return r&&(r.documentSelector===null||qk.is(r.documentSelector))}o(e,"is"),n.is=e})(NM=k.TextDocumentRegistrationOptions||(k.TextDocumentRegistrationOptions={}));var _M;(function(n){function e(r){let i=r;return jt.objectLiteral(i)&&(i.workDoneProgress===void 0||jt.boolean(i.workDoneProgress))}o(e,"is"),n.is=e;function t(r){let i=r;return i&&jt.boolean(i.workDoneProgress)}o(t,"hasWorkDoneProgress"),n.hasWorkDoneProgress=t})(_M=k.WorkDoneProgressOptions||(k.WorkDoneProgressOptions={}));var OM;(function(n){n.method="initialize",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(OM=k.InitializeRequest||(k.InitializeRequest={}));var MM;(function(n){n.unknownProtocolVersion=1})(MM=k.InitializeErrorCodes||(k.InitializeErrorCodes={}));var UM;(function(n){n.method="initialized",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(UM=k.InitializedNotification||(k.InitializedNotification={}));var qM;(function(n){n.method="shutdown",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType0(n.method)})(qM=k.ShutdownRequest||(k.ShutdownRequest={}));var $M;(function(n){n.method="exit",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType0(n.method)})($M=k.ExitNotification||(k.ExitNotification={}));var WM;(function(n){n.method="workspace/didChangeConfiguration",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(WM=k.DidChangeConfigurationNotification||(k.DidChangeConfigurationNotification={}));var BM;(function(n){n.Error=1,n.Warning=2,n.Info=3,n.Log=4})(BM=k.MessageType||(k.MessageType={}));var jM;(function(n){n.method="window/showMessage",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolNotificationType(n.method)})(jM=k.ShowMessageNotification||(k.ShowMessageNotification={}));var VM;(function(n){n.method="window/showMessageRequest",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolRequestType(n.method)})(VM=k.ShowMessageRequest||(k.ShowMessageRequest={}));var GM;(function(n){n.method="window/logMessage",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolNotificationType(n.method)})(GM=k.LogMessageNotification||(k.LogMessageNotification={}));var HM;(function(n){n.method="telemetry/event",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolNotificationType(n.method)})(HM=k.TelemetryEventNotification||(k.TelemetryEventNotification={}));var zM;(function(n){n.None=0,n.Full=1,n.Incremental=2})(zM=k.TextDocumentSyncKind||(k.TextDocumentSyncKind={}));var KM;(function(n){n.method="textDocument/didOpen",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(KM=k.DidOpenTextDocumentNotification||(k.DidOpenTextDocumentNotification={}));var XM;(function(n){function e(r){let i=r;return i!=null&&typeof i.text=="string"&&i.range!==void 0&&(i.rangeLength===void 0||typeof i.rangeLength=="number")}o(e,"isIncremental"),n.isIncremental=e;function t(r){let i=r;return i!=null&&typeof i.text=="string"&&i.range===void 0&&i.rangeLength===void 0}o(t,"isFull"),n.isFull=t})(XM=k.TextDocumentContentChangeEvent||(k.TextDocumentContentChangeEvent={}));var JM;(function(n){n.method="textDocument/didChange",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(JM=k.DidChangeTextDocumentNotification||(k.DidChangeTextDocumentNotification={}));var QM;(function(n){n.method="textDocument/didClose",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(QM=k.DidCloseTextDocumentNotification||(k.DidCloseTextDocumentNotification={}));var YM;(function(n){n.method="textDocument/didSave",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(YM=k.DidSaveTextDocumentNotification||(k.DidSaveTextDocumentNotification={}));var ZM;(function(n){n.Manual=1,n.AfterDelay=2,n.FocusOut=3})(ZM=k.TextDocumentSaveReason||(k.TextDocumentSaveReason={}));var e1;(function(n){n.method="textDocument/willSave",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(e1=k.WillSaveTextDocumentNotification||(k.WillSaveTextDocumentNotification={}));var t1;(function(n){n.method="textDocument/willSaveWaitUntil",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(t1=k.WillSaveTextDocumentWaitUntilRequest||(k.WillSaveTextDocumentWaitUntilRequest={}));var n1;(function(n){n.method="workspace/didChangeWatchedFiles",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolNotificationType(n.method)})(n1=k.DidChangeWatchedFilesNotification||(k.DidChangeWatchedFilesNotification={}));var r1;(function(n){n.Created=1,n.Changed=2,n.Deleted=3})(r1=k.FileChangeType||(k.FileChangeType={}));var i1;(function(n){function e(t){let r=t;return jt.objectLiteral(r)&&(Fk.URI.is(r.baseUri)||Fk.WorkspaceFolder.is(r.baseUri))&&jt.string(r.pattern)}o(e,"is"),n.is=e})(i1=k.RelativePattern||(k.RelativePattern={}));var o1;(function(n){n.Create=1,n.Change=2,n.Delete=4})(o1=k.WatchKind||(k.WatchKind={}));var s1;(function(n){n.method="textDocument/publishDiagnostics",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolNotificationType(n.method)})(s1=k.PublishDiagnosticsNotification||(k.PublishDiagnosticsNotification={}));var a1;(function(n){n.Invoked=1,n.TriggerCharacter=2,n.TriggerForIncompleteCompletions=3})(a1=k.CompletionTriggerKind||(k.CompletionTriggerKind={}));var c1;(function(n){n.method="textDocument/completion",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(c1=k.CompletionRequest||(k.CompletionRequest={}));var l1;(function(n){n.method="completionItem/resolve",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(l1=k.CompletionResolveRequest||(k.CompletionResolveRequest={}));var u1;(function(n){n.method="textDocument/hover",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(u1=k.HoverRequest||(k.HoverRequest={}));var p1;(function(n){n.Invoked=1,n.TriggerCharacter=2,n.ContentChange=3})(p1=k.SignatureHelpTriggerKind||(k.SignatureHelpTriggerKind={}));var d1;(function(n){n.method="textDocument/signatureHelp",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(d1=k.SignatureHelpRequest||(k.SignatureHelpRequest={}));var f1;(function(n){n.method="textDocument/definition",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(f1=k.DefinitionRequest||(k.DefinitionRequest={}));var m1;(function(n){n.method="textDocument/references",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(m1=k.ReferencesRequest||(k.ReferencesRequest={}));var h1;(function(n){n.method="textDocument/documentHighlight",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(h1=k.DocumentHighlightRequest||(k.DocumentHighlightRequest={}));var g1;(function(n){n.method="textDocument/documentSymbol",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(g1=k.DocumentSymbolRequest||(k.DocumentSymbolRequest={}));var b1;(function(n){n.method="textDocument/codeAction",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(b1=k.CodeActionRequest||(k.CodeActionRequest={}));var v1;(function(n){n.method="codeAction/resolve",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(v1=k.CodeActionResolveRequest||(k.CodeActionResolveRequest={}));var y1;(function(n){n.method="workspace/symbol",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(y1=k.WorkspaceSymbolRequest||(k.WorkspaceSymbolRequest={}));var I1;(function(n){n.method="workspaceSymbol/resolve",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(I1=k.WorkspaceSymbolResolveRequest||(k.WorkspaceSymbolResolveRequest={}));var x1;(function(n){n.method="textDocument/codeLens",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(x1=k.CodeLensRequest||(k.CodeLensRequest={}));var S1;(function(n){n.method="codeLens/resolve",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(S1=k.CodeLensResolveRequest||(k.CodeLensResolveRequest={}));var T1;(function(n){n.method="workspace/codeLens/refresh",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolRequestType0(n.method)})(T1=k.CodeLensRefreshRequest||(k.CodeLensRefreshRequest={}));var k1;(function(n){n.method="textDocument/documentLink",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(k1=k.DocumentLinkRequest||(k.DocumentLinkRequest={}));var C1;(function(n){n.method="documentLink/resolve",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(C1=k.DocumentLinkResolveRequest||(k.DocumentLinkResolveRequest={}));var P1;(function(n){n.method="textDocument/formatting",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(P1=k.DocumentFormattingRequest||(k.DocumentFormattingRequest={}));var R1;(function(n){n.method="textDocument/rangeFormatting",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(R1=k.DocumentRangeFormattingRequest||(k.DocumentRangeFormattingRequest={}));var A1;(function(n){n.method="textDocument/onTypeFormatting",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(A1=k.DocumentOnTypeFormattingRequest||(k.DocumentOnTypeFormattingRequest={}));var L1;(function(n){n.Identifier=1})(L1=k.PrepareSupportDefaultBehavior||(k.PrepareSupportDefaultBehavior={}));var E1;(function(n){n.method="textDocument/rename",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(E1=k.RenameRequest||(k.RenameRequest={}));var w1;(function(n){n.method="textDocument/prepareRename",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(w1=k.PrepareRenameRequest||(k.PrepareRenameRequest={}));var F1;(function(n){n.method="workspace/executeCommand",n.messageDirection=te.MessageDirection.clientToServer,n.type=new te.ProtocolRequestType(n.method)})(F1=k.ExecuteCommandRequest||(k.ExecuteCommandRequest={}));var D1;(function(n){n.method="workspace/applyEdit",n.messageDirection=te.MessageDirection.serverToClient,n.type=new te.ProtocolRequestType("workspace/applyEdit")})(D1=k.ApplyWorkspaceEditRequest||(k.ApplyWorkspaceEditRequest={}))});var Bk=w(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});gu.createProtocolConnection=void 0;var Wk=oo();function N1(n,e,t,r){return Wk.ConnectionStrategy.is(r)&&(r={connectionStrategy:r}),(0,Wk.createMessageConnection)(n,e,t,r)}o(N1,"createProtocolConnection");gu.createProtocolConnection=N1});var jk=w(ln=>{"use strict";var _1=ln&&ln.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),bu=ln&&ln.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&_1(e,n,t)};Object.defineProperty(ln,"__esModule",{value:!0});ln.LSPErrorCodes=ln.createProtocolConnection=void 0;bu(oo(),ln);bu(lu(),ln);bu(pt(),ln);bu($k(),ln);var O1=Bk();Object.defineProperty(ln,"createProtocolConnection",{enumerable:!0,get:function(){return O1.createProtocolConnection}});var M1;(function(n){n.lspReservedErrorRangeStart=-32899,n.RequestFailed=-32803,n.ServerCancelled=-32802,n.ContentModified=-32801,n.RequestCancelled=-32800,n.lspReservedErrorRangeEnd=-32800})(M1=ln.LSPErrorCodes||(ln.LSPErrorCodes={}))});var Xe=w(vr=>{"use strict";var U1=vr&&vr.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Vk=vr&&vr.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&U1(e,n,t)};Object.defineProperty(vr,"__esModule",{value:!0});vr.createProtocolConnection=void 0;var q1=bg();Vk(bg(),vr);Vk(jk(),vr);function $1(n,e,t,r){return(0,q1.createMessageConnection)(n,e,t,r)}o($1,"createProtocolConnection");vr.createProtocolConnection=$1});var kC=w((H8,fU)=>{fU.exports={name:"vscode-languageserver-protocol",description:"VSCode Language Server Protocol implementation",version:"3.17.3",author:"Microsoft Corporation",license:"MIT",repository:{type:"git",url:"https://github.com/Microsoft/vscode-languageserver-node.git",directory:"protocol"},bugs:{url:"https://github.com/Microsoft/vscode-languageserver-node/issues"},main:"./lib/node/main.js",browser:{"./lib/node/main.js":"./lib/browser/main.js"},typings:"./lib/common/api.d.ts",dependencies:{"vscode-jsonrpc":"8.1.0","vscode-languageserver-types":"3.17.3"},scripts:{prepublishOnly:'echo "\u26D4 Can only publish from a secure pipeline \u26D4" && node ../build/npm/fail',prepack:"npm run all:publish",postpublish:"node ../build/npm/post-publish.js",preversion:"npm test",compile:"node ../build/bin/tsc -b ./tsconfig.json",watch:"node ../build/bin/tsc -b ./tsconfig.watch.json -w",clean:"node ../node_modules/rimraf/bin.js lib && node ../node_modules/rimraf/bin.js dist",lint:"node ../node_modules/eslint/bin/eslint.js --ext ts src",test:"npm run test:node && npm run test:browser","test:node":"node ../node_modules/mocha/bin/_mocha","test:browser":"npm run webpack:test:silent && node ../build/bin/runBrowserTests.js  http://127.0.0.1:8080/protocol/src/browser/test/","webpack:test":"cd ../types && npm run compile:esm && cd ../protocol && node ../build/bin/webpack --mode none --config ./src/browser/test/webpack.config.js","webpack:test:silent":"cd ../types && npm run compile:esm && cd ../protocol && node ../build/bin/webpack --no-stats --mode none --config ./src/browser/test/webpack.config.js","compile:metaModelTool":"cd ../tools && npm run compile && cd ../protocol","generate:metaModel":"node ../tools/lib/generator-main.js -p ./src/common/tsconfig.json > ./metaModel.json","generate:metaModelSchema":"ts-json-schema-generator --path ../tools/src/metaModel.ts > ./metaModel.schema.json",all:"npm run clean && npm run compile && npm run lint && npm run test && npm run compile:metaModelTool && npm run generate:metaModel && npm run generate:metaModelSchema","compile:publish":"node ../build/bin/tsc -b ./tsconfig.publish.json","all:publish":"git clean -xfd . && npm install && npm run compile:publish && npm run lint && npm run test && npm run compile:metaModelTool && npm run generate:metaModel && npm run generate:metaModelSchema"}}});var bP=w((CQ,gP)=>{function cP(n){return Array.isArray(n)?n:[n]}o(cP,"makeArray");var dP="",lP=" ",Yb="\\",OU=/^\s+$/,MU=/(?:[^\\]|^)\\$/,UU=/^\\!/,qU=/^\\#/,$U=/\r?\n/g,WU=/^\.*\/|^\.+$/,Zb="/",fP="node-ignore";typeof Symbol<"u"&&(fP=Symbol.for("node-ignore"));var uP=fP,BU=o((n,e,t)=>Object.defineProperty(n,e,{value:t}),"define"),jU=/([0-z])-([0-z])/g,mP=o(()=>!1,"RETURN_FALSE"),VU=o(n=>n.replace(jU,(e,t,r)=>t.charCodeAt(0)<=r.charCodeAt(0)?e:dP),"sanitizeRange"),GU=o(n=>{let{length:e}=n;return n.slice(0,e-e%2)},"cleanRangeBackSlash"),HU=[[/\\?\s+$/,n=>n.indexOf("\\")===0?lP:dP],[/\\\s/g,()=>lP],[/[\\$.|*+(){^]/g,n=>`\\${n}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,o(function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"},"startingReplacer")],[/\\\/\\\*\\\*(?=\\\/|$)/g,(n,e,t)=>e+6<t.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(n,e,t)=>{let r=t.replace(/\\\*/g,"[^\\/]*");return e+r}],[/\\\\\\(?=[$.|*+(){^])/g,()=>Yb],[/\\\\/g,()=>Yb],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(n,e,t,r,i)=>e===Yb?`\\[${t}${GU(r)}${i}`:i==="]"&&r.length%2===0?`[${VU(t)}${r}]`:"[]"],[/(?:[^*])$/,n=>/\/$/.test(n)?`${n}$`:`${n}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(n,e)=>`${e?`${e}[^/]+`:"[^/]*"}(?=$|\\/$)`]],pP=Object.create(null),zU=o((n,e)=>{let t=pP[n];return t||(t=HU.reduce((r,i)=>r.replace(i[0],i[1].bind(n)),n),pP[n]=t),e?new RegExp(t,"i"):new RegExp(t)},"makeRegex"),nv=o(n=>typeof n=="string","isString"),KU=o(n=>n&&nv(n)&&!OU.test(n)&&!MU.test(n)&&n.indexOf("#")!==0,"checkPattern"),XU=o(n=>n.split($U),"splitPattern"),rv=class{constructor(e,t,r,i){this.origin=e,this.pattern=t,this.negative=r,this.regex=i}},ev=rv;o(rv,"IgnoreRule");var JU=o((n,e)=>{let t=n,r=!1;n.indexOf("!")===0&&(r=!0,n=n.substr(1)),n=n.replace(UU,"!").replace(qU,"#");let i=zU(n,e);return new ev(t,n,r,i)},"createRule"),QU=o((n,e)=>{throw new e(n)},"throwError"),Zr=o((n,e,t)=>nv(n)?n?Zr.isNotRelative(n)?t(`path should be a \`path.relative()\`d string, but got "${e}"`,RangeError):!0:t("path must not be empty",TypeError):t(`path must be a string, but got \`${e}\``,TypeError),"checkPath"),hP=o(n=>WU.test(n),"isNotRelative");Zr.isNotRelative=hP;Zr.convert=n=>n;var iv=class{constructor({ignorecase:e=!0,ignoreCase:t=e,allowRelativePaths:r=!1}={}){BU(this,uP,!0),this._rules=[],this._ignoreCase=t,this._allowRelativePaths=r,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(e){if(e&&e[uP]){this._rules=this._rules.concat(e._rules),this._added=!0;return}if(KU(e)){let t=JU(e,this._ignoreCase);this._added=!0,this._rules.push(t)}}add(e){return this._added=!1,cP(nv(e)?XU(e):e).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(e){return this.add(e)}_testOne(e,t){let r=!1,i=!1;return this._rules.forEach(s=>{let{negative:a}=s;if(i===a&&r!==i||a&&!r&&!i&&!t)return;s.regex.test(e)&&(r=!a,i=a)}),{ignored:r,unignored:i}}_test(e,t,r,i){let s=e&&Zr.convert(e);return Zr(s,e,this._allowRelativePaths?mP:QU),this._t(s,t,r,i)}_t(e,t,r,i){if(e in t)return t[e];if(i||(i=e.split(Zb)),i.pop(),!i.length)return t[e]=this._testOne(e,r);let s=this._t(i.join(Zb)+Zb,t,r,i);return t[e]=s.ignored?s:this._testOne(e,r)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return cP(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}},tv=iv;o(iv,"Ignore");var bp=o(n=>new tv(n),"factory"),YU=o(n=>Zr(n&&Zr.convert(n),n,mP),"isPathValid");bp.isPathValid=YU;bp.default=bp;gP.exports=bp;if(typeof process<"u"&&(process.env&&process.env.IGNORE_TEST_WIN32||process.platform==="win32")){let n=o(t=>/^\\\\\?\\/.test(t)||/["<>|\u0000-\u001F]+/u.test(t)?t:t.replace(/\\/g,"/"),"makePosix");Zr.convert=n;let e=/^[a-z]:\//i;Zr.isNotRelative=t=>e.test(t)||hP(t)}});var Ws=w((Ap,Rp)=>{var i0=Ap&&Ap.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))};(function(n){if(typeof Rp=="object"&&typeof Rp.exports=="object"){var e=n(require,Ap);e!==void 0&&(Rp.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],n)})(function(n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=void 0;var t=function(){function l(u,p,d,f){this._uri=u,this._languageId=p,this._version=d,this._content=f,this._lineOffsets=void 0}return o(l,"FullTextDocument"),Object.defineProperty(l.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),l.prototype.getText=function(u){if(u){var p=this.offsetAt(u.start),d=this.offsetAt(u.end);return this._content.substring(p,d)}return this._content},l.prototype.update=function(u,p){for(var d=0,f=u;d<f.length;d++){var g=f[d];if(l.isIncremental(g)){var h=a(g.range),T=this.offsetAt(h.start),S=this.offsetAt(h.end);this._content=this._content.substring(0,T)+g.text+this._content.substring(S,this._content.length);var C=Math.max(h.start.line,0),L=Math.max(h.end.line,0),A=this._lineOffsets,W=s(g.text,!1,T);if(L-C===W.length)for(var O=0,j=W.length;O<j;O++)A[O+C+1]=W[O];else W.length<1e4?A.splice.apply(A,i0([C+1,L-C],W,!1)):this._lineOffsets=A=A.slice(0,C+1).concat(W,A.slice(L+1));var J=g.text.length-(S-T);if(J!==0)for(var O=C+1+W.length,j=A.length;O<j;O++)A[O]=A[O]+J}else if(l.isFull(g))this._content=g.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received")}this._version=p},l.prototype.getLineOffsets=function(){return this._lineOffsets===void 0&&(this._lineOffsets=s(this._content,!0)),this._lineOffsets},l.prototype.positionAt=function(u){u=Math.max(Math.min(u,this._content.length),0);var p=this.getLineOffsets(),d=0,f=p.length;if(f===0)return{line:0,character:u};for(;d<f;){var g=Math.floor((d+f)/2);p[g]>u?f=g:d=g+1}var h=d-1;return{line:h,character:u-p[h]}},l.prototype.offsetAt=function(u){var p=this.getLineOffsets();if(u.line>=p.length)return this._content.length;if(u.line<0)return 0;var d=p[u.line],f=u.line+1<p.length?p[u.line+1]:this._content.length;return Math.max(Math.min(d+u.character,f),d)},Object.defineProperty(l.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),l.isIncremental=function(u){var p=u;return p!=null&&typeof p.text=="string"&&p.range!==void 0&&(p.rangeLength===void 0||typeof p.rangeLength=="number")},l.isFull=function(u){var p=u;return p!=null&&typeof p.text=="string"&&p.range===void 0&&p.rangeLength===void 0},l}(),r;(function(l){function u(f,g,h,T){return new t(f,g,h,T)}o(u,"create"),l.create=u;function p(f,g,h){if(f instanceof t)return f.update(g,h),f;throw new Error("TextDocument.update: document must be created by TextDocument.create")}o(p,"update"),l.update=p;function d(f,g){for(var h=f.getText(),T=i(g.map(c),function(j,J){var ie=j.range.start.line-J.range.start.line;return ie===0?j.range.start.character-J.range.start.character:ie}),S=0,C=[],L=0,A=T;L<A.length;L++){var W=A[L],O=f.offsetAt(W.range.start);if(O<S)throw new Error("Overlapping edit");O>S&&C.push(h.substring(S,O)),W.newText.length&&C.push(W.newText),S=f.offsetAt(W.range.end)}return C.push(h.substr(S)),C.join("")}o(d,"applyEdits"),l.applyEdits=d})(r=e.TextDocument||(e.TextDocument={}));function i(l,u){if(l.length<=1)return l;var p=l.length/2|0,d=l.slice(0,p),f=l.slice(p);i(d,u),i(f,u);for(var g=0,h=0,T=0;g<d.length&&h<f.length;){var S=u(d[g],f[h]);S<=0?l[T++]=d[g++]:l[T++]=f[h++]}for(;g<d.length;)l[T++]=d[g++];for(;h<f.length;)l[T++]=f[h++];return l}o(i,"mergeSort");function s(l,u,p){p===void 0&&(p=0);for(var d=u?[p]:[],f=0;f<l.length;f++){var g=l.charCodeAt(f);(g===13||g===10)&&(g===13&&f+1<l.length&&l.charCodeAt(f+1)===10&&f++,d.push(p+f+1))}return d}o(s,"computeLineOffsets");function a(l){var u=l.start,p=l.end;return u.line>p.line||u.line===p.line&&u.character>p.character?{start:p,end:u}:l}o(a,"getWellformedRange");function c(l){var u=a(l.range);return u!==l.range?{newText:l.newText,range:u}:l}o(c,"getWellformedEdit")})});var AP=w((zY,RP)=>{"use strict";RP.exports=I0;function I0(n){if(n)throw n}o(I0,"bail")});var EP=w((XY,LP)=>{LP.exports=o(function(e){return e!=null&&e.constructor!=null&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},"isBuffer")});var qP=w((QY,UP)=>{"use strict";var _p=Object.prototype.hasOwnProperty,MP=Object.prototype.toString,wP=Object.defineProperty,FP=Object.getOwnPropertyDescriptor,DP=o(function(e){return typeof Array.isArray=="function"?Array.isArray(e):MP.call(e)==="[object Array]"},"isArray"),NP=o(function(e){if(!e||MP.call(e)!=="[object Object]")return!1;var t=_p.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&_p.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var i;for(i in e);return typeof i>"u"||_p.call(e,i)},"isPlainObject"),_P=o(function(e,t){wP&&t.name==="__proto__"?wP(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},"setProperty"),OP=o(function(e,t){if(t==="__proto__")if(_p.call(e,t)){if(FP)return FP(e,t).value}else return;return e[t]},"getProperty");UP.exports=o(function n(){var e,t,r,i,s,a,c=arguments[0],l=1,u=arguments.length,p=!1;for(typeof c=="boolean"&&(p=c,c=arguments[1]||{},l=2),(c==null||typeof c!="object"&&typeof c!="function")&&(c={});l<u;++l)if(e=arguments[l],e!=null)for(t in e)r=OP(c,t),i=OP(e,t),c!==i&&(p&&i&&(NP(i)||(s=DP(i)))?(s?(s=!1,a=r&&DP(r)?r:[]):a=r&&NP(r)?r:{},_P(c,{name:t,newValue:n(p,a,i)})):typeof i<"u"&&_P(c,{name:t,newValue:i}));return c},"extend")});var WP=w((ZY,$P)=>{"use strict";$P.exports=n=>{if(Object.prototype.toString.call(n)!=="[object Object]")return!1;let e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}});var jP=w((eZ,BP)=>{"use strict";var x0=[].slice;BP.exports=S0;function S0(n,e){var t;return r;function r(){var a=x0.call(arguments,0),c=n.length>a.length,l;c&&a.push(i);try{l=n.apply(null,a)}catch(u){if(c&&t)throw u;return i(u)}c||(l&&typeof l.then=="function"?l.then(s,i):l instanceof Error?i(l):s(l))}function i(){t||(t=!0,e.apply(null,arguments))}function s(a){i(null,a)}}o(S0,"wrap")});var KP=w((nZ,zP)=>{"use strict";var GP=jP();zP.exports=HP;HP.wrap=GP;var VP=[].slice;function HP(){var n=[],e={};return e.run=t,e.use=r,e;function t(){var i=-1,s=VP.call(arguments,0,-1),a=arguments[arguments.length-1];if(typeof a!="function")throw new Error("Expected function as last argument, not "+a);c.apply(null,[null].concat(s));function c(l){var u=n[++i],p=VP.call(arguments,0),d=p.slice(1),f=s.length,g=-1;if(l){a(l);return}for(;++g<f;)(d[g]===null||d[g]===void 0)&&(d[g]=s[g]);s=d,u?GP(u,c).apply(null,s):a.apply(null,[null].concat(s))}o(c,"next")}o(t,"run");function r(i){if(typeof i!="function")throw new Error("Expected `fn` to be a function, not "+i);return n.push(i),e}o(r,"use")}o(HP,"trough")});var wv=w((iZ,QP)=>{"use strict";var zs={}.hasOwnProperty;QP.exports=T0;function T0(n){return!n||typeof n!="object"?"":zs.call(n,"position")||zs.call(n,"type")?XP(n.position):zs.call(n,"start")||zs.call(n,"end")?XP(n):zs.call(n,"line")||zs.call(n,"column")?Ev(n):""}o(T0,"stringify");function Ev(n){return(!n||typeof n!="object")&&(n={}),JP(n.line)+":"+JP(n.column)}o(Ev,"point");function XP(n){return(!n||typeof n!="object")&&(n={}),Ev(n.start)+"-"+Ev(n.end)}o(XP,"position");function JP(n){return n&&typeof n=="number"?n:1}o(JP,"index")});var eR=w((sZ,ZP)=>{"use strict";var k0=wv();ZP.exports=Fv;function YP(){}o(YP,"VMessagePrototype");YP.prototype=Error.prototype;Fv.prototype=new YP;var Fi=Fv.prototype;Fi.file="";Fi.name="";Fi.reason="";Fi.message="";Fi.stack="";Fi.fatal=null;Fi.column=null;Fi.line=null;function Fv(n,e,t){var r,i,s;typeof e=="string"&&(t=e,e=null),r=C0(t),i=k0(e)||"1:1",s={start:{line:null,column:null},end:{line:null,column:null}},e&&e.position&&(e=e.position),e&&(e.start?(s=e,e=e.start):s.start=e),n.stack&&(this.stack=n.stack,n=n.message),this.message=n,this.name=i,this.reason=n,this.line=e?e.line:null,this.column=e?e.column:null,this.location=s,this.source=r[0],this.ruleId=r[1]}o(Fv,"VMessage");function C0(n){var e=[null,null],t;return typeof n=="string"&&(t=n.indexOf(":"),t===-1?e[1]=n:(e[0]=n.slice(0,t),e[1]=n.slice(t+1))),e}o(C0,"parseOrigin")});var nR=w((cZ,tR)=>{"use strict";tR.exports=require("path")});var iR=w((lZ,rR)=>{"use strict";rR.exports=process});var sR=w((uZ,oR)=>{oR.exports=o(function(e){return e!=null&&e.constructor!=null&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},"isBuffer")});var lR=w((dZ,cR)=>{"use strict";var Pr=nR(),P0=iR(),R0=sR();cR.exports=ti;var A0={}.hasOwnProperty,Dv=["history","path","basename","stem","extname","dirname"];ti.prototype.toString=q0;Object.defineProperty(ti.prototype,"path",{get:L0,set:E0});Object.defineProperty(ti.prototype,"dirname",{get:w0,set:F0});Object.defineProperty(ti.prototype,"basename",{get:D0,set:N0});Object.defineProperty(ti.prototype,"extname",{get:_0,set:O0});Object.defineProperty(ti.prototype,"stem",{get:M0,set:U0});function ti(n){var e,t;if(!n)n={};else if(typeof n=="string"||R0(n))n={contents:n};else if("message"in n&&"messages"in n)return n;if(!(this instanceof ti))return new ti(n);for(this.data={},this.messages=[],this.history=[],this.cwd=P0.cwd(),t=-1;++t<Dv.length;)e=Dv[t],A0.call(n,e)&&(this[e]=n[e]);for(e in n)Dv.indexOf(e)<0&&(this[e]=n[e])}o(ti,"VFile");function L0(){return this.history[this.history.length-1]}o(L0,"getPath");function E0(n){_v(n,"path"),this.path!==n&&this.history.push(n)}o(E0,"setPath");function w0(){return typeof this.path=="string"?Pr.dirname(this.path):void 0}o(w0,"getDirname");function F0(n){aR(this.path,"dirname"),this.path=Pr.join(n||"",this.basename)}o(F0,"setDirname");function D0(){return typeof this.path=="string"?Pr.basename(this.path):void 0}o(D0,"getBasename");function N0(n){_v(n,"basename"),Nv(n,"basename"),this.path=Pr.join(this.dirname||"",n)}o(N0,"setBasename");function _0(){return typeof this.path=="string"?Pr.extname(this.path):void 0}o(_0,"getExtname");function O0(n){if(Nv(n,"extname"),aR(this.path,"extname"),n){if(n.charCodeAt(0)!==46)throw new Error("`extname` must start with `.`");if(n.indexOf(".",1)>-1)throw new Error("`extname` cannot contain multiple dots")}this.path=Pr.join(this.dirname,this.stem+(n||""))}o(O0,"setExtname");function M0(){return typeof this.path=="string"?Pr.basename(this.path,this.extname):void 0}o(M0,"getStem");function U0(n){_v(n,"stem"),Nv(n,"stem"),this.path=Pr.join(this.dirname||"",n+(this.extname||""))}o(U0,"setStem");function q0(n){return(this.contents||"").toString(n)}o(q0,"toString");function Nv(n,e){if(n&&n.indexOf(Pr.sep)>-1)throw new Error("`"+e+"` cannot be a path: did not expect `"+Pr.sep+"`")}o(Nv,"assertPart");function _v(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}o(_v,"assertNonEmpty");function aR(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}o(aR,"assertPath")});var pR=w((mZ,uR)=>{"use strict";var $0=eR(),Op=lR();uR.exports=Op;Op.prototype.message=W0;Op.prototype.info=j0;Op.prototype.fail=B0;function W0(n,e,t){var r=new $0(n,e,t);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}o(W0,"message");function B0(){var n=this.message.apply(this,arguments);throw n.fatal=!0,n}o(B0,"fail");function j0(){var n=this.message.apply(this,arguments);return n.fatal=null,n}o(j0,"info")});var fR=w((gZ,dR)=>{"use strict";dR.exports=pR()});var SR=w((bZ,xR)=>{"use strict";var mR=AP(),V0=EP(),Mp=qP(),hR=WP(),yR=KP(),Ac=fR();xR.exports=IR().freeze();var G0=[].slice,H0={}.hasOwnProperty,z0=yR().use(K0).use(X0).use(J0);function K0(n,e){e.tree=n.parse(e.file)}o(K0,"pipelineParse");function X0(n,e,t){n.run(e.tree,e.file,r);function r(i,s,a){i?t(i):(e.tree=s,e.file=a,t())}o(r,"done")}o(X0,"pipelineRun");function J0(n,e){var t=n.stringify(e.tree,e.file);t==null||(typeof t=="string"||V0(t)?("value"in e.file&&(e.file.value=t),e.file.contents=t):e.file.result=t)}o(J0,"pipelineStringify");function IR(){var n=[],e=yR(),t={},r=-1,i;return s.data=c,s.freeze=a,s.attachers=n,s.use=l,s.parse=p,s.stringify=g,s.run=d,s.runSync=f,s.process=h,s.processSync=T,s;function s(){for(var S=IR(),C=-1;++C<n.length;)S.use.apply(null,n[C]);return S.data(Mp(!0,{},t)),S}o(s,"processor");function a(){var S,C;if(i)return s;for(;++r<n.length;)S=n[r],S[1]!==!1&&(S[1]===!0&&(S[1]=void 0),C=S[0].apply(s,S.slice(1)),typeof C=="function"&&e.use(C));return i=!0,r=1/0,s}o(a,"freeze");function c(S,C){return typeof S=="string"?arguments.length===2?(Uv("data",i),t[S]=C,s):H0.call(t,S)&&t[S]||null:S?(Uv("data",i),t=S,s):t}o(c,"data");function l(S){var C;if(Uv("use",i),S!=null)if(typeof S=="function")O.apply(null,arguments);else if(typeof S=="object")"length"in S?W(S):L(S);else throw new Error("Expected usable value, not `"+S+"`");return C&&(t.settings=Mp(t.settings||{},C)),s;function L(j){W(j.plugins),j.settings&&(C=Mp(C||{},j.settings))}o(L,"addPreset");function A(j){if(typeof j=="function")O(j);else if(typeof j=="object")"length"in j?O.apply(null,j):L(j);else throw new Error("Expected usable value, not `"+j+"`")}o(A,"add");function W(j){var J=-1;if(j!=null)if(typeof j=="object"&&"length"in j)for(;++J<j.length;)A(j[J]);else throw new Error("Expected a list of plugins, not `"+j+"`")}o(W,"addList");function O(j,J){var ie=u(j);ie?(hR(ie[1])&&hR(J)&&(J=Mp(!0,ie[1],J)),ie[1]=J):n.push(G0.call(arguments))}o(O,"addPlugin")}o(l,"use");function u(S){for(var C=-1;++C<n.length;)if(n[C][0]===S)return n[C]}o(u,"find");function p(S){var C=Ac(S),L;return a(),L=s.Parser,Ov("parse",L),gR(L,"parse")?new L(String(C),C).parse():L(String(C),C)}o(p,"parse");function d(S,C,L){if(bR(S),a(),!L&&typeof C=="function"&&(L=C,C=null),!L)return new Promise(A);A(null,L);function A(W,O){e.run(S,Ac(C),j);function j(J,ie,z){ie=ie||S,J?O(J):W?W(ie):L(null,ie,z)}o(j,"done")}o(A,"executor")}o(d,"run");function f(S,C){var L,A;return d(S,C,W),vR("runSync","run",A),L;function W(O,j){A=!0,L=j,mR(O)}o(W,"done")}o(f,"runSync");function g(S,C){var L=Ac(C),A;return a(),A=s.Compiler,Mv("stringify",A),bR(S),gR(A,"compile")?new A(S,L).compile():A(S,L)}o(g,"stringify");function h(S,C){if(a(),Ov("process",s.Parser),Mv("process",s.Compiler),!C)return new Promise(L);L(null,C);function L(A,W){var O=Ac(S);z0.run(s,{file:O},j);function j(J){J?W(J):A?A(O):C(null,O)}o(j,"done")}o(L,"executor")}o(h,"process");function T(S){var C,L;return a(),Ov("processSync",s.Parser),Mv("processSync",s.Compiler),C=Ac(S),h(C,A),vR("processSync","process",L),C;function A(W){L=!0,mR(W)}o(A,"done")}o(T,"processSync")}o(IR,"unified");function gR(n,e){return typeof n=="function"&&n.prototype&&(Q0(n.prototype)||e in n.prototype)}o(gR,"newable");function Q0(n){var e;for(e in n)return!0;return!1}o(Q0,"keys");function Ov(n,e){if(typeof e!="function")throw new Error("Cannot `"+n+"` without `Parser`")}o(Ov,"assertParser");function Mv(n,e){if(typeof e!="function")throw new Error("Cannot `"+n+"` without `Compiler`")}o(Mv,"assertCompiler");function Uv(n,e){if(e)throw new Error("Cannot invoke `"+n+"` on a frozen processor.\nCreate a new processor first, by invoking it: use `processor()` instead of `processor`.")}o(Uv,"assertUnfrozen");function bR(n){if(!n||typeof n.type!="string")throw new Error("Expected node, got `"+n+"`")}o(bR,"assertNode");function vR(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}o(vR,"assertDone")});var Up=w((yZ,CR)=>{"use strict";CR.exports=kR;function kR(n){return n&&(n.value||n.alt||n.title||"children"in n&&TR(n.children)||"length"in n&&TR(n))||""}o(kR,"toString");function TR(n){for(var e=[],t=-1;++t<n.length;)e[t]=kR(n[t]);return e.join("")}o(TR,"all")});var Ks=w((xZ,PR)=>{"use strict";var Y0=Object.assign;PR.exports=Y0});var qv=w((SZ,RR)=>{"use strict";var Z0={}.hasOwnProperty;RR.exports=Z0});var qp=w((TZ,AR)=>{"use strict";function eq(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}o(eq,"normalizeIdentifier");AR.exports=eq});var Lc=w((CZ,LR)=>{"use strict";var tq=String.fromCharCode;LR.exports=tq});var wR=w((PZ,ER)=>{"use strict";var nq=Lc();function rq(n,e){var t=parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"\uFFFD":nq(t)}o(rq,"safeFromInt");ER.exports=rq});var It=w((AZ,FR)=>{"use strict";function iq(n){return n<-2}o(iq,"markdownLineEnding");FR.exports=iq});var Rr=w((EZ,DR)=>{"use strict";function oq(n){return n===-2||n===-1||n===32}o(oq,"markdownSpace");DR.exports=oq});var Rt=w((FZ,_R)=>{"use strict";var NR=Rr();function sq(n,e,t,r){var i=r?r-1:1/0,s=0;return a;function a(l){return NR(l)?(n.enter(t),c(l)):e(l)}function c(l){return NR(l)&&s++<i?(n.consume(l),c):(n.exit(t),e(l))}}o(sq,"spaceFactory");_R.exports=sq});var OR=w($v=>{"use strict";Object.defineProperty($v,"__esModule",{value:!0});var aq=It(),cq=Rt(),lq=uq;function uq(n){var e=n.attempt(this.parser.constructs.contentInitial,r,i),t;return e;function r(c){if(c===null){n.consume(c);return}return n.enter("lineEnding"),n.consume(c),n.exit("lineEnding"),cq(n,e,"linePrefix")}function i(c){return n.enter("paragraph"),s(c)}function s(c){var l=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=l),t=l,a(c)}function a(c){if(c===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(c);return}return aq(c)?(n.consume(c),n.exit("chunkText"),s):(n.consume(c),a)}}o(uq,"initializeContent");$v.tokenize=lq});var Ec=w((OZ,MR)=>{"use strict";var pq=It(),dq=Rt(),fq={tokenize:mq,partial:!0};function mq(n,e,t){return dq(n,r,"linePrefix");function r(i){return i===null||pq(i)?e(i):t(i)}}o(mq,"tokenizePartialBlankLine");MR.exports=fq});var qR=w(Bv=>{"use strict";Object.defineProperty(Bv,"__esModule",{value:!0});var hq=It(),UR=Rt(),gq=Ec(),bq=yq,Wv={tokenize:Iq},vq={tokenize:xq};function yq(n){var e=this,t=[],r=0,i={tokenize:C,partial:!0},s,a,c;return l;function l(L){return r<t.length?(e.containerState=t[r][1],n.attempt(t[r][0].continuation,u,p)(L)):p(L)}function u(L){return r++,l(L)}function p(L){return s&&s.flowContinue?f(L):(e.interrupt=a&&a.currentConstruct&&a.currentConstruct.interruptible,e.containerState={},n.attempt(Wv,d,f)(L))}function d(L){return t.push([e.currentConstruct,e.containerState]),e.containerState=void 0,p(L)}function f(L){if(L===null){S(0,!0),n.consume(L);return}return a=a||e.parser.flow(e.now()),n.enter("chunkFlow",{contentType:"flow",previous:c,_tokenizer:a}),g(L)}function g(L){return L===null?(T(n.exit("chunkFlow")),f(L)):hq(L)?(n.consume(L),T(n.exit("chunkFlow")),n.check(i,h)):(n.consume(L),g)}function h(L){return S(s.continued,s&&s.flowEnd),r=0,l(L)}function T(L){c&&(c.next=L),c=L,a.lazy=s&&s.lazy,a.defineSkip(L.start),a.write(e.sliceStream(L))}function S(L,A){var W=t.length;for(a&&A&&(a.write([null]),c=a=void 0);W-- >L;)e.containerState=t[W][1],t[W][0].exit.call(e,n);t.length=L}function C(L,A){var W=0;return s={},O;function O(B){return W<t.length?(e.containerState=t[W][1],L.attempt(t[W][0].continuation,j,J)(B)):a.currentConstruct&&a.currentConstruct.concrete?(s.flowContinue=!0,M(B)):(e.interrupt=a.currentConstruct&&a.currentConstruct.interruptible,e.containerState={},L.attempt(Wv,z,M)(B))}o(O,"inspectStart");function j(B){return W++,e.containerState._closeFlow?z(B):O(B)}o(j,"inspectContinue");function J(B){return a.currentConstruct&&a.currentConstruct.lazy?(e.containerState={},L.attempt(Wv,z,L.attempt(vq,z,L.check(gq,z,ie)))(B)):z(B)}o(J,"inspectLess");function ie(B){return W=t.length,s.lazy=!0,s.flowContinue=!0,M(B)}o(ie,"inspectLazy");function z(B){return s.flowEnd=!0,M(B)}o(z,"inspectFlowEnd");function M(B){return s.continued=W,e.interrupt=e.containerState=void 0,A(B)}o(M,"inspectDone")}}o(yq,"initializeDocument");function Iq(n,e,t){return UR(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.indexOf("codeIndented")>-1?void 0:4)}o(Iq,"tokenizeContainer");function xq(n,e,t){return UR(n,n.lazy(this.parser.constructs.flow,e,t),"linePrefix",this.parser.constructs.disable.null.indexOf("codeIndented")>-1?void 0:4)}o(xq,"tokenizeLazyFlow");Bv.tokenize=bq});var jv=w(($Z,$R)=>{"use strict";function Sq(n){for(var e=-1,t=0;++e<n.length;)t+=typeof n[e]=="string"?n[e].length:1;return t}o(Sq,"sizeChunks");$R.exports=Sq});var Xs=w((BZ,WR)=>{"use strict";var Tq=jv();function kq(n,e){var t=n[n.length-1];return!t||t[1].type!==e?0:Tq(t[2].sliceStream(t[1]))}o(kq,"prefixSize");WR.exports=kq});var jR=w((VZ,BR)=>{"use strict";var Cq=[].splice;BR.exports=Cq});var Ar=w((GZ,VR)=>{"use strict";var Vv=jR();function Pq(n,e,t,r){var i=n.length,s=0,a;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,t=t>0?t:0,r.length<1e4)a=Array.from(r),a.unshift(e,t),Vv.apply(n,a);else for(t&&Vv.apply(n,[e,t]);s<r.length;)a=r.slice(s,s+1e4),a.unshift(e,0),Vv.apply(n,a),s+=1e4,e+=1e4}o(Pq,"chunkedSplice");VR.exports=Pq});var Di=w((zZ,GR)=>{"use strict";var Rq=Ks();function Aq(n){return Rq({},n)}o(Aq,"shallow");GR.exports=Aq});var Gv=w((XZ,zR)=>{"use strict";var Lq=Ks(),HR=Ar(),Eq=Di();function wq(n){for(var e={},t=-1,r,i,s,a,c,l,u;++t<n.length;){for(;t in e;)t=e[t];if(r=n[t],t&&r[1].type==="chunkFlow"&&n[t-1][1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,s=0,s<l.length&&l[s][1].type==="lineEndingBlank"&&(s+=2),s<l.length&&l[s][1].type==="content"))for(;++s<l.length&&l[s][1].type!=="content";)l[s][1].type==="chunkText"&&(l[s][1].isInFirstContentOfListItem=!0,s++);if(r[0]==="enter")r[1].contentType&&(Lq(e,Fq(n,t)),t=e[t],u=!0);else if(r[1]._container||r[1]._movePreviousLineEndings){for(s=t,i=void 0;s--&&(a=n[s],a[1].type==="lineEnding"||a[1].type==="lineEndingBlank");)a[0]==="enter"&&(i&&(n[i][1].type="lineEndingBlank"),a[1].type="lineEnding",i=s);i&&(r[1].end=Eq(n[i][1].start),c=n.slice(i,t),c.unshift(r),HR(n,i,t-i+1,c))}}return!u}o(wq,"subtokenize");function Fq(n,e){for(var t=n[e][1],r=n[e][2],i=e-1,s=[],a=t._tokenizer||r.parser[t.contentType](t.start),c=a.events,l=[],u={},p,d,f,g,h,T;t;){for(;n[++i][1]!==t;);s.push(i),t._tokenizer||(p=r.sliceStream(t),t.next||p.push(null),d&&a.defineSkip(t.start),t.isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(p),t.isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=t,t=t.next}for(t=d,f=c.length;f--;)c[f][0]==="enter"?g=!0:g&&c[f][1].type===c[f-1][1].type&&c[f][1].start.line!==c[f][1].end.line&&(S(c.slice(f+1,h)),t._tokenizer=t.next=void 0,t=t.previous,h=f+1);for(a.events=t._tokenizer=t.next=void 0,S(c.slice(0,h)),f=-1,T=0;++f<l.length;)u[T+l[f][0]]=T+l[f][1],T+=l[f][1]-l[f][0]-1;return u;function S(C){var L=s.pop();l.unshift([L,L+C.length-1]),HR(n,L,2,C)}}o(Fq,"subcontent");zR.exports=wq});var JR=w((QZ,XR)=>{"use strict";var KR=It(),Dq=Xs(),Nq=Gv(),_q=Rt(),Oq={tokenize:qq,resolve:Uq,interruptible:!0,lazy:!0},Mq={tokenize:$q,partial:!0};function Uq(n){return Nq(n),n}o(Uq,"resolveContent");function qq(n,e){var t;return r;function r(c){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),i(c)}function i(c){return c===null?s(c):KR(c)?n.check(Mq,a,s)(c):(n.consume(c),i)}function s(c){return n.exit("chunkContent"),n.exit("content"),e(c)}function a(c){return n.consume(c),n.exit("chunkContent"),t=t.next=n.enter("chunkContent",{contentType:"content",previous:t}),i}}o(qq,"tokenizeContent");function $q(n,e,t){var r=this;return i;function i(a){return n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),_q(n,s,"linePrefix")}function s(a){return a===null||KR(a)?t(a):r.parser.constructs.disable.null.indexOf("codeIndented")>-1||Dq(r.events,"linePrefix")<4?n.interrupt(r.parser.constructs.flow,t,e)(a):e(a)}}o($q,"tokenizeContinuation");XR.exports=Oq});var QR=w(Hv=>{"use strict";Object.defineProperty(Hv,"__esModule",{value:!0});var Wq=JR(),Bq=Rt(),jq=Ec(),Vq=Gq;function Gq(n){var e=this,t=n.attempt(jq,r,n.attempt(this.parser.constructs.flowInitial,i,Bq(n,n.attempt(this.parser.constructs.flow,i,n.attempt(Wq,i)),"linePrefix")));return t;function r(s){if(s===null){n.consume(s);return}return n.enter("lineEndingBlank"),n.consume(s),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function i(s){if(s===null){n.consume(s);return}return n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),e.currentConstruct=void 0,t}}o(Gq,"initializeFlow");Hv.tokenize=Vq});var zv=w(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});var Hq=Ks(),YR=Di(),zq=ZR("text"),Kq=ZR("string"),Xq={resolveAll:eA()};function ZR(n){return{tokenize:e,resolveAll:eA(n==="text"?Jq:void 0)};function e(t){var r=this,i=this.parser.constructs[n],s=t.attempt(i,a,c);return a;function a(p){return u(p)?s(p):c(p)}function c(p){if(p===null){t.consume(p);return}return t.enter("data"),t.consume(p),l}function l(p){return u(p)?(t.exit("data"),s(p)):(t.consume(p),l)}function u(p){var d=i[p],f=-1;if(p===null)return!0;if(d){for(;++f<d.length;)if(!d[f].previous||d[f].previous.call(r,r.previous))return!0}}}}o(ZR,"initializeFactory");function eA(n){return e;function e(t,r){for(var i=-1,s;++i<=t.length;)s===void 0?t[i]&&t[i][1].type==="data"&&(s=i,i++):(!t[i]||t[i][1].type!=="data")&&(i!==s+2&&(t[s][1].end=t[i-1][1].end,t.splice(s+2,i-s-2),i=s+2),s=void 0);return n?n(t,r):t}}o(eA,"createResolver");function Jq(n,e){for(var t=-1,r,i,s,a,c,l,u,p;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){for(i=n[t-1][1],r=e.sliceStream(i),a=r.length,c=-1,l=0,u=void 0;a--;)if(s=r[a],typeof s=="string"){for(c=s.length;s.charCodeAt(c-1)===32;)l++,c--;if(c)break;c=-1}else if(s===-2)u=!0,l++;else if(s!==-1){a++;break}l&&(p={type:t===n.length||u||l<2?"lineSuffix":"hardBreakTrailing",start:{line:i.end.line,column:i.end.column-l,offset:i.end.offset-l,_index:i.start._index+a,_bufferIndex:a?c:i.start._bufferIndex+c},end:YR(i.end)},i.end=YR(p.start),i.start.offset===i.end.offset?Hq(i,p):(n.splice(t,0,["enter",p,e],["exit",p,e]),t+=2)),t++}return n}o(Jq,"resolveAllLineSuffixes");wc.resolver=Xq;wc.string=Kq;wc.text=zq});var $p=w((ree,tA)=>{"use strict";function Qq(n){return n==null?[]:"length"in n?n:[n]}o(Qq,"miniflat");tA.exports=Qq});var Kv=w((oee,rA)=>{"use strict";var nA=qv(),Yq=Ar(),Zq=$p();function e$(n){for(var e={},t=-1;++t<n.length;)t$(e,n[t]);return e}o(e$,"combineExtensions");function t$(n,e){var t,r,i,s;for(t in e){r=nA.call(n,t)?n[t]:n[t]={},i=e[t];for(s in i)r[s]=n$(Zq(i[s]),nA.call(r,s)?r[s]:[])}}o(t$,"extension");function n$(n,e){for(var t=-1,r=[];++t<n.length;)(n[t].add==="after"?e:r).push(n[t]);return Yq(e,0,0,r),e}o(n$,"constructs");rA.exports=e$});var Wp=w((aee,iA)=>{"use strict";var r$=Ar();function i$(n,e){return n.length?(r$(n,n.length,0,e),n):e}o(i$,"chunkedPush");iA.exports=i$});var Fc=w((lee,oA)=>{"use strict";function o$(n,e,t){for(var r=[],i=-1,s;++i<n.length;)s=n[i].resolveAll,s&&r.indexOf(s)<0&&(e=s(e,t),r.push(s));return e}o(o$,"resolveAll");oA.exports=o$});var aA=w((pee,sA)=>{"use strict";var s$=Lc();function a$(n){for(var e=-1,t=[],r,i,s;++e<n.length;){if(r=n[e],typeof r=="string")i=r;else if(r===-5)i="\r";else if(r===-4)i=`
`;else if(r===-3)i=`\r
`;else if(r===-2)i="	";else if(r===-1){if(s)continue;i=" "}else i=s$(r);s=r===-2,t.push(i)}return t.join("")}o(a$,"serializeChunks");sA.exports=a$});var lA=w((fee,cA)=>{"use strict";function c$(n,e){var t=e.start._index,r=e.start._bufferIndex,i=e.end._index,s=e.end._bufferIndex,a;return t===i?a=[n[t].slice(r,s)]:(a=n.slice(t,i),r>-1&&(a[0]=a[0].slice(r)),s>0&&a.push(n[i].slice(0,s))),a}o(c$,"sliceChunks");cA.exports=c$});var dA=w((hee,pA)=>{"use strict";var l$=Ks(),u$=It(),p$=Wp(),d$=Ar(),Xv=$p(),f$=Fc(),m$=aA(),uA=Di(),h$=lA();function g$(n,e,t){var r=t?uA(t):{line:1,column:1,offset:0},i={},s=[],a=[],c=[],l={consume:L,enter:A,exit:W,attempt:J(O),check:J(j),interrupt:J(j,{interrupt:!0}),lazy:J(j,{lazy:!0})},u={previous:null,events:[],parser:n,sliceStream:g,sliceSerialize:f,now:h,defineSkip:T,write:d},p=e.tokenize.call(u,l);return e.resolveAll&&s.push(e),r._index=0,r._bufferIndex=-1,u;function d(B){return a=p$(a,B),S(),a[a.length-1]!==null?[]:(ie(e,0),u.events=f$(s,u.events,u),u.events)}o(d,"write");function f(B){return m$(g(B))}o(f,"sliceSerialize");function g(B){return h$(a,B)}o(g,"sliceStream");function h(){return uA(r)}o(h,"now");function T(B){i[B.line]=B.column,M()}o(T,"skip");function S(){for(var B,Y;r._index<a.length;)if(Y=a[r._index],typeof Y=="string")for(B=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===B&&r._bufferIndex<Y.length;)C(Y.charCodeAt(r._bufferIndex));else C(Y)}o(S,"main");function C(B){p=p(B)}o(C,"go");function L(B){u$(B)?(r.line++,r.column=1,r.offset+=B===-3?2:1,M()):B!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===a[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=B}o(L,"consume");function A(B,Y){var ae=Y||{};return ae.type=B,ae.start=h(),u.events.push(["enter",ae,u]),c.push(ae),ae}o(A,"enter");function W(B){var Y=c.pop();return Y.end=h(),u.events.push(["exit",Y,u]),Y}o(W,"exit");function O(B,Y){ie(B,Y.from)}o(O,"onsuccessfulconstruct");function j(B,Y){Y.restore()}o(j,"onsuccessfulcheck");function J(B,Y){return ae;function ae(de,He,Je){var _,Ue,at,nt;return de.tokenize||"length"in de?Hn(Xv(de)):v;function v(ct){return ct in de||null in de?Hn(de.null?Xv(de[ct]).concat(Xv(de.null)):de[ct])(ct):Je(ct)}function Hn(ct){return _=ct,Ue=0,pi(ct[Ue])}function pi(ct){return Gi;function Gi(Hi){return nt=z(),at=ct,ct.partial||(u.currentConstruct=ct),ct.name&&u.parser.constructs.disable.null.indexOf(ct.name)>-1?qr():ct.tokenize.call(Y?l$({},u,Y):u,l,di,qr)(Hi)}}function di(ct){return B(at,nt),He}function qr(ct){return nt.restore(),++Ue<_.length?pi(_[Ue]):Je}}}o(J,"constructFactory");function ie(B,Y){B.resolveAll&&s.indexOf(B)<0&&s.push(B),B.resolve&&d$(u.events,Y,u.events.length-Y,B.resolve(u.events.slice(Y),u)),B.resolveTo&&(u.events=B.resolveTo(u.events,u))}o(ie,"addResult");function z(){var B=h(),Y=u.previous,ae=u.currentConstruct,de=u.events.length,He=Array.from(c);return{restore:Je,from:de};function Je(){r=B,u.previous=Y,u.currentConstruct=ae,u.events.length=de,c=He,M()}}o(z,"store");function M(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}o(M,"accountForPotentialSkip")}o(g$,"createTokenizer");pA.exports=g$});var Lr=w((bee,fA)=>{"use strict";function b$(n){return n<0||n===32}o(b$,"markdownLineEndingOrSpace");fA.exports=b$});var hA=w((yee,mA)=>{"use strict";var v$=/[!-\/:-@\[-`\{-~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/;mA.exports=v$});var ni=w((Iee,gA)=>{"use strict";var y$=Lc();function I$(n){return e;function e(t){return n.test(y$(t))}}o(I$,"regexCheck");gA.exports=I$});var Bp=w((See,bA)=>{"use strict";var x$=hA(),S$=ni(),T$=S$(x$);bA.exports=T$});var jp=w((Tee,vA)=>{"use strict";var k$=ni(),C$=k$(/\s/);vA.exports=C$});var Jv=w((kee,yA)=>{"use strict";var P$=Lr(),R$=Bp(),A$=jp();function L$(n){if(n===null||P$(n)||A$(n))return 1;if(R$(n))return 2}o(L$,"classifyCharacter");yA.exports=L$});var xA=w((Pee,IA)=>{"use strict";function E$(n,e){return n.column+=e,n.offset+=e,n._bufferIndex+=e,n}o(E$,"movePoint");IA.exports=E$});var CA=w((Aee,kA)=>{"use strict";var Dc=Wp(),w$=Ar(),SA=Jv(),TA=xA(),F$=Fc(),Er=Di(),D$={name:"attention",tokenize:_$,resolveAll:N$};function N$(n,e){for(var t=-1,r,i,s,a,c,l,u,p;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(r=t;r--;)if(n[r][0]==="exit"&&n[r][1].type==="attentionSequence"&&n[r][1]._open&&e.sliceSerialize(n[r][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[r][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[r][1].end.offset-n[r][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;l=n[r][1].end.offset-n[r][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1,a={type:l>1?"strongSequence":"emphasisSequence",start:TA(Er(n[r][1].end),-l),end:Er(n[r][1].end)},c={type:l>1?"strongSequence":"emphasisSequence",start:Er(n[t][1].start),end:TA(Er(n[t][1].start),l)},s={type:l>1?"strongText":"emphasisText",start:Er(n[r][1].end),end:Er(n[t][1].start)},i={type:l>1?"strong":"emphasis",start:Er(a.start),end:Er(c.end)},n[r][1].end=Er(a.start),n[t][1].start=Er(c.end),u=[],n[r][1].end.offset-n[r][1].start.offset&&(u=Dc(u,[["enter",n[r][1],e],["exit",n[r][1],e]])),u=Dc(u,[["enter",i,e],["enter",a,e],["exit",a,e],["enter",s,e]]),u=Dc(u,F$(e.parser.constructs.insideSpan.null,n.slice(r+1,t),e)),u=Dc(u,[["exit",s,e],["enter",c,e],["exit",c,e],["exit",i,e]]),n[t][1].end.offset-n[t][1].start.offset?(p=2,u=Dc(u,[["enter",n[t][1],e],["exit",n[t][1],e]])):p=0,w$(n,r-1,t-r+3,u),t=r+u.length-p-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}o(N$,"resolveAllAttention");function _$(n,e){var t=SA(this.previous),r;return i;function i(a){return n.enter("attentionSequence"),r=a,s(a)}function s(a){var c,l,u,p;return a===r?(n.consume(a),s):(c=n.exit("attentionSequence"),l=SA(a),u=!l||l===2&&t,p=!t||t===2&&l,c._open=r===42?u:u&&(t||!p),c._close=r===42?p:p&&(l||!u),e(a))}}o(_$,"tokenizeAttention");kA.exports=D$});var Nc=w((Eee,PA)=>{"use strict";var O$=ni(),M$=O$(/[A-Za-z]/);PA.exports=M$});var Js=w((wee,RA)=>{"use strict";var U$=ni(),q$=U$(/[\dA-Za-z]/);RA.exports=q$});var LA=w((Fee,AA)=>{"use strict";var $$=ni(),W$=$$(/[#-'*+\--9=?A-Z^-~]/);AA.exports=W$});var Vp=w((Dee,EA)=>{"use strict";function B$(n){return n<32||n===127}o(B$,"asciiControl");EA.exports=B$});var DA=w((_ee,FA)=>{"use strict";var j$=Nc(),Gp=Js(),wA=LA(),V$=Vp(),G$={name:"autolink",tokenize:H$};function H$(n,e,t){var r=1;return i;function i(h){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),s}function s(h){return j$(h)?(n.consume(h),a):wA(h)?u(h):t(h)}function a(h){return h===43||h===45||h===46||Gp(h)?c(h):u(h)}function c(h){return h===58?(n.consume(h),l):(h===43||h===45||h===46||Gp(h))&&r++<32?(n.consume(h),c):u(h)}function l(h){return h===62?(n.exit("autolinkProtocol"),g(h)):h===32||h===60||V$(h)?t(h):(n.consume(h),l)}function u(h){return h===64?(n.consume(h),r=0,p):wA(h)?(n.consume(h),u):t(h)}function p(h){return Gp(h)?d(h):t(h)}function d(h){return h===46?(n.consume(h),r=0,p):h===62?(n.exit("autolinkProtocol").type="autolinkEmail",g(h)):f(h)}function f(h){return(h===45||Gp(h))&&r++<63?(n.consume(h),h===45?f:d):t(h)}function g(h){return n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.exit("autolink"),e}}o(H$,"tokenizeAutolink");FA.exports=G$});var OA=w((Mee,_A)=>{"use strict";var z$=Rr(),K$=Rt(),NA={name:"blockQuote",tokenize:X$,continuation:{tokenize:J$},exit:Q$};function X$(n,e,t){var r=this;return i;function i(a){return a===62?(r.containerState.open||(n.enter("blockQuote",{_container:!0}),r.containerState.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(a),n.exit("blockQuoteMarker"),s):t(a)}function s(a){return z$(a)?(n.enter("blockQuotePrefixWhitespace"),n.consume(a),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(a))}}o(X$,"tokenizeBlockQuoteStart");function J$(n,e,t){return K$(n,n.attempt(NA,e,t),"linePrefix",this.parser.constructs.disable.null.indexOf("codeIndented")>-1?void 0:4)}o(J$,"tokenizeBlockQuoteContinuation");function Q$(n){n.exit("blockQuote")}o(Q$,"exit");_A.exports=NA});var UA=w((qee,MA)=>{"use strict";var Y$=ni(),Z$=Y$(/[!-/:-@[-`{-~]/);MA.exports=Z$});var $A=w(($ee,qA)=>{"use strict";var eW=UA(),tW={name:"characterEscape",tokenize:nW};function nW(n,e,t){return r;function r(s){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(s),n.exit("escapeMarker"),i}function i(s){return eW(s)?(n.enter("characterEscapeValue"),n.consume(s),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(s)}}o(nW,"tokenizeCharacterEscape");qA.exports=tW});var WA=w((Bee,rW)=>{rW.exports={AEli:"\xC6",AElig:"\xC6",AM:"&",AMP:"&",Aacut:"\xC1",Aacute:"\xC1",Abreve:"\u0102",Acir:"\xC2",Acirc:"\xC2",Acy:"\u0410",Afr:"\u{1D504}",Agrav:"\xC0",Agrave:"\xC0",Alpha:"\u0391",Amacr:"\u0100",And:"\u2A53",Aogon:"\u0104",Aopf:"\u{1D538}",ApplyFunction:"\u2061",Arin:"\xC5",Aring:"\xC5",Ascr:"\u{1D49C}",Assign:"\u2254",Atild:"\xC3",Atilde:"\xC3",Aum:"\xC4",Auml:"\xC4",Backslash:"\u2216",Barv:"\u2AE7",Barwed:"\u2306",Bcy:"\u0411",Because:"\u2235",Bernoullis:"\u212C",Beta:"\u0392",Bfr:"\u{1D505}",Bopf:"\u{1D539}",Breve:"\u02D8",Bscr:"\u212C",Bumpeq:"\u224E",CHcy:"\u0427",COP:"\xA9",COPY:"\xA9",Cacute:"\u0106",Cap:"\u22D2",CapitalDifferentialD:"\u2145",Cayleys:"\u212D",Ccaron:"\u010C",Ccedi:"\xC7",Ccedil:"\xC7",Ccirc:"\u0108",Cconint:"\u2230",Cdot:"\u010A",Cedilla:"\xB8",CenterDot:"\xB7",Cfr:"\u212D",Chi:"\u03A7",CircleDot:"\u2299",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",Colon:"\u2237",Colone:"\u2A74",Congruent:"\u2261",Conint:"\u222F",ContourIntegral:"\u222E",Copf:"\u2102",Coproduct:"\u2210",CounterClockwiseContourIntegral:"\u2233",Cross:"\u2A2F",Cscr:"\u{1D49E}",Cup:"\u22D3",CupCap:"\u224D",DD:"\u2145",DDotrahd:"\u2911",DJcy:"\u0402",DScy:"\u0405",DZcy:"\u040F",Dagger:"\u2021",Darr:"\u21A1",Dashv:"\u2AE4",Dcaron:"\u010E",Dcy:"\u0414",Del:"\u2207",Delta:"\u0394",Dfr:"\u{1D507}",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",Diamond:"\u22C4",DifferentialD:"\u2146",Dopf:"\u{1D53B}",Dot:"\xA8",DotDot:"\u20DC",DotEqual:"\u2250",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrow:"\u2193",DownArrowBar:"\u2913",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVector:"\u21BD",DownLeftVectorBar:"\u2956",DownRightTeeVector:"\u295F",DownRightVector:"\u21C1",DownRightVectorBar:"\u2957",DownTee:"\u22A4",DownTeeArrow:"\u21A7",Downarrow:"\u21D3",Dscr:"\u{1D49F}",Dstrok:"\u0110",ENG:"\u014A",ET:"\xD0",ETH:"\xD0",Eacut:"\xC9",Eacute:"\xC9",Ecaron:"\u011A",Ecir:"\xCA",Ecirc:"\xCA",Ecy:"\u042D",Edot:"\u0116",Efr:"\u{1D508}",Egrav:"\xC8",Egrave:"\xC8",Element:"\u2208",Emacr:"\u0112",EmptySmallSquare:"\u25FB",EmptyVerySmallSquare:"\u25AB",Eogon:"\u0118",Eopf:"\u{1D53C}",Epsilon:"\u0395",Equal:"\u2A75",EqualTilde:"\u2242",Equilibrium:"\u21CC",Escr:"\u2130",Esim:"\u2A73",Eta:"\u0397",Eum:"\xCB",Euml:"\xCB",Exists:"\u2203",ExponentialE:"\u2147",Fcy:"\u0424",Ffr:"\u{1D509}",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",Fopf:"\u{1D53D}",ForAll:"\u2200",Fouriertrf:"\u2131",Fscr:"\u2131",GJcy:"\u0403",G:">",GT:">",Gamma:"\u0393",Gammad:"\u03DC",Gbreve:"\u011E",Gcedil:"\u0122",Gcirc:"\u011C",Gcy:"\u0413",Gdot:"\u0120",Gfr:"\u{1D50A}",Gg:"\u22D9",Gopf:"\u{1D53E}",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",Gt:"\u226B",HARDcy:"\u042A",Hacek:"\u02C7",Hat:"^",Hcirc:"\u0124",Hfr:"\u210C",HilbertSpace:"\u210B",Hopf:"\u210D",HorizontalLine:"\u2500",Hscr:"\u210B",Hstrok:"\u0126",HumpDownHump:"\u224E",HumpEqual:"\u224F",IEcy:"\u0415",IJlig:"\u0132",IOcy:"\u0401",Iacut:"\xCD",Iacute:"\xCD",Icir:"\xCE",Icirc:"\xCE",Icy:"\u0418",Idot:"\u0130",Ifr:"\u2111",Igrav:"\xCC",Igrave:"\xCC",Im:"\u2111",Imacr:"\u012A",ImaginaryI:"\u2148",Implies:"\u21D2",Int:"\u222C",Integral:"\u222B",Intersection:"\u22C2",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",Iogon:"\u012E",Iopf:"\u{1D540}",Iota:"\u0399",Iscr:"\u2110",Itilde:"\u0128",Iukcy:"\u0406",Ium:"\xCF",Iuml:"\xCF",Jcirc:"\u0134",Jcy:"\u0419",Jfr:"\u{1D50D}",Jopf:"\u{1D541}",Jscr:"\u{1D4A5}",Jsercy:"\u0408",Jukcy:"\u0404",KHcy:"\u0425",KJcy:"\u040C",Kappa:"\u039A",Kcedil:"\u0136",Kcy:"\u041A",Kfr:"\u{1D50E}",Kopf:"\u{1D542}",Kscr:"\u{1D4A6}",LJcy:"\u0409",L:"<",LT:"<",Lacute:"\u0139",Lambda:"\u039B",Lang:"\u27EA",Laplacetrf:"\u2112",Larr:"\u219E",Lcaron:"\u013D",Lcedil:"\u013B",Lcy:"\u041B",LeftAngleBracket:"\u27E8",LeftArrow:"\u2190",LeftArrowBar:"\u21E4",LeftArrowRightArrow:"\u21C6",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVector:"\u21C3",LeftDownVectorBar:"\u2959",LeftFloor:"\u230A",LeftRightArrow:"\u2194",LeftRightVector:"\u294E",LeftTee:"\u22A3",LeftTeeArrow:"\u21A4",LeftTeeVector:"\u295A",LeftTriangle:"\u22B2",LeftTriangleBar:"\u29CF",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVector:"\u21BF",LeftUpVectorBar:"\u2958",LeftVector:"\u21BC",LeftVectorBar:"\u2952",Leftarrow:"\u21D0",Leftrightarrow:"\u21D4",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",LessLess:"\u2AA1",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",Lfr:"\u{1D50F}",Ll:"\u22D8",Lleftarrow:"\u21DA",Lmidot:"\u013F",LongLeftArrow:"\u27F5",LongLeftRightArrow:"\u27F7",LongRightArrow:"\u27F6",Longleftarrow:"\u27F8",Longleftrightarrow:"\u27FA",Longrightarrow:"\u27F9",Lopf:"\u{1D543}",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",Lscr:"\u2112",Lsh:"\u21B0",Lstrok:"\u0141",Lt:"\u226A",Map:"\u2905",Mcy:"\u041C",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",MinusPlus:"\u2213",Mopf:"\u{1D544}",Mscr:"\u2133",Mu:"\u039C",NJcy:"\u040A",Nacute:"\u0143",Ncaron:"\u0147",Ncedil:"\u0145",Ncy:"\u041D",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,Nfr:"\u{1D511}",NoBreak:"\u2060",NonBreakingSpace:"\xA0",Nopf:"\u2115",Not:"\u2AEC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",NotLeftTriangle:"\u22EA",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangle:"\u22EB",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",Nscr:"\u{1D4A9}",Ntild:"\xD1",Ntilde:"\xD1",Nu:"\u039D",OElig:"\u0152",Oacut:"\xD3",Oacute:"\xD3",Ocir:"\xD4",Ocirc:"\xD4",Ocy:"\u041E",Odblac:"\u0150",Ofr:"\u{1D512}",Ograv:"\xD2",Ograve:"\xD2",Omacr:"\u014C",Omega:"\u03A9",Omicron:"\u039F",Oopf:"\u{1D546}",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",Or:"\u2A54",Oscr:"\u{1D4AA}",Oslas:"\xD8",Oslash:"\xD8",Otild:"\xD5",Otilde:"\xD5",Otimes:"\u2A37",Oum:"\xD6",Ouml:"\xD6",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",PartialD:"\u2202",Pcy:"\u041F",Pfr:"\u{1D513}",Phi:"\u03A6",Pi:"\u03A0",PlusMinus:"\xB1",Poincareplane:"\u210C",Popf:"\u2119",Pr:"\u2ABB",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",Prime:"\u2033",Product:"\u220F",Proportion:"\u2237",Proportional:"\u221D",Pscr:"\u{1D4AB}",Psi:"\u03A8",QUO:'"',QUOT:'"',Qfr:"\u{1D514}",Qopf:"\u211A",Qscr:"\u{1D4AC}",RBarr:"\u2910",RE:"\xAE",REG:"\xAE",Racute:"\u0154",Rang:"\u27EB",Rarr:"\u21A0",Rarrtl:"\u2916",Rcaron:"\u0158",Rcedil:"\u0156",Rcy:"\u0420",Re:"\u211C",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",Rfr:"\u211C",Rho:"\u03A1",RightAngleBracket:"\u27E9",RightArrow:"\u2192",RightArrowBar:"\u21E5",RightArrowLeftArrow:"\u21C4",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVector:"\u21C2",RightDownVectorBar:"\u2955",RightFloor:"\u230B",RightTee:"\u22A2",RightTeeArrow:"\u21A6",RightTeeVector:"\u295B",RightTriangle:"\u22B3",RightTriangleBar:"\u29D0",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVector:"\u21BE",RightUpVectorBar:"\u2954",RightVector:"\u21C0",RightVectorBar:"\u2953",Rightarrow:"\u21D2",Ropf:"\u211D",RoundImplies:"\u2970",Rrightarrow:"\u21DB",Rscr:"\u211B",Rsh:"\u21B1",RuleDelayed:"\u29F4",SHCHcy:"\u0429",SHcy:"\u0428",SOFTcy:"\u042C",Sacute:"\u015A",Sc:"\u2ABC",Scaron:"\u0160",Scedil:"\u015E",Scirc:"\u015C",Scy:"\u0421",Sfr:"\u{1D516}",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",Sigma:"\u03A3",SmallCircle:"\u2218",Sopf:"\u{1D54A}",Sqrt:"\u221A",Square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",Sscr:"\u{1D4AE}",Star:"\u22C6",Sub:"\u22D0",Subset:"\u22D0",SubsetEqual:"\u2286",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",SuchThat:"\u220B",Sum:"\u2211",Sup:"\u22D1",Superset:"\u2283",SupersetEqual:"\u2287",Supset:"\u22D1",THOR:"\xDE",THORN:"\xDE",TRADE:"\u2122",TSHcy:"\u040B",TScy:"\u0426",Tab:"	",Tau:"\u03A4",Tcaron:"\u0164",Tcedil:"\u0162",Tcy:"\u0422",Tfr:"\u{1D517}",Therefore:"\u2234",Theta:"\u0398",ThickSpace:"\u205F\u200A",ThinSpace:"\u2009",Tilde:"\u223C",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",Topf:"\u{1D54B}",TripleDot:"\u20DB",Tscr:"\u{1D4AF}",Tstrok:"\u0166",Uacut:"\xDA",Uacute:"\xDA",Uarr:"\u219F",Uarrocir:"\u2949",Ubrcy:"\u040E",Ubreve:"\u016C",Ucir:"\xDB",Ucirc:"\xDB",Ucy:"\u0423",Udblac:"\u0170",Ufr:"\u{1D518}",Ugrav:"\xD9",Ugrave:"\xD9",Umacr:"\u016A",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",Uopf:"\u{1D54C}",UpArrow:"\u2191",UpArrowBar:"\u2912",UpArrowDownArrow:"\u21C5",UpDownArrow:"\u2195",UpEquilibrium:"\u296E",UpTee:"\u22A5",UpTeeArrow:"\u21A5",Uparrow:"\u21D1",Updownarrow:"\u21D5",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",Upsi:"\u03D2",Upsilon:"\u03A5",Uring:"\u016E",Uscr:"\u{1D4B0}",Utilde:"\u0168",Uum:"\xDC",Uuml:"\xDC",VDash:"\u22AB",Vbar:"\u2AEB",Vcy:"\u0412",Vdash:"\u22A9",Vdashl:"\u2AE6",Vee:"\u22C1",Verbar:"\u2016",Vert:"\u2016",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",Vopf:"\u{1D54D}",Vscr:"\u{1D4B1}",Vvdash:"\u22AA",Wcirc:"\u0174",Wedge:"\u22C0",Wfr:"\u{1D51A}",Wopf:"\u{1D54E}",Wscr:"\u{1D4B2}",Xfr:"\u{1D51B}",Xi:"\u039E",Xopf:"\u{1D54F}",Xscr:"\u{1D4B3}",YAcy:"\u042F",YIcy:"\u0407",YUcy:"\u042E",Yacut:"\xDD",Yacute:"\xDD",Ycirc:"\u0176",Ycy:"\u042B",Yfr:"\u{1D51C}",Yopf:"\u{1D550}",Yscr:"\u{1D4B4}",Yuml:"\u0178",ZHcy:"\u0416",Zacute:"\u0179",Zcaron:"\u017D",Zcy:"\u0417",Zdot:"\u017B",ZeroWidthSpace:"\u200B",Zeta:"\u0396",Zfr:"\u2128",Zopf:"\u2124",Zscr:"\u{1D4B5}",aacut:"\xE1",aacute:"\xE1",abreve:"\u0103",ac:"\u223E",acE:"\u223E\u0333",acd:"\u223F",acir:"\xE2",acirc:"\xE2",acut:"\xB4",acute:"\xB4",acy:"\u0430",aeli:"\xE6",aelig:"\xE6",af:"\u2061",afr:"\u{1D51E}",agrav:"\xE0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",alpha:"\u03B1",amacr:"\u0101",amalg:"\u2A3F",am:"&",amp:"&",and:"\u2227",andand:"\u2A55",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsd:"\u2221",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",aogon:"\u0105",aopf:"\u{1D552}",ap:"\u2248",apE:"\u2A70",apacir:"\u2A6F",ape:"\u224A",apid:"\u224B",apos:"'",approx:"\u2248",approxeq:"\u224A",arin:"\xE5",aring:"\xE5",ascr:"\u{1D4B6}",ast:"*",asymp:"\u2248",asympeq:"\u224D",atild:"\xE3",atilde:"\xE3",aum:"\xE4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",bNot:"\u2AED",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",barvee:"\u22BD",barwed:"\u2305",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",beta:"\u03B2",beth:"\u2136",between:"\u226C",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bnot:"\u2310",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxDL:"\u2557",boxDR:"\u2554",boxDl:"\u2556",boxDr:"\u2553",boxH:"\u2550",boxHD:"\u2566",boxHU:"\u2569",boxHd:"\u2564",boxHu:"\u2567",boxUL:"\u255D",boxUR:"\u255A",boxUl:"\u255C",boxUr:"\u2559",boxV:"\u2551",boxVH:"\u256C",boxVL:"\u2563",boxVR:"\u2560",boxVh:"\u256B",boxVl:"\u2562",boxVr:"\u255F",boxbox:"\u29C9",boxdL:"\u2555",boxdR:"\u2552",boxdl:"\u2510",boxdr:"\u250C",boxh:"\u2500",boxhD:"\u2565",boxhU:"\u2568",boxhd:"\u252C",boxhu:"\u2534",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxuL:"\u255B",boxuR:"\u2558",boxul:"\u2518",boxur:"\u2514",boxv:"\u2502",boxvH:"\u256A",boxvL:"\u2561",boxvR:"\u255E",boxvh:"\u253C",boxvl:"\u2524",boxvr:"\u251C",bprime:"\u2035",breve:"\u02D8",brvba:"\xA6",brvbar:"\xA6",bscr:"\u{1D4B7}",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsol:"\\",bsolb:"\u29C5",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",bumpeq:"\u224F",cacute:"\u0107",cap:"\u2229",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",capcup:"\u2A47",capdot:"\u2A40",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",ccaps:"\u2A4D",ccaron:"\u010D",ccedi:"\xE7",ccedil:"\xE7",ccirc:"\u0109",ccups:"\u2A4C",ccupssm:"\u2A50",cdot:"\u010B",cedi:"\xB8",cedil:"\xB8",cemptyv:"\u29B2",cen:"\xA2",cent:"\xA2",centerdot:"\xB7",cfr:"\u{1D520}",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",chi:"\u03C7",cir:"\u25CB",cirE:"\u29C3",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledR:"\xAE",circledS:"\u24C8",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",clubs:"\u2663",clubsuit:"\u2663",colon:":",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",conint:"\u222E",copf:"\u{1D554}",coprod:"\u2210",cop:"\xA9",copy:"\xA9",copysr:"\u2117",crarr:"\u21B5",cross:"\u2717",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",cup:"\u222A",cupbrcap:"\u2A48",cupcap:"\u2A46",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curre:"\xA4",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",dArr:"\u21D3",dHar:"\u2965",dagger:"\u2020",daleth:"\u2138",darr:"\u2193",dash:"\u2010",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",dcaron:"\u010F",dcy:"\u0434",dd:"\u2146",ddagger:"\u2021",ddarr:"\u21CA",ddotseq:"\u2A77",de:"\xB0",deg:"\xB0",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",dfr:"\u{1D521}",dharl:"\u21C3",dharr:"\u21C2",diam:"\u22C4",diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divid:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",dopf:"\u{1D555}",dot:"\u02D9",doteq:"\u2250",doteqdot:"\u2251",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",downarrow:"\u2193",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",dscr:"\u{1D4B9}",dscy:"\u0455",dsol:"\u29F6",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",dzcy:"\u045F",dzigrarr:"\u27FF",eDDot:"\u2A77",eDot:"\u2251",eacut:"\xE9",eacute:"\xE9",easter:"\u2A6E",ecaron:"\u011B",ecir:"\xEA",ecirc:"\xEA",ecolon:"\u2255",ecy:"\u044D",edot:"\u0117",ee:"\u2147",efDot:"\u2252",efr:"\u{1D522}",eg:"\u2A9A",egrav:"\xE8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",emptyv:"\u2205",emsp13:"\u2004",emsp14:"\u2005",emsp:"\u2003",eng:"\u014B",ensp:"\u2002",eogon:"\u0119",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",equals:"=",equest:"\u225F",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erDot:"\u2253",erarr:"\u2971",escr:"\u212F",esdot:"\u2250",esim:"\u2242",eta:"\u03B7",et:"\xF0",eth:"\xF0",eum:"\xEB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",expectation:"\u2130",exponentiale:"\u2147",fallingdotseq:"\u2252",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",ffr:"\u{1D523}",filig:"\uFB01",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",fopf:"\u{1D557}",forall:"\u2200",fork:"\u22D4",forkv:"\u2AD9",fpartint:"\u2A0D",frac1:"\xBC",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac3:"\xBE",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",fscr:"\u{1D4BB}",gE:"\u2267",gEl:"\u2A8C",gacute:"\u01F5",gamma:"\u03B3",gammad:"\u03DD",gap:"\u2A86",gbreve:"\u011F",gcirc:"\u011D",gcy:"\u0433",gdot:"\u0121",ge:"\u2265",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",ges:"\u2A7E",gescc:"\u2AA9",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",gfr:"\u{1D524}",gg:"\u226B",ggg:"\u22D9",gimel:"\u2137",gjcy:"\u0453",gl:"\u2277",glE:"\u2A92",gla:"\u2AA5",glj:"\u2AA4",gnE:"\u2269",gnap:"\u2A8A",gnapprox:"\u2A8A",gne:"\u2A88",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",gopf:"\u{1D558}",grave:"`",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",g:">",gt:">",gtcc:"\u2AA7",gtcir:"\u2A7A",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",hArr:"\u21D4",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",hardcy:"\u044A",harr:"\u2194",harrcir:"\u2948",harrw:"\u21AD",hbar:"\u210F",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",hfr:"\u{1D525}",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",hopf:"\u{1D559}",horbar:"\u2015",hscr:"\u{1D4BD}",hslash:"\u210F",hstrok:"\u0127",hybull:"\u2043",hyphen:"\u2010",iacut:"\xED",iacute:"\xED",ic:"\u2063",icir:"\xEE",icirc:"\xEE",icy:"\u0438",iecy:"\u0435",iexc:"\xA1",iexcl:"\xA1",iff:"\u21D4",ifr:"\u{1D526}",igrav:"\xEC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",ijlig:"\u0133",imacr:"\u012B",image:"\u2111",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",imof:"\u22B7",imped:"\u01B5",in:"\u2208",incare:"\u2105",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",int:"\u222B",intcal:"\u22BA",integers:"\u2124",intercal:"\u22BA",intlarhk:"\u2A17",intprod:"\u2A3C",iocy:"\u0451",iogon:"\u012F",iopf:"\u{1D55A}",iota:"\u03B9",iprod:"\u2A3C",iques:"\xBF",iquest:"\xBF",iscr:"\u{1D4BE}",isin:"\u2208",isinE:"\u22F9",isindot:"\u22F5",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",itilde:"\u0129",iukcy:"\u0456",ium:"\xEF",iuml:"\xEF",jcirc:"\u0135",jcy:"\u0439",jfr:"\u{1D527}",jmath:"\u0237",jopf:"\u{1D55B}",jscr:"\u{1D4BF}",jsercy:"\u0458",jukcy:"\u0454",kappa:"\u03BA",kappav:"\u03F0",kcedil:"\u0137",kcy:"\u043A",kfr:"\u{1D528}",kgreen:"\u0138",khcy:"\u0445",kjcy:"\u045C",kopf:"\u{1D55C}",kscr:"\u{1D4C0}",lAarr:"\u21DA",lArr:"\u21D0",lAtail:"\u291B",lBarr:"\u290E",lE:"\u2266",lEg:"\u2A8B",lHar:"\u2962",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",lambda:"\u03BB",lang:"\u27E8",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",laqu:"\xAB",laquo:"\xAB",larr:"\u2190",larrb:"\u21E4",larrbfs:"\u291F",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",lat:"\u2AAB",latail:"\u2919",late:"\u2AAD",lates:"\u2AAD\uFE00",lbarr:"\u290C",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",lcaron:"\u013E",lcedil:"\u013C",lceil:"\u2308",lcub:"{",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",le:"\u2264",leftarrow:"\u2190",leftarrowtail:"\u21A2",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",leftrightarrow:"\u2194",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",leftthreetimes:"\u22CB",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",les:"\u2A7D",lescc:"\u2AA8",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",lessgtr:"\u2276",lesssim:"\u2272",lfisht:"\u297C",lfloor:"\u230A",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",ljcy:"\u0459",ll:"\u226A",llarr:"\u21C7",llcorner:"\u231E",llhard:"\u296B",lltri:"\u25FA",lmidot:"\u0140",lmoust:"\u23B0",lmoustache:"\u23B0",lnE:"\u2268",lnap:"\u2A89",lnapprox:"\u2A89",lne:"\u2A87",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",longleftarrow:"\u27F5",longleftrightarrow:"\u27F7",longmapsto:"\u27FC",longrightarrow:"\u27F6",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",lscr:"\u{1D4C1}",lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",lstrok:"\u0142",l:"<",lt:"<",ltcc:"\u2AA6",ltcir:"\u2A79",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltrPar:"\u2996",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",mDDot:"\u223A",mac:"\xAF",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",mcy:"\u043C",mdash:"\u2014",measuredangle:"\u2221",mfr:"\u{1D52A}",mho:"\u2127",micr:"\xB5",micro:"\xB5",mid:"\u2223",midast:"*",midcir:"\u2AF0",middo:"\xB7",middot:"\xB7",minus:"\u2212",minusb:"\u229F",minusd:"\u2238",minusdu:"\u2A2A",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",mopf:"\u{1D55E}",mp:"\u2213",mscr:"\u{1D4C2}",mstpos:"\u223E",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nGg:"\u22D9\u0338",nGt:"\u226B\u20D2",nGtv:"\u226B\u0338",nLeftarrow:"\u21CD",nLeftrightarrow:"\u21CE",nLl:"\u22D8\u0338",nLt:"\u226A\u20D2",nLtv:"\u226A\u0338",nRightarrow:"\u21CF",nVDash:"\u22AF",nVdash:"\u22AE",nabla:"\u2207",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natur:"\u266E",natural:"\u266E",naturals:"\u2115",nbs:"\xA0",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",ncaron:"\u0148",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",ncy:"\u043D",ndash:"\u2013",ne:"\u2260",neArr:"\u21D7",nearhk:"\u2924",nearr:"\u2197",nearrow:"\u2197",nedot:"\u2250\u0338",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",nexist:"\u2204",nexists:"\u2204",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",ngsim:"\u2275",ngt:"\u226F",ngtr:"\u226F",nhArr:"\u21CE",nharr:"\u21AE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",njcy:"\u045A",nlArr:"\u21CD",nlE:"\u2266\u0338",nlarr:"\u219A",nldr:"\u2025",nle:"\u2270",nleftarrow:"\u219A",nleftrightarrow:"\u21AE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nlsim:"\u2274",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nmid:"\u2224",nopf:"\u{1D55F}",no:"\xAC",not:"\xAC",notin:"\u2209",notinE:"\u22F9\u0338",notindot:"\u22F5\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",npar:"\u2226",nparallel:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",npre:"\u2AAF\u0338",nprec:"\u2280",npreceq:"\u2AAF\u0338",nrArr:"\u21CF",nrarr:"\u219B",nrarrc:"\u2933\u0338",nrarrw:"\u219D\u0338",nrightarrow:"\u219B",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",ntild:"\xF1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvDash:"\u22AD",nvHarr:"\u2904",nvap:"\u224D\u20D2",nvdash:"\u22AC",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwArr:"\u21D6",nwarhk:"\u2923",nwarr:"\u2196",nwarrow:"\u2196",nwnear:"\u2927",oS:"\u24C8",oacut:"\xF3",oacute:"\xF3",oast:"\u229B",ocir:"\xF4",ocirc:"\xF4",ocy:"\u043E",odash:"\u229D",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",oelig:"\u0153",ofcir:"\u29BF",ofr:"\u{1D52C}",ogon:"\u02DB",ograv:"\xF2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",omacr:"\u014D",omega:"\u03C9",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",oopf:"\u{1D560}",opar:"\u29B7",operp:"\u29B9",oplus:"\u2295",or:"\u2228",orarr:"\u21BB",ord:"\xBA",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oscr:"\u2134",oslas:"\xF8",oslash:"\xF8",osol:"\u2298",otild:"\xF5",otilde:"\xF5",otimes:"\u2297",otimesas:"\u2A36",oum:"\xF6",ouml:"\xF6",ovbar:"\u233D",par:"\xB6",para:"\xB6",parallel:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",pfr:"\u{1D52D}",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plus:"+",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",plusm:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",pointint:"\u2A15",popf:"\u{1D561}",poun:"\xA3",pound:"\xA3",pr:"\u227A",prE:"\u2AB3",prap:"\u2AB7",prcue:"\u227C",pre:"\u2AAF",prec:"\u227A",precapprox:"\u2AB7",preccurlyeq:"\u227C",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",precsim:"\u227E",prime:"\u2032",primes:"\u2119",prnE:"\u2AB5",prnap:"\u2AB9",prnsim:"\u22E8",prod:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",pscr:"\u{1D4C5}",psi:"\u03C8",puncsp:"\u2008",qfr:"\u{1D52E}",qint:"\u2A0C",qopf:"\u{1D562}",qprime:"\u2057",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",quo:'"',quot:'"',rAarr:"\u21DB",rArr:"\u21D2",rAtail:"\u291C",rBarr:"\u290F",rHar:"\u2964",race:"\u223D\u0331",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",rang:"\u27E9",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raqu:"\xBB",raquo:"\xBB",rarr:"\u2192",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",rarrtl:"\u21A3",rarrw:"\u219D",ratail:"\u291A",ratio:"\u2236",rationals:"\u211A",rbarr:"\u290D",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",rcaron:"\u0159",rcedil:"\u0157",rceil:"\u2309",rcub:"}",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",rect:"\u25AD",re:"\xAE",reg:"\xAE",rfisht:"\u297D",rfloor:"\u230B",rfr:"\u{1D52F}",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",rho:"\u03C1",rhov:"\u03F1",rightarrow:"\u2192",rightarrowtail:"\u21A3",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",rightthreetimes:"\u22CC",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoust:"\u23B1",rmoustache:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",ropf:"\u{1D563}",roplus:"\u2A2E",rotimes:"\u2A35",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",rsaquo:"\u203A",rscr:"\u{1D4C7}",rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",ruluhar:"\u2968",rx:"\u211E",sacute:"\u015B",sbquo:"\u201A",sc:"\u227B",scE:"\u2AB4",scap:"\u2AB8",scaron:"\u0161",sccue:"\u227D",sce:"\u2AB0",scedil:"\u015F",scirc:"\u015D",scnE:"\u2AB6",scnap:"\u2ABA",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",scy:"\u0441",sdot:"\u22C5",sdotb:"\u22A1",sdote:"\u2A66",seArr:"\u21D8",searhk:"\u2925",searr:"\u2198",searrow:"\u2198",sec:"\xA7",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",shchcy:"\u0449",shcy:"\u0448",shortmid:"\u2223",shortparallel:"\u2225",sh:"\xAD",shy:"\xAD",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",softcy:"\u044C",sol:"/",solb:"\u29C4",solbar:"\u233F",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",squ:"\u25A1",square:"\u25A1",squarf:"\u25AA",squf:"\u25AA",srarr:"\u2192",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",sub:"\u2282",subE:"\u2AC5",subdot:"\u2ABD",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",subset:"\u2282",subseteq:"\u2286",subseteqq:"\u2AC5",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succ:"\u227B",succapprox:"\u2AB8",succcurlyeq:"\u227D",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",sum:"\u2211",sung:"\u266A",sup:"\u2283",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",supE:"\u2AC6",supdot:"\u2ABE",supdsub:"\u2AD8",supe:"\u2287",supedot:"\u2AC4",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",supset:"\u2283",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swArr:"\u21D9",swarhk:"\u2926",swarr:"\u2199",swarrow:"\u2199",swnwar:"\u292A",szli:"\xDF",szlig:"\xDF",target:"\u2316",tau:"\u03C4",tbrk:"\u23B4",tcaron:"\u0165",tcedil:"\u0163",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",tfr:"\u{1D531}",there4:"\u2234",therefore:"\u2234",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",thinsp:"\u2009",thkap:"\u2248",thksim:"\u223C",thor:"\xFE",thorn:"\xFE",tilde:"\u02DC",time:"\xD7",times:"\xD7",timesb:"\u22A0",timesbar:"\u2A31",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",top:"\u22A4",topbot:"\u2336",topcir:"\u2AF1",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",trade:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",tscr:"\u{1D4C9}",tscy:"\u0446",tshcy:"\u045B",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",uArr:"\u21D1",uHar:"\u2963",uacut:"\xFA",uacute:"\xFA",uarr:"\u2191",ubrcy:"\u045E",ubreve:"\u016D",ucir:"\xFB",ucirc:"\xFB",ucy:"\u0443",udarr:"\u21C5",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",ufr:"\u{1D532}",ugrav:"\xF9",ugrave:"\xF9",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",umacr:"\u016B",um:"\xA8",uml:"\xA8",uogon:"\u0173",uopf:"\u{1D566}",uparrow:"\u2191",updownarrow:"\u2195",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",upsi:"\u03C5",upsih:"\u03D2",upsilon:"\u03C5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",uring:"\u016F",urtri:"\u25F9",uscr:"\u{1D4CA}",utdot:"\u22F0",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",uum:"\xFC",uuml:"\xFC",uwangle:"\u29A7",vArr:"\u21D5",vBar:"\u2AE8",vBarv:"\u2AE9",vDash:"\u22A8",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",varr:"\u2195",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",vcy:"\u0432",vdash:"\u22A2",vee:"\u2228",veebar:"\u22BB",veeeq:"\u225A",vellip:"\u22EE",verbar:"|",vert:"|",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",vzigzag:"\u299A",wcirc:"\u0175",wedbar:"\u2A5F",wedge:"\u2227",wedgeq:"\u2259",weierp:"\u2118",wfr:"\u{1D534}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",xfr:"\u{1D535}",xhArr:"\u27FA",xharr:"\u27F7",xi:"\u03BE",xlArr:"\u27F8",xlarr:"\u27F5",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrArr:"\u27F9",xrarr:"\u27F6",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",yacut:"\xFD",yacute:"\xFD",yacy:"\u044F",ycirc:"\u0177",ycy:"\u044B",ye:"\xA5",yen:"\xA5",yfr:"\u{1D536}",yicy:"\u0457",yopf:"\u{1D56A}",yscr:"\u{1D4CE}",yucy:"\u044E",yum:"\xFF",yuml:"\xFF",zacute:"\u017A",zcaron:"\u017E",zcy:"\u0437",zdot:"\u017C",zeetrf:"\u2128",zeta:"\u03B6",zfr:"\u{1D537}",zhcy:"\u0436",zigrarr:"\u21DD",zopf:"\u{1D56B}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"}});var Hp=w((jee,jA)=>{"use strict";var BA=WA();jA.exports=oW;var iW={}.hasOwnProperty;function oW(n){return iW.call(BA,n)?BA[n]:!1}o(oW,"decodeEntity")});var Qv=w((Gee,VA)=>{"use strict";var sW=ni(),aW=sW(/\d/);VA.exports=aW});var HA=w((Hee,GA)=>{"use strict";var cW=ni(),lW=cW(/[\dA-Fa-f]/);GA.exports=lW});var XA=w((zee,KA)=>{"use strict";var uW=Hp(),zA=Js(),pW=Qv(),dW=HA();function fW(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}o(fW,"_interopDefaultLegacy");var mW=fW(uW),hW={name:"characterReference",tokenize:gW};function gW(n,e,t){var r=this,i=0,s,a;return c;function c(d){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),l}function l(d){return d===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(d),n.exit("characterReferenceMarkerNumeric"),u):(n.enter("characterReferenceValue"),s=31,a=zA,p(d))}function u(d){return d===88||d===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(d),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),s=6,a=dW,p):(n.enter("characterReferenceValue"),s=7,a=pW,p(d))}function p(d){var f;return d===59&&i?(f=n.exit("characterReferenceValue"),a===zA&&!mW.default(r.sliceSerialize(f))?t(d):(n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)):a(d)&&i++<s?(n.consume(d),p):t(d)}}o(gW,"tokenizeCharacterReference");KA.exports=hW});var QA=w((Xee,JA)=>{"use strict";var Qs=It(),bW=Lr(),vW=Xs(),_c=Rt(),yW={name:"codeFenced",tokenize:IW,concrete:!0};function IW(n,e,t){var r=this,i={tokenize:L,partial:!0},s=vW(this.events,"linePrefix"),a=0,c;return l;function l(A){return n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),c=A,u(A)}function u(A){return A===c?(n.consume(A),a++,u):(n.exit("codeFencedFenceSequence"),a<3?t(A):_c(n,p,"whitespace")(A))}function p(A){return A===null||Qs(A)?h(A):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),d(A))}function d(A){return A===null||bW(A)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),_c(n,f,"whitespace")(A)):A===96&&A===c?t(A):(n.consume(A),d)}function f(A){return A===null||Qs(A)?h(A):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),g(A))}function g(A){return A===null||Qs(A)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),h(A)):A===96&&A===c?t(A):(n.consume(A),g)}function h(A){return n.exit("codeFencedFence"),r.interrupt?e(A):T(A)}function T(A){return A===null?C(A):Qs(A)?(n.enter("lineEnding"),n.consume(A),n.exit("lineEnding"),n.attempt(i,C,s?_c(n,T,"linePrefix",s+1):T)):(n.enter("codeFlowValue"),S(A))}function S(A){return A===null||Qs(A)?(n.exit("codeFlowValue"),T(A)):(n.consume(A),S)}function C(A){return n.exit("codeFenced"),e(A)}function L(A,W,O){var j=0;return _c(A,J,"linePrefix",this.parser.constructs.disable.null.indexOf("codeIndented")>-1?void 0:4);function J(M){return A.enter("codeFencedFence"),A.enter("codeFencedFenceSequence"),ie(M)}function ie(M){return M===c?(A.consume(M),j++,ie):j<a?O(M):(A.exit("codeFencedFenceSequence"),_c(A,z,"whitespace")(M))}function z(M){return M===null||Qs(M)?(A.exit("codeFencedFence"),W(M)):O(M)}}}o(IW,"tokenizeCodeFenced");JA.exports=yW});var nL=w((Qee,tL)=>{"use strict";var Yv=It(),YA=Ar(),xW=Xs(),ZA=Rt(),SW={name:"codeIndented",tokenize:kW,resolve:TW},eL={tokenize:CW,partial:!0};function TW(n,e){var t={type:"codeIndented",start:n[0][1].start,end:n[n.length-1][1].end};return YA(n,0,0,[["enter",t,e]]),YA(n,n.length,0,[["exit",t,e]]),n}o(TW,"resolveCodeIndented");function kW(n,e,t){return n.attempt(eL,r,t);function r(s){return s===null?e(s):Yv(s)?n.attempt(eL,r,e)(s):(n.enter("codeFlowValue"),i(s))}function i(s){return s===null||Yv(s)?(n.exit("codeFlowValue"),r(s)):(n.consume(s),i)}}o(kW,"tokenizeCodeIndented");function CW(n,e,t){var r=this;return ZA(n,i,"linePrefix",4+1);function i(s){return Yv(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),ZA(n,i,"linePrefix",4+1)):xW(r.events,"linePrefix")<4?t(s):e(s)}}o(CW,"tokenizeIndentedContent");tL.exports=SW});var oL=w((Zee,iL)=>{"use strict";var rL=It(),PW={name:"codeText",tokenize:LW,resolve:RW,previous:AW};function RW(n){var e=n.length-4,t=3,r,i;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(r=t;++r<e;)if(n[r][1].type==="codeTextData"){n[e][1].type=n[t][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)i===void 0?r!==e&&n[r][1].type!=="lineEnding"&&(i=r):(r===e||n[r][1].type==="lineEnding")&&(n[i][1].type="codeTextData",r!==i+2&&(n[i][1].end=n[r-1][1].end,n.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return n}o(RW,"resolveCodeText");function AW(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}o(AW,"previous");function LW(n,e,t){var r=0,i,s;return a;function a(d){return n.enter("codeText"),n.enter("codeTextSequence"),c(d)}function c(d){return d===96?(n.consume(d),r++,c):(n.exit("codeTextSequence"),l(d))}function l(d){return d===null?t(d):d===96?(s=n.enter("codeTextSequence"),i=0,p(d)):d===32?(n.enter("space"),n.consume(d),n.exit("space"),l):rL(d)?(n.enter("lineEnding"),n.consume(d),n.exit("lineEnding"),l):(n.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||rL(d)?(n.exit("codeTextData"),l(d)):(n.consume(d),u)}function p(d){return d===96?(n.consume(d),i++,p):i===r?(n.exit("codeTextSequence"),n.exit("codeText"),e(d)):(s.type="codeTextData",u(d))}}o(LW,"tokenizeCodeText");iL.exports=PW});var Zv=w((tte,aL)=>{"use strict";var sL=Vp(),EW=Lr(),wW=It();function FW(n,e,t,r,i,s,a,c,l){var u=l||1/0,p=0;return d;function d(C){return C===60?(n.enter(r),n.enter(i),n.enter(s),n.consume(C),n.exit(s),f):sL(C)||C===41?t(C):(n.enter(r),n.enter(a),n.enter(c),n.enter("chunkString",{contentType:"string"}),T(C))}function f(C){return C===62?(n.enter(s),n.consume(C),n.exit(s),n.exit(i),n.exit(r),e):(n.enter(c),n.enter("chunkString",{contentType:"string"}),g(C))}function g(C){return C===62?(n.exit("chunkString"),n.exit(c),f(C)):C===null||C===60||wW(C)?t(C):(n.consume(C),C===92?h:g)}function h(C){return C===60||C===62||C===92?(n.consume(C),g):g(C)}function T(C){return C===40?++p>u?t(C):(n.consume(C),T):C===41?p--?(n.consume(C),T):(n.exit("chunkString"),n.exit(c),n.exit(a),n.exit(r),e(C)):C===null||EW(C)?p?t(C):(n.exit("chunkString"),n.exit(c),n.exit(a),n.exit(r),e(C)):sL(C)?t(C):(n.consume(C),C===92?S:T)}function S(C){return C===40||C===41||C===92?(n.consume(C),T):T(C)}}o(FW,"destinationFactory");aL.exports=FW});var ey=w((rte,lL)=>{"use strict";var cL=It(),DW=Rr();function NW(n,e,t,r,i,s){var a=this,c=0,l;return u;function u(g){return n.enter(r),n.enter(i),n.consume(g),n.exit(i),n.enter(s),p}function p(g){return g===null||g===91||g===93&&!l||g===94&&!c&&"_hiddenFootnoteSupport"in a.parser.constructs||c>999?t(g):g===93?(n.exit(s),n.enter(i),n.consume(g),n.exit(i),n.exit(r),e):cL(g)?(n.enter("lineEnding"),n.consume(g),n.exit("lineEnding"),p):(n.enter("chunkString",{contentType:"string"}),d(g))}function d(g){return g===null||g===91||g===93||cL(g)||c++>999?(n.exit("chunkString"),p(g)):(n.consume(g),l=l||!DW(g),g===92?f:d)}function f(g){return g===91||g===92||g===93?(n.consume(g),c++,d):d(g)}}o(NW,"labelFactory");lL.exports=NW});var ty=w((ote,uL)=>{"use strict";var _W=It(),OW=Rr(),MW=Rt();function UW(n,e){var t;return r;function r(i){return _W(i)?(n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),t=!0,r):OW(i)?MW(n,r,t?"linePrefix":"lineSuffix")(i):e(i)}}o(UW,"whitespaceFactory");uL.exports=UW});var ny=w((ate,dL)=>{"use strict";var pL=It(),qW=Rt();function $W(n,e,t,r,i,s){var a;return c;function c(f){return n.enter(r),n.enter(i),n.consume(f),n.exit(i),a=f===40?41:f,l}function l(f){return f===a?(n.enter(i),n.consume(f),n.exit(i),n.exit(r),e):(n.enter(s),u(f))}function u(f){return f===a?(n.exit(s),l(a)):f===null?t(f):pL(f)?(n.enter("lineEnding"),n.consume(f),n.exit("lineEnding"),qW(n,u,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),p(f))}function p(f){return f===a||f===null||pL(f)?(n.exit("chunkString"),u(f)):(n.consume(f),f===92?d:p)}function d(f){return f===a||f===92?(n.consume(f),p):p(f)}}o($W,"titleFactory");dL.exports=$W});var gL=w((lte,hL)=>{"use strict";var fL=It(),WW=Lr(),BW=qp(),jW=Zv(),VW=ey(),ry=Rt(),mL=ty(),GW=ny(),HW={name:"definition",tokenize:KW},zW={tokenize:XW,partial:!0};function KW(n,e,t){var r=this,i;return s;function s(l){return n.enter("definition"),VW.call(r,n,a,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(l)}function a(l){return i=BW(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),l===58?(n.enter("definitionMarker"),n.consume(l),n.exit("definitionMarker"),mL(n,jW(n,n.attempt(zW,ry(n,c,"whitespace"),ry(n,c,"whitespace")),t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString"))):t(l)}function c(l){return l===null||fL(l)?(n.exit("definition"),r.parser.defined.indexOf(i)<0&&r.parser.defined.push(i),e(l)):t(l)}}o(KW,"tokenizeDefinition");function XW(n,e,t){return r;function r(a){return WW(a)?mL(n,i)(a):t(a)}function i(a){return a===34||a===39||a===40?GW(n,ry(n,s,"whitespace"),t,"definitionTitle","definitionTitleMarker","definitionTitleString")(a):t(a)}function s(a){return a===null||fL(a)?e(a):t(a)}}o(XW,"tokenizeTitle");hL.exports=HW});var vL=w((pte,bL)=>{"use strict";var JW=It(),QW={name:"hardBreakEscape",tokenize:YW};function YW(n,e,t){return r;function r(s){return n.enter("hardBreakEscape"),n.enter("escapeMarker"),n.consume(s),i}function i(s){return JW(s)?(n.exit("escapeMarker"),n.exit("hardBreakEscape"),e(s)):t(s)}}o(YW,"tokenizeHardBreakEscape");bL.exports=QW});var xL=w((fte,IL)=>{"use strict";var ZW=It(),yL=Lr(),eB=Rr(),tB=Ar(),nB=Rt(),rB={name:"headingAtx",tokenize:oB,resolve:iB};function iB(n,e){var t=n.length-2,r=3,i,s;return n[r][1].type==="whitespace"&&(r+=2),t-2>r&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&n[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(i={type:"atxHeadingText",start:n[r][1].start,end:n[t][1].end},s={type:"chunkText",start:n[r][1].start,end:n[t][1].end,contentType:"text"},tB(n,r,t-r+1,[["enter",i,e],["enter",s,e],["exit",s,e],["exit",i,e]])),n}o(iB,"resolveHeadingAtx");function oB(n,e,t){var r=this,i=0;return s;function s(p){return n.enter("atxHeading"),n.enter("atxHeadingSequence"),a(p)}function a(p){return p===35&&i++<6?(n.consume(p),a):p===null||yL(p)?(n.exit("atxHeadingSequence"),r.interrupt?e(p):c(p)):t(p)}function c(p){return p===35?(n.enter("atxHeadingSequence"),l(p)):p===null||ZW(p)?(n.exit("atxHeading"),e(p)):eB(p)?nB(n,c,"whitespace")(p):(n.enter("atxHeadingText"),u(p))}function l(p){return p===35?(n.consume(p),l):(n.exit("atxHeadingSequence"),c(p))}function u(p){return p===null||p===35||yL(p)?(n.exit("atxHeadingText"),c(p)):(n.consume(p),u)}}o(oB,"tokenizeHeadingAtx");IL.exports=rB});var TL=w((hte,SL)=>{"use strict";var sB=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","section","source","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"];SL.exports=sB});var CL=w((gte,kL)=>{"use strict";var aB=["pre","script","style","textarea"];kL.exports=aB});var EL=w((bte,LL)=>{"use strict";var Oc=Nc(),PL=Js(),Ys=It(),RL=Lr(),Zs=Rr(),zp=Lc(),cB=TL(),AL=CL(),lB=Ec(),uB={name:"htmlFlow",tokenize:fB,resolveTo:dB,concrete:!0},pB={tokenize:mB,partial:!0};function dB(n){for(var e=n.length;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}o(dB,"resolveToHtmlFlow");function fB(n,e,t){var r=this,i,s,a,c,l;return u;function u(v){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(v),p}function p(v){return v===33?(n.consume(v),d):v===47?(n.consume(v),h):v===63?(n.consume(v),i=3,r.interrupt?e:Ue):Oc(v)?(n.consume(v),a=zp(v),s=!0,T):t(v)}function d(v){return v===45?(n.consume(v),i=2,f):v===91?(n.consume(v),i=5,a="CDATA[",c=0,g):Oc(v)?(n.consume(v),i=4,r.interrupt?e:Ue):t(v)}function f(v){return v===45?(n.consume(v),r.interrupt?e:Ue):t(v)}function g(v){return v===a.charCodeAt(c++)?(n.consume(v),c===a.length?r.interrupt?e:B:g):t(v)}function h(v){return Oc(v)?(n.consume(v),a=zp(v),T):t(v)}function T(v){return v===null||v===47||v===62||RL(v)?v!==47&&s&&AL.indexOf(a.toLowerCase())>-1?(i=1,r.interrupt?e(v):B(v)):cB.indexOf(a.toLowerCase())>-1?(i=6,v===47?(n.consume(v),S):r.interrupt?e(v):B(v)):(i=7,r.interrupt?t(v):s?L(v):C(v)):v===45||PL(v)?(n.consume(v),a+=zp(v),T):t(v)}function S(v){return v===62?(n.consume(v),r.interrupt?e:B):t(v)}function C(v){return Zs(v)?(n.consume(v),C):z(v)}function L(v){return v===47?(n.consume(v),z):v===58||v===95||Oc(v)?(n.consume(v),A):Zs(v)?(n.consume(v),L):z(v)}function A(v){return v===45||v===46||v===58||v===95||PL(v)?(n.consume(v),A):W(v)}function W(v){return v===61?(n.consume(v),O):Zs(v)?(n.consume(v),W):L(v)}function O(v){return v===null||v===60||v===61||v===62||v===96?t(v):v===34||v===39?(n.consume(v),l=v,j):Zs(v)?(n.consume(v),O):(l=void 0,J(v))}function j(v){return v===l?(n.consume(v),ie):v===null||Ys(v)?t(v):(n.consume(v),j)}function J(v){return v===null||v===34||v===39||v===60||v===61||v===62||v===96||RL(v)?W(v):(n.consume(v),J)}function ie(v){return v===47||v===62||Zs(v)?L(v):t(v)}function z(v){return v===62?(n.consume(v),M):t(v)}function M(v){return Zs(v)?(n.consume(v),M):v===null||Ys(v)?B(v):t(v)}function B(v){return v===45&&i===2?(n.consume(v),de):v===60&&i===1?(n.consume(v),He):v===62&&i===4?(n.consume(v),at):v===63&&i===3?(n.consume(v),Ue):v===93&&i===5?(n.consume(v),_):Ys(v)&&(i===6||i===7)?n.check(pB,at,Y)(v):v===null||Ys(v)?Y(v):(n.consume(v),B)}function Y(v){return n.exit("htmlFlowData"),ae(v)}function ae(v){return v===null?nt(v):Ys(v)?(n.enter("lineEnding"),n.consume(v),n.exit("lineEnding"),ae):(n.enter("htmlFlowData"),B(v))}function de(v){return v===45?(n.consume(v),Ue):B(v)}function He(v){return v===47?(n.consume(v),a="",Je):B(v)}function Je(v){return v===62&&AL.indexOf(a.toLowerCase())>-1?(n.consume(v),at):Oc(v)&&a.length<8?(n.consume(v),a+=zp(v),Je):B(v)}function _(v){return v===93?(n.consume(v),Ue):B(v)}function Ue(v){return v===62?(n.consume(v),at):B(v)}function at(v){return v===null||Ys(v)?(n.exit("htmlFlowData"),nt(v)):(n.consume(v),at)}function nt(v){return n.exit("htmlFlow"),e(v)}}o(fB,"tokenizeHtmlFlow");function mB(n,e,t){return r;function r(i){return n.exit("htmlFlowData"),n.enter("lineEndingBlank"),n.consume(i),n.exit("lineEndingBlank"),n.attempt(lB,e,t)}}o(mB,"tokenizeNextBlank");LL.exports=uB});var FL=w((yte,wL)=>{"use strict";var Kp=Nc(),iy=Js(),ri=It(),oy=Lr(),Xp=Rr(),hB=Rt(),gB={name:"htmlText",tokenize:bB};function bB(n,e,t){var r=this,i,s,a,c;return l;function l(v){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume(v),u}function u(v){return v===33?(n.consume(v),p):v===47?(n.consume(v),J):v===63?(n.consume(v),O):Kp(v)?(n.consume(v),M):t(v)}function p(v){return v===45?(n.consume(v),d):v===91?(n.consume(v),s="CDATA[",a=0,S):Kp(v)?(n.consume(v),W):t(v)}function d(v){return v===45?(n.consume(v),f):t(v)}function f(v){return v===null||v===62?t(v):v===45?(n.consume(v),g):h(v)}function g(v){return v===null||v===62?t(v):h(v)}function h(v){return v===null?t(v):v===45?(n.consume(v),T):ri(v)?(c=h,Ue(v)):(n.consume(v),h)}function T(v){return v===45?(n.consume(v),nt):h(v)}function S(v){return v===s.charCodeAt(a++)?(n.consume(v),a===s.length?C:S):t(v)}function C(v){return v===null?t(v):v===93?(n.consume(v),L):ri(v)?(c=C,Ue(v)):(n.consume(v),C)}function L(v){return v===93?(n.consume(v),A):C(v)}function A(v){return v===62?nt(v):v===93?(n.consume(v),A):C(v)}function W(v){return v===null||v===62?nt(v):ri(v)?(c=W,Ue(v)):(n.consume(v),W)}function O(v){return v===null?t(v):v===63?(n.consume(v),j):ri(v)?(c=O,Ue(v)):(n.consume(v),O)}function j(v){return v===62?nt(v):O(v)}function J(v){return Kp(v)?(n.consume(v),ie):t(v)}function ie(v){return v===45||iy(v)?(n.consume(v),ie):z(v)}function z(v){return ri(v)?(c=z,Ue(v)):Xp(v)?(n.consume(v),z):nt(v)}function M(v){return v===45||iy(v)?(n.consume(v),M):v===47||v===62||oy(v)?B(v):t(v)}function B(v){return v===47?(n.consume(v),nt):v===58||v===95||Kp(v)?(n.consume(v),Y):ri(v)?(c=B,Ue(v)):Xp(v)?(n.consume(v),B):nt(v)}function Y(v){return v===45||v===46||v===58||v===95||iy(v)?(n.consume(v),Y):ae(v)}function ae(v){return v===61?(n.consume(v),de):ri(v)?(c=ae,Ue(v)):Xp(v)?(n.consume(v),ae):B(v)}function de(v){return v===null||v===60||v===61||v===62||v===96?t(v):v===34||v===39?(n.consume(v),i=v,He):ri(v)?(c=de,Ue(v)):Xp(v)?(n.consume(v),de):(n.consume(v),i=void 0,_)}function He(v){return v===i?(n.consume(v),Je):v===null?t(v):ri(v)?(c=He,Ue(v)):(n.consume(v),He)}function Je(v){return v===62||v===47||oy(v)?B(v):t(v)}function _(v){return v===null||v===34||v===39||v===60||v===61||v===96?t(v):v===62||oy(v)?B(v):(n.consume(v),_)}function Ue(v){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume(v),n.exit("lineEnding"),hB(n,at,"linePrefix",r.parser.constructs.disable.null.indexOf("codeIndented")>-1?void 0:4)}function at(v){return n.enter("htmlTextData"),c(v)}function nt(v){return v===62?(n.consume(v),n.exit("htmlTextData"),n.exit("htmlText"),e):t(v)}}o(bB,"tokenizeHtmlText");wL.exports=gB});var Jp=w((xte,NL)=>{"use strict";var vB=Lr(),ea=Wp(),yB=Ar(),DL=qp(),IB=Fc(),ta=Di(),xB=Zv(),SB=ey(),TB=ny(),sy=ty(),kB={name:"labelEnd",tokenize:EB,resolveTo:LB,resolveAll:AB},CB={tokenize:wB},PB={tokenize:FB},RB={tokenize:DB};function AB(n){for(var e=-1,t;++e<n.length;)t=n[e][1],!t._used&&(t.type==="labelImage"||t.type==="labelLink"||t.type==="labelEnd")&&(n.splice(e+1,t.type==="labelImage"?4:2),t.type="data",e++);return n}o(AB,"resolveAllLabelEnd");function LB(n,e){for(var t=n.length,r=0,i,s,a,c,l,u,p;t--;)if(c=n[t][1],l){if(c.type==="link"||c.type==="labelLink"&&c._inactive)break;n[t][0]==="enter"&&c.type==="labelLink"&&(c._inactive=!0)}else if(u){if(n[t][0]==="enter"&&(c.type==="labelImage"||c.type==="labelLink")&&!c._balanced&&(l=t,c.type!=="labelLink")){r=2;break}}else c.type==="labelEnd"&&(u=t);return i={type:n[l][1].type==="labelLink"?"link":"image",start:ta(n[l][1].start),end:ta(n[n.length-1][1].end)},s={type:"label",start:ta(n[l][1].start),end:ta(n[u][1].end)},a={type:"labelText",start:ta(n[l+r+2][1].end),end:ta(n[u-2][1].start)},p=[["enter",i,e],["enter",s,e]],p=ea(p,n.slice(l+1,l+r+3)),p=ea(p,[["enter",a,e]]),p=ea(p,IB(e.parser.constructs.insideSpan.null,n.slice(l+r+4,u-3),e)),p=ea(p,[["exit",a,e],n[u-2],n[u-1],["exit",s,e]]),p=ea(p,n.slice(u+1)),p=ea(p,[["exit",i,e]]),yB(n,l,n.length,p),n}o(LB,"resolveToLabelEnd");function EB(n,e,t){for(var r=this,i=r.events.length,s,a;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){s=r.events[i][1];break}return c;function c(p){return s?s._inactive?u(p):(a=r.parser.defined.indexOf(DL(r.sliceSerialize({start:s.end,end:r.now()})))>-1,n.enter("labelEnd"),n.enter("labelMarker"),n.consume(p),n.exit("labelMarker"),n.exit("labelEnd"),l):t(p)}function l(p){return p===40?n.attempt(CB,e,a?e:u)(p):p===91?n.attempt(PB,e,a?n.attempt(RB,e,u):u)(p):a?e(p):u(p)}function u(p){return s._balanced=!0,t(p)}}o(EB,"tokenizeLabelEnd");function wB(n,e,t){return r;function r(l){return n.enter("resource"),n.enter("resourceMarker"),n.consume(l),n.exit("resourceMarker"),sy(n,i)}function i(l){return l===41?c(l):xB(n,s,t,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",3)(l)}function s(l){return vB(l)?sy(n,a)(l):c(l)}function a(l){return l===34||l===39||l===40?TB(n,sy(n,c),t,"resourceTitle","resourceTitleMarker","resourceTitleString")(l):c(l)}function c(l){return l===41?(n.enter("resourceMarker"),n.consume(l),n.exit("resourceMarker"),n.exit("resource"),e):t(l)}}o(wB,"tokenizeResource");function FB(n,e,t){var r=this;return i;function i(a){return SB.call(r,n,s,t,"reference","referenceMarker","referenceString")(a)}function s(a){return r.parser.defined.indexOf(DL(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))<0?t(a):e(a)}}o(FB,"tokenizeFullReference");function DB(n,e,t){return r;function r(s){return n.enter("reference"),n.enter("referenceMarker"),n.consume(s),n.exit("referenceMarker"),i}function i(s){return s===93?(n.enter("referenceMarker"),n.consume(s),n.exit("referenceMarker"),n.exit("reference"),e):t(s)}}o(DB,"tokenizeCollapsedReference");NL.exports=kB});var OL=w((Tte,_L)=>{"use strict";var NB=Jp(),_B={name:"labelStartImage",tokenize:OB,resolveAll:NB.resolveAll};function OB(n,e,t){var r=this;return i;function i(c){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(c),n.exit("labelImageMarker"),s}function s(c){return c===91?(n.enter("labelMarker"),n.consume(c),n.exit("labelMarker"),n.exit("labelImage"),a):t(c)}function a(c){return c===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(c):e(c)}}o(OB,"tokenizeLabelStartImage");_L.exports=_B});var UL=w((Cte,ML)=>{"use strict";var MB=Jp(),UB={name:"labelStartLink",tokenize:qB,resolveAll:MB.resolveAll};function qB(n,e,t){var r=this;return i;function i(a){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(a),n.exit("labelMarker"),n.exit("labelLink"),s}function s(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(a):e(a)}}o(qB,"tokenizeLabelStartLink");ML.exports=UB});var $L=w((Rte,qL)=>{"use strict";var $B=Rt(),WB={name:"lineEnding",tokenize:BB};function BB(n,e){return t;function t(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),$B(n,e,"linePrefix")}}o(BB,"tokenizeLineEnding");qL.exports=WB});var ay=w((Lte,WL)=>{"use strict";var jB=It(),VB=Rr(),GB=Rt(),HB={name:"thematicBreak",tokenize:zB};function zB(n,e,t){var r=0,i;return s;function s(l){return n.enter("thematicBreak"),i=l,a(l)}function a(l){return l===i?(n.enter("thematicBreakSequence"),c(l)):VB(l)?GB(n,a,"whitespace")(l):r<3||l!==null&&!jB(l)?t(l):(n.exit("thematicBreak"),e(l))}function c(l){return l===i?(n.consume(l),r++,c):(n.exit("thematicBreakSequence"),a(l))}}o(zB,"tokenizeThematicBreak");WL.exports=HB});var HL=w((wte,GL)=>{"use strict";var BL=Qv(),cy=Rr(),ly=Xs(),KB=jv(),Qp=Rt(),jL=Ec(),XB=ay(),VL={name:"list",tokenize:YB,continuation:{tokenize:ZB},exit:tj},JB={tokenize:nj,partial:!0},QB={tokenize:ej,partial:!0};function YB(n,e,t){var r=this,i=ly(r.events,"linePrefix"),s=0;return a;function a(f){var g=r.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(g==="listUnordered"?!r.containerState.marker||f===r.containerState.marker:BL(f)){if(r.containerState.type||(r.containerState.type=g,n.enter(g,{_container:!0})),g==="listUnordered")return n.enter("listItemPrefix"),f===42||f===45?n.check(XB,t,l)(f):l(f);if(!r.interrupt||f===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),c(f)}return t(f)}function c(f){return BL(f)&&++s<10?(n.consume(f),c):(!r.interrupt||s<2)&&(r.containerState.marker?f===r.containerState.marker:f===41||f===46)?(n.exit("listItemValue"),l(f)):t(f)}function l(f){return n.enter("listItemMarker"),n.consume(f),n.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||f,n.check(jL,r.interrupt?t:u,n.attempt(JB,d,p))}function u(f){return r.containerState.initialBlankLine=!0,i++,d(f)}function p(f){return cy(f)?(n.enter("listItemPrefixWhitespace"),n.consume(f),n.exit("listItemPrefixWhitespace"),d):t(f)}function d(f){return r.containerState.size=i+KB(r.sliceStream(n.exit("listItemPrefix"))),e(f)}}o(YB,"tokenizeListStart");function ZB(n,e,t){var r=this;return r.containerState._closeFlow=void 0,n.check(jL,i,s);function i(c){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Qp(n,e,"listItemIndent",r.containerState.size+1)(c)}o(i,"onBlank");function s(c){return r.containerState.furtherBlankLines||!cy(c)?(r.containerState.furtherBlankLines=r.containerState.initialBlankLine=void 0,a(c)):(r.containerState.furtherBlankLines=r.containerState.initialBlankLine=void 0,n.attempt(QB,e,a)(c))}o(s,"notBlank");function a(c){return r.containerState._closeFlow=!0,r.interrupt=void 0,Qp(n,n.attempt(VL,e,t),"linePrefix",r.parser.constructs.disable.null.indexOf("codeIndented")>-1?void 0:4)(c)}o(a,"notInCurrentItem")}o(ZB,"tokenizeListContinuation");function ej(n,e,t){var r=this;return Qp(n,i,"listItemIndent",r.containerState.size+1);function i(s){return ly(r.events,"listItemIndent")===r.containerState.size?e(s):t(s)}}o(ej,"tokenizeIndent");function tj(n){n.exit(this.containerState.type)}o(tj,"tokenizeListEnd");function nj(n,e,t){var r=this;return Qp(n,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.indexOf("codeIndented")>-1?void 0:4+1);function i(s){return cy(s)||!ly(r.events,"listItemPrefixWhitespace")?t(s):e(s)}}o(nj,"tokenizeListItemPrefixWhitespace");GL.exports=VL});var KL=w((Dte,zL)=>{"use strict";var rj=It(),uy=Di(),ij=Rt(),oj={name:"setextUnderline",tokenize:aj,resolveTo:sj};function sj(n,e){for(var t=n.length,r,i,s,a;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){r=t;break}n[t][1].type==="paragraph"&&(i=t)}else n[t][1].type==="content"&&n.splice(t,1),!s&&n[t][1].type==="definition"&&(s=t);return a={type:"setextHeading",start:uy(n[i][1].start),end:uy(n[n.length-1][1].end)},n[i][1].type="setextHeadingText",s?(n.splice(i,0,["enter",a,e]),n.splice(s+1,0,["exit",n[r][1],e]),n[r][1].end=uy(n[s][1].end)):n[r][1]=a,n.push(["exit",a,e]),n}o(sj,"resolveToSetextUnderline");function aj(n,e,t){for(var r=this,i=r.events.length,s,a;i--;)if(r.events[i][1].type!=="lineEnding"&&r.events[i][1].type!=="linePrefix"&&r.events[i][1].type!=="content"){a=r.events[i][1].type==="paragraph";break}return c;function c(p){return!r.lazy&&(r.interrupt||a)?(n.enter("setextHeadingLine"),n.enter("setextHeadingLineSequence"),s=p,l(p)):t(p)}function l(p){return p===s?(n.consume(p),l):(n.exit("setextHeadingLineSequence"),ij(n,u,"lineSuffix")(p))}function u(p){return p===null||rj(p)?(n.exit("setextHeadingLine"),e(p)):t(p)}}o(aj,"tokenizeSetextUnderline");zL.exports=oj});var ZL=w(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});var cj=zv(),my=CA(),lj=DA(),uj=OA(),QL=$A(),YL=XA(),XL=QA(),py=nL(),pj=oL(),dj=gL(),fj=vL(),mj=xL(),hj=EL(),gj=FL(),bj=Jp(),vj=OL(),yj=UL(),dy=$L(),An=HL(),JL=KL(),fy=ay(),Ij={42:An,43:An,45:An,48:An,49:An,50:An,51:An,52:An,53:An,54:An,55:An,56:An,57:An,62:uj},xj={91:dj},Sj={"-2":py,"-1":py,32:py},Tj={35:mj,42:fy,45:[JL,fy],60:hj,61:JL,95:fy,96:XL,126:XL},kj={38:YL,92:QL},Cj={"-5":dy,"-4":dy,"-3":dy,33:vj,38:YL,42:my,60:[lj,gj],91:yj,92:[fj,QL],93:bj,95:my,96:pj},Pj={null:[my,cj.resolver]},Rj={null:[]};wr.contentInitial=xj;wr.disable=Rj;wr.document=Ij;wr.flow=Tj;wr.flowInitial=Sj;wr.insideSpan=Pj;wr.string=kj;wr.text=Cj});var nE=w((Ote,tE)=>{"use strict";var Aj=OR(),Lj=qR(),Ej=QR(),eE=zv(),wj=Kv(),Fj=dA(),Dj=$p(),Nj=ZL();function _j(n){var e=n||{},t={defined:[],constructs:wj([Nj].concat(Dj(e.extensions))),content:r(Aj),document:r(Lj),flow:r(Ej),string:r(eE.string),text:r(eE.text)};return t;function r(i){return s;function s(a){return Fj(t,i,a)}}}o(_j,"parse");tE.exports=_j});var oE=w((Ute,iE)=>{"use strict";var rE=/[\0\t\n\r]/g;function Oj(){var n=!0,e=1,t="",r;return i;function i(s,a,c){var l=[],u,p,d,f,g;for(s=t+s.toString(a),d=0,t="",n&&(s.charCodeAt(0)===65279&&d++,n=void 0);d<s.length;){if(rE.lastIndex=d,u=rE.exec(s),f=u?u.index:s.length,g=s.charCodeAt(f),!u){t=s.slice(d);break}if(g===10&&d===f&&r)l.push(-3),r=void 0;else if(r&&(l.push(-5),r=void 0),d<f&&(l.push(s.slice(d,f)),e+=f-d),g===0)l.push(65533),e++;else if(g===9)for(p=Math.ceil(e/4)*4,l.push(-2);e++<p;)l.push(-1);else g===10?(l.push(-4),e=1):(r=!0,e=1);d=f+1}return c&&(r&&l.push(-5),t&&l.push(t),l.push(null)),l}}o(Oj,"preprocess");iE.exports=Oj});var aE=w(($te,sE)=>{"use strict";var Mj=Gv();function Uj(n){for(;!Mj(n););return n}o(Uj,"postprocess");sE.exports=Uj});var uE=w((Bte,lE)=>{"use strict";lE.exports=Hj;var qj=Up(),$j=Ks(),cE=qv(),hy=qp(),Wj=wR(),Bj=nE(),jj=oE(),Vj=aE(),Gj=Hp(),Yp=wv();function Hj(n,e,t){return typeof e!="string"&&(t=e,e=void 0),zj(t)(Vj(Bj(t).document().write(jj()(n,e,!0))))}o(Hj,"fromMarkdown");function zj(n){var e=n||{},t=Kj({transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:u(Qo),autolinkProtocol:ae,autolinkEmail:ae,atxHeading:u(Jo),blockQuote:u(Fa),characterEscape:ae,characterReference:ae,codeFenced:u(Xo),codeFencedFenceInfo:p,codeFencedFenceMeta:p,codeIndented:u(Xo,p),codeText:u(fi,p),codeTextData:ae,data:ae,codeFlowValue:ae,definition:u(Da),definitionDestinationString:p,definitionLabelString:p,definitionTitleString:p,emphasis:u(Ki),hardBreakEscape:u(zn),hardBreakTrailing:u(zn),htmlFlow:u(fr,p),htmlFlowData:ae,htmlText:u(fr,p),htmlTextData:ae,image:u(Na),label:p,link:u(Qo),listItem:u(Yo),listItemValue:S,listOrdered:u(Dn,T),listUnordered:u(Dn),paragraph:u(Zo),reference:Gi,referenceString:p,resourceDestinationString:p,resourceTitleString:p,setextHeading:u(Jo),strong:u(Xi),thematicBreak:u(mr)},exit:{atxHeading:f(),atxHeadingSequence:z,autolink:f(),autolinkEmail:Fn,autolinkProtocol:zi,blockQuote:f(),characterEscapeValue:de,characterReferenceMarkerHexadecimal:Ko,characterReferenceMarkerNumeric:Ko,characterReferenceValue:wa,codeFenced:f(W),codeFencedFence:A,codeFencedFenceInfo:C,codeFencedFenceMeta:L,codeFlowValue:de,codeIndented:f(O),codeText:f(at),codeTextData:de,data:de,definition:f(),definitionDestinationString:ie,definitionLabelString:j,definitionTitleString:J,emphasis:f(),hardBreakEscape:f(Je),hardBreakTrailing:f(Je),htmlFlow:f(_),htmlFlowData:de,htmlText:f(Ue),htmlTextData:de,image:f(v),label:pi,labelText:Hn,lineEnding:He,link:f(nt),listItem:f(),listOrdered:f(),listUnordered:f(),paragraph:f(),referenceString:Hi,resourceDestinationString:di,resourceTitleString:qr,resource:ct,setextHeading:f(Y),setextHeadingLineSequence:B,setextHeadingText:M,strong:f(),thematicBreak:f()}},e.mdastExtensions||[]),r={};return i;function i(I){for(var q={type:"root",children:[]},X=[q],ee=[],ke=[],me=-1,Le,qe,Ie={stack:X,tokenStack:ee,config:t,enter:d,exit:g,buffer:p,resume:h,setData:a,getData:c};++me<I.length;)(I[me][1].type==="listOrdered"||I[me][1].type==="listUnordered")&&(I[me][0]==="enter"?ke.push(me):(qe=ke.pop(me),me=s(I,qe,me)));for(me=-1;++me<I.length;)Le=t[I[me][0]],cE.call(Le,I[me][1].type)&&Le[I[me][1].type].call($j({sliceSerialize:I[me][2].sliceSerialize},Ie),I[me][1]);if(ee.length)throw new Error("Cannot close document, a token (`"+ee[ee.length-1].type+"`, "+Yp({start:ee[ee.length-1].start,end:ee[ee.length-1].end})+") is still open");for(q.position={start:l(I.length?I[0][1].start:{line:1,column:1,offset:0}),end:l(I.length?I[I.length-2][1].end:{line:1,column:1,offset:0})},me=-1;++me<t.transforms.length;)q=t.transforms[me](q)||q;return q}function s(I,q,X){for(var ee=q-1,ke=-1,me=!1,Le,qe,Ie,Re,fe,Ye,lt;++ee<=X;)if(fe=I[ee],fe[1].type==="listUnordered"||fe[1].type==="listOrdered"||fe[1].type==="blockQuote"?(fe[0]==="enter"?ke++:ke--,lt=void 0):fe[1].type==="lineEndingBlank"?fe[0]==="enter"&&(Le&&!lt&&!ke&&!Ye&&(Ye=ee),lt=void 0):fe[1].type==="linePrefix"||fe[1].type==="listItemValue"||fe[1].type==="listItemMarker"||fe[1].type==="listItemPrefix"||fe[1].type==="listItemPrefixWhitespace"||(lt=void 0),!ke&&fe[0]==="enter"&&fe[1].type==="listItemPrefix"||ke===-1&&fe[0]==="exit"&&(fe[1].type==="listUnordered"||fe[1].type==="listOrdered")){if(Le){for(qe=ee,Ie=void 0;qe--;)if(Re=I[qe],Re[1].type==="lineEnding"||Re[1].type==="lineEndingBlank"){if(Re[0]==="exit")continue;Ie&&(I[Ie][1].type="lineEndingBlank",me=!0),Re[1].type="lineEnding",Ie=qe}else if(!(Re[1].type==="linePrefix"||Re[1].type==="blockQuotePrefix"||Re[1].type==="blockQuotePrefixWhitespace"||Re[1].type==="blockQuoteMarker"||Re[1].type==="listItemIndent"))break;Ye&&(!Ie||Ye<Ie)&&(Le._spread=!0),Le.end=l(Ie?I[Ie][1].start:fe[1].end),I.splice(Ie||ee,0,["exit",Le,fe[2]]),ee++,X++}fe[1].type==="listItemPrefix"&&(Le={type:"listItem",_spread:!1,start:l(fe[1].start)},I.splice(ee,0,["enter",Le,fe[2]]),ee++,X++,Ye=void 0,lt=!0)}return I[q][1]._spread=me,X}function a(I,q){r[I]=q}function c(I){return r[I]}function l(I){return{line:I.line,column:I.column,offset:I.offset}}function u(I,q){return X;function X(ee){d.call(this,I(ee),ee),q&&q.call(this,ee)}}function p(){this.stack.push({type:"fragment",children:[]})}function d(I,q){return this.stack[this.stack.length-1].children.push(I),this.stack.push(I),this.tokenStack.push(q),I.position={start:l(q.start)},I}function f(I){return q;function q(X){I&&I.call(this,X),g.call(this,X)}}function g(I){var q=this.stack.pop(),X=this.tokenStack.pop();if(X){if(X.type!==I.type)throw new Error("Cannot close `"+I.type+"` ("+Yp({start:I.start,end:I.end})+"): a different token (`"+X.type+"`, "+Yp({start:X.start,end:X.end})+") is open")}else throw new Error("Cannot close `"+I.type+"` ("+Yp({start:I.start,end:I.end})+"): it\u2019s not open");return q.position.end=l(I.end),q}function h(){return qj(this.stack.pop())}function T(){a("expectingFirstListItemValue",!0)}function S(I){c("expectingFirstListItemValue")&&(this.stack[this.stack.length-2].start=parseInt(this.sliceSerialize(I),10),a("expectingFirstListItemValue"))}function C(){var I=this.resume();this.stack[this.stack.length-1].lang=I}function L(){var I=this.resume();this.stack[this.stack.length-1].meta=I}function A(){c("flowCodeInside")||(this.buffer(),a("flowCodeInside",!0))}function W(){var I=this.resume();this.stack[this.stack.length-1].value=I.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),a("flowCodeInside")}function O(){var I=this.resume();this.stack[this.stack.length-1].value=I}function j(I){var q=this.resume();this.stack[this.stack.length-1].label=q,this.stack[this.stack.length-1].identifier=hy(this.sliceSerialize(I)).toLowerCase()}function J(){var I=this.resume();this.stack[this.stack.length-1].title=I}function ie(){var I=this.resume();this.stack[this.stack.length-1].url=I}function z(I){this.stack[this.stack.length-1].depth||(this.stack[this.stack.length-1].depth=this.sliceSerialize(I).length)}function M(){a("setextHeadingSlurpLineEnding",!0)}function B(I){this.stack[this.stack.length-1].depth=this.sliceSerialize(I).charCodeAt(0)===61?1:2}function Y(){a("setextHeadingSlurpLineEnding")}function ae(I){var q=this.stack[this.stack.length-1].children,X=q[q.length-1];(!X||X.type!=="text")&&(X=es(),X.position={start:l(I.start)},this.stack[this.stack.length-1].children.push(X)),this.stack.push(X)}function de(I){var q=this.stack.pop();q.value+=this.sliceSerialize(I),q.position.end=l(I.end)}function He(I){var q=this.stack[this.stack.length-1];if(c("atHardBreak")){q.children[q.children.length-1].position.end=l(I.end),a("atHardBreak");return}!c("setextHeadingSlurpLineEnding")&&t.canContainEols.indexOf(q.type)>-1&&(ae.call(this,I),de.call(this,I))}function Je(){a("atHardBreak",!0)}function _(){var I=this.resume();this.stack[this.stack.length-1].value=I}function Ue(){var I=this.resume();this.stack[this.stack.length-1].value=I}function at(){var I=this.resume();this.stack[this.stack.length-1].value=I}function nt(){var I=this.stack[this.stack.length-1];c("inReference")?(I.type+="Reference",I.referenceType=c("referenceType")||"shortcut",delete I.url,delete I.title):(delete I.identifier,delete I.label,delete I.referenceType),a("referenceType")}function v(){var I=this.stack[this.stack.length-1];c("inReference")?(I.type+="Reference",I.referenceType=c("referenceType")||"shortcut",delete I.url,delete I.title):(delete I.identifier,delete I.label,delete I.referenceType),a("referenceType")}function Hn(I){this.stack[this.stack.length-2].identifier=hy(this.sliceSerialize(I)).toLowerCase()}function pi(){var I=this.stack[this.stack.length-1],q=this.resume();this.stack[this.stack.length-1].label=q,a("inReference",!0),this.stack[this.stack.length-1].type==="link"?this.stack[this.stack.length-1].children=I.children:this.stack[this.stack.length-1].alt=q}function di(){var I=this.resume();this.stack[this.stack.length-1].url=I}function qr(){var I=this.resume();this.stack[this.stack.length-1].title=I}function ct(){a("inReference")}function Gi(){a("referenceType","collapsed")}function Hi(I){var q=this.resume();this.stack[this.stack.length-1].label=q,this.stack[this.stack.length-1].identifier=hy(this.sliceSerialize(I)).toLowerCase(),a("referenceType","full")}function Ko(I){a("characterReferenceType",I.type)}function wa(I){var q=this.sliceSerialize(I),X=c("characterReferenceType"),ee,ke;X?(ee=Wj(q,X==="characterReferenceMarkerNumeric"?10:16),a("characterReferenceType")):ee=Gj(q),ke=this.stack.pop(),ke.value+=ee,ke.position.end=l(I.end)}function zi(I){de.call(this,I),this.stack[this.stack.length-1].url=this.sliceSerialize(I)}function Fn(I){de.call(this,I),this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(I)}function Fa(){return{type:"blockquote",children:[]}}function Xo(){return{type:"code",lang:null,meta:null,value:""}}function fi(){return{type:"inlineCode",value:""}}function Da(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Ki(){return{type:"emphasis",children:[]}}function Jo(){return{type:"heading",depth:void 0,children:[]}}function zn(){return{type:"break"}}function fr(){return{type:"html",value:""}}function Na(){return{type:"image",title:null,url:"",alt:null}}function Qo(){return{type:"link",title:null,url:"",children:[]}}function Dn(I){return{type:"list",ordered:I.type==="listOrdered",start:null,spread:I._spread,children:[]}}function Yo(I){return{type:"listItem",spread:I._spread,checked:null,children:[]}}function Zo(){return{type:"paragraph",children:[]}}function Xi(){return{type:"strong",children:[]}}function es(){return{type:"text",value:""}}function mr(){return{type:"thematicBreak"}}}o(zj,"compiler");function Kj(n,e){for(var t=-1;++t<e.length;)Xj(n,e[t]);return n}o(Kj,"configure");function Xj(n,e){var t,r;for(t in e)r=cE.call(n,t)?n[t]:n[t]={},t==="canContainEols"||t==="transforms"?n[t]=[].concat(r,e[t]):Object.assign(r,e[t])}o(Xj,"extension")});var dE=w((Vte,pE)=>{"use strict";pE.exports=uE()});var mE=w((Gte,fE)=>{"use strict";fE.exports=Qj;var Jj=dE();function Qj(n){var e=this;this.Parser=t;function t(r){return Jj(r,Object.assign({},e.data("settings"),n,{extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]}))}o(t,"parse")}o(Qj,"parse")});var bE=w((zte,gE)=>{"use strict";gE.exports=Zj;var Yj=Function.prototype,hE={}.hasOwnProperty;function Zj(n,e){var t=e||{};function r(i){var s=r.invalid,a=r.handlers;return i&&hE.call(i,n)&&(s=hE.call(a,i[n])?a[i[n]]:r.unknown),(s||Yj).apply(this,arguments)}return o(r,"one"),r.handlers=t.handlers||{},r.invalid=t.invalid,r.unknown=t.unknown,r}o(Zj,"factory")});var gy=w((Xte,yE)=>{yE.exports=vE;function vE(n,e){var t=-1,r;if(e.extensions)for(;++t<e.extensions.length;)vE(n,e.extensions[t]);for(r in e)r==="extensions"||(r==="unsafe"||r==="join"?n[r]=n[r].concat(e[r]||[]):r==="handlers"?n[r]=Object.assign(n[r],e[r]||{}):n.options[r]=e[r]);return n}o(vE,"configure")});var Po=w((Qte,IE)=>{"use strict";var ii="",by;IE.exports=eV;function eV(n,e){if(typeof n!="string")throw new TypeError("expected a string");if(e===1)return n;if(e===2)return n+n;var t=n.length*e;if(by!==n||typeof by>"u")by=n,ii="";else if(ii.length>=t)return ii.substr(0,t);for(;t>ii.length&&e>1;)e&1&&(ii+=n),e>>=1,n+=n;return ii+=n,ii=ii.substr(0,t),ii}o(eV,"repeat")});var Mc=w((Zte,xE)=>{xE.exports=nV;var tV=Po();function nV(n,e){for(var t=n.children||[],r=[],i=-1,s;++i<t.length;)s=t[i],r.push(e.handle(s,n,e,{before:`
`,after:`
`})),i+1<t.length&&r.push(a(s,t[i+1]));return r.join("");function a(c,l){for(var u=-1,p;++u<e.join.length&&(p=e.join[u](c,l,n,e),!(p===!0||p===1));){if(typeof p=="number")return tV(`
`,1+Number(p));if(p===!1)return`

<!---->

`}return`

`}}o(nV,"flow")});var Zp=w((tne,SE)=>{SE.exports=iV;var rV=/\r?\n|\r/g;function iV(n,e){for(var t=[],r=0,i=0,s;s=rV.exec(n);)a(n.slice(r,s.index)),t.push(s[0]),r=s.index+s[0].length,i++;return a(n.slice(r)),t.join("");function a(c){t.push(e(c,i,!c))}o(a,"one")}o(iV,"indentLines")});var kE=w((rne,TE)=>{TE.exports=aV;var oV=Mc(),sV=Zp();function aV(n,e,t){var r=t.enter("blockquote"),i=sV(oV(n,t),cV);return r(),i}o(aV,"blockquote");function cV(n,e,t){return">"+(t?"":" ")+n}o(cV,"map")});var vy=w((one,PE)=>{PE.exports=lV;function lV(n,e){return CE(n,e.inConstruct,!0)&&!CE(n,e.notInConstruct)}o(lV,"patternInScope");function CE(n,e,t){var r;if(!e)return t;for(typeof e=="string"&&(e=[e]),r=-1;++r<e.length;)if(n.indexOf(e[r])!==-1)return!0;return!1}o(CE,"listInScope")});var yy=w((ane,RE)=>{RE.exports=pV;var uV=vy();function pV(n,e,t,r){for(var i=-1;++i<t.unsafe.length;)if(t.unsafe[i].character===`
`&&uV(t.stack,t.unsafe[i]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}o(pV,"hardBreak")});var LE=w((lne,AE)=>{"use strict";AE.exports=dV;function dV(n,e){var t=0,r=0,i,s;if(typeof e!="string"||e.length!==1)throw new Error("Expected character");for(n=String(n),s=n.indexOf(e),i=s;s!==-1;)t++,s===i?t>r&&(r=t):t=1,i=s+1,s=n.indexOf(e,i);return r}o(dV,"longestStreak")});var Iy=w((pne,EE)=>{EE.exports=fV;function fV(n,e){return!e.options.fences&&n.value&&!n.lang&&/[^ \r\n]/.test(n.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(n.value)}o(fV,"formatCodeAsIndented")});var FE=w((fne,wE)=>{wE.exports=mV;function mV(n){var e=n.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}o(mV,"checkFence")});var xy=w((hne,DE)=>{DE.exports=hV;function hV(n){var e,t;return n._compiled||(e=n.before?"(?:"+n.before+")":"",t=n.after?"(?:"+n.after+")":"",n.atBreak&&(e="[\\r\\n][\\t ]*"+e),n._compiled=new RegExp((e?"("+e+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(n.character)?"\\":"")+n.character+(t||""),"g")),n._compiled}o(hV,"patternCompile")});var Ni=w((bne,_E)=>{_E.exports=vV;var gV=xy(),bV=vy();function vV(n,e,t){for(var r=(t.before||"")+(e||"")+(t.after||""),i=[],s=[],a={},c=-1,l,u,p,d,f,g,h,T;++c<n.unsafe.length;)if(d=n.unsafe[c],!!bV(n.stack,d))for(f=gV(d);g=f.exec(r);)l="before"in d||d.atBreak,u="after"in d,p=g.index+(l?g[1].length:0),i.indexOf(p)===-1?(i.push(p),a[p]={before:l,after:u}):(a[p].before&&!l&&(a[p].before=!1),a[p].after&&!u&&(a[p].after=!1));for(i.sort(yV),h=t.before?t.before.length:0,T=r.length-(t.after?t.after.length:0),c=-1;++c<i.length;)p=i[c],!(p<h||p>=T)&&(p+1<T&&i[c+1]===p+1&&a[p].after&&!a[p+1].before&&!a[p+1].after||(h!==p&&s.push(NE(r.slice(h,p),"\\")),h=p,/[!-/:-@[-`{-~]/.test(r.charAt(p))&&(!t.encode||t.encode.indexOf(r.charAt(p))===-1)?s.push("\\"):(s.push("&#x"+r.charCodeAt(p).toString(16).toUpperCase()+";"),h++)));return s.push(NE(r.slice(h,T),t.after)),s.join("")}o(vV,"safe");function yV(n,e){return n-e}o(yV,"numerical");function NE(n,e){for(var t=/\\(?=[!-/:-@[-`{-~])/g,r=[],i=[],s=-1,a=0,c=n+e,l;l=t.exec(c);)r.push(l.index);for(;++s<r.length;)a!==r[s]&&i.push(n.slice(a,r[s])),i.push("\\"),a=r[s];return i.push(n.slice(a)),i.join("")}o(NE,"escapeBackslashes")});var UE=w((yne,ME)=>{ME.exports=CV;var IV=Po(),xV=LE(),SV=Iy(),TV=FE(),kV=Zp(),OE=Ni();function CV(n,e,t){var r=TV(t),i=n.value||"",s=r==="`"?"GraveAccent":"Tilde",a,c,l,u;return SV(n,t)?(l=t.enter("codeIndented"),a=kV(i,PV)):(c=IV(r,Math.max(xV(i,r)+1,3)),l=t.enter("codeFenced"),a=c,n.lang&&(u=t.enter("codeFencedLang"+s),a+=OE(t,n.lang,{before:"`",after:" ",encode:["`"]}),u()),n.lang&&n.meta&&(u=t.enter("codeFencedMeta"+s),a+=" "+OE(t,n.meta,{before:" ",after:`
`,encode:["`"]}),u()),a+=`
`,i&&(a+=i+`
`),a+=c),l(),a}o(CV,"code");function PV(n,e,t){return(t?"":"    ")+n}o(PV,"map")});var ed=w((xne,qE)=>{qE.exports=EV;var RV=Hp(),AV=/\\([!-/:-@[-`{-~])/g,LV=/&(#(\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function EV(n){return n.label||!n.identifier?n.label||"":n.identifier.replace(AV,"$1").replace(LV,wV)}o(EV,"association");function wV(n,e){return RV(e)||n}o(wV,"decodeIfPossible")});var td=w((Tne,$E)=>{$E.exports=FV;function FV(n){var e=n.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}o(FV,"checkQuote")});var BE=w((Cne,WE)=>{WE.exports=_V;var DV=ed(),NV=td(),nd=Ni();function _V(n,e,t){var r=NV(t),i=r==='"'?"Quote":"Apostrophe",s=t.enter("definition"),a=t.enter("label"),c="["+nd(t,DV(n),{before:"[",after:"]"})+"]: ";return a(),!n.url||/[ \t\r\n]/.test(n.url)?(a=t.enter("destinationLiteral"),c+="<"+nd(t,n.url,{before:"<",after:">"})+">"):(a=t.enter("destinationRaw"),c+=nd(t,n.url,{before:" ",after:" "})),a(),n.title&&(a=t.enter("title"+i),c+=" "+r+nd(t,n.title,{before:r,after:r})+r,a()),s(),c}o(_V,"definition")});var VE=w((Rne,jE)=>{jE.exports=OV;function OV(n){var e=n.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}o(OV,"checkEmphasis")});var oi=w((Lne,GE)=>{GE.exports=MV;function MV(n,e,t){for(var r=n.children||[],i=[],s=-1,a=t.before,c,l,u;++s<r.length;)u=r[s],s+1<r.length?(l=e.handle.handlers[r[s+1].type],l&&l.peek&&(l=l.peek),c=l?l(r[s+1],n,e,{before:"",after:""}).charAt(0):""):c=t.after,i.length>0&&(a==="\r"||a===`
`)&&u.type==="html"&&(i[i.length-1]=i[i.length-1].replace(/(\r?\n|\r)$/," "),a=" "),i.push(e.handle(u,n,e,{before:a,after:c})),a=i[i.length-1].slice(-1);return i.join("")}o(MV,"phrasing")});var KE=w((wne,zE)=>{zE.exports=HE;HE.peek=$V;var UV=VE(),qV=oi();function HE(n,e,t){var r=UV(t),i=t.enter("emphasis"),s=qV(n,t,{before:r,after:r});return i(),r+s+r}o(HE,"emphasis");function $V(n,e,t){return t.options.emphasis||"*"}o($V,"emphasisPeek")});var Sy=w((Dne,XE)=>{XE.exports=BV;var WV=Up();function BV(n,e){return e.options.setext&&(!n.depth||n.depth<3)&&WV(n)}o(BV,"formatHeadingAsSetext")});var ZE=w((_ne,YE)=>{YE.exports=VV;var JE=Po(),jV=Sy(),QE=oi();function VV(n,e,t){var r=Math.max(Math.min(6,n.depth||1),1),i,s,a,c;return jV(n,t)?(i=t.enter("headingSetext"),s=t.enter("phrasing"),a=QE(n,t,{before:`
`,after:`
`}),s(),i(),a+`
`+JE(r===1?"=":"-",a.length-(Math.max(a.lastIndexOf("\r"),a.lastIndexOf(`
`))+1))):(c=JE("#",r),i=t.enter("headingAtx"),s=t.enter("phrasing"),a=QE(n,t,{before:"# ",after:`
`}),a=a?c+" "+a:c,t.options.closeAtx&&(a+=" "+c),s(),i(),a)}o(VV,"heading")});var nw=w((Mne,tw)=>{tw.exports=ew;ew.peek=GV;function ew(n){return n.value||""}o(ew,"html");function GV(){return"<"}o(GV,"htmlPeek")});var ow=w((qne,iw)=>{iw.exports=rw;rw.peek=zV;var HV=td(),rd=Ni();function rw(n,e,t){var r=HV(t),i=r==='"'?"Quote":"Apostrophe",s=t.enter("image"),a=t.enter("label"),c="!["+rd(t,n.alt,{before:"[",after:"]"})+"](";return a(),!n.url&&n.title||/[ \t\r\n]/.test(n.url)?(a=t.enter("destinationLiteral"),c+="<"+rd(t,n.url,{before:"<",after:">"})+">"):(a=t.enter("destinationRaw"),c+=rd(t,n.url,{before:"(",after:n.title?" ":")"})),a(),n.title&&(a=t.enter("title"+i),c+=" "+r+rd(t,n.title,{before:r,after:r})+r,a()),c+=")",s(),c}o(rw,"image");function zV(){return"!"}o(zV,"imagePeek")});var lw=w((Wne,cw)=>{cw.exports=aw;aw.peek=XV;var KV=ed(),sw=Ni();function aw(n,e,t){var r=n.referenceType,i=t.enter("imageReference"),s=t.enter("label"),a=sw(t,n.alt,{before:"[",after:"]"}),c="!["+a+"]",l,u;return s(),u=t.stack,t.stack=[],s=t.enter("reference"),l=sw(t,KV(n),{before:"[",after:"]"}),s(),t.stack=u,i(),r==="full"||!a||a!==l?c+="["+l+"]":r!=="shortcut"&&(c+="[]"),c}o(aw,"imageReference");function XV(){return"!"}o(XV,"imageReferencePeek")});var Ty=w((jne,pw)=>{pw.exports=uw;uw.peek=QV;var JV=xy();function uw(n,e,t){for(var r=n.value||"",i="`",s=-1,a,c,l,u;new RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`";for(/[^ \r\n]/.test(r)&&(/[ \r\n`]/.test(r.charAt(0))||/[ \r\n`]/.test(r.charAt(r.length-1)))&&(r=" "+r+" ");++s<t.unsafe.length;)if(a=t.unsafe[s],!!a.atBreak)for(c=JV(a);l=c.exec(r);)u=l.index,r.charCodeAt(u)===10&&r.charCodeAt(u-1)===13&&u--,r=r.slice(0,u)+" "+r.slice(l.index+1);return i+r+i}o(uw,"inlineCode");function QV(){return"`"}o(QV,"inlineCodePeek")});var fw=w((Gne,dw)=>{dw.exports=ZV;var YV=Up();function ZV(n,e){var t=YV(n);return!e.options.resourceLink&&n.url&&!n.title&&n.children&&n.children.length===1&&n.children[0].type==="text"&&(t===n.url||"mailto:"+t===n.url)&&/^[a-z][a-z+.-]+:/i.test(n.url)&&!/[\0- <>\u007F]/.test(n.url)}o(ZV,"formatLinkAsAutolink")});var vw=w((zne,bw)=>{bw.exports=gw;gw.peek=tG;var eG=td(),hw=fw(),mw=oi(),ky=Ni();function gw(n,e,t){var r=eG(t),i=r==='"'?"Quote":"Apostrophe",s,a,c,l;return hw(n,t)?(l=t.stack,t.stack=[],s=t.enter("autolink"),c="<"+mw(n,t,{before:"<",after:">"})+">",s(),t.stack=l,c):(s=t.enter("link"),a=t.enter("label"),c="["+mw(n,t,{before:"[",after:"]"})+"](",a(),!n.url&&n.title||/[ \t\r\n]/.test(n.url)?(a=t.enter("destinationLiteral"),c+="<"+ky(t,n.url,{before:"<",after:">"})+">"):(a=t.enter("destinationRaw"),c+=ky(t,n.url,{before:"(",after:n.title?" ":")"})),a(),n.title&&(a=t.enter("title"+i),c+=" "+r+ky(t,n.title,{before:r,after:r})+r,a()),c+=")",s(),c)}o(gw,"link");function tG(n,e,t){return hw(n,t)?"<":"["}o(tG,"linkPeek")});var xw=w((Xne,Iw)=>{Iw.exports=yw;yw.peek=oG;var nG=ed(),rG=oi(),iG=Ni();function yw(n,e,t){var r=n.referenceType,i=t.enter("linkReference"),s=t.enter("label"),a=rG(n,t,{before:"[",after:"]"}),c="["+a+"]",l,u;return s(),u=t.stack,t.stack=[],s=t.enter("reference"),l=iG(t,nG(n),{before:"[",after:"]"}),s(),t.stack=u,i(),r==="full"||!a||a!==l?c+="["+l+"]":r!=="shortcut"&&(c+="[]"),c}o(yw,"linkReference");function oG(){return"["}o(oG,"linkReferencePeek")});var Tw=w((Qne,Sw)=>{Sw.exports=aG;var sG=Mc();function aG(n,e,t){var r=t.enter("list"),i=sG(n,t);return r(),i}o(aG,"list")});var Cw=w((Zne,kw)=>{kw.exports=cG;function cG(n){var e=n.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}o(cG,"checkBullet")});var Rw=w((tre,Pw)=>{Pw.exports=lG;function lG(n){var e=n.options.listItemIndent||"tab";if(e===1||e==="1")return"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}o(lG,"checkListItemIndent")});var Cy=w((rre,Lw)=>{Lw.exports=mG;var Aw=Po(),uG=Cw(),pG=Rw(),dG=Mc(),fG=Zp();function mG(n,e,t){var r=uG(t),i=pG(t),s,a,c;return e&&e.ordered&&(r=(e.start>-1?e.start:1)+(t.options.incrementListMarker===!1?0:e.children.indexOf(n))+"."),s=r.length+1,(i==="tab"||i==="mixed"&&(e&&e.spread||n.spread))&&(s=Math.ceil(s/4)*4),c=t.enter("listItem"),a=fG(dG(n,t),l),c(),a;function l(u,p,d){return p?(d?"":Aw(" ",s))+u:(d?r:r+Aw(" ",s-r.length))+u}o(l,"map")}o(mG,"listItem")});var ww=w((ore,Ew)=>{Ew.exports=gG;var hG=oi();function gG(n,e,t){var r=t.enter("paragraph"),i=t.enter("phrasing"),s=hG(n,t,{before:`
`,after:`
`});return i(),r(),s}o(gG,"paragraph")});var Dw=w((are,Fw)=>{Fw.exports=vG;var bG=Mc();function vG(n,e,t){return bG(n,t)}o(vG,"root")});var _w=w((lre,Nw)=>{Nw.exports=yG;function yG(n){var e=n.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}o(yG,"checkStrong")});var Uw=w((pre,Mw)=>{Mw.exports=Ow;Ow.peek=SG;var IG=_w(),xG=oi();function Ow(n,e,t){var r=IG(t),i=t.enter("strong"),s=xG(n,t,{before:r,after:r});return i(),r+r+s+r+r}o(Ow,"strong");function SG(n,e,t){return t.options.strong||"*"}o(SG,"strongPeek")});var $w=w((fre,qw)=>{qw.exports=kG;var TG=Ni();function kG(n,e,t,r){return TG(t,n.value,r)}o(kG,"text")});var Bw=w((hre,Ww)=>{Ww.exports=CG;function CG(n){var e=n.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}o(CG,"checkRule")});var Vw=w((bre,jw)=>{jw.exports=PG;function PG(n){var e=n.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}o(PG,"checkRule")});var Hw=w((yre,Gw)=>{Gw.exports=EG;var RG=Po(),AG=Bw(),LG=Vw();function EG(n,e,t){var r=RG(LG(t)+(t.options.ruleSpaces?" ":""),AG(t));return t.options.ruleSpaces?r.slice(0,-1):r}o(EG,"thematicBreak")});var zw=w(xt=>{xt.blockquote=kE();xt.break=yy();xt.code=UE();xt.definition=BE();xt.emphasis=KE();xt.hardBreak=yy();xt.heading=ZE();xt.html=nw();xt.image=ow();xt.imageReference=lw();xt.inlineCode=Ty();xt.link=vw();xt.linkReference=xw();xt.list=Tw();xt.listItem=Cy();xt.paragraph=ww();xt.root=Dw();xt.strong=Uw();xt.text=$w();xt.thematicBreak=Hw()});var Jw=w((Sre,Xw)=>{Xw.exports=[FG];var Kw=Iy(),wG=Sy();function FG(n,e,t,r){if(e.type==="list"&&e.type===n.type&&!!n.ordered==!!e.ordered||e.type==="code"&&Kw(e,r)&&(n.type==="list"||n.type===e.type&&Kw(n,r)))return!1;if(typeof t.spread=="boolean")return n.type==="paragraph"&&(n.type===e.type||e.type==="definition"||e.type==="heading"&&wG(e,r))?void 0:t.spread?1:0}o(FG,"joinDefaults")});var Yw=w((kre,Qw)=>{Qw.exports=[{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing"},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing"},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*"},{character:"*",inConstruct:"phrasing"},{atBreak:!0,character:"+"},{atBreak:!0,character:"-"},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing"},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:["phrasing","label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{before:"[^A-Za-z]",character:"_",inConstruct:"phrasing"},{character:"_",after:"[^A-Za-z]",inConstruct:"phrasing"},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent","phrasing"]},{atBreak:!0,character:"~"}]});var tF=w((Cre,eF)=>{eF.exports=MG;var DG=bE(),Zw=gy(),NG=zw(),_G=Jw(),OG=Yw();function MG(n,e){var t=e||{},r={enter:s,stack:[],unsafe:[],join:[],handlers:{},options:{}},i;return Zw(r,{unsafe:OG,join:_G,handlers:NG}),Zw(r,t),r.options.tightDefinitions&&(r.join=[$G].concat(r.join)),r.handle=DG("type",{invalid:UG,unknown:qG,handlers:r.handlers}),i=r.handle(n,null,r,{before:`
`,after:`
`}),i&&i.charCodeAt(i.length-1)!==10&&i.charCodeAt(i.length-1)!==13&&(i+=`
`),i;function s(a){return r.stack.push(a),c;function c(){r.stack.pop()}o(c,"exit")}o(s,"enter")}o(MG,"toMarkdown");function UG(n){throw new Error("Cannot handle value `"+n+"`, expected node")}o(UG,"invalid");function qG(n){throw new Error("Cannot handle unknown node `"+n.type+"`")}o(qG,"unknown");function $G(n,e){if(n.type==="definition"&&n.type===e.type)return 0}o($G,"joinDefinition")});var rF=w((Rre,nF)=>{nF.exports=tF()});var oF=w((Are,iF)=>{"use strict";iF.exports=BG;var WG=rF();function BG(n){var e=this;this.Compiler=t;function t(r){return WG(r,Object.assign({},e.data("settings"),n,{extensions:e.data("toMarkdownExtensions")||[]}))}o(t,"compile")}o(BG,"stringify")});var aF=w((Ere,sF)=>{"use strict";var jG=SR(),VG=mE(),GG=oF();sF.exports=jG().use(VG).use(GG).freeze()});var TF=w(SF=>{var lF=Nc(),uF=Js(),pF=Vp(),HG=It(),dF=Bp(),fF=jp(),zG={tokenize:QG,partial:!0},mF={tokenize:YG,partial:!0},hF={tokenize:ZG,partial:!0},na={tokenize:tH,partial:!0},gF={tokenize:eH,partial:!0},bF={tokenize:XG,previous:IF},vF={tokenize:JG,previous:Ry},si={tokenize:KG,previous:xF},Fr={};SF.text=Fr;var Ro=48;for(;Ro<123;)Fr[Ro]=si,Ro++,Ro===58?Ro=65:Ro===91&&(Ro=97);Fr[43]=si;Fr[45]=si;Fr[46]=si;Fr[95]=si;Fr[72]=[si,vF];Fr[104]=[si,vF];Fr[87]=[si,bF];Fr[119]=[si,bF];function KG(n,e,t){var r=this,i;return s;function s(f){return!cF(f)||!xF(r.previous)||Ay(r.events)?t(f):(n.enter("literalAutolink"),n.enter("literalAutolinkEmail"),a(f))}function a(f){return cF(f)?(n.consume(f),a):f===64?(n.consume(f),c):t(f)}function c(f){return f===46?n.check(na,d,l)(f):f===45||f===95?n.check(na,t,u)(f):uF(f)?(n.consume(f),c):d(f)}function l(f){return n.consume(f),i=!0,c}function u(f){return n.consume(f),p}function p(f){return f===46?n.check(na,t,l)(f):c(f)}function d(f){return i?(n.exit("literalAutolinkEmail"),n.exit("literalAutolink"),e(f)):t(f)}}o(KG,"tokenizeEmailAutolink");function XG(n,e,t){var r=this;return i;function i(a){return a!==87&&a-32!==87||!IF(r.previous)||Ay(r.events)?t(a):(n.enter("literalAutolink"),n.enter("literalAutolinkWww"),n.check(zG,n.attempt(mF,n.attempt(hF,s),t),t)(a))}function s(a){return n.exit("literalAutolinkWww"),n.exit("literalAutolink"),e(a)}}o(XG,"tokenizeWwwAutolink");function JG(n,e,t){var r=this;return i;function i(h){return h!==72&&h-32!==72||!Ry(r.previous)||Ay(r.events)?t(h):(n.enter("literalAutolink"),n.enter("literalAutolinkHttp"),n.consume(h),s)}function s(h){return h===84||h-32===84?(n.consume(h),a):t(h)}function a(h){return h===84||h-32===84?(n.consume(h),c):t(h)}function c(h){return h===80||h-32===80?(n.consume(h),l):t(h)}function l(h){return h===83||h-32===83?(n.consume(h),u):u(h)}function u(h){return h===58?(n.consume(h),p):t(h)}function p(h){return h===47?(n.consume(h),d):t(h)}function d(h){return h===47?(n.consume(h),f):t(h)}function f(h){return pF(h)||fF(h)||dF(h)?t(h):n.attempt(mF,n.attempt(hF,g),t)(h)}function g(h){return n.exit("literalAutolinkHttp"),n.exit("literalAutolink"),e(h)}}o(JG,"tokenizeHttpAutolink");function QG(n,e,t){return r;function r(l){return n.consume(l),i}function i(l){return l===87||l-32===87?(n.consume(l),s):t(l)}function s(l){return l===87||l-32===87?(n.consume(l),a):t(l)}function a(l){return l===46?(n.consume(l),c):t(l)}function c(l){return l===null||HG(l)?t(l):e(l)}}o(QG,"tokenizeWww");function YG(n,e,t){var r,i;return s;function s(l){return l===38?n.check(gF,c,a)(l):l===46||l===95?n.check(na,c,a)(l):pF(l)||fF(l)||l!==45&&dF(l)?c(l):(n.consume(l),s)}function a(l){return l===46?(i=r,r=void 0,n.consume(l),s):(l===95&&(r=!0),n.consume(l),s)}function c(l){return!i&&!r?e(l):t(l)}}o(YG,"tokenizeDomain");function ZG(n,e){var t=0;return r;function r(a){return a===38?n.check(gF,e,i)(a):(a===40&&t++,a===41?n.check(na,s,i)(a):Py(a)?e(a):yF(a)?n.check(na,e,i)(a):(n.consume(a),r))}function i(a){return n.consume(a),r}function s(a){return t--,t<0?e(a):i(a)}}o(ZG,"tokenizePath");function eH(n,e,t){return r;function r(a){return n.consume(a),i}function i(a){return lF(a)?(n.consume(a),i):a===59?(n.consume(a),s):t(a)}function s(a){return Py(a)?e(a):t(a)}}o(eH,"tokenizeNamedCharacterReference");function tH(n,e,t){return r;function r(s){return n.consume(s),i}function i(s){return yF(s)?(n.consume(s),i):Py(s)?e(s):t(s)}}o(tH,"tokenizePunctuation");function yF(n){return n===33||n===34||n===39||n===41||n===42||n===44||n===46||n===58||n===59||n===60||n===63||n===95||n===126}o(yF,"trailingPunctuation");function Py(n){return n===null||n<0||n===32||n===60}o(Py,"pathEnd");function cF(n){return n===43||n===45||n===46||n===95||uF(n)}o(cF,"gfmAtext");function IF(n){return n===null||n<0||n===32||n===40||n===42||n===95||n===126}o(IF,"previousWww");function Ry(n){return n===null||!lF(n)}o(Ry,"previousHttp");function xF(n){return n!==47&&Ry(n)}o(xF,"previousEmail");function Ay(n){for(var e=n.length;e--;)if((n[e][1].type==="labelLink"||n[e][1].type==="labelImage")&&!n[e][1]._balanced)return!0}o(Ay,"previous")});var CF=w((Dre,kF)=>{kF.exports=TF()});var AF=w((Nre,RF)=>{RF.exports=rH;var PF=Jv(),Ly=Ar(),nH=Fc(),id=Di();function rH(n){var e=n||{},t=e.singleTilde,r={tokenize:a,resolveAll:i};return t==null&&(t=!0),{text:{126:r},insideSpan:{null:r}};function i(c,l){for(var u=-1,p,d,f,g;++u<c.length;)if(c[u][0]==="enter"&&c[u][1].type==="strikethroughSequenceTemporary"&&c[u][1]._close){for(f=u;f--;)if(c[f][0]==="exit"&&c[f][1].type==="strikethroughSequenceTemporary"&&c[f][1]._open&&c[u][1].end.offset-c[u][1].start.offset===c[f][1].end.offset-c[f][1].start.offset){c[u][1].type="strikethroughSequence",c[f][1].type="strikethroughSequence",p={type:"strikethrough",start:id(c[f][1].start),end:id(c[u][1].end)},d={type:"strikethroughText",start:id(c[f][1].end),end:id(c[u][1].start)},g=[["enter",p,l],["enter",c[f][1],l],["exit",c[f][1],l],["enter",d,l]],Ly(g,g.length,0,nH(l.parser.constructs.insideSpan.null,c.slice(f+1,u),l)),Ly(g,g.length,0,[["exit",d,l],["enter",c[u][1],l],["exit",c[u][1],l],["exit",p,l]]),Ly(c,f-1,u-f+3,g),u=f+g.length-2;break}}return s(c)}o(i,"resolveAllStrikethrough");function s(c){for(var l=-1,u=c.length;++l<u;)c[l][1].type==="strikethroughSequenceTemporary"&&(c[l][1].type="data");return c}o(s,"removeRemainingSequences");function a(c,l,u){var p=this.previous,d=this.events,f=0;return g;function g(T){return T!==126||p===126&&d[d.length-1][1].type!=="characterEscape"?u(T):(c.enter("strikethroughSequenceTemporary"),h(T))}function h(T){var S=PF(p),C,L;return T===126?f>1?u(T):(c.consume(T),f++,h):f<2&&!t?u(T):(C=c.exit("strikethroughSequenceTemporary"),L=PF(T),C._open=!L||L===2&&S,C._close=!S||S===2&&L,l(T))}}o(a,"tokenizeStrikethrough")}o(rH,"create")});var wF=w(EF=>{EF.flow={null:{tokenize:sH,resolve:oH,interruptible:!0}};var Ey=Rt(),iH={tokenize:aH,partial:!0},LF={tokenize:cH,partial:!0};function oH(n,e){for(var t=n.length,r=-1,i,s,a,c,l,u,p,d,f,g;++r<t;)i=n[r][1],c&&(i.type==="temporaryTableCellContent"&&(d=d||r,f=r),(i.type==="tableCellDivider"||i.type==="tableRow")&&f&&(u={type:"tableContent",start:n[d][1].start,end:n[f][1].end},p={type:"chunkText",start:u.start,end:u.end,contentType:"text"},n.splice(d,f-d+1,["enter",u,e],["enter",p,e],["exit",p,e],["exit",u,e]),r-=f-d-3,t=n.length,d=void 0,f=void 0)),n[r][0]==="exit"&&g&&g+1<r&&(i.type==="tableCellDivider"||i.type==="tableRow"&&(g+3<r||n[g][1].type!=="whitespace"))&&(l={type:a?"tableDelimiter":s?"tableHeader":"tableData",start:n[g][1].start,end:n[r][1].end},n.splice(r+(i.type==="tableCellDivider"?1:0),0,["exit",l,e]),n.splice(g,0,["enter",l,e]),r+=2,t=n.length,g=r+1),i.type==="tableRow"&&(c=n[r][0]==="enter",c&&(g=r+1)),i.type==="tableDelimiterRow"&&(a=n[r][0]==="enter",a&&(g=r+1)),i.type==="tableHead"&&(s=n[r][0]==="enter");return n}o(oH,"resolveTable");function sH(n,e,t){var r=[],i=0,s,a;return c;function c(_){return _===null||_===-5||_===-4||_===-3?t(_):(n.enter("table")._align=r,n.enter("tableHead"),n.enter("tableRow"),_===124?l(_):(i++,n.enter("temporaryTableCellContent"),d(_)))}function l(_){return n.enter("tableCellDivider"),n.consume(_),n.exit("tableCellDivider"),s=!0,u}function u(_){return _===null||_===-5||_===-4||_===-3?g(_):_===-2||_===-1||_===32?(n.enter("whitespace"),n.consume(_),p):(s&&(s=void 0,i++),_===124?l(_):(n.enter("temporaryTableCellContent"),d(_)))}function p(_){return _===-2||_===-1||_===32?(n.consume(_),p):(n.exit("whitespace"),u(_))}function d(_){return _===null||_<0||_===32||_===124?(n.exit("temporaryTableCellContent"),u(_)):(n.consume(_),_===92?f:d)}function f(_){return _===92||_===124?(n.consume(_),d):d(_)}function g(_){return _===null?t(_):(n.exit("tableRow"),n.exit("tableHead"),n.enter("lineEnding"),n.consume(_),n.exit("lineEnding"),n.check(iH,t,Ey(n,h,"linePrefix",4)))}function h(_){return _===null||_<0||_===32?t(_):(n.enter("tableDelimiterRow"),T(_))}function T(_){return _===null||_===-5||_===-4||_===-3?W(_):_===-2||_===-1||_===32?(n.enter("whitespace"),n.consume(_),S):_===45?(n.enter("tableDelimiterFiller"),n.consume(_),a=!0,r.push(null),C):_===58?(n.enter("tableDelimiterAlignment"),n.consume(_),n.exit("tableDelimiterAlignment"),r.push("left"),L):_===124?(n.enter("tableCellDivider"),n.consume(_),n.exit("tableCellDivider"),T):t(_)}function S(_){return _===-2||_===-1||_===32?(n.consume(_),S):(n.exit("whitespace"),T(_))}function C(_){return _===45?(n.consume(_),C):(n.exit("tableDelimiterFiller"),_===58?(n.enter("tableDelimiterAlignment"),n.consume(_),n.exit("tableDelimiterAlignment"),r[r.length-1]=r[r.length-1]==="left"?"center":"right",A):T(_))}function L(_){return _===45?(n.enter("tableDelimiterFiller"),n.consume(_),a=!0,C):t(_)}function A(_){return _===null||_===-5||_===-4||_===-3?W(_):_===-2||_===-1||_===32?(n.enter("whitespace"),n.consume(_),S):_===124?(n.enter("tableCellDivider"),n.consume(_),n.exit("tableCellDivider"),T):t(_)}function W(_){return n.exit("tableDelimiterRow"),!a||i!==r.length?t(_):_===null?O(_):n.check(LF,O,j)(_)}function O(_){return n.exit("table"),e(_)}function j(_){return n.enter("lineEnding"),n.consume(_),n.exit("lineEnding"),Ey(n,J,"linePrefix",4)}function J(_){return n.enter("tableBody"),ie(_)}function ie(_){return n.enter("tableRow"),_===124?z(_):(n.enter("temporaryTableCellContent"),Y(_))}function z(_){return n.enter("tableCellDivider"),n.consume(_),n.exit("tableCellDivider"),M}function M(_){return _===null||_===-5||_===-4||_===-3?de(_):_===-2||_===-1||_===32?(n.enter("whitespace"),n.consume(_),B):_===124?z(_):(n.enter("temporaryTableCellContent"),Y(_))}function B(_){return _===-2||_===-1||_===32?(n.consume(_),B):(n.exit("whitespace"),M(_))}function Y(_){return _===null||_<0||_===32||_===124?(n.exit("temporaryTableCellContent"),M(_)):(n.consume(_),_===92?ae:Y)}function ae(_){return _===92||_===124?(n.consume(_),Y):Y(_)}function de(_){return n.exit("tableRow"),_===null?He(_):n.check(LF,He,Je)(_)}function He(_){return n.exit("tableBody"),O(_)}function Je(_){return n.enter("lineEnding"),n.consume(_),n.exit("lineEnding"),Ey(n,ie,"linePrefix",4)}}o(sH,"tokenizeTable");function aH(n,e,t){return r;function r(a){return a!==45?t(a):(n.enter("setextUnderline"),i(a))}function i(a){return a===45?(n.consume(a),i):s(a)}function s(a){return a===-2||a===-1||a===32?(n.consume(a),s):a===null||a===-5||a===-4||a===-3?e(a):t(a)}}o(aH,"tokenizeSetextUnderlineMini");function cH(n,e,t){var r=0;return i;function i(a){return n.enter("check"),n.consume(a),s}function s(a){return a===-1||a===32?(n.consume(a),r++,r===4?e:s):a===null||a<0?e(a):t(a)}}o(cH,"tokenizeNextPrefixedOrBlank")});var DF=w((Ure,FF)=>{FF.exports=wF()});var _F=w(NF=>{var lH=Lr(),uH=Rt(),pH=Xs(),dH={tokenize:fH};NF.text={91:dH};function fH(n,e,t){var r=this;return i;function i(c){return c!==91||r.previous!==null||!r._gfmTasklistFirstContentOfListItem?t(c):(n.enter("taskListCheck"),n.enter("taskListCheckMarker"),n.consume(c),n.exit("taskListCheckMarker"),s)}function s(c){return c===-2||c===32?(n.enter("taskListCheckValueUnchecked"),n.consume(c),n.exit("taskListCheckValueUnchecked"),a):c===88||c===120?(n.enter("taskListCheckValueChecked"),n.consume(c),n.exit("taskListCheckValueChecked"),a):t(c)}function a(c){return c===93?(n.enter("taskListCheckMarker"),n.consume(c),n.exit("taskListCheckMarker"),n.exit("taskListCheck"),n.check({tokenize:mH},e,t)):t(c)}}o(fH,"tokenizeTasklistCheck");function mH(n,e,t){var r=this;return uH(n,i,"whitespace");function i(s){return pH(r.events,"whitespace")&&s!==null&&!lH(s)?e(s):t(s)}}o(mH,"spaceThenNonSpace")});var MF=w((Wre,OF)=>{OF.exports=_F()});var qF=w((Bre,UF)=>{var hH=Kv(),gH=CF(),bH=AF(),vH=DF(),yH=MF();UF.exports=IH;function IH(n){return hH([gH,bH(n),vH,yH])}o(IH,"create")});var WF=w((Vre,$F)=>{$F.exports=qF()});var jF=w((Gre,BF)=>{"use strict";BF.exports=xH;function xH(n,e){var t=String(n),r=0,i;if(typeof e!="string")throw new Error("Expected character");for(i=t.indexOf(e);i!==-1;)r++,i=t.indexOf(e,i+e.length);return r}o(xH,"ccount")});var wy=w((zre,GF)=>{"use strict";GF.exports=VF;function VF(n){if(n==null)return CH;if(typeof n=="string")return kH(n);if(typeof n=="object")return"length"in n?TH(n):SH(n);if(typeof n=="function")return n;throw new Error("Expected function, string, or object as test")}o(VF,"convert");function SH(n){return e;function e(t){var r;for(r in n)if(t[r]!==n[r])return!1;return!0}}o(SH,"allFactory");function TH(n){for(var e=[],t=-1;++t<n.length;)e[t]=VF(n[t]);return r;function r(){for(var i=-1;++i<e.length;)if(e[i].apply(this,arguments))return!0;return!1}}o(TH,"anyFactory");function kH(n){return e;function e(t){return!!(t&&t.type===n)}}o(kH,"typeFactory");function CH(){return!0}o(CH,"ok")});var zF=w((Xre,HF)=>{HF.exports=PH;function PH(n){return"\x1B[33m"+n+"\x1B[39m"}o(PH,"color")});var QF=w((Qre,JF)=>{"use strict";JF.exports=od;var RH=wy(),AH=zF(),KF=!0,XF="skip",Fy=!1;od.CONTINUE=KF;od.SKIP=XF;od.EXIT=Fy;function od(n,e,t,r){var i,s;typeof e=="function"&&typeof t!="function"&&(r=t,t=e,e=null),s=RH(e),i=r?-1:1,a(n,null,[])();function a(c,l,u){var p=typeof c=="object"&&c!==null?c:{},d;return typeof p.type=="string"&&(d=typeof p.tagName=="string"?p.tagName:typeof p.name=="string"?p.name:void 0,f.displayName="node ("+AH(p.type+(d?"<"+d+">":""))+")"),f;function f(){var g=u.concat(c),h=[],T,S;if((!e||s(c,l,u[u.length-1]||null))&&(h=LH(t(c,u)),h[0]===Fy))return h;if(c.children&&h[0]!==XF)for(S=(r?c.children.length:-1)+i;S>-1&&S<c.children.length;){if(T=a(c.children[S],S,g)(),T[0]===Fy)return T;S=typeof T[1]=="number"?T[1]:S+i}return h}o(f,"visit")}o(a,"factory")}o(od,"visitParents");function LH(n){return n!==null&&typeof n=="object"&&"length"in n?n:typeof n=="number"?[KF,n]:[n]}o(LH,"toResult")});var ZF=w((Zre,YF)=>{"use strict";YF.exports=n=>{if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}});var iD=w((eie,rD)=>{"use strict";rD.exports=NH;var EH=QF(),wH=wy(),FH=ZF(),DH=[].splice;function NH(n,e,t,r){var i,s;return typeof e=="string"||e&&typeof e.exec=="function"?s=[[e,t]]:(s=e,r=t),i=r||{},eD(n,i,a(_H(s))),n;function a(c){var l=c[0];return u;function u(p,d){var f=l[0],g=l[1],h=[],T=0,S=d.children.indexOf(p),C,L,A,W;for(f.lastIndex=0,L=f.exec(p.value);L&&(C=L.index,W=g.apply(null,[].concat(L,{index:L.index,input:L.input})),W!==!1&&(T!==C&&h.push({type:"text",value:p.value.slice(T,C)}),typeof W=="string"&&W.length>0&&(W={type:"text",value:W}),W&&(h=[].concat(h,W)),T=C+L[0].length),!!f.global);)L=f.exec(p.value);if(C===void 0?(h=[p],S--):(T<p.value.length&&h.push({type:"text",value:p.value.slice(T)}),h.unshift(S,1),DH.apply(d.children,h)),c.length>1)for(A=a(c.slice(1)),C=-1;++C<h.length;)p=h[C],p.type==="text"?A(p,d):eD(p,i,A);return S+h.length+1}}o(a,"handlerFactory")}o(NH,"findAndReplace");function eD(n,e,t){var r=wH(e.ignore||[]),i=[];return EH(n,"text",s),i;function s(a,c){for(var l=-1,u,p;++l<c.length;){if(u=c[l],r(u,p?p.children.indexOf(u):void 0,p))return;p=u}return t(a,p)}o(s,"visitor")}o(eD,"search");function _H(n){var e=[],t,r;if(typeof n!="object")throw new Error("Expected array or object as schema");if("length"in n)for(r=-1;++r<n.length;)e.push([tD(n[r][0]),nD(n[r][1])]);else for(t in n)e.push([tD(t),nD(n[t])]);return e}o(_H,"toPairs");function tD(n){return typeof n=="string"?new RegExp(FH(n),"g"):n}o(tD,"toExpression");function nD(n){return typeof n=="function"?n:e;function e(){return n}}o(nD,"toFunction")});var aD=w(sd=>{var oD=jF(),OH=iD(),MH=Bp(),UH=jp();sd.transforms=[VH];sd.enter={literalAutolink:qH,literalAutolinkEmail:Dy,literalAutolinkHttp:Dy,literalAutolinkWww:Dy};sd.exit={literalAutolink:jH,literalAutolinkEmail:BH,literalAutolinkHttp:$H,literalAutolinkWww:WH};function qH(n){this.enter({type:"link",title:null,url:"",children:[]},n)}o(qH,"enterLiteralAutolink");function Dy(n){this.config.enter.autolinkProtocol.call(this,n)}o(Dy,"enterLiteralAutolinkValue");function $H(n){this.config.exit.autolinkProtocol.call(this,n)}o($H,"exitLiteralAutolinkHttp");function WH(n){this.config.exit.data.call(this,n),this.stack[this.stack.length-1].url="http://"+this.sliceSerialize(n)}o(WH,"exitLiteralAutolinkWww");function BH(n){this.config.exit.autolinkEmail.call(this,n)}o(BH,"exitLiteralAutolinkEmail");function jH(n){this.exit(n)}o(jH,"exitLiteralAutolink");function VH(n){OH(n,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/i,GH],[/([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/,HH]],{ignore:["link","linkReference"]})}o(VH,"transformGfmAutolinkLiterals");function GH(n,e,t,r,i){var s="",a,c;return!sD(i)||(/^w/i.test(e)&&(t=e+t,e="",s="http://"),!zH(t))||(a=KH(t+r),!a[0])?!1:(c={type:"link",title:null,url:s+e+a[0],children:[{type:"text",value:e+a[0]}]},a[1]&&(c=[c,{type:"text",value:a[1]}]),c)}o(GH,"findUrl");function HH(n,e,t,r){return!sD(r,!0)||/[_-]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+t,children:[{type:"text",value:e+"@"+t}]}}o(HH,"findEmail");function zH(n){var e=n.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}o(zH,"isCorrectDomain");function KH(n){var e=/[!"&'),.:;<>?\]}]+$/.exec(n),t,r,i;if(e)for(n=n.slice(0,e.index),e=e[0],t=e.indexOf(")"),r=oD(n,"("),i=oD(n,")");t!==-1&&r>i;)n+=e.slice(0,t+1),e=e.slice(t+1),t=e.indexOf(")"),i++;return[n,e]}o(KH,"splitUrl");function sD(n,e){var t=n.input.charCodeAt(n.index-1);return(t!==t||UH(t)||MH(t))&&(!e||t!==47)}o(sD,"previous")});var cD=w(ad=>{ad.canContainEols=["delete"];ad.enter={strikethrough:XH};ad.exit={strikethrough:JH};function XH(n){this.enter({type:"delete",children:[]},n)}o(XH,"enterStrikethrough");function JH(n){this.exit(n)}o(JH,"exitStrikethrough")});var uD=w(_y=>{_y.enter={table:QH,tableData:lD,tableHeader:lD,tableRow:ZH};_y.exit={codeText:ez,table:YH,tableData:Ny,tableHeader:Ny,tableRow:Ny};function QH(n){this.enter({type:"table",align:n._align,children:[]},n),this.setData("inTable",!0)}o(QH,"enterTable");function YH(n){this.exit(n),this.setData("inTable")}o(YH,"exitTable");function ZH(n){this.enter({type:"tableRow",children:[]},n)}o(ZH,"enterRow");function Ny(n){this.exit(n)}o(Ny,"exit");function lD(n){this.enter({type:"tableCell",children:[]},n)}o(lD,"enterCell");function ez(n){var e=this.resume();this.getData("inTable")&&(e=e.replace(/\\([\\|])/g,tz)),this.stack[this.stack.length-1].value=e,this.exit(n)}o(ez,"exitCodeText");function tz(n,e){return e==="|"?e:n}o(tz,"replace")});var fD=w(dD=>{dD.exit={taskListCheckValueChecked:pD,taskListCheckValueUnchecked:pD,paragraph:nz};function pD(n){this.stack[this.stack.length-2].checked=n.type==="taskListCheckValueChecked"}o(pD,"exitCheck");function nz(n){var e=this.stack[this.stack.length-2],t=this.stack[this.stack.length-1],r=e.children,i=t.children[0],s=-1,a;if(e&&e.type==="listItem"&&typeof e.checked=="boolean"&&i&&i.type==="text"){for(;++s<r.length;)if(r[s].type==="paragraph"){a=r[s];break}a===t&&(i.value=i.value.slice(1),i.value.length===0?t.children.shift():(i.position.start.column++,i.position.start.offset++,t.position.start=Object.assign({},i.position.start)))}this.exit(n)}o(nz,"exitParagraphWithTaskListItem")});var hD=w((uie,mD)=>{var rz=aD(),iz=cD(),oz=uD(),sz=fD(),az={}.hasOwnProperty;mD.exports=cz([rz,iz,oz,sz]);function cz(n){for(var e={transforms:[],canContainEols:[]},t=n.length,r=-1;++r<t;)lz(e,n[r]);return e}o(cz,"configure");function lz(n,e){var t,r,i;for(t in e)r=az.call(n,t)?n[t]:n[t]={},i=e[t],t==="canContainEols"||t==="transforms"?n[t]=[].concat(r,i):Object.assign(r,i)}o(lz,"extension")});var bD=w(gD=>{var Oy="phrasing",My=["autolink","link","image","label"];gD.unsafe=[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Oy,notInConstruct:My},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Oy,notInConstruct:My},{character:":",before:"[ps]",after:"\\/",inConstruct:Oy,notInConstruct:My}]});var yD=w(Uy=>{var uz=oi();Uy.unsafe=[{character:"~",inConstruct:"phrasing"}];Uy.handlers={delete:vD};vD.peek=pz;function vD(n,e,t){var r=t.enter("emphasis"),i=uz(n,t,{before:"~",after:"~"});return r(),"~~"+i+"~~"}o(vD,"handleDelete");function pz(){return"~"}o(pz,"peekDelete")});var kD=w((hie,TD)=>{"use strict";var ra=Po();TD.exports=vz;var dz=/ +$/,Ao=" ",fz=`
`,mz="-",cd=":",ID="|",xD=0,hz=67,gz=76,bz=82,ld=99,qy=108,ud=114;function vz(n,e){for(var t=e||{},r=t.padding!==!1,i=t.delimiterStart!==!1,s=t.delimiterEnd!==!1,a=(t.align||[]).concat(),c=t.alignDelimiters!==!1,l=[],u=t.stringLength||Iz,p=-1,d=n.length,f=[],g=[],h=[],T=[],S=[],C=0,L,A,W,O,j,J,ie,z,M,B,Y;++p<d;){for(L=n[p],A=-1,W=L.length,h=[],T=[],W>C&&(C=W);++A<W;)J=yz(L[A]),c===!0&&(j=u(J),T[A]=j,O=S[A],(O===void 0||j>O)&&(S[A]=j)),h.push(J);f[p]=h,g[p]=T}if(A=-1,W=C,typeof a=="object"&&"length"in a)for(;++A<W;)l[A]=SD(a[A]);else for(Y=SD(a);++A<W;)l[A]=Y;for(A=-1,W=C,h=[],T=[];++A<W;)Y=l[A],M="",B="",Y===qy?M=cd:Y===ud?B=cd:Y===ld&&(M=cd,B=cd),j=c?Math.max(1,S[A]-M.length-B.length):1,J=M+ra(mz,j)+B,c===!0&&(j=M.length+j+B.length,j>S[A]&&(S[A]=j),T[A]=j),h[A]=J;for(f.splice(1,0,h),g.splice(1,0,T),p=-1,d=f.length,ie=[];++p<d;){for(h=f[p],T=g[p],A=-1,W=C,z=[];++A<W;)J=h[A]||"",M="",B="",c===!0&&(j=S[A]-(T[A]||0),Y=l[A],Y===ud?M=ra(Ao,j):Y===ld?j%2===0?(M=ra(Ao,j/2),B=M):(M=ra(Ao,j/2+.5),B=ra(Ao,j/2-.5)):B=ra(Ao,j)),i===!0&&A===0&&z.push(ID),r===!0&&!(c===!1&&J==="")&&(i===!0||A!==0)&&z.push(Ao),c===!0&&z.push(M),z.push(J),c===!0&&z.push(B),r===!0&&z.push(Ao),(s===!0||A!==W-1)&&z.push(ID);z=z.join(""),s===!1&&(z=z.replace(dz,"")),ie.push(z)}return ie.join(fz)}o(vz,"markdownTable");function yz(n){return n==null?"":String(n)}o(yz,"serialize");function Iz(n){return n.length}o(Iz,"defaultStringLength");function SD(n){var e=typeof n=="string"?n.charCodeAt(0):xD;return e===gz||e===qy?qy:e===bz||e===ud?ud:e===hz||e===ld?ld:xD}o(SD,"toAlignment")});var PD=w((bie,CD)=>{var xz=oi(),Sz=Ty(),Tz=kD();CD.exports=kz;function kz(n){var e=n||{},t=e.tableCellPadding,r=e.tablePipeAlign,i=e.stringLength,s=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{table:a,tableRow:c,tableCell:l,inlineCode:f}};function a(g,h,T){return u(p(g,T),g.align)}function c(g,h,T){var S=d(g,T),C=u([S]);return C.slice(0,C.indexOf(`
`))}function l(g,h,T){var S=T.enter("tableCell"),C=xz(g,T,{before:s,after:s});return S(),C}function u(g,h){return Tz(g,{align:h,alignDelimiters:r,padding:t,stringLength:i})}function p(g,h){for(var T=g.children,S=-1,C=T.length,L=[],A=h.enter("table");++S<C;)L[S]=d(T[S],h);return A(),L}function d(g,h){for(var T=g.children,S=-1,C=T.length,L=[],A=h.enter("tableRow");++S<C;)L[S]=l(T[S],g,h);return A(),L}function f(g,h,T){var S=Sz(g,h,T);return T.stack.indexOf("tableCell")!==-1&&(S=S.replace(/\|/g,"\\$&")),S}}o(kz,"toMarkdown")});var RD=w($y=>{var Cz=Cy();$y.unsafe=[{atBreak:!0,character:"-",after:"[:|-]"}];$y.handlers={listItem:Pz};function Pz(n,e,t){var r=Cz(n,e,t),i=n.children[0];return typeof n.checked=="boolean"&&i&&i.type==="paragraph"&&(r=r.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,s)),r;function s(a){return a+"["+(n.checked?"x":" ")+"] "}o(s,"check")}o(Pz,"listItemWithTaskListItem")});var LD=w((xie,AD)=>{var Rz=bD(),Az=yD(),Lz=PD(),Ez=RD(),wz=gy();AD.exports=Fz;function Fz(n){var e=wz({handlers:{},join:[],unsafe:[],options:{}},{extensions:[Rz,Az,Lz(n),Ez]});return Object.assign(e.options,{handlers:e.handlers,join:e.join,unsafe:e.unsafe})}o(Fz,"toMarkdown")});var FD=w((Tie,wD)=>{"use strict";var Dz=WF(),Nz=hD(),_z=LD(),ED;wD.exports=Oz;function Oz(n){var e=this.data();!ED&&(this.Parser&&this.Parser.prototype&&this.Parser.prototype.blockTokenizers||this.Compiler&&this.Compiler.prototype&&this.Compiler.prototype.visitors)&&(ED=!0,console.warn("[remark-gfm] Warning: please upgrade to remark 13 to use this plugin")),t("micromarkExtensions",Dz(n)),t("fromMarkdownExtensions",Nz),t("toMarkdownExtensions",_z(n));function t(r,i){e[r]?e[r].push(i):e[r]=[i]}o(t,"add")}o(Oz,"gfm")});var wx=w(Ex=>{"use strict";Object.defineProperty(Ex,"__esModule",{value:!0});Ex.TypedEmitter=require("events").EventEmitter});var XN=w(GS=>{"use strict";var KN={b:"\b",f:"\f",n:`
`,r:"\r",t:"	",'"':'"',"/":"/","\\":"\\"},E2="a".charCodeAt();GS.parse=function(n,e,t){var r={},i=0,s=0,a=0,c=t&&t.bigint&&typeof BigInt<"u";return{data:l("",!0),pointers:r};function l(z,M){u();var B;A(z,"value");var Y=T();switch(Y){case"t":h("rue"),B=!0;break;case"f":h("alse"),B=!1;break;case"n":h("ull"),B=null;break;case'"':B=p();break;case"[":B=f(z);break;case"{":B=g(z);break;default:S(),"-0123456789".indexOf(Y)>=0?B=d():j()}return A(z,"valueEnd"),u(),M&&a<n.length&&j(),B}function u(){e:for(;a<n.length;){switch(n[a]){case" ":s++;break;case"	":s+=4;break;case"\r":s=0;break;case`
`:s=0,i++;break;default:break e}a++}}function p(){for(var z="",M;M=T(),M!='"';)M=="\\"?(M=T(),M in KN?z+=KN[M]:M=="u"?z+=C():J()):z+=M;return z}function d(){var z="",M=!0;n[a]=="-"&&(z+=T()),z+=n[a]=="0"?T():L(),n[a]=="."&&(z+=T()+L(),M=!1),(n[a]=="e"||n[a]=="E")&&(z+=T(),(n[a]=="+"||n[a]=="-")&&(z+=T()),z+=L(),M=!1);var B=+z;return c&&M&&(B>Number.MAX_SAFE_INTEGER||B<Number.MIN_SAFE_INTEGER)?BigInt(z):B}function f(z){u();var M=[],B=0;if(T()=="]")return M;for(S();;){var Y=z+"/"+B;M.push(l(Y)),u();var ae=T();if(ae=="]")break;ae!=","&&J(),u(),B++}return M}function g(z){u();var M={};if(T()=="}")return M;for(S();;){var B=O();T()!='"'&&J();var Y=p(),ae=z+"/"+VS(Y);W(ae,"key",B),A(ae,"keyEnd"),u(),T()!=":"&&J(),u(),M[Y]=l(ae),u();var de=T();if(de=="}")break;de!=","&&J(),u()}return M}function h(z){for(var M=0;M<z.length;M++)T()!==z[M]&&J()}function T(){ie();var z=n[a];return a++,s++,z}function S(){a--,s--}function C(){for(var z=4,M=0;z--;){M<<=4;var B=T().toLowerCase();B>="a"&&B<="f"?M+=B.charCodeAt()-E2+10:B>="0"&&B<="9"?M+=+B:J()}return String.fromCharCode(M)}function L(){for(var z="";n[a]>="0"&&n[a]<="9";)z+=T();if(z.length)return z;ie(),j()}function A(z,M){W(z,M,O())}function W(z,M,B){r[z]=r[z]||{},r[z][M]=B}function O(){return{line:i,column:s,pos:a}}function j(){throw new SyntaxError("Unexpected token "+n[a]+" in JSON at position "+a)}function J(){S(),j()}function ie(){if(a>=n.length)throw new SyntaxError("Unexpected end of JSON input")}};GS.stringify=function(n,e,t){if(!wf(n))return;var r=0,i,s,a=typeof t=="object"?t.space:t;switch(typeof a){case"number":var c=a>10?10:a<0?0:Math.floor(a);a=c&&W(c," "),i=c,s=c;break;case"string":a=a.slice(0,10),i=0,s=0;for(var l=0;l<a.length;l++){var u=a[l];switch(u){case" ":s++;break;case"	":s+=4;break;case"\r":s=0;break;case`
`:s=0,r++;break;default:throw new Error("whitespace characters not allowed in JSON")}i++}break;default:a=void 0}var p="",d={},f=0,g=0,h=0,T=t&&t.es6&&typeof Map=="function";return S(n,0,""),{json:p,pointers:d};function S(O,j,J){switch(A(J,"value"),typeof O){case"number":case"bigint":case"boolean":C(""+O);break;case"string":C(Ff(O));break;case"object":O===null?C("null"):typeof O.toJSON=="function"?C(Ff(O.toJSON())):Array.isArray(O)?ie():T?O.constructor.BYTES_PER_ELEMENT?ie():O instanceof Map?M():O instanceof Set?M(!0):z():z()}A(J,"valueEnd");function ie(){if(O.length){C("[");for(var B=j+1,Y=0;Y<O.length;Y++){Y&&C(","),L(B);var ae=wf(O[Y])?O[Y]:null,de=J+"/"+Y;S(ae,B,de)}L(j),C("]")}else C("[]")}o(ie,"stringifyArray");function z(){var B=Object.keys(O);if(B.length){C("{");for(var Y=j+1,ae=0;ae<B.length;ae++){var de=B[ae],He=O[de];if(wf(He)){ae&&C(",");var Je=J+"/"+VS(de);L(Y),A(Je,"key"),C(Ff(de)),A(Je,"keyEnd"),C(":"),a&&C(" "),S(He,Y,Je)}}L(j),C("}")}else C("{}")}o(z,"stringifyObject");function M(B){if(O.size){C("{");for(var Y=j+1,ae=!0,de=O.entries(),He=de.next();!He.done;){var Je=He.value,_=Je[0],Ue=B?!0:Je[1];if(wf(Ue)){ae||C(","),ae=!1;var at=J+"/"+VS(_);L(Y),A(at,"key"),C(Ff(_)),A(at,"keyEnd"),C(":"),a&&C(" "),S(Ue,Y,at)}He=de.next()}L(j),C("}")}else C("{}")}o(M,"stringifyMapSet")}o(S,"_stringify");function C(O){g+=O.length,h+=O.length,p+=O}o(C,"out");function L(O){if(a){for(p+=`
`+W(O,a),f++,g=0;O--;)r?(f+=r,g=s):g+=s,h+=i;h+=1}}o(L,"indent");function A(O,j){d[O]=d[O]||{},d[O][j]={line:f,column:g,pos:h}}o(A,"map");function W(O,j){return Array(O+1).join(j)}o(W,"repeat")};var w2=["number","bigint","boolean","string","object"];function wf(n){return w2.indexOf(typeof n)>=0}o(wf,"validType");var F2=/"|\\/g,D2=/[\b]/g,N2=/\f/g,_2=/\n/g,O2=/\r/g,M2=/\t/g;function Ff(n){return n=n.replace(F2,"\\$&").replace(N2,"\\f").replace(D2,"\\b").replace(_2,"\\n").replace(O2,"\\r").replace(M2,"\\t"),'"'+n+'"'}o(Ff,"quoted");var U2=/~/g,q2=/\//g;function VS(n){return n.replace(U2,"~0").replace(q2,"~1")}o(VS,"escapeJsonPointer")});var iK={};b_(iK,{ServerStarter:()=>Dl,createCdsLanguageTestServer:()=>$2,formatCli:()=>sT,lspRoot:()=>Ft,ruleName:()=>Un});module.exports=v_(iK);var pT=K(require("path")),I_={filename:"/xmake/j/prod-build10210/w/ght-cap/ght-cap-cds-lsp-SP-REL-linuxx86_64_indirectshipment-linuxx86_64/gen/out/module/src/root.ts",dirname:"/xmake/j/prod-build10210/w/ght-cap/ght-cap-cds-lsp-SP-REL-linuxx86_64_indirectshipment-linuxx86_64/gen/out/module/src",relativefilename:"src/root.ts",relativedirname:"src"};var Ft=pT.resolve(global.__lspBundleDirname??I_.dirname,"..");var pe=Symbol("file does not exist"),_a=["db","srv","app"];var Gf=class{static create(e,t=!0){return new Proxy({},{get(r,i,s){let a=t?i:e.adapter.toUri(i),c=e.getContent(a);if(c!==pe)return c}})}},mi=Gf;o(Gf,"WorkspaceDocumentsProxy");var dT=["title","description"],fT="<add text here>",hr=(s=>(s.IMPORT_ARTIFACT="import-artifact",s.MAINTAIN_TRANSLATION="maintain-translation",s.MIGRATE_TO_DOCCOMMENT="migrate-to-doccomment",s.MIGRATE_DEPRECATED_DELIMITER="migrate-deprecated-delimiter",s.CUSTOM_ANNOTATION_QUICKFIX="custom-annotation-quickfix",s))(hr||{});var mT=["format-range","analyze-dependencies","active-editor-changed","parse-tree"],jf="cds/userOutput",Vf="cds/statusMessage";function hT(n,e,t){let r=t;for(let i of n)e(r,i);return r}o(hT,"reduceFiles");var Hf="\x1B[",zf="m",gT=o(n=>Hf+n+zf,"makeAnsi"),Qi=o((n,e=n+20)=>{let t=gT(n),r=gT(e);return i=>t+i+r},"makeTypo"),bT=o((n,e=!1)=>t=>{let c=Hf+(t+(n?30:40)+(e?60:0))+zf,l=Hf+(9+(n?30:40))+zf;return u=>c+u+l},"makeColorize"),x_=["black","red","green","khaki","blue","purple","petrol","lightgray"],S_=["darkgray","lightred","lightgreen","yellow","lightblue","magenta","cyan","white"],vT=o(n=>{let e={};return x_.forEach((t,r)=>e[t]=bT(n,!1)(r)),S_.forEach((t,r)=>e[t]=bT(n,!0)(r)),e},"makeColors"),Yi=vT(!0),yT=vT(!1),$t={fg:Yi,bg:yT,intense:Qi(1,22),dim:Qi(2),italic:Qi(3),underline:Qi(4),blink:Qi(5),inverse:Qi(7),strikethrough:Qi(9)},Ne={requestFromServer:Yi.purple,responseToClient:Yi.lightgreen,error:n=>Yi.yellow(yT.red(n)),warn:Yi.yellow,info:Yi.white,success:Yi.green};function Zi(){return process.env.NODE_ENV!=="test"}o(Zi,"isProduction");var ze="/",xn="\\",_l=`
`;var IT="'";function is(n,e){let t=process.env["CDS_LSP_FEATURE_FLAG_"+n];return t?e?!["off","false","0"].includes(t):["on","true","1"].includes(t):e}o(is,"isFeatureEnabled");var Ul=K(require("async_hooks"));var Kf=class{constructor(e){this.asyncId=e}},Ol=Kf;o(Kf,"ClsFrame");var Xf=class{constructor(e){this.clsFactory=e;m(this,"frames",new Map);m(this,"hook");this.hook=Ul.createHook({init:(t,r,i,s)=>{let a=this.getFrame(i),c=this.getFrame(t,a);this.frames.set(t,c)},destroy:t=>{this.frames.delete(t)}}),this.hook.enable()}getFrame(e,t){let r=this.frames.get(e);return r||(r=this.clsFactory.createFrame(e,t),this.frames.set(e,r)),r}currentFrame(){return this.getFrame(Ul.executionAsyncId())}},Ml=Xf;o(Xf,"ContinuationLocalStorage");var be=(u=>(u[u.invalid=0]="invalid",u[u.OFF=1]="OFF",u[u.INFRASTRUCTURE=2]="INFRASTRUCTURE",u[u.ERROR=3]="ERROR",u[u.WARNING=4]="WARNING",u[u.INFO=5]="INFO",u[u.VERBOSE=6]="VERBOSE",u[u.DEBUG=7]="DEBUG",u[u.IGNORE=8]="IGNORE",u))(be||{}),Z=(L=>(L.ALL="*",L.ADAPTER="adapter",L.COMPLETION="completion",L.COMPILER="compiler",L.CONTRIBUTION="contribution",L.DOCUMENTATION="docs",L.FORMATTING="format",L.MODEL="model",L.MODEL_TODOS="model-todos",L.REFACTOR="refactor",L.REQUESTS="requests",L.SETTINGS="settings",L.UTIL="util",L.WORKSPACE="workspace",L.FILES="files",L.ENV="cdsenv",L.COMMAND="command",L.CONTEXT_LOG="context-log",L))(Z||{});var $l="---> ",Wr="<--- ";function hi(n,{errorPredicate:e=!1,warnPredicate:t=!1,infoPredicate:r=!1,successPredicate:i=!1,debugPredicate:s=!1}){return e?Ne.error(n):t?Ne.warn(n):i?Ne.success(n):r?Ne.info(n):s?$t.fg.darkgray(n):n}o(hi,"highlight");var Jf=class{constructor(e=!1){this.warnPrinted=e}printWarning(){this.warnPrinted||(this.warnPrinted=!0,console.error(`
NoTracer was used!!!
${new Error().stack}`))}isTracing(e){return this.printWarning(),!1}debug(e){this.conditionalTrace(7,e)}verbose(e){this.conditionalTrace(6,e)}info(e){this.conditionalTrace(5,e)}warn(e){this.conditionalTrace(4,e)}error(e){this.conditionalTrace(3,e)}footprint(e,t,r,i){return t(...r)}conditionalTrace(e,t){this.printWarning()}},Oa=Jf;o(Jf,"NoTracer");var Qf=class{constructor(e=new Oa){this._tracer=e}conditionalTrace(){}configure(){}doTraceToFile(){}noTraceDuring(e){return e()}renderMessage(e,t,r){return""}tracer(){return this._tracer}extendedStat(){}extendedStatLater(){}cancelLaterStats(){}traceLevel(e){return 1}},ql=Qf;o(Qf,"NoTrace");var Yf=class{constructor(e){}},os=Yf;o(Yf,"UnsupportedValue");var rm=class{},Wl=rm;o(rm,"SymbolData");var im=class extends Wl{constructor(){super(...arguments);m(this,"trace",new ql)}},Zf=im;o(im,"LspClsAppScope");var om=class extends Wl{constructor(t,r){super();this.name=t;this.requestNumber=r;m(this,"snapshots",new Map)}},Bl=om;o(om,"LspClsRequestScope");var sm=class{constructor(e=0){m(this,"indentLevel",0);this.indentLevel=e}isTraceEnabled(){return this.indentLevel>=0}},Ma=sm;o(sm,"LspClsFrameScope");var am=class extends Ol{constructor(t,r,i,s){super(t);this.appScope=r;m(this,"requestScope");m(this,"frameScope");this.frameScope=s,this.requestScope=i}},jl=am;o(am,"LspClsFrame");var cm=class{constructor(){m(this,"appScope",new Zf)}createFrame(e,t){return t?t.frameScope.isTraceEnabled()?new jl(e,t.appScope,t.requestScope,new Ma(t.frameScope.indentLevel)):t:new jl(e,this.appScope,new Bl("<fromScratch>",-e),new Ma)}},em=cm;o(cm,"LspFrameFactory");var T_=new em,k_=new Ml(T_),he=o(()=>k_.currentFrame(),"currentFrame");function G(){return he().appScope.trace}o(G,"currentTrace");function tm(n){return he().appScope[n]}o(tm,"current");function nm(n,e){he().appScope[n]=e}o(nm,"initCurrent");var xT=1,ss=o((n,e=xT)=>{xT++;let t=he(),r=t.requestScope;return t.requestScope=new Bl(n,e),t.frameScope=new Ma,r},"startRequestScope");function ST(n){return()=>{let e=he();e.requestScope=n}}o(ST,"endRequestScope");function F(n,e={}){let t=is("FOOTPRINT",!0),r=Zi();return(i,s,a)=>{if(!t)return a;let c=a.value;e.scope||(e.scope=s);let l,u=o(()=>(r&&l||(l=G().tracer(n)),l),"getTracer");return a.value=o(function(...d){return u().footprint(this,c.bind(this),d,e)},"FootprintDecorator"),a}}o(F,"Footprint");var tt=K(require("fs")),_g=K(require("os")),Tn=K(require("path"));function Dt(n){n?.catch(e=>{})}o(Dt,"safeTriggerAsync");function lm(n,e="Failed to determine (%%e)"){try{return n()}catch(t){return e.replace("%%e",`${t}`)}}o(lm,"tryCatch");var vu=K(require("path")),Is=K(require("util")),Ct=K(Xe());function Gk(n){switch(n){case Ct.DocumentHighlightKind.Text:return"text";case Ct.DocumentHighlightKind.Read:return"read";case Ct.DocumentHighlightKind.Write:return"writ";default:return Ne.error("[E] <unknown kind> "+n)}}o(Gk,"renderKind");function xs(n,e=70){return JSON.stringify(n.length<=e?n:n.slice(0,e-3)+"...")}o(xs,"shorten");function Hk(n){if(Ct.MarkupContent.is(n))return`${n.kind}: ${xs(n.value)}`;let e=o(t=>typeof t=="string"?xs(t):`[${t.language}] ${xs(t.value)}`,"renderMarkedString");return Array.isArray(n)?Lt(n.map(e)):e(n)}o(Hk,"renderContents");function W1(n){return n?.range}o(W1,"isIncremental");var B1={[Ct.FileChangeType.Created]:"Created",[Ct.FileChangeType.Deleted]:"Deleted",[Ct.FileChangeType.Changed]:"Changed"};function zk(n){if(n!==void 0)switch(n){case Ct.DiagnosticSeverity.Error:return"Error";case Ct.DiagnosticSeverity.Warning:return"Warn";case Ct.DiagnosticSeverity.Information:return"Info";case Ct.DiagnosticSeverity.Hint:return"Hint"}return"?"}o(zk,"renderSeverity");function j1(n=""){return e=>Yk(e,n)}o(j1,"makeRenderLocation");function Kk(n){let e="";return n?.documentation&&(e=Ct.MarkupContent.is(n.documentation)?n.documentation.value:n.documentation),`<${n.kind}> ${n.label} [${n.commitCharacters||""}] ${xs(e)}`}o(Kk,"renderCompletionItem");function Xk(n,e=[]){let t={};for(let i of e){let s=i.lastIndexOf(n)+1,a=i.slice(0,s),c=i.slice(s);(t[a]||(t[a]=[])).push(c)}let r="";for(let i of Object.keys(t).sort()){let s=t[i];if(s.length===1)r+=`
${i}${s[0]}`;else{let c=s.reduce((p,d)=>Math.max(p,d.length),0)+2,l=Math.floor(120/c);r+=`
${i}
  `;let u=0;s.sort(),s.forEach(p=>r+=`${p.padEnd(c)}${++u%l===0?`
  `:""}`)}}return r}o(Xk,"renderPaths");function Lt(n,e=""){return n?n.length?n.reduce((t,r)=>`${t}
${e}   ${r}`,"[")+`
${e}]`:"[]":""}o(Lt,"arr");var Qk=(M=>(M[M.File=1]="File",M[M.Module=2]="Module",M[M.Namespace=3]="Namespace",M[M.Package=4]="Package",M[M.Class=5]="Class",M[M.Method=6]="Method",M[M.Property=7]="Property",M[M.Field=8]="Field",M[M.Constructor=9]="Constructor",M[M.Enum=10]="Enum",M[M.Interface=11]="Interface",M[M.Function=12]="Function",M[M.Variable=13]="Variable",M[M.Constant=14]="Constant",M[M.String=15]="String",M[M.Number=16]="Number",M[M.Boolean=17]="Boolean",M[M.Array=18]="Array",M[M.Object=19]="Object",M[M.Key=20]="Key",M[M.Null=21]="Null",M[M.EnumMember=22]="EnumMember",M[M.Struct=23]="Struct",M[M.Event=24]="Event",M[M.Operator=25]="Operator",M[M.TypeParameter=26]="TypeParameter",M))(Qk||{});function Ng(n,e=""){return(e?"":`
`)+n.map(t=>H1(t,e)).join(`
`)+(e?"":`
`)}o(Ng,"docSymbolsToString");function V1(n){let e=n.map(r=>Is.inspect(r,{compact:!0,maxStringLength:200,breakLength:200})),t=e.reduce((r,i)=>r+i.length,0)>200;return e.join(t?`,
`:", ")}o(V1,"renderArgs");var R={array:n=>R.asIs(n),asIs:n=>Is.inspect(n,{depth:null,compact:!1}),args:V1,changeTextDoc:n=>`${n.textDocument.uri}#${n.textDocument.version} ${Lt(n.contentChanges.map(Jk))}`,changeWatched:n=>Lt(n.changes.map(e=>`${B1[e.type]||e.type} ${e.uri})`)),codeAction:n=>`${n.textDocument.uri} ${R.range(n.range)}`,codeActions:n=>Lt(n.map(e=>`${e.title}: ${e.command}(${R.asIs(e.data)})`)),commands:n=>Lt(n.map(e=>`${e.title}: ${e.command}(${R.asIs(e.arguments)})`)),completionItem:Kk,completionList:n=>`${n.isIncomplete?"incomplete":""} ${Lt(n.items.map(Kk))}`,contents:Hk,diags:n=>R.diagsWithIndent(n),diagsWithIndent:(n,e="")=>Lt(n.map(t=>`${zk(t.severity)} ${R.range(t.range)}: ${t.message}`),e),docClosed:n=>n.textDocument.uri,docHighlight:n=>`${Gk(n.kind)}: ${R.range(n.range)}`,docHighlights:n=>Lt(n.map(R.docHighlight)),docOpened:n=>`${n.textDocument.uri}#${n.textDocument.version} ${xs(n.textDocument.text,30)}`,docSaved:n=>`${n.textDocument.uri}`,docSymbolParams:n=>n.textDocument.uri,docSymbolResult:z1,docSymbols:n=>Ng(n),documentLink:n=>`${n.data}@${R.pos(n.range.start)} -> ${n.target}`,documentLinkParams:n=>`${n.textDocument.uri}`,documentLinks:n=>Lt(n.map(R.documentLink)),execCmd:n=>`${n.command}(${JSON.stringify(n.arguments)})`,exception:n=>G1(n)&&n.stack?n.stack:Is.inspect(n),hov:n=>n?`${n.range?R.range(n.range):""}: ${Hk(n?.contents)}`:"",kind:Gk,location:Yk,locations:n=>Lt(n.map(j1())),localPaths:(n=[])=>Xk(vu.sep,n),map:n=>[...n.entries()].map(([e,t])=>`${e}:
	${Is.inspect(t)}`).join(`
`),nothing:()=>"",pos:n=>`[${n.line}:${n.character}]`,range:n=>`[${n.start.line}:${n.start.character}-${n.end.line}:${n.end.character}]`,ref:n=>`${n.textDocument.uri} ${R.pos(n.position)} ${n.context.includeDeclaration?"withDecl":""}`,result:n=>Is.inspect(n,{compact:!0,maxStringLength:200,breakLength:200}),severity:zk,symbolInfos:n=>Lt(n.map(e=>`${R.range(e.location.range).padEnd(14)} ${(""+e.kind).padStart(2)} ${e.name.padEnd(20)} (${e.containerName??"/"})`)),symbolInfos_Uri:X1,symbolKind:n=>Qk[n]??"<unknown symbol kind>",textDocConChEv:Jk,textEdits:n=>`${Lt(n.map(e=>`'${e.newText.replaceAll(_l,xn+"n")}'${R.range(e.range)}`))}`,textPos:n=>`${n.textDocument.uri} ${R.pos(n.position)}`,uris:(n=[])=>Xk(ze,n),wsSymbol:n=>n.query,direntsOrStrings:n=>n.length?typeof n[0]=="string"?Lt(n):R.dirEnts(n):"[]",dirEnts:n=>Lt(n.map(R.dirEnt)),dirEnt:n=>`${R.dirEntType(n)} ${n.name}`,dirEntType(n){return n.isFile()?"-":n.isDirectory()?"d":n.isSymbolicLink()?"l":n.isFIFO()?"p":n.isSocket()?"s":n.isBlockDevice()?"b":n.isCharacterDevice()?"c":"?"},stats:n=>`${R.dirEntType(n)} ${n.mode.toString(8)} ${new Date(n.mtimeMs).toISOString()} ${n.size} bytes`,content:n=>`"${n.slice(0,10)}${n.length>10?`..." (${n.length} bytes)`:'"'}`};function G1(n){return!!n&&!!n.stack}o(G1,"isError");function H1(n,e){return`${e}${R.symbolKind(n.kind)} ${n.name} ${R.range(n.selectionRange)} ${R.range(n.range)}${n.detail?` "${n.detail}"`:""}${n.children?.length?`
`+Ng(n.children,e+"  "):""}`}o(H1,"docSymbolToString");function z1(n){return n?.length?Ct.DocumentSymbol.is(n[0])?Ng(n):R.symbolInfos(n):R.asIs(n)}o(z1,"renderDocSymbolResult");function K1(n){return n!==void 0?n:""}o(K1,"renderExists");function Jk(n){return`${W1(n)?R.range(n.range):""} ${K1(n?.rangeLength)} ${xs(n.text,20)}`}o(Jk,"renderTextDocConChEv");function Yk(n,e=""){let t=o(r=>e.length?vu.relative(e,r):r,"relPath");return Ct.LocationLink.is(n)?`${t(n.targetUri)}${R.range(n.targetSelectionRange)} in ${R.range(n.targetRange)}`:`${t(n.uri)}${R.range(n.range)}`}o(Yk,"renderLocation");function X1(n,e){if(e<7){let t=n||[];return`${t.length} symbols from ${t.reduce((r,i)=>(r.add(i.location.uri),r),new Set).size} files`}return Lt(n.map(t=>`${(""+t.kind).padStart(2)} ${`(${t.containerName||"/"})`.padEnd(40)} ${t.name.padEnd(20)} ${R.range(t.location.range).padEnd(14)} ${t.location.uri}`))}o(X1,"renderSymbolInfos_Uri");function bt(n){return typeof n[0]=="string"?n[0]:R.asIs(n[0])}o(bt,"firstArg");function Kt(n){return e=>{try{let t=n.split("."),r=t.shift(),i=e[Number(r)];for(let s=t.shift();s!==void 0;s=t.shift())i=i?.[s];return typeof i=="string"?i:R.asIs(i)}catch(t){return`? ${t}`}}}o(Kt,"specificArg");var J1=1,xu=class{constructor(e=`${process.pid}_${J1++}`,t=""){m(this,"_folder");m(this,"fileDescriptor",0);m(this,"_filePath");m(this,"logId");m(this,"onceRenamed",!1);let r=t+e;this.logId=r,this._folder=this.defaultFolder(),this._filePath=this.logFilePath(r),this.createFile()}createFile(){try{this.fileDescriptor=tt.openSync(this._filePath,"w+"),this.appendRaw(Ne.requestFromServer("---------- opened trace file")+`
`),this.appendRaw(Ne.responseToClient(new Date().toISOString())+`
`)}catch(e){this.logError(e)}}defaultFolder(){return Tn.join(_g.tmpdir(),"cdxlsp")}get folder(){return xu.ensureFolderExists(this._folder)}set folder(e){e&&(this._folder=e)}static ensureFolderExists(e){return tt.existsSync(e)||tt.mkdirSync(e,{recursive:!0}),e}get filePath(){return this._filePath}logError(e){console.error(R.exception(e))}rename(e){if(this.onceRenamed){this.append(`[w] LogFile.rename(id: ${this.logId} => ${e}) ignored`);return}this.onceRenamed=!0,this.append(`LogFile.rename(id: ${this.logId} => ${e})`),this.logId=e;try{let t=this.logFilePath(this.logId);this._filePath!==t&&(tt.closeSync(this.fileDescriptor),this.deleteOrphanedLogFiles(),Tn.dirname(this._filePath)===Tn.dirname(t)?tt.renameSync(this._filePath,t):(tt.copyFileSync(this._filePath,t),tt.unlinkSync(this._filePath)),this._filePath=t,this.fileDescriptor=tt.openSync(this._filePath,"a+"))}catch(t){this.logError(t)}}deleteOrphanedLogFiles(){}logFilePath(e){let t=`${e.replaceAll(/[:/\\]/g,"_")}.log`;return lm(()=>Tn.join(this.folder,t),Tn.join(_g.tmpdir(),"cdxlsp_"+t))}append(e){this.appendRaw(`${e}
`)}appendRaw(e){if(this.fileDescriptor)try{tt.appendFileSync(this.fileDescriptor,e)}catch{}}close(){this.appendRaw(`

---------- closing trace file
`),tt.closeSync(this.fileDescriptor),this.fileDescriptor=0}},yu=xu;o(xu,"LogFile");var tc=class extends yu{constructor(){super(...arguments);m(this,"_maxFileSize",tc.DEFAULT_MAX_FILE_SIZE);m(this,"_numberOfFiles",tc.DEFAULT_NUMBER_OF_FILES);m(this,"currentFileNumber",0);m(this,"currentFileCount",0)}appendRaw(t){super.appendRaw(t),this.currentFileCount+=t.length,this.currentFileCount>=this.maxFileSize&&this.rotateFile()}get numberOfFiles(){return this._numberOfFiles}set numberOfFiles(t){t!==void 0&&(this._numberOfFiles=Math.max(2,t))}get maxFileSize(){return this._maxFileSize}set maxFileSize(t){t!==void 0&&(this._maxFileSize=Math.max(1e3,t))}logFilePath(t){return super.logFilePath(`${t}.${this.currentFileNumber??0}`)}rotateFile(){try{let t=this._filePath;this.bumpFileNumber(),this._filePath=this.logFilePath(this.logId),this.currentFileCount=0,this.appendRaw(`
----- continued in `+this._filePath),tt.closeSync(this.fileDescriptor),this.fileDescriptor=tt.openSync(this._filePath,"w+"),this.currentFileCount=0,this.appendRaw(`----- continued from ${t}

`)}catch(t){this.logError(t)}}bumpFileNumber(){let t=(this.currentFileNumber+1)%(this.numberOfFiles+1);this.currentFileNumber=t||1}deleteOrphanedLogFiles(){try{for(let t of this.findOrphanedFiles())this.renameAndUnlinkOrphanedFile(t)}catch(t){this.logError(t)}}findOrphanedFiles(){let t=super.logFilePath(this.logId+".[0-9]+"),r=Tn.basename(t),i=Tn.dirname(t);return tt.readdirSync(i).filter(s=>s.match(r)).map(s=>Tn.join(i,s))}renameAndUnlinkOrphanedFile(t){let r=Tn.dirname(t);if(tt.statSync(t).isFile()){let s=Tn.join(r,"orphaned-"+Math.floor(Math.random()*1e4));tt.renameSync(t,s),tt.unlinkSync(s)}else this.appendRaw("Orphaned but not a file: "+t)}},ir=tc;o(tc,"RotationLogFile"),m(ir,"DEFAULT_MAX_FILE_SIZE",1e7),m(ir,"DEFAULT_NUMBER_OF_FILES",3);var Og=class extends yu{get enabled(){return Zi()}constructor(){super(void 0,"context")}createFile(){this.enabled&&super.createFile()}appendRaw(e){this.enabled&&super.appendRaw(e)}rename(e){this.enabled&&super.rename(e)}},Iu=Og;o(Og,"ContextLogFile");function Ii(n){return Object.entries(n??{})}o(Ii,"entries");function Xt(n){return JSON.parse(n)}o(Xt,"parseJson");function Su(n){return Q1(n)}o(Su,"calculateHashDigest");function Q1(n){let e=5381,t=2166136261,r=n.length;for(;r;){let i=n.charCodeAt(--r);e=e*33^i,t=(t^i)*16777619}return`${e>>>0}/${t>>>0}`}o(Q1,"hash");var ku=K(require("util"));var rc=1024*1024,Zk=1e3*1e3;function eC(n){return Math.abs(n)>=rc?`${Math.round(n/rc)}~M`:`${Math.round(n/1024)}~K`}o(eC,"memoryUnit");var nc=[{unit:"ns",factor:1n},{unit:"us",factor:BigInt(1e3)},{unit:"ms",factor:BigInt(1e6)},{unit:"s",factor:BigInt(1e9)},{unit:"min",factor:BigInt(6e10)}];function Mg(n){let e=o(()=>{let s=nc.findIndex((c,l)=>{let u=nc[l+1];return u?n<2n*u.factor:!0}),a=s===nc.length-1;return[nc[s],a?nc[s-1]:void 0]},"getScales"),[t,r]=e(),i=`${n/t.factor}~${t.unit}`;return r&&(i+=` ${n%t.factor/r.factor}~${r.unit}`),hi(i,{errorPredicate:n>1e3*Zk,warnPredicate:n>200*Zk,successPredicate:n<0})}o(Mg,"renderElapsedNanos");var tC=o(()=>global.gc?.call(global,!0),"gc"),Ug=class{constructor(e=!1){m(this,"startTime");m(this,"startMemory");e&&(tC(),this.startMemory=process.memoryUsage()),this.startTime=process.hrtime.bigint()}get elapsedNanos(){return process.hrtime.bigint()-this.startTime}get elapsed(){return this.elapsedMemory()+Mg(this.elapsedNanos)}elapsedMemory(){if(!this.startMemory)return"";tC();let e=process.memoryUsage(),t=o((r,i=!0)=>{let s=e[r],a=i?"":this.diffMemory(s-this.startMemory[r]),c=hi(eC(s),{errorPredicate:s>200*rc,warnPredicate:s>100*rc});return`${r}${a}=${c} `},"diff");return`${t("rss")}${t("external")}${t("heapUsed",!1)}`}diffMemory(e){if(e!==0){let t=eC(e);return hi((e>0?"+":"")+t,{errorPredicate:e>20*rc,successPredicate:e<0})}return""}},xi=Ug;o(Ug,"Stopwatch");function nC(n){return new Promise(e=>setTimeout(e,n))}o(nC,"sleep");function Y1(n=R.args){return(e,t,r)=>{try{let i=n(e,t,r);return typeof i=="string"?i:ku.inspect(i)}catch(i){let s=i;return Ne.error(`[E] argument rendering failed with: ${s.message}
${R.args(e)}`)}}}o(Y1,"SafeArgs");function Z1(n=R.result){return(e,t,r,i)=>{try{let s=n(e,t,r,i);return typeof s=="string"?s:ku.inspect(s)}catch(s){let a=s;return Ne.error(`[E] result rendering failed with: ${a.message}
${R.result(e)}`)}}}o(Z1,"SafeResult");var qg=class extends Oa{constructor(t,r){super();this.component=t;this.tracerAdapter=r}isTracing(t){return this.tracerAdapter.traceLevel(this.component)>=t}footprint(t,r,i=[],s={}){let a="<unknown>",c=s.startScope||s.scope||a,l=s.endScope||s.scope||a,u=this.tracerAdapter.traceLevel(this.component),p=s.traceLevel??5,d=u>=p,f=u>=6,g=Z1(s.resultRenderer??R.result),h=Y1(s.argumentsRenderer??(f?R.args:R.nothing)),T=new xi(s.trackMemory),S=this.tracerAdapter.indentLevel,C=o(()=>he().frameScope.indentLevel=S,"rebaseIndent"),L=this;function A(O,j){return C(),d&&!s.onlyTraceStart&&L.conditionalTrace(p,()=>`}${j?"~":""} ${l} [${T.elapsed}] ${f?" => "+g(O,i,t,u):""}`),O}o(A,"onSuccess");function W(O,j){throw C(),L.error(()=>`}${j?"~":""} [E] ${l} [${T.elapsed}] => ${ku.inspect(O)}`),O}o(W,"onError");try{d&&!s.onlyTraceEnd&&this.conditionalTrace(p,()=>`${c} ${f?"("+h(i,t,p)+")":""} {`),this.tracerAdapter.increaseIndent();let O=r(...i),j=O;return j?.then?(C(),j.then(J=>A(J,!0)).catch(J=>W(J,!0))):A(O,!1)}catch(O){return W(O,!1)}}conditionalTrace(t,r){this.tracerAdapter.conditionalTrace(this.component,t,r)}},Tu=qg;o(qg,"Tracer");var eU=Object.keys(Z).reduce((n,e)=>Math.max(n,e.length),0),rC={},tU=o(n=>rC[n]??(rC[n]="".padEnd(n*3)),"paddingFor"),nU={1:"[-]",2:$t.fg.magenta("[:]"),3:Ne.error("[E]"),4:Ne.warn("[w]"),5:Ne.info(" | "),6:" : ",7:$t.fg.darkgray(" . ")},Pu=class{constructor(){m(this,"logFile");m(this,"extendedStatsLogFile");m(this,"traceComponents",new Map([["*",6]]));m(this,"tracers",new Map);m(this,"lastTimeTraced",new Date().getTime());this.logFile=new ir,this.extendedStatsLogFile=new Iu}get indentLevel(){return he().frameScope.indentLevel}increaseIndent(){let e=he().frameScope;e.isTraceEnabled()&&(e.indentLevel+=1)}decreaseIndent(){let e=he().frameScope;e.isTraceEnabled()&&(e.indentLevel-=1,e.indentLevel<0&&(e.indentLevel=0,this.doTraceToFile("!!! Indent underflow")))}traceLevel(e){return this.traceComponents.get(e)||this.traceComponents.get("*")||1}get logfilename(){return this.logFile.filePath}configureFolder(e){e&&(this.logFile.folder=e,this.extendedStatsLogFile.folder=e)}configureName(e){if(e){let t=e.length<=60?e:e.slice(0,40)+"_"+Su(e).replaceAll(/[/\\]/g,"_");this.logFile.rename(t),this.extendedStatsLogFile.rename(t+"_context")}}configureRotation(e=ir.DEFAULT_MAX_FILE_SIZE,t=ir.DEFAULT_NUMBER_OF_FILES){this.logFile.maxFileSize=e,this.logFile.numberOfFiles=t}configureTraceComponents(e){let t=this.traceComponents,r=this.traceLevel("util");if(Array.isArray(e)&&(t.clear(),e.forEach(s=>{let a=s.name;a==="*"&&t.clear(),t.set(a,Pu.toTraceLevel(s.level))}),Math.max(r,this.traceLevel("util"))>=2)){this.doTrace(2,"util",()=>"New trace component configuration: ");for(let[s,a]of t.entries())this.doTrace(2,"util",()=>`   ${s} = ${be[a]}`)}}configure(e){this.configureFolder(e.folder),this.configureName(e.name),this.configureTraceComponents(e.components),this.configureRotation(e.logfileSize,e.logfileCount),this.conditionalTrace("util",2,()=>`(current logs in ${this.logFile.filePath})`)}tracer(e){let t=this.tracers.get(e);return t||(t=new Tu(e,this),this.tracers.set(e,t)),t}async noTraceDuring(e){return o(async()=>{let{indentLevel:r}=he().frameScope;try{return he().frameScope.indentLevel=-1,await e()}finally{he().frameScope.indentLevel=r}},"wrapper")()}conditionalTrace(e,t,r){this.traceLevel(e)<t||!he().frameScope.isTraceEnabled()||this.doTrace(t,e,r)}doTrace(e,t,r){t==="context-log"?this.extendedStatsLogFile?.appendRaw(r()):this.doTraceMessage(this.renderMessage(e,t,r))}renderMessage(e,t,r){let i=r(),s=this.traceLevel("requests")>=7,a=o(()=>{let p=new Date,d=p.getTime(),f=d-this.lastTimeTraced;this.lastTimeTraced=d;let g=p.toISOString();if(t==="requests"){if(i.startsWith($l))return Ne.requestFromServer(g);if(i.includes(Wr))return Ne.responseToClient(g)}return hi(g,{errorPredicate:f>5e3})},"colorizedTime");function c(){let p=`{${t}}`.padEnd(eU+2),d=31,{name:f,requestNumber:g=-1,snapshots:h}=he().requestScope,T="";if(s&&h){let L=[];for(let A of h.values())A.constructor.name!=="NonScanningWorkspaceSnapshot"&&L.push(A.workspaceVersion);T=`/${L.join(",")}`}let S=hi(f.padEnd(d),{warnPredicate:f.startsWith("@")});return`${`${g}${T}`.padStart(s?11:5)}:${S} ${nU[e]??"???"} ${p}`}o(c,"colorizedContext");let l=`${a()} ${c()} ${tU(this.indentLevel)}`;function u(){let p=i;if(p.includes(`
`)){let d=" ".repeat(l.length),f=o((g,h,T)=>`${g}${T>0?d:""}${h}
`,"appendIndented");p=p.split(/\r?\n/g).reduce(f,"")}return hi(p,{errorPredicate:e===3,warnPredicate:e===4,infoPredicate:e===5,debugPredicate:e===7})}return o(u,"colorizedMessage"),`${l}${u()}`}doTraceMessage(e){this.doTraceToFile(e)}doTraceToFile(e){this.logFile&&this.logFile.append(e)}static toTraceLevel(e){switch(e){case"off":return 1;case"error":return 3;case"warning":return 4;case"info":return 5;case"verbose":return 6;case"debug":return 7;default:return 1}}},Cu=Pu;o(Pu,"LspTrace");var sC=K(require("path")),ue=K(Xe());var iC=new Set,oC=o(n=>n.___CACHES??(n.___CACHES=new Map),"cachesFor"),Ru=o((n,e)=>{let t=oC(n),r=t.get(e);return r||(r=new Map,t.set(e,r),iC.add(r)),r},"cacheFor");function Pe(n={key:e=>e[0]}){return(e,t,r)=>{let i=r.value;return r.value=o(function(...a){let c=Ru(this,t),l=n.key(a);return c.has(l)||c.set(l,i.call(this,...a)),c.get(l)},"CacheDecorator"),r}}o(Pe,"Cache");Pe.clear=(n,e)=>{if(n)e?Ru(n,e).clear():oC(n).clear();else if(!e)iC.forEach(t=>t.clear());else throw new Error(`Clearing method cache '${e}' requires an instance`)};Pe.set=(n,e,t,r)=>{Ru(n,e).set(t,r)};Pe.get=(n,e,t)=>Ru(n,e).get(t);function rU(n){return sC.extname(n)!==".cds"}o(rU,"isCsn");var iU=o(()=>({start:{line:0,character:0},end:{line:0,character:0}}),"csnFallbackLocation"),Wg=class{static adapt(e){return rU(e.file)?iU():{start:{line:e.line-1,character:e.col-1},end:{line:e.endLine?e.endLine-1:e.line-1,character:e.endCol?e.endCol-1:e.col-1}}}},yr=Wg;o(Wg,"RangeAdapter");function oc(n){return yr.adapt(n)}o(oc,"adaptRange");function aC(n){return $g.adapt(n)}o(aC,"adaptCompletionKind");var oU=new Map([["context",ue.CompletionItemKind.Unit],["element",ue.CompletionItemKind.Field],["entity",ue.CompletionItemKind.Class],["namespace",ue.CompletionItemKind.Module],["source",ue.CompletionItemKind.File],["type",ue.CompletionItemKind.Interface]]),Bg=class{static adapt(e){return oU.get(e)??ue.CompletionItemKind.Variable}},$g=Bg;o(Bg,"CompletionKindAdapter");var jg=class{static adapt(e){switch(e){case"Error":return ue.DiagnosticSeverity.Error;case"Warning":return ue.DiagnosticSeverity.Warning;case"Info":return ue.DiagnosticSeverity.Information;case"Debug":default:return ue.DiagnosticSeverity.Hint}}},Si=jg;o(jg,"SeverityAdapter");function Ve(){return Object.create(null)}o(Ve,"empty");var sU=new Map([["action",ue.SymbolKind.Function],["aspect",ue.SymbolKind.Constructor],["context",ue.SymbolKind.Package],["element",ue.SymbolKind.Field],["entity",ue.SymbolKind.Class],["enum",ue.SymbolKind.EnumMember],["event",ue.SymbolKind.Event],["function",ue.SymbolKind.Function],["mixin",ue.SymbolKind.Operator],["namespace",ue.SymbolKind.Namespace],["param",ue.SymbolKind.Variable],["qualifiedAnnotation",ue.SymbolKind.Property],["type",ue.SymbolKind.Interface],["using",ue.SymbolKind.Module],["service",ue.SymbolKind.Object],["view",ue.SymbolKind.Class]]);function Au(n,e){let t=e||n,r=sU.get(t);return r||G().tracer("adapter").verbose(()=>`default adaptSymbolKind(${t})`),r??ue.SymbolKind.String}o(Au,"adaptSymbolKind");var aU=new Map([[ue.SymbolKind.Module,ue.CompletionItemKind.Module],[ue.SymbolKind.Namespace,ue.CompletionItemKind.Unit],[ue.SymbolKind.Package,ue.CompletionItemKind.Unit],[ue.SymbolKind.Class,ue.CompletionItemKind.Class],[ue.SymbolKind.Field,ue.CompletionItemKind.Field],[ue.SymbolKind.Interface,ue.CompletionItemKind.Interface],[ue.SymbolKind.Function,ue.CompletionItemKind.Function],[ue.SymbolKind.Variable,ue.CompletionItemKind.Variable],[ue.SymbolKind.Object,ue.CompletionItemKind.Method],[ue.SymbolKind.EnumMember,ue.CompletionItemKind.EnumMember],[ue.SymbolKind.Event,ue.CompletionItemKind.Event],[ue.SymbolKind.TypeParameter,ue.CompletionItemKind.TypeParameter],[ue.SymbolKind.String,ue.CompletionItemKind.Text]]);function cC(n){return aU.get(n)??ue.CompletionItemKind.Text}o(cC,"toCompletionKind");function lC(n,e){if(!(n instanceof e))throw new TypeError}o(lC,"assertsType");var Vg=class{isWindows(){return/^win/.test(process.platform)}},ic=Vg;o(Vg,"PlatformTester"),x([Pe()],ic.prototype,"isWindows",1);function Lu(n){return n.toLowerCase()===n?n.toUpperCase():n.toLowerCase()}o(Lu,"toggleCase");function ao(n,e,t,r=0,i=n.length-1){if(r>i)return;let s=Math.floor((r+i)/2),a=t(n[s],e);return a===0?n[s]:a>0?ao(n,e,t,r,s-1):ao(n,e,t,s+1,i)}o(ao,"binSearch");var wu=K(require("child_process"));var Gg=class extends Error{constructor(t,r){let i=r.exitCode!==0?`
<exit code:>
${r.exitCode}`:"",s=r.stdout?`
<stdout:>
${r.stdout}`:"",a=r.stderr?`
<stderr:>
${r.stderr}`:"";super(t+i+s+a);this.result=r}},Eu=Gg;o(Gg,"CliError");var Hg=class{constructor(){}static streamIntoResult(e,t,r,i="utf8"){return new Promise((s,a)=>{e.setEncoding(i),e.on("data",c=>t[r]+=c),e.on("end",()=>s(t[r])),e.on("error",c=>a(c))})}static async run(e,t,r={failIfNonZeroExit:!0}){r.shell=!0;let i=wu.spawn(e,t,r);i.stdin.end();let s={stdout:"",stderr:"",exitCode:1},a=o(()=>{s.stdout=s.stdout.trim(),s.stderr=s.stderr.trim()},"trimResult"),c=this.streamIntoResult(i.stdout,s,"stdout"),l=this.streamIntoResult(i.stderr,s,"stderr"),u=new Promise((p,d)=>{i.on("error",f=>d(f)),i.on("close",(f,g)=>{a(),s.exitCode=g??f,g||f!==0&&r.failIfNonZeroExit?d(new Eu(`Failed: ${e} ${t.join(" ")}`,s)):p(s)})});return await Promise.allSettled([c,l,u]),u}static runSync(e,t,r={encoding:"utf8"}){r.shell=!0,r.encoding="utf8";let i=wu.spawnSync(e,t,r),s={stdout:"",stderr:"",exitCode:1};if(s.stdout=i.stdout?.trim()??"",s.stderr=i.stderr?.trim()??"",s.exitCode=i.signal??i.status??0,i.error)throw i.error;if(i.signal||i.status!==0&&r.failIfNonZeroExit)throw new Eu(`Failed: ${e} ${t.join(" ")}`,s);return s}},Vt=Hg;o(Hg,"CLI"),m(Vt,"_currentlyRunning",0),x([F("util",{argumentsRenderer:n=>`<<${++Vt._currentlyRunning}>> ${R.args(n)}`,resultRenderer:(n,e)=>`<<${--Vt._currentlyRunning}>> ${R.args(e)} => ${R.result(n)}`})],Vt,"run",1),x([F("util",{argumentsRenderer:n=>`<<${++Vt._currentlyRunning}>> ${R.args(n)}`,resultRenderer:(n,e)=>`<<${--Vt._currentlyRunning}>> ${R.args(e)} => ${R.result(n)}`})],Vt,"runSync",1);function z4(n,e){let t=[];for(let r of n)t.push(e(r));return t}o(z4,"map");function uC(n,e){let t=[];for(let r of n)e(r)&&t.push(r);return t}o(uC,"filter");function co(n,e){let t=n.uri.localeCompare(e.uri);return t!==0?Math.sign(t):(t=kn(n.range.start,e.range.start),t!==0?t:kn(n.range.end,e.range.end))}o(co,"compareLocations");function kn(n,e){let t=n.line-e.line;return Math.sign(t!==0?t:n.character-e.character)}o(kn,"comparePosition");function pC(n,e){let t=kn(n.start,e);return t>0?1:t===0?0:kn(n.end,e)<0?-1:0}o(pC,"compareRange");var dC=Symbol("languageServer"),fC=Symbol("factory");function vt(){return tm(dC)}o(vt,"currentLanguageServer");function mC(n){nm(dC,n)}o(mC,"initLanguageServer");function ne(){return tm(fC)}o(ne,"currentFactory");function cU(n){nm(fC,n)}o(cU,"initFactory");var Ss=o(n=>{cU(n),he().appScope.trace=n.getTrace()},"startAppScope");var Ti=K(require("fs")),hC=K(require("os")),gC=K(require("path")),zg=K(require("util"));var Kg=class{constructor(e=G()){this.trace=e;m(this,"emergencyHooksInstalled",!1)}install(){if(this.emergencyHooksInstalled){this.trace.tracer("util").warn(()=>"Ignored: hooks already attached");return}this.emergencyHooksInstalled=!0,process.on("uncaughtException",this.onUncaughtException.bind(this)),process.on("unhandledRejection",this.onUnhandledRejection.bind(this)),process.on("exit",this.onExit.bind(this)),process.on("warning",this.onWarning.bind(this))}onUncaughtException(e){this.trace.conditionalTrace("util",3,()=>`SEVERE: uncaughtException: ${R.exception(e)}`)}onUnhandledRejection(e,t){this.trace.conditionalTrace("util",3,()=>`Unhandled Rejection at: ${zg.inspect(t,!0,4)} reason: ${e}`)}onExit(e){this.trace.conditionalTrace("util",2,()=>`CDS-LS will exit now with code ${e}`);let t=`
        

----- ${new Date().toISOString()}
pid: ${process.pid} <- ${process.ppid}
memory:
${JSON.stringify(process.memoryUsage(),null,2)}
exited with code ${e}:
${new Error().stack?.split(/\r?\n/).slice(1).join(`
`)}
process details:
${zg.inspect(process)}
`;this.trace.doTraceToFile(t);let r=gC.join(hC.tmpdir(),"cdxlsp/exitInfos.txt");Ti.existsSync(r)&&Ti.statSync(r).mtime.toDateString()!==new Date().toDateString()&&Ti.rmSync(r),Ti.appendFileSync(r,t)}onWarning(e){this.trace.doTraceToFile(this.trace.renderMessage(2,"util",()=>`Process warning (${e.name}): ${e.message}
${e.stack}
`))}},sc=Kg;o(Kg,"EmergencyHooks"),x([F("util",{scope:"installEmergencyHooks"})],sc.prototype,"install",1);function Fu(n){throw new Error(n)}o(Fu,"NoSuchOption");var Oe=K(require("fs")),vC=K(require("os")),Qt=K(require("path"));var bC=K(require("os")),Nu=K(require("path"));var Du=require("url"),Jt=Du.pathToFileURL,Cn=Du.fileURLToPath;var Ts=class{static isUntitledFile(e){return e.startsWith(this.UNTITLED_ROOT_URI)}static toDiskUri(e){return this.isUntitledFile(e)?e.replace(Ts.UNTITLED_ROOT_URI,Ts.UNTITLED_ROOT_URI_ONDISK):e}},mt=Ts;o(Ts,"Untitled"),m(mt,"UNTITLED_ROOT",Nu.join(bC.tmpdir(),"cds_lsp_untitled_files")+Nu.sep),m(mt,"UNTITLED_ROOT_URI_ONDISK",Jt(Ts.UNTITLED_ROOT).toString()),m(mt,"UNTITLED_ROOT_URI","untitled:");var gn="package.json";function uU(n){let e=pU(n);return Cn(mt.toDiskUri(e))}o(uU,"getLocalPath");function pU(n){return n.startsWith("file:")?n:Jt(n).toString()}o(pU,"ensureUri");var Xg=class{constructor(){m(this,"uriToIsCsn",new Map)}isTranslationFile(e,t){let r=Qt.extname(t);if(![".properties",".json",".csv"].includes(r)||!Qt.basename(t).startsWith(e.i18n.file))return!1;t=t.replaceAll(Qt.sep,ze);for(let s of e.i18n.folders)for(let a of[e.i18n.fallback_bundle,e.i18n.default_language]){let c=a.length?"_"+a.replace("-","_"):a;if(t.endsWith(`/${s}/${e.i18n.file}${c}${r}`)||a.length&&(c="_"+a.match(/[a-zA-Z]+/),t.endsWith(`/${s}/${e.i18n.file}${c}${r}`)))return!0}return!1}isPackageJsonFile(e=""){return Qt.basename(e)===gn}typeofFile(e,t,r){if(e&&!e.endsWith(Qt.sep)){let i=Qt.basename(e);switch(Qt.extname(e)){case".cds":return"CdsSource";case".csn":return"CsnFile";case".json":if(i===gn)return"PackageJson";if(this.isCdsEnvFile(e))return".cdsrc.json";if(this.isCsnFile(e,r))return"CsnFile";break;case"":if(this.isIgnoreFile(i))return"IgnoreFile";break}if(this.isTranslationFile(t,e))return"TranslationDefinitions"}return"Unrelated"}isCsnFileByExtension(e){return e.endsWith(".csn")||e.endsWith(".csn.json")}isCsnFile(e,t){if(this.isCsnFileByExtension(e))return!0;if(e.endsWith(".json")&&!this.isPackageJsonFile(e))try{let r=this.uriToIsCsn.get(e);if(r!==void 0)return r;let i=t();if(i===pe)return!1;let s=Xt(i),a=!!(s?.$version&&s?.meta?.creator?.toLowerCase().includes("cds"))||!!s?.version?.csn;return this.uriToIsCsn.set(e,a),a}catch(r){G().tracer("workspace").warn(()=>`Invalid JSON file ${e}: ${r}`)}return!1}isCdsEnvFile(e=""){return[".cdsrc.json","default-env.json",".env","package.json"].includes(Qt.basename(e))}isIgnoreFile(e=""){return[".gitignore",".cdsignore"].includes(Qt.basename(e))}isCdsSourceFile(e=""){return Qt.extname(e)===".cds"||e.startsWith(mt.UNTITLED_ROOT_URI)}isCdsFile(e="",t=pe){switch(Qt.extname(e)){case".cds":return!0;case".csn":return!0;case".json":return this.isCsnFile(e,()=>t===pe?this.readFileSync(uU(e)):t)}return!!e&&e.startsWith("untitled:")}isFileSystemRoot(e){return Qt.dirname(e)===e}existsSync(e){return Oe.existsSync(e)}async readFile(e){return Oe.promises.readFile(e,"utf8")}readFileSync(e){return Oe.readFileSync(e,"utf8")}writeFileSync(e,t,r){return Oe.writeFileSync(e,t,r)}async copyFile(e,t,r){return Oe.promises.copyFile(e,t,r)}unlinkSync(e){return Oe.unlinkSync(e)}async mkdir(e){return Oe.promises.mkdir(e,{recursive:!0})}mkdirSync(e){if(Oe.existsSync(e)){if(Oe.statSync(e).isDirectory())return;throw new Error(`Path '${e}' already exists but is not a folder`)}Oe.mkdirSync(e,{recursive:!0})}mkdtempSync(e){return Oe.mkdtempSync(e,"utf8")}async rmdir(e){return Oe.promises.rm(e,{recursive:!0,force:!0})}rmdirSync(e){return Oe.rmSync(e,{recursive:!0,force:!0})}readdirSync(e,t){return t?Oe.readdirSync(e,{encoding:"utf8",withFileTypes:t}):Oe.readdirSync(e,{encoding:"utf8"})}statSync(e){return Oe.statSync(e)}realpathSync(e){return Oe.realpathSync(e,"utf8")}realpathSyncNative(e){return Oe.realpathSync.native(e,"utf8")}stat(...e){return Oe.stat.bind(Oe).call(...e)}homedir(){return vC.homedir()}},$e=Xg;o(Xg,"DiskFileSystem"),x([F("files",{traceLevel:7,argumentsRenderer:n=>n[1]})],$e.prototype,"isTranslationFile",1),x([F("files",{traceLevel:7})],$e.prototype,"isPackageJsonFile",1),x([F("files",{traceLevel:7,argumentsRenderer:n=>n[0]})],$e.prototype,"typeofFile",1),x([F("files",{traceLevel:7})],$e.prototype,"isCsnFileByExtension",1),x([F("files",{traceLevel:7,argumentsRenderer:n=>n[0]})],$e.prototype,"isCsnFile",1),x([F("files",{traceLevel:7})],$e.prototype,"isCdsEnvFile",1),x([F("files",{traceLevel:7})],$e.prototype,"isIgnoreFile",1),x([F("files",{traceLevel:7})],$e.prototype,"isCdsSourceFile",1),x([F("files",{traceLevel:7,argumentsRenderer:n=>n[0]})],$e.prototype,"isCdsFile",1),x([F("files",{traceLevel:7})],$e.prototype,"isFileSystemRoot",1),x([F("files",{traceLevel:7})],$e.prototype,"existsSync",1),x([F("files",{resultRenderer:n=>`${n.length} bytes`})],$e.prototype,"readFile",1),x([F("files",{resultRenderer:n=>`${n.length} bytes`})],$e.prototype,"readFileSync",1),x([F("files",{argumentsRenderer:n=>n[0],resultRenderer:R.nothing})],$e.prototype,"writeFileSync",1),x([F("files",{resultRenderer:R.nothing})],$e.prototype,"copyFile",1),x([F("files")],$e.prototype,"unlinkSync",1),x([F("files")],$e.prototype,"mkdir",1),x([F("files")],$e.prototype,"mkdirSync",1),x([F("files")],$e.prototype,"mkdtempSync",1),x([F("files")],$e.prototype,"rmdir",1),x([F("files")],$e.prototype,"rmdirSync",1),x([F("files",{traceLevel:7,resultRenderer:R.direntsOrStrings})],$e.prototype,"readdirSync",1),x([F("files",{traceLevel:7,resultRenderer:R.stats})],$e.prototype,"statSync",1),x([F("files",{traceLevel:7})],$e.prototype,"realpathSync",1),x([F("files",{traceLevel:7})],$e.prototype,"realpathSyncNative",1),x([F("files",{traceLevel:7})],$e.prototype,"stat",1),x([F("files",{traceLevel:7})],$e.prototype,"homedir",1);function yC(n){if(n===pe)throw new Error("File does not exist")}o(yC,"assertIsContent");var IC=K(require("path"));function un(n,e){return new Pn(typeof n=="string"?Pn.escapePlainString(n):n,e)}o(un,"rgx");function b8(n){return new Pn(n[0])}o(b8,"R");function zr(n,e,...t){return t.unshift(e),Pn.and(...t).capture(n)}o(zr,"capture");var Et=class extends RegExp{constructor(e="",t){super(e,t)}capture(e){let t=e?`(?<${e}>`+this.source+")":"("+this.source+")";return new Et(t)}static and(...e){let t={capturingGroupsBefore:0};return new Et(e.map(r=>typeof r=="string"?Et.escapePlainString(r):r).map(r=>this.adaptCapturingReferenceNumber(r,t)).map(r=>r.source).join(""))}and(...e){return Et.and(this,...e)}static or(...e){return this.combine("|",...e.map(t=>typeof t=="string"?Et.escapePlainString(t):t))}or(...e){return Et.or(this,...e)}static wrap(e,t){return new Et(un(e).source.replace("XXX",t.source),t.flags)}wrap(e){return Et.wrap(e,this)}optional(){let e=this.wrapInNonCapturingGroup();return new Et(e.source+"?",e.flags)}static flags(e,t){return new Et(e,t)}withFlags(e){return Et.flags(this,e)}static combine(e,...t){let r={capturingGroupsBefore:0};return new Et(t.map(i=>this.adaptCapturingReferenceNumber(i,r)).map(i=>i.wrapInNonCapturingGroup()).map(i=>i.source).join(e)).wrapInNonCapturingGroup()}wrapInNonCapturingGroup(){return Et.wrapInNonCapturingClosure(this)}static wrapInNonCapturingClosure(e){let t=e.source;return t.startsWith("(")&&t.endsWith(")")&&this.openingParenthesisMatchesClosingParenthesis(t)?e:Et.wrap(/(?:XXX)/,e)}static openingParenthesisMatchesClosingParenthesis(e){if(e[0]!=="(")return!1;let t=0,r=0;for(let i=0;i<e.length;i++){if(e[i]==="\\"){r^=1;continue}if(e[i]===")"&&!r&&(t--,t===0))return i===e.length-1;e[i]==="("&&!r&&t++,r=0}return!1}static escapePlainString(e){let t=/[-.*?+|\\{}()[\]^$]/g,r=e.replace(t,"\\$&");return new Et(r)}static adaptCapturingReferenceNumber(e,t){let r=e.source.replace(/\\[1-9]/g,s=>"\\"+(t.capturingGroupsBefore+Number.parseInt(s.slice(1),10))),i=[...e.source.matchAll(/(?<!\\)\((?!\?:)/g)].length;return t.capturingGroupsBefore+=i,new Et(r)}},Pn=Et;o(Et,"REGEX");function S8(n){return n.replaceAll(xn,ze)}o(S8,"toUnixPath");function T8(n){return n.replaceAll(un(ze).or(xn).withFlags("g"),IC.sep)}o(T8,"toPlatformPath");function Jg(n,e,t="",r=G().tracer("util")){let i=o(s=>typeof s=="object","isObject");return Object.entries(e).forEach(([s,a])=>{let c=t.length?`${t}.${s}`:s,l=n[s];if(l&&i(l)&&i(a)){if(Array.isArray(l)&&Array.isArray(a)){r.verbose(()=>`- ${c}: to ${R.asIs(l)} appending ${R.asIs(a)}`),l.push(...a);return}Jg(l,a,c,r)}else l!==a&&r.verbose(()=>`- ${c}: changing from ${l} to ${R.asIs(a)}`),n[s]=a}),n}o(Jg,"mergeJSONs");function Qg(n,e){let t={};return Object.entries(n).forEach(([r,i])=>{let s=e[r];if(Array.isArray(i))t[r]=s;else if(typeof i=="object"){let a=Qg(i,e[r]);a&&(t[r]=a)}else i!==s&&(t[r]=s)}),t}o(Qg,"diffJSONs");var ac=K(require("path")),Yg=K(require("util"));function or(n){let e=`
	`;e+=`--- ${n.statName}
	`;let t=Object.keys(n.stats).reduce((i,s)=>Math.max(i,s.length),0),r=new Array(1+t).join(" ");return Ii(n.stats).forEach(([i,s])=>{Array.isArray(s)?(e+=`          ${i}:
	`,s.forEach(a=>{e+=`          ${r}  ${a}
	`})):e+=`          ${i}:${r.slice(i.length)} ${s}
	`}),e}o(or,"renderStats");var Zg=class{genericStats(e,t){return{statName:e,stats:{value:`
`+R.asIs(t).split(/\r?\n/).map(r=>`                              ${r}`).join(`
`)}}}async npmStats(){let[e,t,r]=await Promise.all([this.execCmd("npm",["-v"]),this.npmRegistry("registry"),this.npmRegistry("@sap:registry")]);return{statName:"npm (for contributions)",stats:{version:e,registry:t,sapRegistry:r}}}async capStats(){let e=await this.capVersions(ac.resolve("/"));return{statName:"CAP",stats:{"home (global)":e.home,"cds-dk (global)":e["@sap/cds-dk"],"cds (global)":e["@sap/cds"],"cds-compiler (global)":e["@sap/cds-compiler"],"cds-compiler (built-in)":require("@sap/cds-compiler/package.json").version}}}async capVersions(e){try{return(await this.run("cds",["v"],e)).stdout.split(/\r?\n/g).reduce((r,i)=>{let s=i.split(":").map(l=>l.trim()),[a,c]=s;return a&&c&&(r[a]=c),r},{})}catch(t){return{"@sap/cds-dk":Yg.inspect(t)}}}async workspaceFolderStats(e,t,r){let[i,s]=await Promise.all([this.execCmd("git",["config","--get","remote.origin.url"],t),this.capVersions(t)]);return{statName:`Workspace "${e}"`,stats:{clientRootUri:r,workspaceRoot:t,git:i,"cds (local)":s["@sap/cds"],"cds-compiler (local)":s["@sap/cds-compiler"],"home (local)":s.home}}}async npmRegistry(e){return this.execCmd("npm",["get",e],ac.resolve(ac.join(Ft,"contributions")))}async execCmd(e,t=[],r){try{return(await this.run(e,t,r)).stdout}catch(i){return Yg.inspect(i)}}async run(e,t=[],r){return Vt.run(e,t,{cwd:r,failIfNonZeroExit:!1})}static log(e){Zi()&&(this.appendRaw(`

${Ne.responseToClient(new Date().toISOString())}`),this.appendRaw(or(e)))}static logLater(e){if(Zi()){let t=setTimeout(()=>{Dt(e().then(r=>{this.appendRaw(`

${Ne.responseToClient(new Date().toISOString())}`),this.appendRaw(or(r))}))},3e4);this._laterStats.push(t)}}static cancelLaterStats(){this._laterStats.forEach(clearTimeout),this._laterStats.length=0}static appendRaw(e){G().tracer("context-log").conditionalTrace(2,()=>e)}},wt=Zg;o(Zg,"LspExtendedStats"),m(wt,"_laterStats",[]);var TC=K(require("util"));var re=o(()=>{},"FB_UNDEFINED"),Ee=o(()=>[],"FB_EMPTY_ARRAY");function Q(n){return(e,t,r)=>{let i=o((a,c,l)=>{let u=n.errorTrace?()=>n.errorTrace(a,c):()=>`Caught in ${t}: ${R.exception(a)}
=> (returning default value)
`;return G().conditionalTrace(n.traceComponent??"util",n.traceLevel??3,u),n.fallback(a,c,l)},"onError"),s=r.value;return r.value=o(function(...c){try{let l=s.bind(this)(...c);return l?.then?l.catch(u=>i(u,c,this)):l}catch(l){return i(l,c,this)}},"TryCatchDecorator"),r}}o(Q,"TryCatch");var xC=new Map([["cds.typeGenerator.outputPath","./@types"],["cds.typeGenerator.localInstallationOnly",!0],["cds.typeGenerator.enabled",!1],["cds.codeLensStatistics.enabled",!1],["cds.contributions.registry","https://registry.npmjs.org/"],["cds.contributions.enablement.odata",!0],["cds.contributions.enablement.longRunning.detect",!0],["cds.contributions.enablement.longRunning.maxMillis",3e3],["cds.contributions.enablement.longRunning.repeats",5],["cds.contributions.enablement.longRunning.timeFrameSeconds",120],["cds.diagnosticsSeverity","Warning"],["cds.completion.showDocumentation",!0],["cds.outline.semantical",!1],["cds.completion.docFiles",[]],["cds.completion.formatSnippets",!1],["cds.quickfix.importArtifact",!1],["cds.completion.annotations.omitRedundantTypesInSnippets",!1],["cds.semanticHighlighting.enabled",!1],["cds.compiler.showInternalErrors",!1],["cds.whereused.showGenericAnnotations",!1],["cds.whereused.showStringConstants",!1],["cds.trace.components",[]],["cds.trace.logfiles.count",ir.DEFAULT_NUMBER_OF_FILES],["cds.trace.logfiles.maxSize",ir.DEFAULT_MAX_FILE_SIZE],["cds.compiler.markMissingI18nDefault",!1],["cds.workspace.scanCsn","ByFileExtension"],["cds.workspace.scanDependentModules",!1],["cds.workspace.debounceFastChanges",!0],["cds.workspaceValidationMode","OpenEditorsOnly"],["cds.completion.workspaceSymbols.minPrefixLength",-1],["cds.completion.workspaceSymbols.maxProposals",-1],["cds.workspaceSymbols.lazy",!1],["cds.workspaceSymbols.caseInsensitive",!1]]),dU=o(n=>n,"as"),tb=class{static get(e){return xC.has(e)?xC.get(e):Fu(`No default exist for user setting '${e}'`)}},eb=tb;o(tb,"UserSettingDefaults");var SC=Symbol("Placeholder to tag that no defined result was found"),nb=class{constructor(){m(this,"_clientCapabilities");m(this,"_userSettings",{settings:{}});m(this,"tracer",G().tracer("settings"))}set clientCapabilities(e){this._clientCapabilities=e}get clientCapabilities(){throw new Error("Getter is not supposed to be used")}set userSettings(e){this.tracer.info(()=>`userSettings changed to ${TC.inspect(e,{depth:10})}`),this._userSettings=e}get userSettings(){throw new Error("Getter is not supposed to be used")}getClientCapability(e,t){return this.getSetting(this._clientCapabilities,e,t)}getUserSetting(e){let t=this.getSetting(this._userSettings.settings,e,SC);return t!==SC?t:e==="cds.workspaceValidationMode"&&this.getClientCapability("capabilities.workspace.cds.didChangeActiveEditor")?dU("ActiveEditorOnly"):(this.tracer.verbose(()=>`Using default value for ${e}`),eb.get(e))}setUserSettingTemporarily(e,t){let r=e.split(".");r.unshift("settings");let i=r.pop(),s=this._userSettings;for(let a of r)s=s[a]||(s[a]={});s[i]=t}getSetting(e,t,r){let i=t.split("."),s=e??{};for(let a of i){if(!Object.prototype.hasOwnProperty.call(s,a))return r;s=s[a]}return s}},ki=nb;o(nb,"LspOptions"),x([F("settings",{traceLevel:7})],ki.prototype,"getClientCapability",1),x([F("settings",{traceLevel:7})],ki.prototype,"getUserSetting",1),x([F("settings",{traceLevel:7})],ki.prototype,"setUserSettingTemporarily",1),x([Q({fallback:(n,e)=>e[2],traceComponent:"settings"})],ki.prototype,"getSetting",1);var We=K(require("os")),CC=K(require("path")),Be=K(require("process"));var cc="7.0.0",rb="2023-06-13T12:30:55.340Z";var lc=["bytes","KB","MB","GB","TB"],sr=class{constructor(){m(this,"lastUsedCompiler")}healthStats(){let e=Be.cpuUsage(),t=Be.memoryUsage(),r=Be.uptime(),i=this.lastUsedCompiler?{"cds-compiler":this.lastUsedCompiler.version(),"compiler-location":this.lastUsedCompiler.__logicalLocation}:{};return{type:"health",health:{"ls-uptime":`${Math.trunc(r/3600)}h ${Math.trunc(r/60%60)}m ${Math.trunc(r%60)}s`,"cpu.usage.user":`${e.user/1e6}s`,"cpu.usage.system":`${e.system/1e6}s`,"memory.occupied":`${uc(t.rss,lc,1024)}`,"memory.heap.used":`${uc(t.heapUsed,lc,1024)}`,"memory.heap.total":`${uc(t.heapTotal,lc,1024)}`,"avg.machine.load":`${We.loadavg()} (1, 5, 15min)`},version:{"cds-lsp":cc,built:rb,...i}}}static startStack(){return{statName:"start stack",stats:new Error().stack.split(/\r?\n/).slice(1).map(t=>t.match(/ at (.*)/)?.[1])}}static processStats(){return{statName:"process",stats:{pid:`${Be.pid}   (ppid: ${Be.ppid})`,args:Be.argv,"cds-lsp":cc,locatedAt:Ft,built:rb,cwd:Be.cwd(),argv0:Be.argv0,execPath:Be.execPath,execArgv:Be.execArgv}}}static nodeStats(){return{statName:"node",stats:{"node ver":Be.version,source:Be.release?.sourceUrl,procarch:`${Be.platform} ${Be.arch}`}}}static compilerStats(){return{statName:"compiler",stats:{"cds-compiler":require("@sap/cds-compiler/package.json").version}}}static protocolStats(){return{statName:"language server protocol",stats:{"vscode-languageserver-protocol":kC().version}}}static platformStats(){let e=We.EOL,t="";for(let r=0;r<e.length;r++)t+=`x0${e.charCodeAt(r).toString(16)} `;return{statName:"platform",stats:{os:`${We.type()} ${We.release()} ${We.platform()} ${We.arch()} ${We.endianness()}`,host:We.hostname(),user:We.userInfo().username,home:We.homedir(),tmp:We.tmpdir(),eol:t,"path sep":CC.sep}}}static machineStats(){let e=We.cpus(),t=e[0];return{statName:"machine",stats:{"CPU(s)":`${e.length}x ${t.model} @${t.speed}`,memory:`${uc(We.freemem(),lc,1024)} free / ${uc(We.totalmem(),lc,1024)} total`,"up since":`${new Date(Date.now()-We.uptime()*1e3)}`,"avg load":`${We.loadavg()} (1, 5, 15min)`}}}static processEnvironmentStats(e){let t=new Intl.Collator("en");return{statName:"process environment",stats:Object.keys(Be.env).filter(r=>r.match(e)).sort(t.compare).reduce((r,i)=>(r[i]=Be.env[i]??"",r),{})}}static initialStats(e){let t="";return t+=or(sr.processStats()),t+=or(sr.nodeStats()),t+=or(sr.compilerStats()),t+=or(sr.protocolStats()),t+=or(sr.platformStats()),t+=or(sr.machineStats()),t+=or(sr.processEnvironmentStats(e)),t+=or(sr.startStack()),t+=`

`,t}},uo=sr;o(sr,"LspStats");function uc(n,e=[],t=1e3){let r;for(e.length===0&&(e=[""]),r=0;n>t*2&&e.length>r+1;r++)n/=t;return n.toFixed(1)+e[r]}o(uc,"formatSize");var ib=class{constructor(e){this._connection=e;m(this,"tracer",G().tracer("requests"))}addTelemetry(e){this.tracer.info(()=>`${Wr}addTelemetry`),this.tracer.verbose(()=>R.asIs(e)),this._connection.telemetry.logEvent(e)}},_u=ib;o(ib,"LspTelemetry");var PC=K(require("path"));var mU="nodeModulesPath",hU="importPath",gU="npmModule",bU="optScope",vU="moduleRelativePath";function ob(n){return n.split(PC.sep).filter(e=>e==="node_modules").length}o(ob,"countNodeModules");function Ou(n){return zr(mU,/.*/).and(/node_modules[/\\]/,zr(hU,zr(gU,zr(bU,un(/@[^/\\]+[/\\]/)).optional(),/[^@/\\]+/),/[/\\]/,zr(vU,/.*/)),/$/).exec(n)?.groups}o(Ou,"matchNodeModulePath");var Cs=K(require("path"));var sb=class{constructor(e,t=Cn(e)){this.clientRootUri=e;this.localRootPath=t;m(this,"fs",ne().getFileSystem());m(this,"relativePathToAbsolute",new Map);m(this,"canonicalizeLocalPath",this.isWindows()?e=>{if(this.fs.existsSync(e)){e.endsWith(Cs.sep)&&(e=e.slice(0,-1));let t=this.fs.realpathSyncNative(e);return t.length!==e.length?t[0]+e.slice(1):t}else return e}:e=>e);m(this,"clientifyUri",this.makeClientifyUri());m(this,"uriToPath",new Map);m(this,"pathToUri",new Map);this.clientRootUri=this.stripTrailingSeparator(e),this.clientRootUri=this.mitigateInvalidUri(e),this.fs.existsSync(t)&&(this.localRootPath=this.fs.realpathSyncNative(t))}isWindows(){return ne().getPlatformTester().isWindows()}mitigateInvalidUri(e){if(e.startsWith("file:/")&&!e.startsWith("file://")){let t=e.replace("file:/","file:///");G().tracer("adapter").warn(()=>`Workspace folder uri is not a valid file URI
given:     ${e}
mitigated: ${t}`),e=t}return e}stripTrailingSeparator(e){return e.endsWith(ze)&&(e=e.slice(0,-1)),e}ensureAbsolutePath(e){if(Cs.isAbsolute(e))return e;{let t=this.relativePathToAbsolute.get(e);return t||(t=Cs.join(this.localRootPath,e),this.relativePathToAbsolute.set(e,t)),t}}makeClientifyUri(){let e=this.isWindows()?r=>Jt(Cn(r)).toString().toLowerCase():r=>Jt(Cn(r)).toString(),t=this.clientRootUri.startsWith("file:")?e(this.clientRootUri):this.clientRootUri;return r=>e(r).startsWith(t)?this.clientRootUri+r.slice(t.length):r}toLocalPath(e){let t=this.uriToPath.get(e);return t||(t=this._toLocalPath(e),this.uriToPath.set(e,t)),t}_toLocalPath(e){let t=Cn(e);return t=this.canonicalizeLocalPath(t),t}toUri(e){let t=this.pathToUri.get(e);return t||(t=this._toUri(e),this.pathToUri.set(e,t)),t}_toUri(e){let t=Jt(e).toString();return t=this.clientifyUri(t),t}},ks=sb;o(sb,"PathAdapter");var RC=Symbol("compilationStatsSymbol");function Mu(n=he().requestScope){let e=n[RC];return e||(e={dirtyModels:0,compilations:0,compiledFiles:0,compiledSourceLength:0,compilationElapsedNanos:0n},n[RC]=e),e}o(Mu,"compilationStats");var EC=K(require("path"));var ab=class{assertNodeVersion(e){if(!is("ASSERT_NODE_VERSION",!0))return;let t=ne().getFileSystem();this.check(Xt(t.readFileSync(EC.join(e,"package.json"))))}check(e){let t=e.engines?.node??"",r=process.version;if(!t.startsWith(">="))throw new Error(`Expected minimum required NodeJS version starts with '>=': ${t}`);let i=AC(t.slice(2)),s=AC(r.slice(1));if(!yU(s,i))throw new Error(`Minimum required node version is ${t} but runtime NodeJS (${process.argv0}) is only ${r}`)}},Uu=ab;o(ab,"NodeVersionChecker");function AC(n){let e=n.match(/^(?<major>0|[1-9]\d*)\.(?<minor>0|[1-9]\d*)\.(?<patch>0|[1-9]\d*)(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<buildmetadata>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/);if(!e)throw new Error(`invalid semver: ${n}`);return["major","minor","patch"].map(t=>parseInt(e.groups[t]??"0",10))}o(AC,"parseSemver");function yU(n,e){LC(n),LC(e);for(let t=0;t<n.length;t++){let r=n[t]-e[t];if(r!==0)return r>=0}return!0}o(yU,"gte");function LC(n){if(!n||n.length!==3)throw new Error(`semver needs 3 numbers: ${n}`)}o(LC,"validateSemver");function IU(n){return n.length?n[0].toUpperCase()+n.toLowerCase().slice(1):""}o(IU,"capitalize");function wC(n){return n.includes("-")||n.includes("_")?n.split(/[_-]/).map((e,t)=>t?IU(e):e.toLowerCase()).join(""):n}o(wC,"toCamelCase");var ub=class{constructor(){m(this,"lines",[]);m(this,"lineOffsets",[0]);m(this,"firstCharacterOffsets",[0]);m(this,"leftTrimmedLines",[]);m(this,"lineBreaks",[])}get lineCount(){return this.lines.length}},cb=ub;o(ub,"SplitLines");var Nt=/\r?\n/g;function dc(n){if(n==null)throw new Error("text must be defined");let e=new cb;n.split(Nt).forEach((r,i)=>{let s=r.trimStart();e.lines[i]=r,e.firstCharacterOffsets[i]=r.length-s.length,e.leftTrimmedLines[i]=s}),e.lines.length>1&&(e.lineBreaks=n.match(Nt)||[]),e.lineBreaks.length<e.lines.length&&e.lineBreaks.push("");let t=0;for(let r=0;r<e.lines.length;r++)e.lineOffsets[r]=t,t+=e.lines[r].length+e.lineBreaks[r].length;return e}o(dc,"splitLines");var pc="    ";function Wu(n){for(;n>pc.length;)pc=pc+pc;return pc.substring(0,n)}o(Wu,"indent");var $u=class{constructor(e){m(this,"_splitLines");this._splitLines=dc(e)}insert(e,t){let r=this._splitLines.lines[t.line];return r!==void 0&&(r=r.substring(0,t.character)+e+r.substring(t.character),this._splitLines.lines[t.line]=r),this}clone(){let e=new $u("");return e._splitLines.lineBreaks=this._splitLines.lineBreaks.slice(0),e._splitLines.lines=this._splitLines.lines.slice(0),e}getLines(){return this._splitLines.lines}restoreLines(e=0,t=this._splitLines.lines.length-1){let r=this._splitLines,i="";for(let s=e;s<=t;s++)i+=r.lines[s]+(r.lineBreaks[s]??"");return i}getText(e){if(!e)return this.restoreLines();let t=e.start.line,r=e.end.line,i=this._splitLines.lines[t]??"";if(t===r)return i.slice(e.start.character,e.end.character);let s=this._splitLines.lines[r]??"";return i.slice(e.start.character)+this._splitLines.lineBreaks[t]+this.restoreLines(t+1,r-1)+s.slice(0,e.end.character)}},On=$u;o($u,"TextLines");function FC(n){return`**${n}**`}o(FC,"markdownBold");function DC(n){return`\`${n}\``}o(DC,"markdownItalics");function lb(n){return n?.[0]}o(lb,"first");function b6(n){return n?.[1]}o(b6,"second");function je(n){return n?.[n.length-1]}o(je,"last");var pb=class{constructor(){m(this,"uniqueStrings",Ve())}uniquify(e){return this.uniqueStrings[e]??(this.uniqueStrings[e]=e)}},qu=pb;o(pb,"Uniquifier");var NC=require("util");var mb=class{constructor(e,t,r,i,s){this.tracer=e;this.resourceId=t;this.previousResult=s;m(this,"state","queued");m(this,"asyncTask");m(this,"asyncResult");m(this,"versions",[]);let{requestScope:a,frameScope:c}=he();this.asyncTask=i,this.versions.push(r),e.verbose(()=>`Task ${this}`),this.asyncResult=new Promise((l,u)=>{let p=o(async()=>{try{this.state="started",e.verbose(()=>`Task ${this}`);let d=await this.asyncTask();this.state="completed",e.verbose(()=>`Task ${this} => ${(0,NC.inspect)(d,{depth:-1})}`),l(d)}catch(d){this.state="completed",e.error(()=>`Rejected: Task ${this} => ${R.asIs(d)}`),u(d)}},"startThis");if(s){e.verbose(()=>`Chaining ${this} after previous`);let d=o(()=>(e.verbose(()=>`Starting chained task ${this} after previous completed`),he().requestScope=a,he().frameScope=c,p()),"explainChainingAndStartNext");s.catch(_C).then(d)}else Dt(p())})}rebase(e,t){if(this.state!=="queued")throw new Error(`Rebase not possible, task is in '${this.state}' state`);this.versions.push(e),this.asyncTask=t,this.tracer.verbose(()=>`Rebased task ${this}`)}isResponsibleFor(e){return this.versions.includes(e)}toString(){return`(${this.state}) #${this.versions.join(",")} ${fb(this.resourceId)}`}},db=mb;o(mb,"Task");var hb=class{constructor(e=G().tracer("util")){this.tracer=e;m(this,"_idToTasks",new Map)}async enqueue(e,t,r){let i=this._idToTasks.get(e)||[];i.length||this._idToTasks.set(e,i);let s=i.find(l=>l.isResponsibleFor(t));if(s)return this.tracer.verbose(()=>`Reusing pending task ${s}`),s.asyncResult;let a=o(l=>{let u=new db(this.tracer,e,t,r,l?l.asyncResult:void 0);return u.asyncResult.catch(_C).then(()=>{let p=i.shift();this.tracer.verbose(()=>`Garbage collected task ${p}`),p!==u&&(this.tracer.error(()=>`Garbage collection failed for task ${u}, collected ${p}`),this._idToTasks.set(e,[]))}),i.push(u),u.asyncResult},"createTask"),c=je(i);return c?c.state==="queued"?(c.rebase(t,r),c.asyncResult):a(c):a()}},fc=hb;o(hb,"TaskManager"),x([F("workspace",{traceLevel:6,argumentsRenderer:n=>`${fb(n[0])} %${n[1]}`,resultRenderer:(n,e)=>`${fb(e[0])} %${e[1]}`})],fc.prototype,"enqueue",1);function _C(){}o(_C,"nop");function fb(n,e=200){return n.length<=e?n:n.slice(0,e)+"..."}o(fb,"abbrev");var SU="Disable until restart";function OC(n,e){return(t,r,i)=>{let s=i.value,a=[];async function c(l){let u=this.languageServer;if(!u)return;let p=l.elapsedNanos/BigInt(1e6);if(!u.options.getUserSetting("cds.contributions.enablement.longRunning.detect"))return;let f=u.options.getUserSetting("cds.contributions.enablement.longRunning.maxMillis");if(p<f)return;a.push(Date.now());let g=u.options.getUserSetting("cds.contributions.enablement.longRunning.repeats");if(a.length!==g)return;let h=je(a)-a[0];a.shift();let T=u.options.getUserSetting("cds.contributions.enablement.longRunning.timeFrameSeconds");if(h>=T*1e3)return;let S=SU;await u.userInterface.userPopup("Warning","Fiori/OData annotation plugin is running slow",S,"Ignore")===S&&u.options.setUserSettingTemporarily(n,!1)}return o(c,"checkFootprint"),i.value=o(async function(...u){let p=new xi;try{return this.languageServer.options.getUserSetting(n)?await s.call(this,...u):e}finally{await c.call(this,p)}},"trackFootprint"),i}}o(OC,"ControlFootprint");var Bu="0.cursorPosition",xr={traceComponent:"contribution",traceLevel:6},ju=Object.freeze({diagnostics:new Map,annotationIndex:[]}),gb=class{constructor(e,t,r,i,s,a){this.languageServer=e;this.name=t;this.description=r;this.external=i;this.version=s;this.root=a;m(this,"context")}async initialize(e){return e.trace.info(()=>`Initializing external annotation handler '${this.name}@${this.version}' ...`),this.context=e,this.external.initialize?.(e)}async fetchDiagnostics(e){let t=await this.external.fetchDiagnostics?.(e)??new Map;for(let[r,i]of t.entries())t.set(r,i.filter(TU));return t}async fetchQuickfixes(e){return await this.external.fetchQuickfixes?.(e)??[]}async fetchCompletions(e){return await this.external.fetchCompletions?.(e)??[]}async fetchHover(e){return this.external.fetchHover?.(e)}async fetchDefinition(e){return this.external.fetchDefinition?.(e)}async fetchReferences(e){return this.external.fetchReferences?.(e)}async fetchSemanticTokens(e){return await this.external.fetchSemanticTokens?.(e)??[]}async indexAnnotationIdentifiers(e){return await this.external.indexAnnotationIdentifiers?.(e)??[]}async indexAndValidate(e){return await this.external.indexAndValidate?.(e)??ju}},Yt=gb;o(gb,"InternalAnnotationHandler"),x([F("contribution",{argumentsRenderer:R.nothing}),Q({fallback:re,...xr})],Yt.prototype,"initialize",1),x([F("contribution",{argumentsRenderer:Kt("0.uris.0"),resultRenderer:R.map}),OC("cds.contributions.enablement.odata",new Map),Q({fallback:()=>new Map,...xr})],Yt.prototype,"fetchDiagnostics",1),x([F("contribution",{argumentsRenderer:Kt("0.textDocument.uri"),resultRenderer:R.array}),Q({fallback:Ee,...xr})],Yt.prototype,"fetchQuickfixes",1),x([F("contribution",{argumentsRenderer:Kt(Bu)}),Q({fallback:Ee,...xr})],Yt.prototype,"fetchCompletions",1),x([F("contribution",{argumentsRenderer:Kt(Bu)}),Q({fallback:re,...xr})],Yt.prototype,"fetchHover",1),x([F("contribution",{argumentsRenderer:Kt(Bu)}),Q({fallback:re,...xr})],Yt.prototype,"fetchDefinition",1),x([F("contribution",{argumentsRenderer:Kt(Bu)}),Q({fallback:Ee,...xr})],Yt.prototype,"fetchReferences",1),x([F("contribution",{argumentsRenderer:Kt("0.uri"),resultRenderer:n=>`${n.length} tokens`}),Q({fallback:Ee,...xr})],Yt.prototype,"fetchSemanticTokens",1),x([F("contribution",{argumentsRenderer:R.nothing,resultRenderer:n=>`${n.length} entries`}),Q({fallback:Ee,...xr})],Yt.prototype,"indexAnnotationIdentifiers",1),x([F("contribution",{argumentsRenderer:R.nothing,resultRenderer:n=>`${n.annotationIndex.length} entries, ${n.diagnostics.size} diagnostics`}),Q({fallback:()=>({diagnostics:new Map,annotationIndex:[]}),...xr})],Yt.prototype,"indexAndValidate",1);function TU(n){return n.range?!0:(G().tracer("contribution").warn(()=>`Ignoring diagnostic w/o range: ${R.asIs(n)}`),!1)}o(TU,"ensureRange");var Gu=K(require("path"));function kU(n){let e=n.getArtifactName??(t=>t.name);return n.getArtifactName=t=>t?e(t):void 0,n.createToolbox=()=>ne().createToolbox(n),n}o(kU,"polyfillHelpers");function Vu(n){if(!n)return;let e=n.$lsp;return e.version=()=>n.version(),e.__loadedFrom=n.__loadedFrom,e.__logicalLocation=n.__logicalLocation,kU(e)}o(Vu,"compilerOf");var MC=K(require("os")),UC=K(require("path"));var bb=class{constructor(){m(this,"fs");this.fs=ne().getFileSystem()}_resolveId(e,t){let r,i=o(()=>{let s=UC.resolve(t,e);return this.fs.existsSync(s)?s:void 0},"relativeResolve");try{r=e.startsWith(".")?i():require.resolve(e,{paths:[t]})}catch{G().tracer("workspace").verbose(()=>`Could not resolve id '${Ne.warn(e)}' from ${t}`)}return r}resolveId(e,t){return this._resolveId(e,t)}reset(){Pe.clear(this)}getPlatform(){return MC.platform()}getEnv(e){let t=Object.keys(process.env).find(r=>r.toLowerCase()===e.toLowerCase());return t&&process.env[t]}getLspFolder(){return Ft}},Ci=bb;o(bb,"PathResolver"),x([F("util",{traceLevel:7})],Ci.prototype,"_resolveId",1),x([Pe({key:([n,e])=>`${n}:${e}`})],Ci.prototype,"resolveId",1),x([F("util",{traceLevel:6})],Ci.prototype,"getEnv",1),x([F("util")],Ci.prototype,"getLspFolder",1);function mc(){return{traceComponent:"util",traceLevel:4,fallback:re}}o(mc,"warnAndReturnUndefined");var vb="(compiler)",Ps="NOT EXISTS",yb=class{constructor(e){this._resolvedGlobalSapCdsHome=e;m(this,"resolver",new Ci);m(this,"_globalCds");m(this,"_projectCds",new Map);m(this,"_globalCompiler");m(this,"_projectCompiler",new Map);m(this,"_builtinCompiler")}loadCds(e){global.cds=void 0;let t=this.loadProjectCds(e)??this.loadGlobalCds()??this.notInstalled("Could not resolve @sap/cds");return global.cds=t,t}loadCompiler(e){return this.loadProjectCompiler(e)??this.loadGlobalCompiler()??this.loadBuiltInCompiler()??this.notInstalled("No compiler installed")}notInstalled(e){throw new Error(e)}getGlobalCdsHome(){return this._resolvedGlobalSapCdsHome||(this._resolvedGlobalSapCdsHome=this.execSync("cds",["-e",".home"],Gu.resolve("/"))),this._resolvedGlobalSapCdsHome}getProjectCdsHome(e){let t=require.resolve("@sap/cds/package.json",{paths:[e]});return t&&Gu.dirname(t)}loadGlobalCds(){if(!this._globalCds){let e=this.getGlobalCdsHome(),t=e&&this.resolveId("@sap/cds",e);this._globalCds=this.requireModule("globally installed",t)}return this._globalCds}loadProjectCds(e){let t=this._projectCds.get(e);if(!t){let r=this.getProjectCdsHome(e);t=this.requireModule("from project",r),t&&this._projectCds.set(e,t)}return t}loadGlobalCompiler(){if(!this._globalCompiler){let e=this.getGlobalCdsHome(),t=e&&this.resolveId("@sap/cds-compiler",e);this._globalCompiler=Vu(this.requireModule("globally installed",t))}return this._globalCompiler}loadProjectCompiler(e){let t=this._projectCompiler.get(e);if(!t){let r=this.resolveId("@sap/cds-compiler",e);t=Vu(this.requireModule("from project",r)),t&&this._projectCompiler.set(e,t)}return t}loadBuiltInCompiler(){if(!this._builtinCompiler){let e=this.resolver.getLspFolder(),t=this.resolveId("@sap/cds-compiler",e),r=this.requireModule("included in Language Server",t)??this.notInstalled("Built-in compiler is missing");this._builtinCompiler=Vu(r)}return this._builtinCompiler}resolveId(e,t){return this.resolver.resolveId(e,t)}requireModule(e,t){if(!t)return;let r=require(t);return r.__loadedFrom=t,r.__logicalLocation=e,r}execSync(e,t=[],r){return Vt.runSync(e,t,{cwd:r,encoding:"utf8"}).stdout}},Gt=yb;o(yb,"ModuleLoader"),m(Gt,"GLOBAL_CDS_HOME_ARG","--globalCdsHome="),x([F("util")],Gt.prototype,"getGlobalCdsHome",1),x([F("util"),Q({fallback:re,traceComponent:"util",traceLevel:4})],Gt.prototype,"getProjectCdsHome",1),x([F("util",{resultRenderer:n=>n?"(cds)":Ps}),Q(mc())],Gt.prototype,"loadGlobalCds",1),x([F("util",{resultRenderer:n=>n?"(cds)":Ps}),Q(mc())],Gt.prototype,"loadProjectCds",1),x([F("util",{resultRenderer:n=>n?vb:Ps}),Q(mc())],Gt.prototype,"loadGlobalCompiler",1),x([F("util",{resultRenderer:n=>n?vb:Ps}),Q(mc())],Gt.prototype,"loadProjectCompiler",1),x([F("util",{resultRenderer:n=>n?vb:Ps}),Q(mc())],Gt.prototype,"loadBuiltInCompiler",1),x([F("util",{resultRenderer:n=>n?`${n.__logicalLocation}`:Ps})],Gt.prototype,"requireModule",1),x([Q({fallback:re,traceLevel:4,errorTrace:()=>"Locating global cds"})],Gt.prototype,"execSync",1);function Kr(){return{folders:{db:"db/",srv:"srv/",app:"app/"},i18n:{file:"i18n",folders:["i18n","_i18n","assets/i18n"],default_language:"en",fallback_bundle:""},cdsc:{},rootModels:{}}}o(Kr,"defaultEnv");var Hu=K(require("path")),qC=K(require("util"));var CU=o(()=>Kr(),"FB_DEFAULT_ENV"),Ib=class{constructor(e){this.moduleLoader=e}getEnv(e){let t=this._getEnv(e);return this.extendedTraceEnv(t),t}_getEnv(e){var u,p;if(!is("FETCH_ENV",!0))return Kr();let t=G().tracer("cdsenv");t.verbose(()=>"requiring @sap/cds");let r=this.moduleLoader.loadCds(e),s={...r.env.for("cds",e,!0)};this.retainChildren(s,["features","build","mtx","profiles","env","_home","_sources","folders","i18n","cdsc","roots"]),this.retainChildren(s.i18n,["folders","default_language","file","fallback_bundle"]),(u=s.i18n).file??(u.file="i18n"),(p=s.i18n).fallback_bundle??(p.fallback_bundle=""),t.verbose(()=>"resolving roots");let a=s.rootModels={},c=o(d=>Hu.relative(e,d).replaceAll(xn,ze),"absToRel"),l=o(d=>(r.resolve(d,{root:d})??[]).map(c),"resolve");return a["/"]=l(e),_a.forEach(d=>{let f=s.folders[d];f&&(a[d]=l(Hu.join(e,f)))}),s}retainChildren(e,t){let r=new Set(t);Object.keys(e).forEach(i=>!r.has(i)&&delete e[i])}extendedTraceEnv(e){wt.log({statName:"cds.env",stats:{raw:qC.inspect(e,{depth:null,compact:!1,sorted:!0,showProxy:!0})}})}},hc=Ib;o(Ib,"CdsEnv"),x([F("workspace"),Q({fallback:CU,traceComponent:"workspace"})],hc.prototype,"getEnv",1);var xb=class{constructor(e){this.languageServer=e}},Pi=xb;o(xb,"CommandHandler");var Sb=class extends Pi{constructor(){super(...arguments);m(this,"id","active-editor-changed")}async execute(t){for(let i of this.languageServer.workspaceService.workspaceFolders())i.workspaceSnapshot.activeEditor=void 0;let r=t.arguments[0].newActiveUri;if(r&&this.languageServer.fileSystem.isCdsSourceFile(r)){let i=this.languageServer.workspaceService.getWorkspaceFolder(r);if(i.workspaceSnapshot.activeEditor=r,this.languageServer.options.getUserSetting("cds.workspaceValidationMode")==="ActiveEditorOnly"){let s=i.workspaceSnapshot.fileIndexFor(r);(!s||s.isInvalidByChangedContent||s.isInvalidByChangedDependency)&&await i.triggerRevalidation([r])}}}},zu=Sb;o(Sb,"ActiveEditorChangedCommand");var Cr=K(require("path"));var Tb=class{constructor(e){this.dependencyProvider=e;m(this,"_transitiveDependencies",new Map)}getTransitiveDependencies(e,t=!1){let r=this._transitiveDependencies.get(e)??this.calculateTransitiveDependencies([e]).get(e);return r.isShared&&!t&&(r=new Set(r),r.delete(e),this._transitiveDependencies.set(e,r)),r}calculateTransitiveDependencies(e){let t=this._transitiveDependencies,r=o(a=>({into:c=>{for(let l of a)c.add(l)}}),"copy"),i=0,s=o((a=this.dependencyProvider)=>o(function c(l){i++;let u=t.get(l);if(u)return u;let p=new Set;t.set(l,p);let d=a.getDirectDependencies(l);r(d).into(p);for(let f of d){let g=c(f);g.has(l)?(r(p).into(g),p=g,t.set(l,p),g.isShared=!0):r(g).into(p)}return p},"followAndCollect"),"transitiveDeps");return e.forEach(a=>s()(a)),t.follows=i,t}},Mn=Tb;o(Tb,"DependencyCalculator");var So=K(require("path"));var kb=class{constructor(e,t){this._mainUri=e;this._workspaceVersion=t;m(this,"dependencyCalculator");m(this,"_implicitDefinitions",{builtIns:Ve(),implicitNamespaces:Ve(),freeAnnotations:Ve()});m(this,"_fileIndexes",Ve());let r=this;this.dependencyCalculator=new Mn({getDirectDependencies(i){return r.forUri(i).directDependentUris}})}getTransitiveDependencies(e){return this.dependencyCalculator.getTransitiveDependencies(e)}forUri(e,t="warnCreate"){let r=this._fileIndexes[e];if(!r){if(t==="noCreate")return;t==="warnCreate"&&G().tracer("model").warn(()=>`Access for uri ${e} in index ${this._mainUri} created empty file index`),r=ne().createFileIndex(e,this._workspaceVersion,this._implicitDefinitions),this._fileIndexes[e]=r}return r}get builtUris(){return Object.keys(this._fileIndexes)}},Rs=kb;o(kb,"BlitzIndex");var lp=K(require("util")),iP=K(Xe());var Cb=class{static get instance(){return ne().getModuleLoader().loadBuiltInCompiler()}},ar=Cb;o(Cb,"BuiltinCompiler");function ge(n){return!!n?.finalizeCategory}o(ge,"isRuleToken");function ye(n){return!!n?.children}o(ye,"isRuleNode");var PU=-1;function po(n,e,t){for(let r=e-1;r>=0;r--){let i=n[r];if(i&&(!t||t(i)))return i}}o(po,"getPreviousToken");function $C(n,e,t){for(let r=e+1;r<n.length;r++){let i=n[r];if(i&&(!t||t(i)))return i}}o($C,"getNextToken");function WC(n){return RU(n)?.type===PU?n.slice(0,-1):n}o(WC,"filterFinalEof");function As(n,e){let{type:t}=n;if(t===-1)return"<EOF>";if(e.literalNames[t])return"Operator";let r=e.symbolicNames[t];if(!r)return e.literalNames.includes(`'${n.text}'`)?"Operator":n.text.toLowerCase()==="virtual"?"Keyword":"<???>";if(r.toUpperCase()===r)return n.isIdentifier?"Identifier":"Keyword";switch(r){case"HelperToken1":case"HelperToken2":case"DOTbeforeBRACE":case"COMPOSITIONofBRACE":return"Operator";case"VIRTUAL":case"OVER":return"Keyword";case"GenericIntro":case"GenericSeparator":case"GenericExpr":return n.text==="*"?"Operator":"Keyword";default:return r}}o(As,"getCategory");function RU(n){return n?.[n.length-1]}o(RU,"last");function Ku(n,e){return n+AU(e)-1}o(Ku,"_endLine");function AU(n){return(n.match(Nt)||[]).length+1}o(AU,"lineCount");function Ri(n){if(n?.includes("i18n")){let e=/{\s*i18n\s*>\s*([^}']*)/.exec(n);if(e&&e[1]!==void 0)return e[1]}}o(Ri,"getTranslationId");function Pb(n,e){for(let t of n){let r=t();if(r)return r}return e}o(Pb,"tester");function Xr(n,e){let{start:t,end:r}=n;if(e.line<t.line)return"tokenAfterCursor";if(r.line<e.line)return"tokenBeforeCursor";function i(){return e.character<t.character?"tokenAfterCursor":void 0}o(i,"afterCursor");function s(){return e.character===t.character?"tokenStartsAtCursor":void 0}o(s,"startsAtCursor");function a(){return e.character<r.character?"tokenContainsCursor":void 0}o(a,"containsCursor");function c(){return e.character===r.character?"tokenEndsWithCursor":void 0}return o(c,"endsWithCursor"),t.line===r.line?Pb([i,s,a,c],"tokenBeforeCursor"):t.line===e.line?Pb([i,s],"tokenContainsCursor"):t.line<e.line&&e.line<r.line?"tokenContainsCursor":r.line===e.line?Pb([a,c],"tokenBeforeCursor"):"tokenBeforeCursor"}o(Xr,"rangeRelativeToCursor");function Rn(n,e,t=0,r=n.length-1){return typeof e=="number"?ao(n,e,(i,s)=>i.tokenIndex-s,t,r):ao(n,e,(i,s)=>i.compare(s),t,r)}o(Rn,"findToken");function fo(n,e){return BC(n,-1,e)}o(fo,"getPreviousSibling");function Zt(n,e){return BC(n,1,e)}o(Zt,"getNextSibling");function BC(n,e,t){if(!n)return null;let r=n.parent?.children;if(!r)return null;let i=r.indexOf(n);for(let s=i+e;0<=s&&s<r.length;s+=e){let a=r[s];if(!t||t(a))return a}return null}o(BC,"getAdjacentSibling");function jC(n,e){return Ju(n,1,e)}o(jC,"getFirstDescendant");function VC(n,e){return Ju(n,-1,e)}o(VC,"getLastDescendant");function Ju(n,e,t){if(!n)return null;let r=n.children.length;if(r===0&&(!t||t(n)))return n;for(let i=e>0?0:r-1;0<=i&&i<r;i+=e){let s=n.children[i];if(t&&!t(s))continue;if(ge(s))return s;let a=Ju(s,e,t);if(a)return a}return null}o(Ju,"getFirstOrLastDescendant");function Ai(n,e){return Xu(n,-1,e)}o(Ai,"getPreviousToken");function GC(n,e){return Xu(n,1,e)}o(GC,"getNextToken");function Xu(n,e,t){if(!n)return null;let r=n.parent?.children;if(r)for(let i=r.indexOf(n)+e;0<=i&&i<r.length;i+=e){let s=r[i];if(t&&!t(s))continue;if(ge(s))return s;let a=Ju(s,e,t);if(a)return ge(a)?a:Xu(a,e,t)}return Xu(n.parent,e,t)}o(Xu,"getAdjacentToken");function Qu(n,e){return ge(e)?n.push(e):n=e.children.reduce(Qu,n),n}o(Qu,"getTokens");function Yu(n){return n.parser.ruleNames[n.ruleIndex]}o(Yu,"getRuleName");function Un(n){return ye(n)?n.ruleName:void 0}o(Un,"ruleName");var LU=["start","actionFunctionDef","actionFunctionMainDef","annotateElement","annotationAssignment_atn","annotationAssignment_fix","annotationAssignment_ll1","annotationAssignment_1","annotationAssignment_paren","annotationDef","annoValue","annoSubValue","artifactDefOrExtend","cardinalityAndFilter","condition","conditionTerm","contextDef","elementDef","elementDefInner","elementDefOrExtend","elementType","entityDef","expression","extendArtifact","extendContext","extendProjection","flattenedValue","usingProxy","mixinElementDef","namedValue","namespaceDeclaration","orderBySpec","parameterListDef","projectionExclusion","projectionSpec","queryExpression","queryTerm","queryPrimary","returnTypeSpec","selectItemDef","selectItemInlineList","serviceDef","tableExpression","typeAssociationBase","typeAssociationCont","typeAssociationElementCont","typeCompoStruct","typeDef","typeNamedArg","typeNamedArgList","typeRefArgs","typeRefOptArgs","typeSpecSemi","typeStruct","usingDeclaration","viewDef"],E=EU(Object.create(null));function HC(n){return E[n]===n}o(HC,"isBlockRule");function EU(n){return LU.forEach(e=>n[e]=e),Object.freeze(n)}o(EU,"assignKeyNamesAsValueAndFreeze");var Rb=class{constructor(e,t){m(this,"id");m(this,"_category","<???>");m(this,"_identifierCategory");m(this,"startOffset");m(this,"_line");m(this,"_character");m(this,"_endLine");m(this,"_endCharacter");m(this,"_tokenIndex");m(this,"_text");m(this,"originalText");m(this,"ejected",!1);this._tokenIndex=e.tokenIndex,this._text=this.originalText=e.text,this.id=`#${this._tokenIndex} ${this.text}`,this.deriveCategory(e,t),this._line=e.line-1,this._character=e.column,this.startOffset=e.start}get endOffset(){return this.startOffset+this.text.length-1}deriveCategory(e,t){this._category=t,this._identifierCategory=e.isIdentifier}get category(){return this._category}get identifierCategory(){return this._identifierCategory}get line(){return this._line}setLine(e){this._line=e,this._endLine=void 0}get character(){return this._character}set character(e){this._character=e,this._endCharacter=void 0}get text(){return this._text}set text(e){this._text=e,this._endLine=void 0,this._endCharacter=void 0}get endLine(){return this._endLine===void 0&&(this._endLine=Ku(this.line,this.text)),this._endLine}get endCharacter(){if(this._endCharacter===void 0){let e=this.text.lastIndexOf(`
`);e===-1?this._endCharacter=this.character+this.text.length:this._endCharacter=this.text.length-e-1}return this._endCharacter}getLowerLexem(){return this.text.toLowerCase()}get tokenIndex(){return this._tokenIndex}get startTokenIndex(){return this.tokenIndex}compare(e){return pC(this,e)}isIdentifier(){return this.category==="Identifier"}isOperator(){return this.category==="Operator"}isKeyword(){return this.category==="Keyword"}isComment(){return this.category==="Comment"||this.category==="LineComment"||this.category==="DocComment"}isLineComment(){return this.category==="LineComment"}isBlockComment(){return this.isComment()&&!this.text.startsWith("//")}isDocComment(){return this.isBlockComment()&&this.text.startsWith("/**")}isSingleLined(){return this.line===this.endLine}toString(){return this.text}relativeToCursor(e){return Xr(this,e)}get end(){return{line:this.endLine,character:this.endCharacter}}get start(){return{line:this.line,character:this.character}}},Ls=Rb;o(Rb,"Token");var Ab=class extends Ls{constructor(t,r,i,s,a=!1){super(i,s);this.context=t;this.parent=r;this.isErrorToken=a;m(this,"followUpLineEndCommentToken")}finalizeCategory(t,r){this.deriveCategory(t,r)}clone(t){let r=Object.create(this);return t.text!==void 0&&(r.text=t.text),t.line!==void 0&&r.setLine(t.line),t.character!==void 0&&(r.character=t.character),t.startOffset!==void 0&&(r.startOffset=t.startOffset),r}isInlineComment(){let t=this.getNextToken();return this.isBlockComment()&&this.isSingleLined()&&!!t&&this.endLine===t.line}isFollowUpComment(){if(!this.isComment())return!1;let t=this.getPreviousToken();return t?t.endLine===this.line:!1}getFollowUpLineEndComment(){return this.followUpLineEndCommentToken}getPreviousToken(t){return po(this.context.ruleTokens,this.tokenIndex,t)}getNextToken(t){return $C(this.context.ruleTokens,this.tokenIndex,t)}isCqlKeyword(){if(!this.isKeyword())return!1;let t=this.parent;for(;t;){if(t.ruleName==="queryExpression")return!0;t=t.parent}return!1}},Sr=Ab;o(Ab,"RuleToken");function Li(n){return n._al_annoNumberInLine??1}o(Li,"getAnnotationNumberInLine");function zC(n,e){return n._al_annoNumberInLine=e}o(zC,"setAnnotationNumberInLine");function*mo(n,e){let t=n.parent;for(;t;)(!e||e(t))&&(yield t),t=t.parent}o(mo,"getAncestors");function ce(n,...e){for(let t of mo(n))if(e.includes(t.ruleName))return t;return null}o(ce,"getNearestAncestor");function Zu(n,...e){let t=null;for(let r of mo(n))e.includes(r.ruleName)&&(t=r);return t}o(Zu,"getFarthestAncestor");function KC(n,e){for(let t of mo(e))if(t===n)return!0;return!1}o(KC,"hasDescendant");function _9(n,...e){let t=n;for(let r of e){if(!ye(t))throw new Error(`not a RuleNode: ${t.id}`);if(!t.children[r])throw new Error(`index ${r} not set in children of ${t.id}`);t=t.children[r]}return t}o(_9,"getDescendant");function Ht(n){return ye(n)||!n.isComment()}o(Ht,"nonComment");function gc(n,...e){return n.children.filter(t=>ye(t)&&e.includes(t.ruleName)||ge(t)&&t.isKeyword()&&e.includes(t.text)).length}o(gc,"countDirectChildren");function Lb(n,...e){function t(r,i){return r+(ye(i)?e.includes(i.ruleName)?1:Lb(i,...e):0)}return o(t,"countRecursively"),n.children.reduce(t,0)}o(Lb,"countDescendants");function XC(n,e,t){let r=n.children,i=t?.tokenIndex??-1;for(let s of r)if(s instanceof Sr){if(s.text===e&&s.tokenIndex>i)return s}else{let a=XC(s,e,t);if(a)return a}return null}o(XC,"findTokenInDescendants");function JC(n,e,t){let r=XC(n,t,e);return r?r.tokenIndex-1-e.tokenIndex:-1}o(JC,"countTokensBetween");function Eb(n,e){for(let t=n.length-1;t>=0;t--){let r=n[t];if(e(r))return r}}o(Eb,"reverseFind");function xe(n){return ge(n)&&(n.isKeyword()||n.isOperator())?n.getLowerLexem():void 0}o(xe,"lowerLexem");var ho=K(Xe());var wb=class{constructor(e){this.completionRequest=e;m(this,"tracer",G().tracer("completion"));m(this,"name");this.name=this.constructor.name}async fetchList(e){return{items:await this.fetchProposals(e),isIncomplete:!1}}async resolve(e){}},en=wb;o(wb,"ProposalsProvider");var ep="\u2026";function QC(n){if(n?.data?.providerName)return n.data}o(QC,"asProposalData");var YC=K(Xe());function Jr(n,e,t,r){let i=e;return t&&(i=e.startsWith(".")?"":e.split(".")[0]),YC.Range.create(r.line,r.character-n.length,r.line,r.character+i.length)}o(Jr,"replacementRange");var tp=class extends en{async fetchProposals(e){return e.keywordMap.identifier!==void 0?(delete e.keywordMap.identifier,this.fetchPossibleIdentifierItems(e)):[]}async fetchPossibleIdentifierItems(e){let t=await e.compile(e,tp.IDENTIFIER_INLAY),r=t.options.messages;r=r.filter(s=>t.toolbox.filterMessagesInScope(e.position,s,0));let i=[];for(let s of r)i=i.concat(this.extractIdentifiersFromCompileMessage(s,e,Jr(e.prefix,e.suffix,!0,e.position)));return i}extractIdentifiersFromCompileMessage({severity:e,validNames:t},{prefix:r,position:i,triggerUri:s,parseAst:a},c){if(!t)return[];let l=[],u=this.completionRequest.languageServer.options.getClientCapability("capabilities.textDocument.completion.completionItem.snippetSupport",!1);for(let[p,d]of Object.entries(t))if(this.completionRequest.matchesPrefix(!0,r,p,d.name.absolute||d.name.id)){let f=d.builtin?"2)":"1)",g=this.prepareCompletionItem(p,f,e,d,c);if(this.attachDocumentationLink(a.toolbox,f,s,d,g,i),l.push(g),d.parameters?.length&&u){let h=this.createParameterSnippet(g,d.parameters,c,p);l.push(h)}}return l}createParameterSnippet(e,t,r,i){let s=Xt(JSON.stringify(e));s.label+="(\u2026)";let a=t.map((c,l)=>`\${${l+1}:<${c}>}`).join(", ");return s.textEdit=ho.TextEdit.replace(r,`${i}(${a})`),s.insertTextFormat=ho.InsertTextFormat.Snippet,s.kind=ho.CompletionItemKind.Snippet,s}attachDocumentationLink(e,t,r,i,s,a){if(t==="1)"){let c=this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(r),l=this.adaptLocation(e,i,c.adapter);l&&(this.completionRequest.documentationProposals.attachDocsForDefinition(s,c.documentationProvider,l),s.data.position={...a},s.data.url=r)}}adaptLocation(e,t,r){if(!t)return null;let i=this.getSymbolLocation(e,t);if(!i)return null;let s=r.ensureAbsolutePath(i.file);return{uri:r.toUri(s),range:yr.adapt(i)}}getSymbolLocation(e,t){let r=t;return e.locationOf(ar.instance.getArtifactName(r))||e.locationOf(r)}prepareCompletionItem(e,t,r,i,s){return{label:e,sortText:t+Si.adapt(r)+e,kind:aC(i.kind),textEdit:ho.TextEdit.replace(s,e),commitCharacters:["."],data:{}}}},Tr=tp;o(tp,"IdentifierProposals"),m(Tr,"IDENTIFIER_INLAY","xx_xx_xx_xx_xx_xx_xx"),x([F("completion",{scope:"Compiling @ beginning of prefix",argumentsRenderer:R.nothing})],Tr.prototype,"fetchPossibleIdentifierItems",1),x([F("completion",{traceLevel:6,argumentsRenderer:wU,resultRenderer:R.nothing}),Q({fallback:Ee,traceComponent:"completion",traceLevel:6})],Tr.prototype,"extractIdentifiersFromCompileMessage",1),x([Q({fallback:()=>null,traceLevel:4,traceComponent:"completion"})],Tr.prototype,"adaptLocation",1);function wU(n){return`Raw suggestions: ${Lt(Ii(n.validNames??{}).map(([e,t])=>`${t.kind} ${e}`))}`}o(wU,"renderRawSuggestions");var nP=K(require("path"));var Db=class{constructor(e,t){this.uri=t;m(this,"tokenIndex");m(this,"text");m(this,"line");m(this,"character");m(this,"annotationValue");this.text=e.text,this.line=e.line,this.character=e.character,this.tokenIndex=e.tokenIndex}toString(){return`${this.text}@${this.line}:${this.character}`}get range(){return{start:{line:this.line,character:this.character},end:{line:this.line,character:this.character+this.text.length}}}get location(){return{uri:this.uri,range:this.range}}compare(e){let t=this.line-e.line;return t===0?(t=e.character-this.character,t<0?1:t<=this.text.length?0:-1):Math.sign(t)}},bc=Db;o(Db,"GenericToken");var Nb=class extends bc{constructor(t,r,i){super({text:t,line:r.line,character:r.character,tokenIndex:r.tokenIndex},r.uri);this.carrier=i;m(this,"carrierName","");m(this,"carrierNameRange");m(this,"_range")}overwriteText(t){this.text=t,this._range=void 0}get range(){if(!this._range){let t=this.text.split(Nt);this._range={start:{line:this.line,character:this.character},end:{line:this.line+t.length-1,character:t.length===1?this.character+this.text.length:je(t).length}}}return this._range}compare(t){switch(Xr(this.range,t)){case"tokenBeforeCursor":return-1;case"tokenAfterCursor":return 1;default:return 0}}},np=Nb;o(Nb,"AnnotationAssignmentToken");var ip,ZC,op,eP,sp,tP,_b=class extends bc{constructor(){super(...arguments);ns(this,ip);ns(this,op);ns(this,sp);m(this,"_definition")}get definitions(){return this._definition}addDefinition(t){return this._definition===void 0?rs(this,ip,ZC).call(this,t):Array.isArray(this._definition)?rs(this,sp,tP).call(this,t,this._definition):rs(this,op,eP).call(this,t,this._definition)}traceAddAdditionalDefinition(t,r){let i=G().tracer("model-todos");if(i.isTracing(6)){let s=t.symbolName===t.absoluteName?`${t.symbolName}`:`sym:${t.symbolName}/abs:${t.absoluteName}`,a=r.symbolName===r.absoluteName?`${r.symbolName}`:`sym:${r.symbolName}/abs:${r.absoluteName}`;i.warn(()=>`Trying to redefine Token ${this.text}@${this.uri}#${this.line}:${this.character} definition ${s} with different definition ${a}`)}}},cr=_b;ip=new WeakSet,ZC=o(function(t){this._definition=t},"#addFirstDefinition"),op=new WeakSet,eP=o(function(t,r){t!==r&&(this.traceAddAdditionalDefinition(r,t),this._definition=[r,t])},"#addSecondDefinition"),sp=new WeakSet,tP=o(function(t,r){for(let i of r)if(t===i)return;this.traceAddAdditionalDefinition(r[0],t),r.push(t)},"#addMultipleDefinition"),o(_b,"IdentifierToken");var Ob=class extends bc{constructor(){super(...arguments);m(this,"translationId");m(this,"isUsingPath")}},Es=Ob;o(Ob,"StringLiteralToken");var Mb=class{constructor(e,t,r=e){this.symbolName=e;this.kind=t;this.absoluteName=r}get fullyQualifiedName(){return this.symbolName}},rp=Mb;o(Mb,"GenericDefinition");var Ub=class extends rp{constructor(t,r,i,s,a){super(t,r,a?.absoluteName??t);this.location=i;this.nameLocation=s;m(this,"baseDefinitions",new Set);m(this,"isExtend");m(this,"isAutoexposed");m(this,"docComment");m(this,"_annotationReferences",Ve());t!==this.absoluteName&&G().tracer("model").warn(()=>`Name mismatch: fqn=${t}, abs=${this.absoluteName}`),a&&(this.isExtend=a.isExtend,this.isAutoexposed=a.isAutoexposed,this.docComment=a.docComment)}get line(){return this.nameLocation.range.start.line}get character(){return this.nameLocation.range.start.character}addBaseDefinition(t){this.baseDefinitions.add(t)}addAnnotationReference(t,r){let i=this._annotationReferences[t];i?Array.isArray(i)?i.includes(r)?G().tracer("model").warn(()=>`Annotation reference '${t}' already known: ${r}`):i.push(r):i===r?G().tracer("model").warn(()=>`Annotation reference '${t}' already known: ${i}`):this._annotationReferences[t]=[i,r]:this._annotationReferences[t]=r}annotation(t){return this._annotationReferences[t]}},yt=Ub;o(Ub,"ExplicitDefinition");var qb=class extends rp{},Ei=qb;o(qb,"ImplicitDefinition");var $b=class extends Ei{},ws=$b;o($b,"BuiltinDefinition");var Wb=class extends Ei{},Fs=Wb;o(Wb,"FreeAnnotationDefinition");var Bb=class extends Ei{constructor(t,r,i){super(t,"namespace");this.nameLocation=r;this.location=i}},Yr=Bb;o(Bb,"ImplicitNamespaceDefinition");function FU(n,e){return n.sort((t,r)=>{let i=e(t),s=e(r),a=i.uri.localeCompare(s.uri);return a||(a=i.range.start.line-s.range.start.line,a||(a=i.range.start.character-s.range.start.character)),a})}o(FU,"sortLocations");function go(n,e){return FU(n,e).filter((t,r,i)=>r===0||co(e(i[r-1]),e(t)))}o(go,"sortAndUniqueLocations");function Fb(n,e){return n instanceof Yr?e instanceof Yr?n.absoluteName.localeCompare(e.absoluteName):-1:e instanceof Yr?1:co(n.location,e.location)||e.symbolName.length-n.symbolName.length}o(Fb,"compareDefs");var bo="__$__$__";function jb(n=!1){return e=>{let t=Ds(e);return n&&(t.name=e.kind+": "+t.name),t}}o(jb,"totoSymbolInfo");function Ds(n){let e=n.symbolName.split("."),t=o(s=>s.nameLocation,"locationOfImplicitDef"),r=n instanceof yt?n.location:t(n),i=Au(n.kind);switch(n.kind){case"context":case"service":case"namespace":return{name:n.symbolName,containerName:"",location:r,kind:i};default:return{name:vo(n,e),containerName:e.slice(0,-1).join("."),location:r,kind:i}}}o(Ds,"toSymbolInfo");function*Vb(n){let e=n.split(".").slice(0,-1);for(let t=e.length;t>0;t--)yield e.slice(0,t).join(".")}o(Vb,"possibleContainerNameAndName");function vo(n,e=n.symbolName.split(".")){return je(e)}o(vo,"shortName");function vc(n){return n.kind==="annotation"||n instanceof Fs}o(vc,"isAnnotationDefinition");function Ns(n){let e=new Set;function t(r){if(!e.has(r)&&(e.add(r),r instanceof yt))for(let i of r.baseDefinitions)t(i)}return o(t,"followDef"),_t(n).forEach(t),e}o(Ns,"allDownstreamDefinitions");function ap(n){for(let e of _t(n)){if(e instanceof yt)for(let t of e.baseDefinitions)return ap(t);return e}}o(ap,"baseDefinition");function _t(n){return n?Array.isArray(n)?n:[n]:[]}o(_t,"flatten");var Gb=class{constructor(e,t){this.tracer=e;this.context=t;m(this,"uniq",new qu);m(this,"namePrefixTokenToThing",new Map)}handleLocalized(e){return e.fullyQualifiedName==="localized"||e.fullyQualifiedName.startsWith("localized.")?!0:(e.fullyQualifiedName.endsWith(".localized")&&this.tracer.warn(()=>`Localized: ${e.fullyQualifiedName} ${e.thing.kind} ${e.thing.$inferred}`),!1)}handleBuiltIn(e){let{thing:t}=e;if(t.builtin&&!this.context.index._implicitDefinitions.builtIns[e.fullyQualifiedName]){let r=new ws(e.compiler.getArtifactName(t).absolute,t.kind);return this.context.index._implicitDefinitions.builtIns[r.absoluteName]=r,!0}return!1}handleNamespace(e){let t=e.thing;if(!t||t.kind!=="namespace")return!1;let r=e.compiler.getArtifactName(t).absolute,i=e.toolbox.nameLocation(t);if(e.toolbox.isImplicitNamespace(t))return this.context.index._implicitDefinitions.implicitNamespaces[r]=new Yr(r,this.context.toLspLocation(i),this.context.toLspLocation(e.toolbox.locationOf(t))),!0;let s=e.toolbox.locationOf(t),a=new yt(r,e.toolbox.expectedKindOf(t),this.context.toLspLocation(s),this.context.toLspLocation(i));return this.context.index.forUri(a.nameLocation.uri,"create")._explicitNamespaces[r]=a,this.attachToToken(a,t),!0}attachToToken(e,t){let r=e.nameLocation.range.start,i=e.nameLocation.uri,s=this.context._identifierTokens.forUri(i),a=s?.firstAt(r);if(!a){let c=ao(this.context.index.forUri(i).tokens,r,(l,u)=>l.compare(u));c?.text==="returns"&&c.isKeyword()&&(a=this.context.index.forUri(i).addIdentifierToken(c,!0),this.context._identifierTokens.addOccurrence(a,a))}a instanceof cr&&(a.addDefinition(e),this.prepareWorkaroundForPreviousNamespaceToken(a.tokenIndex,this.context.index.forUri(i).tokens,t,s))}prepareWorkaroundForPreviousNamespaceToken(e,t,r,i){if(!r?._parent)return;let s=po(t,e,a=>!a.isComment());if(s?.isOperator()&&s.text==="."){let a=po(t,s.tokenIndex,c=>!c.isComment());if(a?.isIdentifier()){let c=i.firstAt(a);c.definitions===void 0&&this.namePrefixTokenToThing.set(c,r._parent),this.prepareWorkaroundForPreviousNamespaceToken(c.tokenIndex,t,r._parent,i)}}}onDefinitionFound(e){let{thing:t}=e,{toolbox:r}=e;if(this.handleLocalized(e)||this.handleBuiltIn(e)||this.handleNamespace(e))return;let i=_t(r.resolve(t)),s=r.nameLocation(t);for(let f of i){let g=r.nameLocation(f);if(g&&s&&g.file===s.file&&g.line===s.line&&g.col===s.col&&(g.endLine<s.endLine||g.endLine===s.endLine&&g.endCol<s.endCol)){this.onDefinitionFound({...e,thing:f});return}}let a=r.locationOf(t),c=e.fullyQualifiedName=this.uniq.uniquify(e.fullyQualifiedName),l=this.uniq.uniquify(r.absoluteNameOf(t)??c),u=i.filter(f=>f!==t),p=new yt(c,r.expectedKindOf(t),this.context.toLspLocation(a),this.context.toLspLocation(r.nameLocation(t)),{absoluteName:l,isExtend:r.getKind(t)==="extend"||r.getKind(t)==="aspect",docComment:t.doc?.val,isAutoexposed:r.isAutoexposed(t)});if(this.tracer.isTracing(7)){let f=o(T=>`${nP.basename(T.uri)}[${T.range.start.line}:${T.range.start.character}-${T.range.end.line}:${T.range.end.character}]`,"printLoc"),g=p.nameLocation.uri!==p.location.uri&&p.kind!=="context"?f(p.location):"",h=g?"error":c.includes("_texts")?"warn":"debug";this.tracer[h](()=>`@@@ onDefinitionFound: ${c}@${f(p.nameLocation)} ${g}`)}if(r.isAutoexposed(t)&&t.name.absolute.endsWith(".texts"))return;let d=this.context.index.forUri(p.nameLocation.uri,"create");if(d._definitions.addOccurrence(p,p.nameLocation.range.start),this.attachToToken(p,i[0]),p.kind==="annotation")this.context.index._implicitDefinitions.freeAnnotations[c]=p;else if(p.kind==="element"){let g=c.split(".").slice(0,-1).join(".");this.context.index._implicitDefinitions.freeAnnotations[g]&&(this.context.index._implicitDefinitions.freeAnnotations[c]=p)}u.map(f=>this.context.toLspLocation(r.nameLocation(f))).forEach(f=>{if(f){let g=this.context.index.forUri(f.uri).definitionAt(f.range.start);g instanceof yt&&(p.addBaseDefinition(g),d.addRedefinition(p,g))}})}},cp=Gb;o(Gb,"DefinitionIndexer");var rP=K(Xe());var Hb=class{constructor(){m(this,"_positions",new Map);m(this,"_multiplier",1e4)}firstAt(e){let t=this.hashFor(e),r=this._positions.get(t);return Array.isArray(r)?r[0]:r}addOccurrence(e,t){let r=this.hashFor(t),i=this._positions.get(r);Array.isArray(i)?i.push(e):this._positions.set(r,i?[i,e]:e)}*yieldTargets(e){if(!e){yield*this.yieldAll();return}let t=this._positions.get(this.hashFor(e));yield*this.yieldTarget(t)}*yieldAll(){for(let e of this._positions.values())yield*this.yieldTarget(e)}*yieldTarget(e){if(Array.isArray(e)){yield*e;return}e&&(yield e)}hashFor(e){return e.character>=this._multiplier&&this.rehash(e.character+1),e.line*this._multiplier+e.character}rehash(e){let t=this._multiplier;this._multiplier=this.secondNextPowerOf10(e);let r=[...this._positions.entries()];this._positions.clear();for(let[i,s]of r){let a=i%t,c=Math.floor(i/t);this._positions.set(this.hashFor({line:c,character:a}),s)}}secondNextPowerOf10(e){return Math.pow(10,Math.floor(Math.log10(e)+2))}},_s=Hb;o(Hb,"PositionIndex");var zb=class{constructor(){m(this,"_locations",Ve());m(this,"_globals",Ve())}forUri(e){return this._locations[e]}firstAt(e){return this.forUri(e.uri)?.firstAt(e.range.start)}addOccurrence(e,t){t instanceof Ei?(this._globals[t.absoluteName]??(this._globals[t.absoluteName]=[])).push(e):t instanceof yt?this._addOccurrence(e,t.nameLocation):rP.Location.is(t)&&this._addOccurrence(e,t)}_addOccurrence(e,t){(this._locations[t.uri]??(this._locations[t.uri]=new _s)).addOccurrence(e,t.range.start)}*yieldOccurrences(e){if(e instanceof Ei)yield*this._globals[e.absoluteName]??[];else if(e instanceof yt){let t=e.nameLocation,r=this._locations[t.uri];r&&(yield*r.yieldTargets(t.range.start))}}},yo=zb;o(zb,"LocationIndex");var pp,oP,Kb=class{constructor(e,t,r){this.index=e;this.adapter=t;this.effectiveWorkspaceDocuments=r;ns(this,pp);m(this,"tracer",G().tracer("model"));m(this,"tracerModelTodos",G().tracer("model-todos"));m(this,"mainReferences",new Set);m(this,"_identifierTokens",new yo);m(this,"identifierAt",o(e=>this._identifierTokens.firstAt(e),"identifierAt"));m(this,"recordReference",o(e=>this.mainReferences.add(e),"recordReference"));m(this,"localPathToUri",o(e=>this.adapter.toUri(this.adapter.ensureAbsolutePath(e)),"localPathToUri"));m(this,"toLspLocation",o(e=>e?{uri:this.localPathToUri(e.file),range:oc(e)}:void 0,"toLspLocation"));m(this,"clearedUsingSegments",{});m(this,"definitionIndexer");this.definitionIndexer=new cp(this.tracer,{index:e,_identifierTokens:this._identifierTokens,toLspLocation:this.toLspLocation.bind(this)})}onTokensFound(e,t,r){let i=this.adapter.toUri(e),s=this.index.forUri(i,"create"),a=t;s._statistics.modelFiles=1,s.tokens=a,s.compilerVersion=r;for(let c of a){let l=c.tokenIndex;if(s._statistics.tokenCount++,c.identifierCategory){let u=s.addIdentifierToken(c);this._identifierTokens.addOccurrence(u,u)}else if(c.category==="String"){let u=new Es(c,i),p=Ri(u.text);p!==void 0?(u.translationId=p,s.i18nStringTokens.push(u)):(l>0&&a[l-1].text==="from"&&(u.isUsingPath=!0),s.plainStringTokens.push(u))}}}onMessagesFound(e,t,r){let i=this.localPathToUri(t);this.index.forUri(i,"create").compilerMessages.push(...r.map(a=>_U(e,a,i)))}onDefinitionFound(e){this.definitionIndexer.onDefinitionFound(e)}isInferredTexts(e,t){let i=t.getArtifactName(e)?._artifact??e._artifact;if(i&&i.kind==="element"){if(i.$inferred){if(i.$inferred==="localized")return!0;let s=i._main;if(s&&s.kind==="entity"&&t.getArtifactName(s)?.absolute?.endsWith(".texts"))return!0}else if(i._parent?.$inferred==="localized-entity")return!0}return!1}getAnnotationAssignmentLocation(e){let t=e.toolbox.locationOf(e.thing),r=this.toLspLocation(t);if(!t.file)return r;let i=this.adapter.ensureAbsolutePath(t.file),s=e.toolbox.sourcesOf(e.model)[i];if(!s?.ruleTree)return r;let c=s.ruleTree.getFirstToken(p=>p.relativeToCursor(r.range.start)==="tokenStartsAtCursor");if(!c)return r;let u=ce(c,E.annotationAssignment_1,E.annotationAssignment_ll1)?.containedTokens;return u?(u=u.filter(p=>p.tokenIndex>=c.tokenIndex),{uri:r.uri,range:{start:u[0].start,end:je(u).end}}):r}onReferenceFound(e){let{thing:t,toolbox:r,hint:i}=e;function s(d){return e.compiler.getArtifactName(d)&&r.nameLocation(d)||e.toolbox.locationOf(d)}if(o(s,"anyLocation"),i==="annotationAssignment"){let d=this.getAnnotationAssignmentLocation(e),f=this.effectiveWorkspaceDocuments[d.uri],g=new On(f).getText(d.range),h=g.match(/@?(.*)/s);if(h){let W=h[1].trimStart();if(d.range.start.character+=g.indexOf(W),g=W,g=g.replace(Tr.IDENTIFIER_INLAY,""),!g)return}let T=this.index.forUri(d.uri),S=this.toLspLocation(s(t.carrier)),C=this.index.forUri(S.uri).identifierAt(S.range.start);if(!C)return;d.uri===C.uri&&(!C.compare(d.range.start)||!C.compare(d.range.end))&&this.tracer.warn(()=>`Annotation "${g}" at ${d.uri}[${d.range.start.line}:${d.range.start.character}:${d.range.end.line}-${d.range.end.character}]
    overlaps with carrier "${C.text}" at [${C.range.start.line}:${C.range.start.character}:${C.range.end.line}-${C.range.end.character}]`);let L=this.toLspLocation(e.compiler.getArtifactName(t.carrier).location).range,A=NU(e);if(!A)return;T.addAnnotationAssignment(d,g,C,A,L);return}if(!e.toolbox.locationOf(t)){let d=e.toolbox.fullyQualifiedNameOf(t);this.tracer.error(()=>`REF: Thing ${d} without location: ${lp.inspect(t,{depth:3})}`);return}let a=this.toLspLocation(s(t));if(a.range.start.line!==a.range.end.line)return;let c=this._identifierTokens.firstAt(a);if(!c||c.text.length!==a.range.end.character-a.range.start.character)return;a.range.end.character-a.range.start.character,c.text.length;let l=o((d,f)=>{let g=this.index._implicitDefinitions.builtIns[d]||this.index._implicitDefinitions.freeAnnotations[d]||(this.index._implicitDefinitions.freeAnnotations[d]=new Fs(d,t.kind)),h=this.mainReferences.has(c),T=typeof t.value=="string";if(h){T&&typeof c.annotationValue!="string"&&this.tracer.error(()=>"Reference is already known but of different type");return}T&&(c.annotationValue=t.value);let S=c;this.index.forUri(S.uri).addReference(S,g),this.recordReference(S),_t(r.resolve(f)).forEach(A=>{let W=r.nameLocation(A);if(W){let O=this.toLspLocation(W),j=O&&this.index.forUri(O.uri).definitionAt(O.range.start);j instanceof yt&&j.addAnnotationReference(d,S)}});let L=this.identifierAt(a);L&&L.addDefinition(g)},"handleAnnotation");if(i==="annotation"){let d=t.absolute;l(d,t.carrier||t);return}else if(t.literal&&t.literal!=="string")return;if(this.isInferredTexts(t,e.compiler))return;this.recordUsing(e);let u=r.resolve(t),p=_t(u).filter(d=>!d.$inferred||r.isAutoexposed(d));if(!p.length){let d=this.identifierAt(a);if(d){let f=d.uri.startsWith(this.adapter.clientRootUri)?"."+d.uri.slice(this.adapter.clientRootUri.length):d.uri;this.tracer.error(()=>`Given ref only resolved via token: ${f} ${d.text}@${d.line}:${d.character}`)}else this.tracer.error(()=>`No identifier token found for given reference thing @${a.range.start.line}:${a.range.start.character}`);return}for(let d of p){let f,g=e.compiler.getArtifactName(d);if(d.builtin||!r.locationOf(d)||g&&r.locationOf(g)&&r.locationOf(g).file==="<built-in>"){let h=g.absolute;f=this.index._implicitDefinitions.builtIns[h]}else if(d.kind==="namespace"){let h=this.toLspLocation(s(d));f=this.index._implicitDefinitions.implicitNamespaces[g.absolute]??this.index.forUri(h.uri)._explicitNamespaces[g.absolute]}else{let h=this.toLspLocation(s(d)),T=r.isAutoexposed(d)?S=>S.absoluteName===d.name.absolute:S=>!0;f=this.index.forUri(h.uri).definitionAt(h.range.start,T)}if(f)this.index.forUri(c.uri).addReference(c,f),c.addDefinition(f);else{if(d.op)continue;t.$duplicate!==!0&&d.$duplicate!==!0&&d.kind!=="builtin"&&this.tracerModelTodos.isTracing(6)&&this.tracerModelTodos.warn(()=>`No def found for ref (${t.kind}) ${lp.inspect(t.name?.absolute)} ${a.uri}@${R.range(a.range)}, resolved is ${lp.inspect(d,{depth:2})}`)}}}onReferencesDone(e){for(let[t,r]of this.definitionIndexer.namePrefixTokenToThing.entries()){if(r?.$inferred==="localized-entity"||t.definitions!==void 0)continue;let i=rs(this,pp,oP).call(this,e,r);i&&(this.index.forUri(t.uri).addReference(t,i),t.addDefinition(i))}}onDirectDependenciesFound(e,t){let r=this.index.forUri(this.adapter.toUri(e),"create");r.directDependentUris=t.map(i=>this.adapter.toUri(i))}recordUsing(e){var g,h,T;let{thing:t}=e;if(e.thing.kind&&e.thing.kind!=="using")return;let r=o((S,C,L)=>S<=L&&L<=C,"between"),i=t.location,s=i.file;if(!e.thing.kind&&this.clearedUsingSegments[s]?.find(S=>r(S.line,S.endLine,i.line)&&r(S.line,S.endLine,i.endLine)&&r(S.col,S.endCol,i.col)&&r(S.col,S.endCol,i.endCol)))return;t.kind==="using"&&((g=this.clearedUsingSegments)[s]??(g[s]=[]),this.clearedUsingSegments[s].push(i));function a(){let{alias:S}=t.name,{absolute:C,id:L}=t._artifact.name,A={absolute:C,id:L,alias:S,label:"",callerLocation:t.location};return u(A),A}o(a,"resolveTableAlias");function c(){let S=e.toolbox.name(t)??t._artifact.name;return S&&(S.alias=S.id),l(S)}o(c,"resolveUsing");function l(S){if(!S)return;let{alias:C,absolute:L,id:A,location:W}=S,O={alias:C,absolute:L,id:A,label:"",callerLocation:W};if(!C||C===A){let j=je(L.split(".")),J=A&&j!==A;O.id=J?j:void 0}return u(O),O}o(l,"rectify");function u(S){S.label=S.alias&&S.id&&S.alias!==S.id?`${S.absolute} as ${S.alias}`:S.absolute}o(u,"insertLabel");function p(){let S=t._artifact;if(!S)return;let C=t.location,L=S.location;if(S.kind!=="entity"||C.file===L.file)return;let{absolute:A,id:W}=S.name,O={absolute:A,id:W,alias:t.id,label:"",callerLocation:t.location};return u(O),O}o(p,"resolvePropertyType");let f=({using:c,$tableAlias:a}[e.thing?.kind]??p)();if(f){let S=this.adapter.ensureAbsolutePath(f.callerLocation.file),C=this.index.forUri(this.adapter.toUri(S));(h=C.usingStatistics)[T=f.label]??(h[T]={name:f.label,referenceCount:-1,ranges:[]}),C.usingStatistics[f.label].referenceCount++,C.usingStatistics[f.label].ranges.push(yr.adapt(t.location))}}},up=Kb;pp=new WeakSet,oP=o(function(e,t){let r=e.compiler.getArtifactName(t),i=o(()=>this.toLspLocation(e.toolbox.locationOf(je(r.path))??e.toolbox.locationOf(r)),"lspLoc");if(t.builtin||!e.toolbox.locationOf(t)||r&&e.toolbox.locationOf(r)&&e.toolbox.locationOf(r).file==="<built-in>"){let s=r.absolute;return this.index._implicitDefinitions.builtIns[s]}else{if(t.kind==="namespace")return this.index._implicitDefinitions.implicitNamespaces[r?.absolute]??this.index.forUri(i().uri)._explicitNamespaces[r.absolute];{let s=i();return this.index.forUri(s.uri).definitionAt(s.range.start)}}},"#getDefinition"),o(Kb,"IndexBuilder");function DU(n){let{carrier:e}=n.thing,t=n.compiler.getArtifactName(e);return e.kind==="annotate"&&t._artifact?n.compiler.getArtifactName(t._artifact):t}o(DU,"getName");function NU(n){let e=DU(n);if(!e)return;let t=[e.absolute];return e.element&&t.push(e.element),e.action&&t.push(e.action),e.param&&t.push(e.param),t.join(".")}o(NU,"getCarrierName");function _U(n,e,t){let r=yr.adapt(n.toolbox.locationOf(e)),i=e?.home?[{location:{uri:t,range:r},message:e.home}]:void 0;return iP.Diagnostic.create(r,e.message,Si.adapt(e.severity),e.messageId||"<unspecified>","CDS (compiler)",i)}o(_U,"adaptDiagnostic");var Xb=class{constructor(){m(this,"modelFiles",0);m(this,"tokenCount",0);m(this,"identifiers",0);m(this,"definitions",0);m(this,"references",0);m(this,"translations",0);m(this,"messages",0);m(this,"directDependencies",0)}toString(){return`${this.modelFiles!==1?`${this.modelFiles} files, `:""}${this.tokenCount} tokens, ${this.identifiers} identifiers, ${this.definitions} definitions, ${this.references} references, ${this.translations} translation strings, ${this.messages} messages, ${this.directDependencies} dependencies`}},Os=Xb;o(Xb,"Statistics");var Jb=class{static fromFileIndexes(e){let t=new Map(e.map(i=>[i.uri,i])),r=new Mn({getDirectDependencies(i){return t.get(i)?.directDependentUris??[]}});return{builtUris:e.map(i=>i.uri),forUri(i){return t.get(i)},getTransitiveDependencies(i){return r.getTransitiveDependencies(i)}}}static index(e,t,r,i,s){let a=G().tracer("model"),c=new Rs(e,i),l=new up(c,s,t);if(r){let p=r.toolbox.extract(r,l);p.length&&a.error(()=>p.reduce((d,f)=>`${d}
--------
${R.exception(f)}`,`Exceptions during AST extraction (${p.length}):
${p.map(d=>d.message.split(/\r?\n/)[0].slice(0,200)).join(`
`)}`))}let u=new Os;return Object.entries(c._fileIndexes).forEach(([,p])=>{let d=p._statistics;d.definitions=p.definitions.length,d.translations=p.i18nStringTokens.length,d.identifiers=p.idTokens.length,d.directDependencies=p.directDependentUris.length,d.messages=p.compilerMessages.length,u.modelFiles+=d.modelFiles,u.tokenCount+=d.tokenCount,u.definitions+=d.definitions,u.translations+=d.translations,u.identifiers+=d.identifiers,u.directDependencies+=d.directDependencies,u.messages+=d.messages}),a.info(()=>`computing reference statistics for ${c._mainUri}`),l.mainReferences.forEach(p=>c.forUri(p.uri)._statistics.references++),u.references=l.mainReferences.size,c.forUri(e),a.info(()=>`Stats: ${u.toString()}`),c}},Ms=Jb;o(Jb,"BlitzIndexFactory"),x([F("model",{argumentsRenderer:bt,resultRenderer:R.nothing,trackMemory:!0})],Ms,"index",1);var fp=Object.freeze([]),dp=class{constructor(e,t,r){this.uri=e;this.workspaceVersion=t;this._implicitDefinitions=r;m(this,"usingStatistics",{});m(this,"_isInvalidByChangedContent",!1);m(this,"_isInvalidByChangedDependency",!1);m(this,"_explicitNamespaces",Ve());m(this,"_definitions",new _s);m(this,"_reverseRedefinitions",new yo);m(this,"_reverseReferences",new yo);m(this,"tokens",[]);m(this,"idTokens",[]);m(this,"i18nStringTokens",[]);m(this,"plainStringTokens",[]);m(this,"compilerVersion","<unknown>");m(this,"compilerMessages",[]);m(this,"directDependentUris",[]);m(this,"_annotationAssignments",new Map);m(this,"_annotationDiagnostics",fp);m(this,"_statistics",new Os)}addIdentifierToken(e,t=!1){let r=new cr(e,this.uri);if(!t)this.idTokens.push(r);else{let i=0;for(let s=this.idTokens.length-1;s>=0;s--)if(Xr(this.idTokens[s].range,e)==="tokenBeforeCursor"){i=s+1;break}this.idTokens.splice(i,0,r)}return r}clone(){let e=new dp(this.uri,this.workspaceVersion,this._implicitDefinitions);return e._annotationAssignments=this._annotationAssignments,e._annotationDiagnostics=this._annotationDiagnostics,e._definitions=this._definitions,e._explicitNamespaces=this._explicitNamespaces,e._isInvalidByChangedContent=this._isInvalidByChangedContent,e._isInvalidByChangedDependency=this._isInvalidByChangedDependency,e._reverseRedefinitions=this._reverseRedefinitions,e._reverseReferences=this._reverseReferences,e._statistics=this._statistics,e.compilerMessages=this.compilerMessages,e.compilerVersion=this.compilerVersion,e.directDependentUris=this.directDependentUris,e.i18nStringTokens=this.i18nStringTokens,e.idTokens=this.idTokens,e.plainStringTokens=this.plainStringTokens,e.tokens=this.tokens,e.usingStatistics=this.usingStatistics,e}get isInvalidByChangedContent(){return this._isInvalidByChangedContent}get isInvalidByChangedDependency(){return this._isInvalidByChangedDependency}staleContent(){this._isInvalidByChangedContent=!0}staleDependencies(){this._isInvalidByChangedDependency=!0}identifierAt(e){return Rn(this.idTokens,e)}stringAt(e){return Rn(this.i18nStringTokens,e)||Rn(this.plainStringTokens,e)}definitionAt(e,t=r=>!0){for(let r of this._definitions.yieldTargets(e))if(t(r))return r;return Object.values(this._explicitNamespaces).find(r=>!kn(r.nameLocation.range.start,e)&&t(r))}addReference(e,t){this._reverseReferences.addOccurrence(e,t)}*referencesFor(e){yield*this._reverseReferences.yieldOccurrences(e)}addRedefinition(e,t){this._reverseRedefinitions.addOccurrence(e,t)}*redefinitionsFor(e){yield*this._reverseRedefinitions.yieldOccurrences(e)}get definitions(){return[...this._definitions.yieldTargets()].concat(Object.values(this._explicitNamespaces))}addAnnotationAssignment(e,t,r,i,s){let c=o(l=>`${l.line}:${l.character}`,"key")(e.range.start);if(!this._annotationAssignments.has(c)){let l=this.idTokens.find(u=>u.line===e.range.start.line&&u.character===e.range.start.character);if(l){let u=new np(t,l,r);u.carrierName=i,u.carrierNameRange=s,this._annotationAssignments.set(c,u)}}}get annotationAssignments(){return this._annotationAssignments.values()}correspondingStringTokens(e){let t=o(i=>i.text===e,"sameText"),r=[];return r.push(...this.i18nStringTokens.filter(t)),r.push(...this.plainStringTokens.filter(t)),r}implicitDefinitionFor(e){return this._implicitDefinitions.builtIns[e]||this._implicitDefinitions.freeAnnotations[e]||this._implicitDefinitions.implicitNamespaces[e]}},Io=dp;o(dp,"FileIndex"),x([F("files",{onlyTraceStart:!0,argumentsRenderer:(n,e)=>`${e.uri}`})],Io.prototype,"staleContent",1),x([F("files",{onlyTraceStart:!0,argumentsRenderer:(n,e)=>`${e.uri}`})],Io.prototype,"staleDependencies",1);function mp(n,e,t,r,i){return Ms.index(n,e,t,r,i)}o(mp,"indexModel");function sP(n){return Ms.fromFileIndexes(n)}o(sP,"fromFileIndexes");function hp(n){return n&&n instanceof cr}o(hp,"isIdentifierToken");function Pt(n){return n&&n instanceof yt}o(Pt,"isExplicitDefinition");function aP(n){return n&&n instanceof ws}o(aP,"isBuiltinDefinition");function Ic(n){return n&&n instanceof Yr}o(Ic,"isImplicitNamespaceDefinition");var Qb=class{constructor(){m(this,"tracer",G().tracer("files"));m(this,"canonicalFoldersVisited",new Set);m(this,"fs",ne().getFileSystem())}alreadyVisited(e){let t=this.fs.realpathSyncNative(e);return t!==e&&this.tracer.info(()=>`
Folder      ${e}
is actually ${t}`),this.canonicalFoldersVisited.has(t)?(this.tracer.warn(()=>`Loop found when scanning folder: ${e} canonical: ${t}`),!0):(this.canonicalFoldersVisited.add(t),!1)}},gp=Qb;o(Qb,"LoopDetector");var yp=K(require("path"));var yP=K(require("path"));var vP=K(bP()),pn=K(require("path"));var ov=class{constructor(e){this.rootFolder=e;m(this,"ignoreFactory",new Us);m(this,"fs",ne().getFileSystem())}isIgnored(e){if(!e.startsWith(this.rootFolder))return!1;let t=this.rootFolder,r={toCheckAbsolute:e,fileType:this.getFileType(e),cwd:t,toCheckRelative:pn.relative(t,e),nextSubIgnoreFolder:void 0};return r.fileType===0?!0:this.checkIgnored(r)===1}getFileType(e){let t=this.stats(e);return t.isFile()?1:t.isDirectory()?2:0}stats(e){return this.fs.statSync(e)}checkIgnored(e){let{cwd:t,toCheckRelative:r}=e,i=this.ignoreFactory.getIgnoreFor(e.cwd,this.rootFolder===t);try{let s=this.enterSubFolder(e);if(s===1)return 1;if(!i)return s;let a=this.checkFolder(i,{cwd:t,toCheckRelative:r,toCheckAbsolute:e.toCheckAbsolute,fileType:e.fileType,nextSubIgnoreFolder:e.nextSubIgnoreFolder});if(a===1)return 1;if(s===0&&e.fileType===1){let c=i.test(r);return c.ignored?1:c.unignored?2:a===3?3:0}return 0}finally{i&&(e.nextSubIgnoreFolder=t)}}checkFolder(e,t){let r=t.nextSubIgnoreFolder?t.nextSubIgnoreFolder.slice(t.cwd.length+1):t.fileType===1?pn.dirname(t.toCheckRelative):t.toCheckRelative,i=pn.relative(".",r);for(;i;){let s=e.test(ZU(i));if(s.ignored)return 1;if(s.unignored)return 3;{let a=i.lastIndexOf(pn.sep);if(a<0)return 0;i=i.slice(0,a)}}return 0}enterSubFolder(e){let t=e.toCheckRelative.indexOf(pn.sep);if(t<0)return 0;let r=e.toCheckRelative.slice(0,t);return e.cwd=pn.join(e.cwd,r),e.toCheckRelative=e.toCheckRelative.slice(t+1),this.checkIgnored(e)}},qs=ov;o(ov,"IgnoreManager"),x([Pe()],qs.prototype,"isIgnored",1),x([Q({fallback:()=>0})],qs.prototype,"getFileType",1);var sv=class{constructor(){m(this,"tracer",G().tracer("files"));m(this,"fs",ne().getFileSystem())}getIgnoreFor(e,t=!1){let r=this.getIgnorePatternsFor(e);if(t&&(r.push("node_modules/"),r.push(".git/")),!r.length)return;let i=(0,vP.default)();return i.add(r),i}getIgnorePatternsFor(e){let t=this.getIgnoreFilePathFor(e);if(t){let r=this.fs.readFileSync(t).toString();this.tracer.verbose(()=>`Found ${pn.basename(t)} in ${e} with rules: 
${R.asIs(r.split(/\r?\n/))}`);let i=/^(\s*)(#.*)?$/;return r.split(/\r?\n/).filter(s=>!s.match(i))}return[]}getIgnoreFilePathFor(e){let t=[".cdsignore",".gitignore"];for(let r of t){let i=pn.join(e,r);if(this.existsFile(i))return i}}existsFile(e){return this.fs.existsSync(e)&&this.fs.statSync(e).isFile()}},Us=sv;o(sv,"IgnoreFactory"),x([Pe({key:n=>n[0]})],Us.prototype,"getIgnoreFor",1),x([Q({fallback:Ee})],Us.prototype,"getIgnorePatternsFor",1),x([Q({fallback:()=>!1,errorTrace:(n,e)=>`existsFile(${e[0]}) threw ${R.exception(n)}`})],Us.prototype,"existsFile",1);function ZU(n){return n.endsWith(pn.sep)?n:n+pn.sep}o(ZU,"ensureTrailingSeparator");var av=class extends Object{constructor(t){super();this.rootPath=t;m(this,"totalFiles",0);m(this,"totalFolders",1);m(this,"relevantFolders",0);m(this,"ignoredFiles",0);m(this,"ignoredFolders",0);m(this,"relevantFiles",0);m(this,"nonRelevantFiles",0);m(this,"tracer",G().tracer("files"))}toString(){return`+${this.relevantFiles}/?${this.nonRelevantFiles}/-${this.ignoredFiles}/${this.totalFiles} files, +${this.relevantFolders}/-${this.ignoredFolders}/${this.totalFolders} folders`}relativePath(t,r=!1){return t.slice(this.rootPath.length)}found(t){t?this.totalFolders++:this.totalFiles++}ignored(t,r){this.tracer.verbose(()=>`- ${this.relativePath(t,r)} (IGNORED)`),r?this.ignoredFolders++:this.ignoredFiles++}relevantFile(t,r){r?(this.tracer.verbose(()=>`+ ${this.relativePath(t)}`),this.relevantFiles++):(this.tracer.debug(()=>`? ${this.relativePath(t)} (NOT_RELEVANT)`),this.nonRelevantFiles++)}relevantFolder(){this.relevantFolders++}},vp=av;o(av,"ScanStatistics");var cv=class{constructor(e,t,r){this.rootPath=e;this.isRelevant=t;this.loopDetector=r;m(this,"tracer",G().tracer("files"));m(this,"fs",ne().getFileSystem());m(this,"statistics");m(this,"foundFiles",[]);m(this,"ignoredFiles",[]);m(this,"ignoreManager");this.statistics=new vp(e),this.ignoreManager=new qs(e)}findFiles(){return this.scanFolder(this.rootPath),{included:this.foundFiles,ignored:this.ignoredFiles}}onRelevantFileFound(e,t){t?this.ignoredFiles.push(e):this.foundFiles.push(e)}scanFolder(e){if(this.loopDetector.alreadyVisited(e))return;this.statistics.relevantFolder();let t=this.fs.readdirSync(e,!0);this.tracer.debug(()=>`${t.length} entries - following and filtering ignored...`);for(let r of t)this.scanFolderEntry(r,e)}scanFolderEntry(e,t){let r=yP.join(t,e.name),i=e.isDirectory();e.isSymbolicLink()&&(this.tracer.verbose(()=>`symbolic link: ${r}`),i=this.fs.statSync(r).isDirectory()),this.statistics.found(i);let s=this.ignoreManager.isIgnored(r);s&&(this.statistics.ignored(r,i),i)||(i?this.scanFolder(r):this.scanFile(r,s))}scanFile(e,t){let r=this.isRelevant(e);this.statistics.relevantFile(e,r),r&&this.onRelevantFileFound(e,t)}},xo=cv;o(cv,"IgnoreAwareScanner"),x([F("files",{traceLevel:5,argumentsRenderer:(n,e)=>`${e.rootPath}`,resultRenderer:(n,e,t,r)=>`${t.statistics}${r<7?"":`
in: ${R.localPaths(n.included)}
out: ${R.localPaths(n.ignored)}`}`}),Q({fallback:(n,e,t)=>({included:t.foundFiles,ignored:t.ignoredFiles})})],xo.prototype,"findFiles",1),x([F("files",{traceLevel:6,argumentsRenderer:bt,resultRenderer:R.nothing}),Q({fallback:re})],xo.prototype,"scanFolder",1),x([Q({fallback:re,traceComponent:"files",traceLevel:8})],xo.prototype,"scanFolderEntry",1);var lv=class{constructor(e,t,r,i){this.rootPath=e;this.loopDetector=t;this.adapter=r;this.options=i;m(this,"tracer",G().tracer("files"));m(this,"fileSystem",ne().getFileSystem())}scanFiles(){let e=this.options.getUserSetting("cds.workspace.scanCsn"),t=typeof e=="boolean"?e?"InspectJson":"Off":e,r=this.includeCsn(t);return this.tracer.info(()=>`scanFiles(${this.rootPath}) is ${e?"HANDLING":"IGNORING"} csn files`),new xo(this.rootPath,i=>r(i)||this.fileSystem.isPackageJsonFile(i),this.loopDetector).findFiles()}static readDependencies(e,t=vt().moduleLoader.resolver){let r=t0(e),i=[];if(r?.dependencies)for(let[s,a]of Object.entries(r.dependencies)){let c=a.startsWith(".")?a:s,l=t.resolveId(`${c}/${gn}`,e);if(l){let u=yp.dirname(l);i.push({name:s,absoluteLocalPath:u})}}return i}includeCsn(e){switch(e){case"Off":return t=>this.fileSystem.isCdsSourceFile(t);case"ByFileExtension":return t=>this.fileSystem.isCdsSourceFile(t)||this.fileSystem.isCsnFileByExtension(t);case"InspectJson":return t=>this.fileSystem.isCdsFile(t);default:throw new os(e)}}},$s=lv;o(lv,"NodeModule"),x([F("workspace")],$s,"readDependencies",1);function t0(n){try{let e=yp.join(n,gn),t=ne().getFileSystem();if(t.existsSync(e)){let r=t.readFileSync(e).toString();return Xt(r)}}catch{}}o(t0,"readPackageJson");var uv=class{constructor(e,t){this.options=e;this.adapter=t}scan(e,t,r=new gp){let i=this.options.getUserSetting("cds.workspace.scanDependentModules");[e,...i?$s.readDependencies(e).map(a=>a.absoluteLocalPath):[]].map(a=>new $s(a,r,this.adapter,this.options)).forEach(a=>{let c=a.scanFiles();c.included.forEach(l=>t(l,!1)),c.ignored.forEach(l=>t(l,!0))})}},Ip=uv;o(uv,"WorkspaceScanner");var pv=class{constructor(e,t){this.files=e;this.snapshot=t;m(this,"_copy");m(this,"_changedUris",new Set)}get copy(){return this._copy||(this._copy=new Map(this.files)),this._copy}change(e,t,r){let i=this.files.get(e);if(!r&&i?.isOpen){let c=this.snapshot.context.dependencyLevel(e);if(c>1){G().tracer("files").info(()=>`Closed level-${c} file. Removing ${e}`),this.copy.delete(e),this._changedUris.add(e);return}}if(t===pe){i&&(G().tracer("files").info(()=>`Closed a file, no (longer) existing on disk. Removing ${e}`),this.copy.delete(e),this._changedUris.add(e));return}let a=i?i.progress(t,r):ne().createFile(e,t,r);a!==i&&(this.copy.set(e,a),this._changedUris.add(e))}get changedUris(){return this._changedUris}commit(){return this._copy??this.files}},xp=pv;o(pv,"DraftWorkspaceFiles");var IP=Symbol("progressSymbol"),fv=class{constructor(){m(this,"progressReporterPromise");m(this,"progressReporter");m(this,"lastPercentage",0)}setProgressReporter(e){this.progressReporter=void 0,this.progressReporterPromise=e,e.then(t=>{this.progressReporter=t,this.progressReporterPromise=void 0})}progress(e=this.lastPercentage,t){this.lastPercentage=e;let r=o(i=>{G().tracer("util").debug(()=>`PROGRESS: ${t??""} ${Math.floor(e)}%`),t!==void 0?i.report(e,t):i.report(e)},"reportProgress");this.progressReporter?r(this.progressReporter):(G().tracer("util").debug(()=>`No reporter - PROGRESS: ${t??""} ${Math.floor(e)}%`),this.progressReporterPromise&&this.progressReporterPromise.then(r))}},dv=fv;o(fv,"RequestProgress");function Ot(n=he().requestScope){let e=n[IP];return e||(e=new dv,n[IP]=e),e}o(Ot,"requestProgress");var Sp=o(()=>pe,"FB_NO_FILE"),hv=class{constructor(e){this.context=e;m(this,"tracer",G().tracer("workspace"));m(this,"scanner");this.scanner=new Ip(this.options,this.adapter)}get options(){return this.context.options}get adapter(){return this.context.adapter}getCdsEnv(){return this.context.getCdsEnv()}beforeRescan(){return this.context.beforeRescan()}dependencyLevel(e){return this.context.dependencyLevel(e)}},Tp=hv;o(hv,"ExtendedWorkspaceStateContext");function mv(...n){return e=>{for(let t of n)if(!t(e))return!1;return!0}}o(mv,"And");var kp=o(n=>!n.isOutsider,"noOutsiders"),qn=o(n=>ne().getFileSystem().isCdsFile(n.uri,n.content),"cdsFiles"),kr=o(n=>n.uri,"toUri"),wi=class{constructor(e,t,r,i=new Map,s=!1,a=wi.nextWorkspaceVersion++){this.context=e;this.dependencyNet=t;this.activeEditor=r;this._scanned=s;this.workspaceVersion=a;m(this,"fs",ne().getFileSystem());m(this,"files");this.files=new Map(i)}*streamFiles(e=kp,t="OpenEditorsDirectSourcesAndDirectDependencies",r=i=>i){for(let i of this.selectFiles(t))e(i)&&(yield r(i))}toString(){return`%${this.workspaceVersion}`}static create(e){let t=new Map;return this.addLocalSapCdsCommon(e,t)||this.addGlobalSapCdsCommon(e,t),new wi(new Tp(e),ne().createDependencyNet(e.adapter.localRootPath),void 0,t)}isScanned(){return this._scanned}isIgnored(e){return!1}*streamOpenFiles(){for(let e of this.files.values())e.isOpen&&(yield e)}*streamOpenAndWorkspaceFiles(){for(let e of this.files.values())(e.isOpen||this.context.dependencyLevel(e.uri)===0||e.uri.endsWith("/@sap/cds/common.cds"))&&(yield e)}*streamAllFiles(){for(let e of this.files.values())e.isOutsider||(yield e)}*selectFiles(e){switch(e){case"ActiveEditorOnly":case"OpenEditorsOnly":{yield*this.streamOpenFiles();return}case"OpenEditorsAndDirectSources":{yield*this.streamOpenAndWorkspaceFiles();return}case"OpenEditorsDirectSourcesAndDirectDependencies":default:yield*this.streamAllFiles()}}getContent(e){return this.files.get(e)?.content??pe}async ensureScanned(e){if(this.isScanned())return;this.context.beforeRescan();let t=this.context.adapter.localRootPath,r=[];for(let h of _a)e.rootModels[h]?.forEach(T=>{T&&r.push(So.join(t,T))});Ot().progress(1,"Scanning workspace");let i=[],s=[];this.context.scanner.scan(this.context.adapter.localRootPath,(h,T)=>{T?s.push(h):i.push(h)});let a=[];[...i,...s].forEach(h=>{So.relative(t,h).includes("node_modules")&&a.push(h)});let c=_a.map(h=>So.join(t,e.folders[h])),l=[],u=[];if([...i,...s].forEach(h=>{for(let T of c)if(h.startsWith(T)){l.push(h);return}u.push(h)}),!l.length){let h=So.join(t,"models");u.forEach(T=>{T.startsWith(h)&&l.push(T)})}l.length||(l.push(...i),l.push(...s));let p=[...r,...l,...a],d=await this.readMissingFiles(p),f=this.workspaceFolder.lastRequestIndependentWorkspaceSnapshot===this.workspaceFolder.workspaceSnapshot;Ot().progress(55,"Analyzing dependencies");let g=this.workspaceFolder.progressSnapshot(d.newlyReadLatestDocs,void 0,f);if(g.updatedSnapshot._scanned=!0,!f){let h=this.workspaceFolder.workspaceSnapshot.change(d.newlyReadRequestDocs);he().requestScope.snapshots.set(this.workspaceFolder.workspaceUri,h)}this._scanned=!0,Ot().progress(60," ")}get workspaceFolder(){return vt().workspaceService.getWorkspaceFolder(this.context.adapter.clientRootUri)}get latestSnapshot(){return this.workspaceFolder.lastRequestIndependentWorkspaceSnapshot}async readMissingFiles(e){let t={},r={},i=30/e.length,s=15,a=he().frameScope.indentLevel;for(let c of e){he().frameScope.indentLevel=a,Ot().progress(s+=i,"Scanning workspace");let l=this.context.adapter.toUri(c);if(!this.files.has(l)){let u=this.latestSnapshot.files.get(l)?.content??pe;u===pe&&(u=await this.readContent(c),u!==pe&&(r[l]=u)),u!==pe&&(t[l]=u)}}return Ot().progress(s," "),{newlyReadRequestDocs:t,newlyReadLatestDocs:r}}async readContent(e){return this.fs.readFile(e)}static addLocalSapCdsCommon(e,t){let i=vt().moduleLoader.getProjectCdsHome(e.adapter.localRootPath);return this.addSapCdsCommon(i,e,t)}static addGlobalSapCdsCommon(e,t){let i=vt().moduleLoader._resolvedGlobalSapCdsHome;return this.addSapCdsCommon(i,e,t)}static addSapCdsCommon(e,t,r){if(e){let i=ne(),s=i.getFileSystem(),a=o(c=>{let l=So.join(e,c);if(s.existsSync(l)){let u=t.adapter.toUri(l),p=s.readFileSync(l);return r.set(u,i.createFile(u,p)),u}},"addFile");return a("package.json"),a("common.cds")}}change(e={},t={},r=!1){let i=new xp(this.files,this);for(let[a,c]of Object.entries(e))this.files.get(a)?.isOpen||i.change(a,c,!1);for(let[a,c]of Object.entries(t)){let l=c!==pe;i.change(a,l?c:this.readFromDisk(a),l)}let s=i.commit();if(s===this.files)return this;for(let a of i.changedUris){let l=s.get(a)?.content??pe;this.updateDependencyNet(a,l),this.invalidateIndexes(a,l)}return this.create(s,!r)}readFromDisk(e){return mt.isUntitledFile(e)?pe:this.fs.readFileSync(this.adapter.toLocalPath(e))}create(e=this.files,t){return new wi(this.context,this.dependencyNet,this.activeEditor,e,this._scanned,t?wi.nextWorkspaceVersion++:this.workspaceVersion)}reset(){G().tracer("files").warn(()=>`Snapshot %${this.workspaceVersion} was reset!`);let e=ne().createDependencyNet(this.context.adapter.localRootPath);return new wi(this.context,e,this.activeEditor)}get adapter(){return this.context.adapter}isIndexDirty(e,t){let r=this.fileIndexFor(e);return!r||r.isInvalidByChangedContent?!0:!t.onlyDefinitions&&r.isInvalidByChangedDependency}findDirtyUris(e){return[...this.streamContextRelevantUris(e)].filter(r=>this.isIndexDirty(r,e))}*streamContextRelevantUris(e){let t=o(()=>e.uri?[e.uri]:[],"uriFromContext");if(e.singleFile)yield*t();else if(e.considerOnlyActiveFile)this.activeEditor&&(yield this.activeEditor),e.uri&&(!this.activeEditor||e.uri!==this.activeEditor)&&(yield e.uri,G().tracer("workspace").error(()=>`Review this use case: 
active: ${this.activeEditor}
context: ${e.uri}`));else if(e.considerOnlyOpenFiles){yield*t();for(let r of this.files.values())if(r.isOpen){let i=r.uri,s=this.dependencyNet.transitiveDependenciesFor(i);e.uri&&s.has(e.uri)&&i!==e.uri&&(yield i)}}else yield*this.streamFiles(mv(kp,qn),void 0,kr)}sortByRank(e){if(e.length<2)return e;let t=o(s=>[s,this.dependencyNet.transitiveDependenciesFor(s).size],"attachRank"),r=o(s=>s[0],"detachRank"),i=o((s,a)=>a[1]-s[1],"byDescendingRank");return e.map(t).sort(i).map(r)}updateDependencyNet(e,t){this.dependencyNet.onFileChanged(e,t)}invalidateIndexes(e,t){if(t===pe){let r=this.files.get(e);r&&(r.fileIndex=void 0)}else this.fileIndexFor(e)?.staleContent();for(let r of this.dependencyNet.allPotentialUsers(e))this.fileIndexFor(r)?.staleDependencies()}fileIndexFor(e){return this.files.get(e)?.fileIndex}definitionAt(e,t){let r=this.fileIndexFor(e);if(r)return r._definitions.firstAt(t)??Object.values(r._explicitNamespaces).find(i=>!kn(i.nameLocation.range.start,t))}correspondingDefinition(e){if(Pt(e))return this.definitionAt(e.nameLocation.uri,e.nameLocation.range.start);for(let t of this.files.values()){let r=t.fileIndex;if(!r)continue;let i=r.implicitDefinitionFor(e.absoluteName);if(i)return i}}},dn=wi;o(wi,"WorkspaceSnapshot"),m(dn,"nextWorkspaceVersion",0),x([F("files",{resultRenderer:(n,e,t,r)=>n0(t,r)})],dn.prototype,"ensureScanned",1),x([F("files",{traceLevel:7,resultRenderer:n=>`${typeof n=="string"?n.length:"-1"} bytes`}),Q({fallback:Sp,traceComponent:"files"})],dn.prototype,"readContent",1),x([F("files",{argumentsRenderer:R.nothing,resultRenderer:(n,e,t)=>`%${t.workspaceVersion} -> %${n.workspaceVersion}`})],dn.prototype,"change",1),x([Q({fallback:Sp,traceLevel:7})],dn.prototype,"readFromDisk",1),x([F("files",{resultRenderer:(n,e,t)=>`%${t.workspaceVersion} -> %${n.workspaceVersion}`})],dn.prototype,"reset",1),x([F("workspace",{resultRenderer:R.uris})],dn.prototype,"findDirtyUris",1),x([F("workspace",{argumentsRenderer:R.nothing})],dn.prototype,"updateDependencyNet",1),x([F("workspace",{argumentsRenderer:R.nothing}),Q({fallback:re})],dn,"addLocalSapCdsCommon",1),x([F("workspace",{argumentsRenderer:R.nothing}),Q({fallback:re})],dn,"addGlobalSapCdsCommon",1);var xc=class extends dn{static create(e){let t=ne().createDependencyNet(e.adapter.localRootPath);return new xc(new Tp(e),t)}isScanned(){return!0}create(e){return new xc(this.context,this.dependencyNet,this.activeEditor,e,!0)}},Cp=xc;o(xc,"NonScanningWorkspaceSnapshot");function n0(n,e){return e<5?"":e<7?`${n.files.size} files in snapshot`:`${n.files.size} files in snapshot:
${R.uris([...n.files.keys()])}
`}o(n0,"renderSnapshotFiles");var To=K(require("path"));var gv=class{constructor(e,t={}){this.importNameFor=e;this.layerFolders=t;m(this,"differentFolderDeps",[]);m(this,"nodeStatement",'node [margin=0.05 height=0.2 width=0.3 shape=box style="rounded" fontsize=10 fontname="helvetica"]');m(this,"colorSchemes",{db:"blues9",srv:"orrd9",app:"greens9"});this.canonicalizeFolders()}canonicalizeFolders(){let e=o(t=>t.endsWith(ze)?t.slice(0,-1):t,"stripFinalSlash");Object.keys(this.layerFolders).forEach(t=>{this.layerFolders[t]=e(this.layerFolders[t])})}writeDotFile(e,t,r,i){let s=Sc(1),a=`digraph Model {
${s}labeljust=l
${s}fontsize=8
${s}fontname="helvetica"
${s}colorscheme=greys9
${s}edge [penwidth=0.4 arrowhead=onormal color="deeppink2;0.5:black"]
${s}${this.nodeStatement}
`,c=this.calculateTree(t);a+=this.renderFolder(c,1,!1),a+=this.renderOutsideDependencies(),a+=this.renderSummary(t,r,i),a+=`}
`,ne().getFileSystem().writeFileSync(e,a)}renderOutsideDependencies(){let e=`
`;return this.differentFolderDeps.forEach(t=>{t[1].size&&(e+=`
   "${t[0]}" -> {${[...t[1]].map(SP).join(" ")}}`)}),e}renderSummary(e,t,r){let i=t==="file2file"?e.size:[...e.values()].reduce((c,l)=>c+l.sourceUris.size,0),s=r?`'${this.importNameFor(r).importName}'`:"workspace",a=0;for(let c of e.values())a+=c.contentLength;return`
       
   labeljust=r
   fontsize=16   
   label=" ${s} covering ${i} model files (${t})\\l ${a} bytes to compile\\l graph created ${new Date().toUTCString()}\\l"
`}calculateTree(e){let t=xP("file:///"),r=o(i=>{let s=i.slice(8).split(ze).slice(0,-1);return s.reduce((a,c,l)=>(a.has(c)||a.set(c,xP("file:///"+s.slice(0,l+1).join(ze))),a.get(c)),t)},"getFolder");for(let[i,s]of e.entries())r(i).set(To.basename(i),this.toFileNode(s));return t}toFileNode(e){return{uri:e.sourceUri,displayImportPath:this.importNameFor(e.sourceUri).importName,rank:e.rank,bytesRank:e.bytesRank,dependencies:new Set([...e.targetUris]),contentLength:e.contentLength}}colorSchemeFor(e){return this.colorSchemes[e]}renderFolder(e,t,r){let i="";for(let[s,a]of e.entries())if(r0(a)){let c=this.importNameFor(a.uri),l=c.isOutsideNpmPackage;if(!l){i+=`
${Sc(t)}subgraph "cluster_${r?s:a.uri}" {`;let u=Sc(t+1),p=c.isNpmPackageRoot;if(i+=`
${u}label="${p?c.importName:To.basename(c.importName)}"
${u}tooltip="${c.importName}
(${a.uri})"
${u}bgcolor=${1+t%9}
${u}fontcolor=${p?"brown":t%9>3?"white":"black"}
${u}style="dotted"
${u}${this.nodeStatement}
`,this.layerFolders){let f=Object.entries(this.layerFolders).find(([,g])=>a.uri.split(ze).includes(g))?.[0];f&&(i+=`${u}colorscheme=${this.colorSchemeFor(f)}
`)}}i+=this.renderFolder(a,t+(l?0:1),!l),l||(i+=`
${Sc(t)}}
`)}else i+=this.renderFile(a,t);return i}renderFile(e,t=0){let r=To.dirname(e.uri),i=Sc(t),s=`
${i}${this.renderNode(e)};`,a=o(u=>To.dirname(u)===r,"sameFolder"),c=new Set,l=new Set;return e.dependencies.forEach(u=>a(u)?c.add(u):l.add(u)),c.size&&(s+=`
${i}"${e.uri}" -> {${[...c].map(SP).join(" ")}};
`),this.differentFolderDeps.push([e.uri,l]),s}renderNode(e){let t=`"${e.uri}"`,r=[],i=[".cds",".csn.json",".csn",".json"],s=o(u=>{let p=i.find(d=>u.endsWith(d));return p?u.slice(0,-p.length):u},"stripExtension");r.push(`label="${s(To.basename(e.uri))}"`),r.push('style="filled, rounded"'),r.push("penwidth=0.2"),r.push(`tooltip="${e.displayImportPath}
(${e.uri})

${e.rank} covered models
${e.bytesRank} bytes to compile
${e.contentLength} own bytes"`);let a=Math.floor(Math.min(e.rank,501)/100),l=(255-Math.min(a*42,255)).toString(16);return r.push(`fillcolor="#${l}${l}${l}"`),r.push(`fontcolor=${a<3?"black":"white"}`),r.length&&(t+=` [${r.join(" ")}]`),t}},Tc=gv;o(gv,"DotRenderer"),x([F("command",{argumentsRenderer:R.asIs,resultRenderer:R.asIs})],Tc.prototype,"calculateTree",1);function r0(n){return n instanceof Map}o(r0,"isFolderNode");function xP(n){let e=new Map;return e.uri=n,e}o(xP,"folderFor");function SP(n){return`"${n}"`}o(SP,"quoted");function Sc(n){return"   ".repeat(n)}o(Sc,"indent");var bv=class{constructor(e,t,r="file2file"){this.languageServer=e;this.detailMode=r;m(this,"workspaceFolder");m(this,"dependencyMap");m(this,"startUri");m(this,"filesOfFolder",new Map);this.workspaceFolder=e.workspaceService.getWorkspaceFolder(t),this.startUri=t===this.workspaceFolder.workspaceUri?void 0:t}calculate(){return this.buildDirectDependenciesMap(),this.restrictDependencyMapToStartModel(),this.calculateFileRanks(),this.detailMode!=="file2file"&&this.compactDependencyMap(),this}persistTo(e){let t=this.workspaceFolder.adapter.toLocalPath(e),r=this.workspaceFolder.getCdsEnv();new Tc(i=>this.getImportPathViaCorrespondingPackageJson(this.workspaceFolder.adapter.toLocalPath(i)),r.folders).writeDotFile(t,this.dependencyMap,this.detailMode,this.startUri)}buildDirectDependenciesMap(){this.dependencyMap=new Map,this.addKnownSources()}getImportPathViaCorrespondingPackageJson(e){let t=Cr.join(e,"package.json"),r=this.languageServer.fileSystem;if(r.existsSync(t)){let a=r.readFileSync(t),{name:c}=JSON.parse(a);return{importName:c,isNpmPackageRoot:!0,isOutsideNpmPackage:!1}}let i=Cr.dirname(e);if(r.isFileSystemRoot(i))return{importName:e,isNpmPackageRoot:!1,isOutsideNpmPackage:!0};let s=this.getImportPathViaCorrespondingPackageJson(i);return{importName:Cr.join(s.importName,Cr.basename(e)),isNpmPackageRoot:!1,isOutsideNpmPackage:s.isOutsideNpmPackage}}addKnownSources(){for(let e of this.workspaceFolder.workspaceSnapshot.streamFiles(qn,void 0,t=>t))this.dependencyMap.set(e.uri,this.resolveDirectDependencies(e.uri,e.content))}resolveDirectDependencies(e,t){let r=new Set,s=this.languageServer.compiler.parse(t,Cn(e)).parseAst.dependencies||[];for(let a of s){let c=a.val,l=this.resolveDependency(e,c,this.workspaceFolder);l&&r.add(l)}return{sourceUri:e,contentLength:t.length,targetUris:r,rank:-1,bytesRank:-1}}*findMissingSources(){let{dependencyMap:e}=this;for(let[,{targetUris:t}]of e.entries())for(let r of t)e.has(r)||(yield r)}divideDependencyMapIntoFolders(){if(this.detailMode==="folder2folder"){let e=o(r=>Cr.dirname(r)+"/.","toFolderUri"),t=this.filesOfFolder;for(let[r]of this.dependencyMap){let i=e(r);t.has(i)||t.set(i,[]),t.get(i).push(r)}}}restrictDependencyMapToStartModel(){this.divideDependencyMapIntoFolders(),this.startUri&&(this.dependencyMap=this.detailMode==="folder2folder"?this.restrictFolderToFolder():this.restrictFileToFileOrFolder())}restrictFileToFileOrFolder(){let{startUri:e,dependencyMap:t}=this,r=new Set,i=o(a=>{r.has(a)||(r.add(a),t.get(a)?.targetUris.forEach(i))},"follow");e.endsWith(".cds")?i(e):t.forEach((a,c)=>{c.startsWith(e)&&i(c)});let s=new Map;return r.forEach(a=>s.set(a,t.get(a))),s}restrictFolderToFolder(){let{startUri:e,dependencyMap:t}=this,r=o(u=>Cr.dirname(u)+"/.","toFolderUri"),i=e.endsWith(".cds")?r(e):e+"/.",s=this.filesOfFolder,a=new Set,c=o(u=>{a.has(u)||(a.add(u),t.get(u)?.targetUris.forEach(c),s.get(r(u)).forEach(c))},"follow");s.get(i).forEach(c);let l=new Map;return a.forEach(u=>l.set(u,t.get(u))),l}resolveDependency(e,t,r){return this.languageServer.usingPathResolver.resolveUsingPath(e,t,r)??null}calculateFileRanks(){let{dependencyMap:e}=this,t=new Mn({getDirectDependencies:r=>this.dependencyMap.get(r)?.targetUris??[]});for(let[r,i]of e.entries()){let s=t.getTransitiveDependencies(r,!0);i.rank=s.size,i.bytesRank=0,s.forEach(c=>i.bytesRank+=e.get(c).contentLength),s.has(r)||(i.rank++,i.bytesRank+=i.contentLength)}}compactDependencyMap(){let e=o(i=>Cr.dirname(i)+"/.","toFolderUri"),t=new Map,r=this.detailMode==="folder2folder"?new Mn({getDirectDependencies:i=>{let s=new Set;return[...this.dependencyMap.get(i).targetUris].map(e).forEach(a=>this.filesOfFolder.get(a).forEach(c=>s.add(c))),s}}):new Mn({getDirectDependencies:i=>this.dependencyMap.get(i)?.targetUris??[]});for(let[,i]of this.dependencyMap.entries()){let s=e(i.sourceUri),a=t.get(s);a||(a={contentLength:0,bytesRank:0,rank:0,sourceUri:s,targetUris:new Set,sourceUris:new Set},t.set(s,a)),a.sourceUris.add(i.sourceUri),i.targetUris.forEach(c=>{a.targetUris.add(c)})}t.forEach(i=>{let s=new Set(i.sourceUris),a=o(l=>{s.add(l),r.getTransitiveDependencies(l,!0).forEach(p=>s.add(p))},"collectTransitiveDeps");i.sourceUris.forEach(a),i.contentLength=[...i.sourceUris].reduce((l,u)=>l+this.dependencyMap.get(u).contentLength,0),i.rank=s.size,i.bytesRank=[...s].reduce((l,u)=>l+this.dependencyMap.get(u).contentLength,0);let c=new Set;for(let l of i.targetUris)c.add(e(l));i.targetUris=c}),this.dependencyMap=t}},kc=bv;o(bv,"AnalyzeDependencies"),x([Pe()],kc.prototype,"getImportPathViaCorrespondingPackageJson",1);var vv=class extends Pi{constructor(){super(...arguments);m(this,"id","analyze-dependencies")}async execute(t){let{startModelUri:r,outputUri:i,detailMode:s}=t.arguments[0];for(let c of this.languageServer.workspaceService.workspaceFolders())await c.ensureScanned();let a=new kc(this.languageServer,r,s);a.calculate(),a.persistTo(i)}},Pp=vv;o(vv,"AnalyzeDependenciesCommand");var FN=K(Ws());var Ep=K(require("path")),js=K(Xe());function Lp(n){if(!n||n.length===0)return;n.sort((t,r)=>TP(t).localeCompare(TP(r)));let e={contents:{kind:"markdown"}};for(let{hover:t}of n)t.range&&e.range?(kn(t.range.start,e.range.start)<0&&(e.range.start=t.range.start),kn(e.range.end,t.range.end)<0&&(e.range.end=t.range.end)):e.range=e.range??t.range;return e.contents.value=n.map(t=>t.hover.contents.value).join(`

---
`),e}o(Lp,"mergeHovers");function TP(n){switch(n.domain){case"title":return"a";case"description":return"b";case"annotation domain":return"c:"+n.source;case"documentation":return"d";case"translation":return"e";default:throw new os(n.domain)}}o(TP,"prio");var yv=class{constructor(e){this.completionRequest=e;m(this,"tracer",G().tracer("completion"));m(this,"CDL","CDL.md");m(this,"CQL","CQL.md");m(this,"TYPES","TYPES.md");m(this,"docFolder")}async attachDocumentation(e,t){let r=e.sortText||"zzz";if(r.startsWith("2)"))return this._attachDocumentation(e,e.label,!1,this.TYPES,[{from:"# Built-in Types",to:"### See also..."}]);if(r.startsWith("4)"))return this.attachKeywordDocumentation(e);if(r.startsWith("6)"))return this.attachModuleDocumentation(e);if(r.startsWith("1)"))return this.attachIdentifierDocumentation(e,t);if(r.startsWith("3)"))return this.attachSnippetDocumentation(e);if(r.startsWith("8)")){let i=e.data,{importUri:s,line:a,character:c}=i,l=this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(s),p=(await l.fetchFileIndex(s)).definitionAt({line:a,character:c});if(Pt(p)){let d=l.getContent(p.location.uri),f=new On(d!==pe?d:"").getText(p.location.range);e.documentation={kind:js.MarkupKind.Markdown,value:`_${p.kind}_ **${p.absoluteName}**
            &nbsp;&nbsp;&nbsp;&nbsp;in module \`${s.slice(l.workspaceUri.length+1)}\` ${p.docComment?`

---
`+p.docComment:""}

            ---
            \`\`\`
            ${f}
            \`\`\`
            `}}}}attachSnippetDocumentation(e){this._attachDocumentation(e,"annotate",!0,"CDL.md",[{from:"### The `annotate` Directive",to:"## Aspects"},{from:"### Named Aspects --- `define aspect`",to:"### Includes -- `:` as Shortcut Syntax"}]),this._attachDocumentation(e,"Association",!0,"CDL.md",[{from:"## Associations & Compositions",to:"### Compositions"}]),this._attachDocumentation(e,"Composition",!0,"CDL.md",[{from:"### Compositions",to:"## Annotations"}]),this._attachDocumentation(e,"context",!0,"CDL.md",[{from:"### The `context` Directive",to:"## Scoped Definitions"}]),this._attachDocumentation(e,"entity",!0,this.CDL,[{from:"### Entity Definitions --- `define entity`",to:"### Type Definitions --- `define type`"},{from:"### Auto-Exposed Entities",to:"### Custom Actions and Functions"}]),this._attachDocumentation(e,"enum",!0,this.CDL,[{from:"### Enums",to:"## Views and Projections"}]),this._attachDocumentation(e,"extend",!0,"CDL.md",[{from:"### The `extend` Directive",to:"## Services"},{from:"### Extending Services",to:"### Derived Services"}]),this._attachDocumentation(e,"namespace",!0,"CDL.md",[{from:"## Namespaces",to:"### The `context` Directive"}]),this._attachDocumentation(e,"service",!0,this.CDL,[{from:"## Services",to:"### Exposed Entities"},{from:"### Derived Services",to:"## Namespaces"}]),this._attachDocumentation(e,"structured type",!0,this.CDL,[{from:"### Structured Types",to:"### Arrayed Types"}]),this._attachDocumentation(e,"type",!0,this.CDL,[{from:"### Type Definitions --- `define type`",to:"### Virtual Elements"}]),this._attachDocumentation(e,"using",!0,"CDL.md",[{from:"### The `using` Directive",to:"### The `import` Directive"},{from:"### Model Resolution"}]),this._attachDocumentation(e,"view",!0,"CDL.md",[{from:"## Views and Projections",to:"## Associations & Compositions"}])}attachKeywordDocumentation(e){this._attachDocumentation(e,"@",!1,this.CDL,[{from:"### Annotation Syntax",to:"### The `annotate` Directive"}]),this._attachDocumentation(e,"action",!1,this.CDL,[{from:"### Custom Actions and Functions",to:"### Custom-Defined Events"}]),this._attachDocumentation(e,"function",!1,this.CDL,[{from:"### Custom Actions and Functions",to:"### Custom-Defined Events"}]),this._attachDocumentation(e,"excluding",!1,this.CQL,[{from:"## Excluding Clause",to:"## Query-Local Mixins"}]),this._attachDocumentation(e,"mixin",!1,this.CQL,[{from:"## Query-Local Mixins"}]),this._attachDocumentation(e,"virtual",!1,this.CDL,[{from:"### Virtual Elements",to:"### Literals"}])}async attachIdentifierDocumentation(e,t){let r=e.data?.docs;if(r){let i=t.getWorkspaceFolder(r.uri),a=(await i?.fetchFileIndex(r.uri)).definitionAt(r.position),c=[],l={start:{line:0,character:0},end:{line:0,character:0}};for(let p of i.documentationProvider.streamDefinitionDocumentations(r.uri,a?[a]:[]))c.push({domain:p.domain,hover:{contents:p.content,range:l}});c.find(p=>p.domain==="title")||c.unshift({domain:"title",hover:{contents:{kind:"markdown",value:e.label}}});let u=Lp(c);e.documentation=u?.contents}}attachDocsForDefinition(e,t,r){e.data.docs={uri:r.uri,position:{...r.range.start}}}getModuleRoot(e){let t=this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(e),r=t.adapter.toLocalPath(e),i=t.npmPackages.getPackageRootFolder(r);return i?i.packageJsonFolderPath:t.workspaceRoot}attachModuleDocumentation(e){if(!e.data?.targetUri)return;let t=this.getModuleRoot(e.data.targetUri),r=this.completionRequest.languageServer.options.getUserSetting("cds.completion.docFiles"),i=this.completionRequest.languageServer.fileSystem,s=o((a,c)=>{let l=Ep.join(t,a);try{if(i.existsSync(l)){let u=i.readFileSync(l);return e.documentation={kind:js.MarkupKind.Markdown,value:c(u)},this.tracer.info(()=>`Added ${l}`),!0}}catch(u){this.tracer.info(()=>`Could not read file content of ${l}: ${u}`)}return!1},"handle");for(let a of r)if(s(a,c=>c))return;s(gn,a=>{let c=JSON.parse(a);return`## ${c.name}
${c.description??""}`})}getDocFolder(){return this.docFolder||(this.docFolder=Ep.join(Ft,"doc")),this.docFolder}_attachDocumentation(e,t,r,i,s){if(e.label.startsWith(t)&&(!r||e.kind===js.CompletionItemKind.Snippet)){let a=ne().getFileSystem().readFileSync(Ep.join(this.getDocFolder(),i)),c=[];a=s.reduce((l,u)=>{let p=o0(a,u.from,u.to);return c.push(...p.errors),`${l}${p.content}

`},""),a=a.split(Nt).map(a0).map(s0).map(c0).map(l0).map(u0).map(p0).map(d0).map(f0).join(`
`).trim(),e.documentation={kind:js.MarkupKind.Markdown,value:a.trim()},c.length&&(e.documentation.errors=c)}}},Bs=yv;o(yv,"DocumentationProposals"),x([Q({fallback:re,traceComponent:"completion",traceLevel:5})],Bs.prototype,"attachModuleDocumentation",1),x([Q({fallback:re,traceComponent:"completion"})],Bs.prototype,"_attachDocumentation",1);function o0(n,e="",t){let r=[],i=n.indexOf(e);i<0&&r.push(`Start delimiter '${e}' not found`),i=Math.max(i,0);let s=t||"<<<<<<eof>>>>>>",a=n.indexOf(s,i);return!!t&&a<0&&r.push(`End delimiter '${s}' not found`),{content:n.slice(i,a>0?a:void 0).trim(),errors:r}}o(o0,"filterContentRegion");function kP(n,e){let t=Pn.and(Pn.and("[",zr("anchorLabel",/.*?/),"]"),Pn.and("(",zr("anchorLink",/.*?/),")"));return n.replaceAll(t.withFlags("gm"),(r,...i)=>e(i[0],i[1])??r)}o(kP,"replaceMdLink");function s0(n){return kP(n,(e,t)=>{if(t.startsWith("{{cap}}"))return`[${e}](${t.replace("{{cap}}","https://cap.cloud.sap/docs")})`})}o(s0,"hardenCapLinks");function a0(n){return kP(n,(e,t)=>{if(t.match(/^\.\.?\//))return`${e}`})}o(a0,"removeRelativeMdLinks");function c0(n){return n.replaceAll(/<a\s.*?\/>/g,"")}o(c0,"removeHtmlAnchors");function l0(n){return n.replaceAll(/<!--\s.*?-->/g,"")}o(l0,"removeComments");function u0(n){return n.replaceAll(/{%.*?%}/g,"")}o(u0,"removeIncludes");function p0(n){return n.replaceAll(/{:.*?}/g,"")}o(p0,"removeTags");function d0(n){return n.replaceAll(/<sup>(.*?)<\/sup>/g,"$1")}o(d0,"simplifySuperscript");function f0(n){return n.replaceAll(/<br\/?>/g,"&nbsp;")}o(f0,"simplifyBreaks");var Iv=class{constructor(e){this.label=e}},ko=Iv;o(Iv,"AntiCompletionItem");var Sv=class extends en{constructor(e){super(e)}async fetchProposals(e){if(!(await this.completionRequest.languageServer.fetchAnnotationHandlers()).length)return[];let t=e.triggerUri,r=this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(t),i=h0(e),s=e.keywordMap["@"]!==void 0&&e.prefix===""&&!i,a=e,c=await r.fetchTransitiveIndex(t),l={uri:e.triggerUri,assignmentToken:void 0,model:void 0,index:c,prefixWithAtSign:!1,effectivePosition:e.position,isCompoundAnnotation:!1,sortPrefix:"9)",cursorInsideAnnotation:i,async fetchFakeIndex(d){return e.prefix="",this.model=await e.compile(a,d,0),mp(t,mi.create(a.effectiveSnapshot),this.model,-1,r.adapter)}},u=o(()=>[...l.index.forUri(e.triggerUri).tokens],"cloneTokens");if(s?await this.fetchEmptyAnnotation(e,l):(l.sortPrefix="0)",await this.fetchInsideAnnotation(e,l)),!l.assignmentToken)return[];l.model||(l.model=await e.compile(e));let p=e.localTriggerPath.slice(e.workspaceFolder.workspaceRoot.length+1);if(l.assignmentToken.text.length){if(l.assignmentToken.text.indexOf(bo)>=0){let f=l.assignmentToken.text.replace(bo,"");l.assignmentToken.overwriteText(f)}if(e.parseAst.options.messages?.length&&!s){let f=u(),g=[];for(let h of f)if(!["tokenBeforeCursor","tokenEndsWithCursor"].includes(h.relativeToCursor(l.assignmentToken))&&h.relativeToCursor(l.assignmentToken.range.end)!=="tokenAfterCursor")switch(h.text){case"(":g.push(")");break;case"{":g.push("}");break;case"[":g.push("]");break;case"}":case"]":case")":case";":if(je(g)===h.text)g.length-=1;else{let S=e.textLines.getText({start:l.assignmentToken,end:h});l.assignmentToken.overwriteText(S),this.tracer.verbose(()=>`Mismatch in brackets detected: cut assignment to '${S}'`);break}}}if(l.cursorInsideAnnotation==="afterAssignment"){let f=e.textLines.getText({start:l.assignmentToken,end:e.position});l.assignmentToken.overwriteText(f),this.tracer.verbose(()=>`Cursor detected as afterAssignment: cut assignment to '${f}'`)}}{let d=["tokenBeforeCursor","tokenEndsWithCursor"],f=u();f.reverse();let g=f.find(C=>d.includes(C.relativeToCursor(l.assignmentToken)));l.isCompoundAnnotation=g&&[",","("].includes(g.text);let{carrier:h}=l.assignmentToken,S=l.index.forUri(h.uri).identifierAt(h);if(!S?.definitions)if(S.text==="texts")this.tracer.warn(()=>`No explicit definition for carrier "${h.text}" at ${h.uri}[${h.range}], assuming localized entity`);else return this.tracer.warn(()=>`No definition for carrier "${h.text}" at ${h.uri}[${h.range}]`),[]}return this.callHandlers(l,p)}async fetchEmptyAnnotation(e,t){let r=` @${bo} `,i=2;t.prefixWithAtSign=!0,t.index=await t.fetchFakeIndex(r),t.effectivePosition={line:e.position.line,character:e.position.character+i},t.assignmentToken=Cc(t.index,t.uri,t.effectivePosition)}async fetchInsideAnnotation(e,t){let r=/^[\w$]/,i=o(()=>e.parseTree.allTokens.find(u=>["tokenStartsAtCursor","tokenContainsCursor","tokenAfterCursor"].includes(u.relativeToCursor(e.position)))?.isIdentifier(),"nextIsIdentifier");e.identifierExpected&&!i()&&e.keywordMap["{"]===void 0&&!r.test(e.prefix+e.suffix)&&(t.index=await t.fetchFakeIndex(bo));let s=e.position,a=o(l=>l.isIdentifier(),"previousIdentifier");if(t.cursorInsideAnnotation==="afterAssignment"){let l=e.parseTree.allTokens.find(u=>["tokenStartsAtCursor","tokenContainsCursor","tokenAfterCursor"].includes(u.relativeToCursor(e.position)));s=l?.getPreviousToken(a)??l}if(t.assignmentToken=Cc(t.index,t.uri,s),t.assignmentToken||(e.position.character>0&&e.textLines.getLines()[e.position.line].slice(e.position.character-1,e.position.character+1).match(/@([\s;{]|$)/)&&(t.index=await t.fetchFakeIndex(bo),t.assignmentToken=Cc(t.index,t.uri,e.position)),t.assignmentToken))return;let c=e.parseTree.allTokens.find(l=>l.relativeToCursor(e.position)!=="tokenBeforeCursor");if(ce(c,E.annotationAssignment_1,E.annotationAssignment_ll1,E.annotationAssignment_fix)&&(t.index=await t.fetchFakeIndex(bo),t.assignmentToken=Cc(t.index,t.uri,e.position)),!t.assignmentToken){if(c.relativeToCursor(e.position)==="tokenEndsWithCursor")return;let l=c.getPreviousToken();t.assignmentToken=l&&Cc(t.index,t.uri,l);let u=t.index.forUri(e.triggerUri);if(!t.assignmentToken&&l?.text===":"){let p=l.getPreviousToken(Ht);for(let d of u.annotationAssignments)if(d.compare(p)===0){let f=e.textLines.getText({start:d,end:e.position}).trim();t.assignmentToken=d,t.assignmentToken.overwriteText(f)}}if(!t.assignmentToken&&c){let p=ce(c,E.annotationAssignment_ll1,E.annotationAssignment_paren,E.annotationAssignment_1);if(p){let d=p.containedTokens[0];for(let f of u.annotationAssignments)if(f.compare(d)===0){let g=e.textLines.getText({start:p.containedTokens[0],end:je(p.containedTokens).end});t.assignmentToken=f,t.assignmentToken.overwriteText(g)}}}}}async callHandlers(e,t){let r=[];for(let i of await this.completionRequest.languageServer.fetchAnnotationHandlers()){let s=[];s=await i.fetchCompletions({cursorPosition:{textDocument:{uri:e.uri},position:e.effectivePosition},index:e.index,annotation:e.assignmentToken,ast:e.model,relativeLocalPath:t,isCompoundAnnotation:e.isCompoundAnnotation}),s.forEach(a=>{a.sortText=e.sortPrefix+(a.sortText??"zzz"),a.data||(a.data={}),a.data["*origin"]=i.name,m0(a,e.prefixWithAtSign)}),r.push(...s)}return r.length>0&&r.push(new ko("@")),r}},wp=Sv;o(Sv,"ExternalAnnotationProposals");function m0(n,e){e&&(n.insertText?n.insertText.startsWith("@")||(n.insertText=`@${n.insertText}`):n.textEdit?n.textEdit.newText.startsWith("@")||(n.textEdit.newText=`@${n.textEdit.newText}`):n.insertText=`@${n.label}`)}o(m0,"ensureSkeleton");function Cc(n,e,t){for(let r of n.forUri(e).annotationAssignments)if(r.compare(t)===0)return r}o(Cc,"findAnnotationAssignmentToken");function xv(n){let e=ce(n,E.annotationAssignment_1,E.annotationAssignment_ll1,E.annotationAssignment_paren,E.annotationAssignment_atn,E.annotationAssignment_fix);return e?.ruleName===E.annotationAssignment_paren?void 0:e}o(xv,"getTopLevelAnnotationAssignmentRuleNodeForToken");function h0(n){let e=["tokenAfterCursor","tokenStartsAtCursor","tokenContainsCursor"],t=n.parseTree.allTokens.find(r=>e.includes(r.relativeToCursor(n.position)));if(t){let r=t.relativeToCursor(n.position);return r==="tokenAfterCursor"||r==="tokenStartsAtCursor"&&[";","}",")"].includes(t.text)?b0(t,r):g0(t)}return!1}o(h0,"isCursorInsideAnnotation");function g0(n){let e=xv(n);return e?e.getFirstToken(Ht)===n?n.text!=="@":!0:!1}o(g0,"isCursorInsideAnnotationIfCursorOnToken");function b0(n,e){let t=e==="tokenAfterCursor"&&n.isComment()?n.getNextToken(Ht):n,r=n.getPreviousToken(Ht),i=xv(t),s=r&&xv(r);if(i&&i===s){if(!t.isErrorToken){let a=t.getNextToken(Ht);if(a?.isErrorToken||t.text==="@"&&[":","."].includes(a?.getNextToken(Ht).text))return"afterAssignment"}return!0}if(s){if(r.text===":")return"afterAssignment";let a=ce(r,E.annoValue);if(a?.getFirstToken(Ht)?.text==="{"&&a.getLastToken(Ht)?.text!=="}")return"afterAssignment"}return!1}o(b0,"isCursorInsideAnnotationIfCursorInWhitespaceLand");var Vs=K(Xe());var Tv=class extends en{async fetchProposals(e){if(!this.isPotentiallyWithinComment(e))return[];this.tracer.debug(()=>"Potentially within comment, parsing to retrieve token");let r=e.parseAst.tokens.find(v0(e.position));if(r){this.tracer.debug(()=>`Comment token found: ${r.text}`);let i=r.isBlockComment(),s=i?r.text.slice(2,-2).trim():r.text.slice(2).trim();this.tracer.debug(()=>`Comment token content: '${s}'`);let a="@formatter";if(a.startsWith(s.slice(0,a.length))){let c=o(u=>i?`/* ${u} */`:`// ${u}`,"newText"),l={start:r.start,end:r.end};return[{label:"Turn off code formatter from here on",filterText:r.text,sortText:"4)"+"formatterOff",kind:Vs.CompletionItemKind.Constant,textEdit:Vs.TextEdit.replace(l,c("@formatter:off")),commitCharacters:[],data:{}},{label:"Turn on again code formatter",filterText:r.text,sortText:"4)"+"formatterOn",kind:Vs.CompletionItemKind.Constant,textEdit:Vs.TextEdit.replace(l,c("@formatter:on")),commitCharacters:[],data:{}}]}}return[]}isPotentiallyWithinComment(e){let t=e.textLines._splitLines.lines[e.position.line]??"";this.tracer.debug(()=>`Checking if potentially within comment, line: ${t.slice(0,50)}`);let r=t.lastIndexOf("//",e.position.character),i=!1;if(r>=0)i=!0;else{let s=e.textLines._splitLines.lineOffsets[e.position.line]+e.position.character,a=e.originalContent.lastIndexOf("/*",s);if(a>=0){this.tracer.debug(()=>`Block comment opening found at offset ${a}`);let c=e.originalContent.lastIndexOf("*/",s);this.tracer.debug(()=>`Block comment closing found at offset ${c}`),(c>=s||c<a)&&(i=!0)}}return i}},Pc=Tv;o(Tv,"FormatterOptionProposals"),x([Q({fallback:Ee,traceComponent:"format"})],Pc.prototype,"fetchProposals",1);function v0(n){return e=>{if(e.isComment())switch(e.relativeToCursor(n)){case"tokenStartsAtCursor":case"tokenContainsCursor":case"tokenEndsWithCursor":return!0}return!1}}o(v0,"relevantCommentToken");var hN=K(Xe());var da=K(require("path")),mN=K(Xe());var kv=class{constructor(){m(this,"currentFileState")}isRootNode(e){return Yu(e)==="start"}},Gs=kv;o(kv,"$AbstractParseListener");var Cv=class{constructor(){m(this,"ruleTokens",[]);m(this,"messages",[])}},Fp=Cv;o(Cv,"TokenContext");var Pv=class{constructor(e){this.relativePath=e;m(this,"rawTokens",[]);m(this,"tokens",[])}copyRawTokens(e){let r=e.parser.getTokenStream();this.rawTokens=r.tokens}cleanup(){this.rawTokens=[]}},Rc=Pv;o(Pv,"$ParseFileState");var Rv=class extends Rc{constructor(){super(...arguments);m(this,"rootNode");m(this,"currentRuleNode");m(this,"currentTokenIndex",-1);m(this,"ruleNodeToRuleContext",new Map);m(this,"context",new Fp);m(this,"parser")}cleanup(){super.cleanup(),this.ruleNodeToRuleContext.clear(),this.parser=void 0}},Dp=Rv;o(Rv,"$RuleParseFileState");var ei=class{constructor(e,t,r){this.context=e;this.parent=r;m(this,"id");m(this,"children",[]);m(this,"ruleName");m(this,"ruleStartIndex");m(this,"ruleEndIndex",ei.UNKNOWN_STOP_INDEX);m(this,"_nTokens",0);m(this,"data",{});this.ruleStartIndex=t.start.tokenIndex,this.ruleName=Yu(t),this.id=`${this.ruleName}@${t.start.tokenIndex}`}finalize(e){this.ruleEndIndex=e.stop?.tokenIndex??ei.UNKNOWN_STOP_INDEX}addToken(e){if(this._nTokens++,e.isComment())for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(e.tokenIndex>=r.startTokenIndex){this.children.splice(t+1,0,e);return}}this.children.push(e)}addChild(e){ge(e)?this.addToken(e):this.children.push(e)}toString(){let e=this.startTokenIndex,t=this.endTokenIndex,r="";return(e!==this.ruleStartIndex||t!==this.ruleEndIndex)&&(t===ei.UNKNOWN_END_INDEX?r=" [/]":r=` [${e}..${t}]`),`${this.id}..${this.ruleEndIndex}${r}`}getFirstToken(e){return jC(this,t=>t instanceof Sr&&(!e||e(t))||t instanceof ei&&t.children.length>0)}getLastToken(e){return VC(this,t=>t instanceof Sr&&(!e||e(t))||t instanceof ei&&t.children.length>0)}get startTokenIndex(){let e=this.getFirstToken();return e?e.tokenIndex:this.ruleStartIndex}get endTokenIndex(){let e=this.getLastToken();return e?e.tokenIndex:ei.UNKNOWN_END_INDEX}get containedTokens(){return this.children.reduce(Qu,[])}get allTokens(){return this.context.ruleTokens}},Co=ei;o(ei,"RuleNode"),m(Co,"UNKNOWN_END_INDEX",-1),m(Co,"UNKNOWN_STOP_INDEX",-2);var Av=class extends Gs{constructor(t,r=new Dp(t),i){super();this.ruleFileState=r;this.dataTemplate=i}finalize(t){let r=this.ruleFileState.rootNode;return t&&(t.ruleTree=r,r&&(t.tokens=r.context.ruleTokens??[],r.context.messages=t.options.messages??[])),r}visitTerminal(t){this.onToken(t.symbol)}visitErrorNode(t){this.onToken(t.symbol,!0)}enterEveryRule(t){let r=this.ruleFileState,i=new Co(r.context,t,r.currentRuleNode);r.rootNode||(r.rootNode=i,r.parser=t.parser,this.ruleFileState.copyRawTokens(t)),this.dataTemplate&&(i.data=Object.create(this.dataTemplate)),r.ruleNodeToRuleContext.set(i,t),r.currentRuleNode?.addChild(i),r.currentRuleNode=i}exitEveryRule(t){let r=this.ruleFileState,i=r.currentRuleNode;i.finalize(r.ruleNodeToRuleContext.get(i)),r.ruleNodeToRuleContext.delete(i),r.currentRuleNode=i.parent,this.isRootNode(t)&&(r.context.ruleTokens.forEach(s=>{let a=r.rawTokens[s.tokenIndex],c=As(a,t.parser);s.finalizeCategory(a,c)}),r.cleanup())}onRuleToken(t){let r=this.ruleFileState,i=t.parent;if(!i.parent&&t.isComment()){let l=i.children.findIndex(u=>u instanceof Co&&!u.getFirstToken());l>=0?i.children.splice(l,0,t):i.addChild(t)}else i.addChild(t);let{ruleTokens:a}=r.context,{tokenIndex:c}=t;a[c]=t,r.currentTokenIndex=c}determineRuleNode(t){for(let r=this.ruleFileState.currentRuleNode;r;r=r.parent)if(r.ruleName==="start"||r.startTokenIndex<=t.tokenIndex)return r;throw new Error(`Failed to determine rule context for comment token#${t.tokenIndex} '${t.text}'`)}onCommentToken(t,r){let i=this.ruleFileState,s=this.determineRuleNode(t),a=po(i.context.ruleTokens,t.tokenIndex),c=a&&a.endLine===t.line-1;if(c)s=a.parent;else{let u=!0,p=i.rawTokens.slice(t.tokenIndex,r.tokenIndex+1);for(let d=1;d<p.length;d++){let f=p[d-1];if(p[d].line-1-y0(f)>1){u=!1;break}}u&&(s=r.parent)}let l=new Sr(i.context,s,t,As(t,i.parser));c&&(a.followUpLineEndCommentToken=l),this.onRuleToken(l)}handleSkippedComments(t){let r=this.ruleFileState,i=t.tokenIndex;if(i>r.currentTokenIndex+1)for(let s=r.currentTokenIndex+1;s<i;s++){let a=r.rawTokens[s];this.onCommentToken(a,t)}}onToken(t,r=!1){let i=this.ruleFileState,s=new Sr(i.context,i.currentRuleNode,t,As(t,i.parser),r);this.handleSkippedComments(s),t.text!=="<EOF>"&&this.onRuleToken(s)}},Hs=Av;o(Av,"$RuleTreeBuildingParseListener");function y0(n){return Ku(n.line-1,n.text)}o(y0,"endLine");var Lv=class{constructor(e=ar.instance){this.compiler=e}getDefaultOptions(){return{fallbackParser:"cds",parseOnly:!0,lintMode:!0,attachTokens:!0,messages:[]}}parse(e,t="a.cds",r=this.getDefaultOptions(),i){let s=new Hs(t,void 0,i);r.parseListener=s;let a=this.compiler.parse(e,t,r);return s.finalize(a),a.toolbox=this.compiler.createToolbox(),{rootNode:a.ruleTree,parseAst:a}}},Np=Lv;o(Lv,"$Parser");function PP(n){let e=CP(n.toLowerCase());switch(e){case"off":case"no":case"false":return!1;case"on":case"yes":case"true":return!0}let t=parseInt(e,10);return!t&&t!==0?CP(n):t}o(PP,"convertSourceConfigValueToNativeType");function CP(n){function e(r){return n.indexOf(r)===0&&n.lastIndexOf(r)===n.length-1?n.slice(1,-1):n}o(e,"checkQuotes");let t=e('"');return t===n?e("'"):t}o(CP,"destringify");function DD(n){return Uc.loadRemark().remark.stringify(n)}o(DD,"stringify");var By=class{static loadRemark(){return{remark:aF(),gfm:FD()}}},Uc=By;o(By,"Lazy"),x([Pe(),F("format")],Uc,"loadRemark",1);function pd(n,e,t=0,r=0){n.currentColumns+=t,_D(e)?e.children.forEach(i=>ND(n,i,t)):OD(e)&&(n.currentColumns+=String(e.value).length),n.currentColumns+=r}o(pd,"handleNode");function Mz(n,e,t=0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(!(i===0&&t>0)&&n.currentColumns+1+s.length>n.maxLineLength)r+=`
`+s,n.currentColumns=s.length;else{let l=(i===0||n.currentColumns===0?"":" ")+s;r+=l,n.currentColumns+=l.length}}return r}o(Mz,"wrapWords");function ND(n,e,t=0){switch(e.type){case"text":{if(OD(e)){let i=e.value.split(/\s+/gm);e.value=Mz(n,i,t)}return}case"paragraph":pd(n,e);return;case"emphasis":pd(n,e,1,1);return;case"strong":pd(n,e,2,2);return;case"inlineCode":pd(n,e,1,1);return;case"image":case"link":case"imageReference":case"linkReference":n.currentColumns+=DD(e).length;break;case"break":case"thematicBreak":case"code":case"blockquote":case"definition":case"delete":case"html":case"list":case"listItem":case"heading":case"table":case"tableCell":case"tableRow":default:G().tracer("format").warn(()=>`Unexpected block type '${e.type}' inside a 'paragraph' block`),n.currentColumns+=DD(e).length;break}}o(ND,"traverse");var Uz=o(n=>e=>{ND({currentColumns:0,maxLineLength:n},e)},"createBlockFormatParagraph"),qz=o(n=>(e,t,r)=>{MD(e,"paragraph",Uz(n)),r?.(null,e,t)},"createBlockFormat");function _D(n){return!!n.children}o(_D,"isParent");function OD(n){return!!n.value}o(OD,"isLiteral");function MD(n,e,t){if(n.type===e)t(n);else if(_D(n))for(let r of n.children)MD(r,e,t)}o(MD,"walkOn");function $z(n,e=60){let{remark:t,gfm:r}=Uc.loadRemark(),i=t().use(r).use(()=>qz(e)).use({settings:{listItemIndent:"one",fences:!0,bullet:"-",strong:"*",emphasis:"_"}}).processSync(n);return String(i.contents).trim()}o($z,"formatMarkdown");function dd(n,e,t){let r=Wy(n),i=$z(r,t);return Wz(i,e)}o(dd,"formatDocComments");function Wy(n){return n.slice(3,-2).trim().split(Nt).map(e=>e.replace(/^\s*\*( |$)/,"")).join(`
`).trim()}o(Wy,"unwrapMarkdownFromCommentContainer");function Wz(n,e){let t=" ".repeat(e);return`/**
${n.split(Nt).map(r=>`${t} * ${r}`).join(`
`)}
 ${t}*/`}o(Wz,"wrapMarkdownInCommentContainer");var jy=class{constructor(e,t,r,i){this.metaModel=e;this.options=t;this.tracer=r;this.sourceTag=i;r.info(()=>`-- formatting options from '${i}'`)}getValue(e){let t=this.options[e];if(t===void 0)return null;let r=o(s=>s?!!this.options[s]&&r(this.metaModel.getMetaOption(s).parentDependency):!0,"parentOn"),i=this.metaModel.getMetaOption(e);return r(i.parentDependency)?t:typeof i.defaultValue=="boolean"?!1:null}setValue(e,t){let r=this.metaModel.getMetaOption(e);return r?r.isValidValue(t)?(this.options[e]===void 0?this.tracer.info(()=>`| ${(e+":").padEnd(40)} ${JSON.stringify(t)}`):this.options[e]===t?this.tracer.debug(()=>`= unchanged option ${(e+":").padEnd(40)} ${JSON.stringify(t)}`):this.tracer.info(()=>`* changing option '${e}': ${JSON.stringify(this.options[e])} -> ${JSON.stringify(t)}`),this.options[e]=t,!0):(this.tracer.warn(()=>`/ cannot set option ${e}: given value ${JSON.stringify(t)} has wrong type: expected type ${typeof r.defaultValue}`),!1):(this.tracer.warn(()=>`/ cannot set unknown option ${e} to value ${JSON.stringify(t)}`),!1)}overlayWith(e){if(!e)return;let t=e;this.tracer.info(()=>`-- overlaying options from ${this.sourceTag} with those from ${t.sourceTag}`),Object.keys(t.options).forEach(r=>this.setValue(r,e.getValue(r)))}get optionNames(){return Object.keys(this.options)}},qc=jy;o(jy,"FormatOptionConfiguration"),x([F("format",{argumentsRenderer:R.nothing}),Q({fallback:re})],qc.prototype,"overlayWith",1);var UD=`using {
  Person    as User,
  UserIdent as UserID
} from './persons';

@requires             : 'authenticated-user'  @insertonly
@PropertyRestrictions : true                  @Searchable : true
entity Task : managed {
  key id       : /* UUID */ String(20) = 4;
      assignee :            Association to one User @cds.on.insert /*1*/ :       #user;
      subTasks :            Composition of many {
                              id : Integer;
                            }
      priority :            Integer = 2;
      dueOn    :            DateTime                @cds.on.insert       : /*2*/ #now;
}

context Lists {
  entity TaskList    as
      select from Task as task
      join ToDo as todo
        on  todo.taskId =      't' + task.id
        and task.dueOn  is not null
      mixin {
        taskType        : Association to one TaskType

                            on taskType.available = true;
        rejectionStatus : Association to one Text;
      }
      into {
        task.id : String,
        task.dueOn    as dueOn,
        task.assignee as assignee
      }
    union
      select from GenericTasks
      mixin {}
      into {
        'none' as id
      }
      actions {
        action print()  returns Integer;
        function sort() returns array of Task;
      };

  entity HiddenTasks as
    select from Hidden {


      // only expose ID
      id
    }
}


type Number : Integer;
/**
 * # The Text
 *
 * This is a very delicate sentence as it has few tiny words in
 * it
 *
 * * * *
 *
 * - _italics_ and **bold**
 * - **bold** or _italics_
 *
 * 1. good
 * 2. cheap
 *
 *    | name    | age |
 *    | ------- | --: |
 *    | john    |  39 |
 *    | joe     |   2 |
 *    | grandma | 108 |
 */
type Text : String;
`;var Ky=class{constructor(e,t,r,i,s=!1,a=UD){this.defaultValue=e;this.label=t;this.description=r;this.parentDependency=i;this.isInternal=s;this.sampleCode=a}get allowedEnumValues(){}isValidValue(e){return typeof e===typeof this.defaultValue}},$c=Ky;o(Ky,"FormatOptionDefinition");var Xy=class extends $c{constructor(t,r,i,s,a){super(t,i,s,a);m(this,"_allowedEnumValues");this._allowedEnumValues=r}isValidValue(t){return typeof t!="string"?!1:this.allowedEnumValues.includes(t)}get allowedEnumValues(){return this._allowedEnumValues}},Gy=Xy;o(Xy,"FormatOptionEnumDefinition");var Ae=o((n,e,t,r)=>new $c(n,e,t,r),"def"),Vy=o((n,e,t,r,i)=>new Gy(n,e,t,r,i),"enumDef"),Hy=(t=>(t.keepLine="keepLine",t.separateLine="separateLine",t))(Hy||{}),zy=(r=>(r.lower="lower",r.upper="upper",r.title="title",r["as-is"]="as-is",r))(zy||{}),Bc={alignAfterKey:Ae(!0,"Align _element names_ after **key**","Align _element identifiers_ after optional **key** keyword"),alignAnnotations:Ae(!0,"Align _annotations_","Align _annotations_"),alignPreAnnotations:Ae(!0,"pre-annotations","Align annotations before items. If multiple annotations exist in a line, they are aligned in a tabular way","alignAnnotations"),alignPostAnnotations:Ae(!0,"post-annotations","Align annotations after items","alignAnnotations"),alignColonsInAnnotations:Ae(!0,"colons","Align _colons_ in annotations","alignAnnotations"),alignValuesInAnnotations:Ae(!0,"values","Align _values_ in annotations","alignAnnotations"),alignActionsAndFunctions:Ae(!0,"Align _actions_ and _functions_","Align parts of _actions_ and _functions_"),alignActionNames:Ae(!0,"_names_","Align the names of _functions_ and _actions_","alignActionsAndFunctions"),alignActionReturns:Ae(!0,"**returns** keyword","Align the **returns** keyword of _actions_ and _functions_","alignActionsAndFunctions"),alignAs:Ae(!0,"Align **as**","Align the **as** keyword"),alignAsInEntities:Ae(!0,"in entities","Align the **as** keyword in entities. Alignment scope: encompassing context","alignAs"),alignAsInSelectItems:Ae(!0,"in **select** items","Align the **as** keyword in entity **select** items","alignAs"),alignAsInUsing:Ae(!0,"in **using**","Align the **as** keyword in **using** statements","alignAs"),alignExpressionsAndConditions:Ae(!0,"Align _expressions_ and _conditions_","Align parts of _expressions_ and _conditions_, including left- and right-hand side and operator"),alignExprAndCondWithinBlock:Ae(!0,"within block","Align parts of _expressions_ and _conditions_ within the encompassing block rather than throughout the whole statement","alignExpressionsAndConditions"),alignTypes:Ae(!0,"Align _types_ of elements","Align _element types_ within entities, type or annotation specifications"),alignColonsBeforeTypes:Ae(!0,"including _colons_","Align _colons_ before element types","alignTypes"),alignEqualsAfterTypes:Ae(!0,"including _assignment operators_","Align _assignment operators_ **=** after element types","alignTypes"),alignTypesWithinBlock:Ae(!0,"within block","Align _element types_ (and _colons_) within the encompassing block rather than throughout the whole statement","alignTypes"),alignCompositionStructToRight:Ae(!0,"Align _struct_ in **composition** to the right","Align _struct_ defined in **composition** to the right","alignTypes"),cqlKeywordCapitalization:Vy("lower",Object.values(zy),"Capitalization style of _CQL keywords_","How _CQL keywords_ are capitalized"),keepPreAnnotationsInOriginalLine:Vy("keepLine",Object.values(Hy),"Line wrapping of _pre-annotations_","Either keeps the line structure of _pre-annotations_ or wraps each annotation in separate line"),keepPostAnnotationsInOriginalLine:Vy("keepLine",Object.values(Hy),"Line wrapping of _post-annotations_","Either keeps the line structure of _post-annotations_ or wraps each annotation in separate line"),keepEmptyBracketsTogether:Ae(!0,"Keep empty _brackets_ together","Keep _bracket pairs_ **{} [] ()** together rather than separating them with whitespace"),keepSingleLinedBlocksTogether:Ae(!0,"Keep similar single-lined _blocks_ together","Avoid single-lined _blocks_ of the same type being separated by empty lines"),keepOriginalEmptyLines:Ae(!0,"Keep original _empty lines_","Prevent deletion of consecutive empty lines below the limit. If disabled, allow consecutive empty lines to be removed depending on the context"),maxKeepEmptyLines:Ae(2,"Maximum consecutive _empty lines_","Maximum number of consecutive _empty lines_ to keep. Empty lines below this limit may still be removed depending on other settings"),openingBraceInNewLine:Ae(!1,"Line wrapping before opening _brace_","Wrap line before opening _brace_"),selectInNewLine:Ae(!0,"Line wrapping before **select** of entity or view","Start **select** statement of entity or view definition in a new line (indented)"),tabSize:Ae(2,"Tab size","Specify the number of spaces per indentation level"),finalNewline:Ae(!0,"Final newline","Insert newline character at the end of the file"),maxDocCommentLine:Ae(60,"Max doc comment line length","Wrap doc comment lines at given length"),whitespaceBeforeColon:Ae(!0,"Blank before _colon_","Use blank to separate item from following _colon_"),whitespaceBeforeColonInAnnotation:Ae(!1,"Blank before _colon_ in _annotations_","Use blank to separate key and _colon_ in _annotations_","whitespaceBeforeColon"),whitespaceAfterColon:Ae(!0,"Blank after _colon_","Use blank to separate _colon_ from following item"),whitespaceAfterColonInAnnotation:Ae(!0,"Blank after _colon_ in _annotations_","Use blank to separate _colon_ and value in _annotations_","whitespaceAfterColon"),whitespaceAfterComma:Ae(!0,"Blank after _comma_","Use blank to separate _comma_ from following item"),whitespaceAroundAlignedOps:Ae(!0,"Blanks around aligned _binary operators_ and _colons_","Use blank before and after aligned _binary operators_ and _colons_ (except colons in annotations)"),whitespaceAroundBinaryOps:Ae(!0,"Blanks around _binary operators_","Use blank before and after _binary operators_"),whitespaceWithinBrackets:Ae(!1,"Blanks within _brackets_","Use blank after opening and before closing _brackets_ **{} [] ()**"),cancelFormattingOnAlignmentDeadlocks:new $c(!1,"","",void 0,!0,void 0)},Jy=class{constructor(e=G().tracer("format"),t=Bc){this.tracer=e;this.optionDefinitions=t}has(e){return e in this.optionDefinitions}getMetaOption(e){return this.optionDefinitions[e]}emptySet(e="empty"){return new qc(this,{},this.tracer,e)}get optionNames(){return Object.keys(this.optionDefinitions)}defaultSet(e="defaults"){let t=this.emptySet(e);return this.optionNames.forEach(r=>t.setValue(r,this.getMetaOption(r).defaultValue)),t}},Wc=Jy;o(Jy,"MetaModel");var Qy=-1,Yy=class{constructor(e,t){this.globalOptions=e;this.tracer=t;m(this,"areasByOption",{});e.metaModel.optionNames.forEach(r=>this.areasByOption[r]=[])}setLocallyFromString(e,t,r){let i;switch(t.toLowerCase()){case"true":i=!0;break;case"false":i=!1;break;default:i=Number(t),isNaN(i)&&(i=t)}if(!this.globalOptions.metaModel.has(e)){this.tracer.error(()=>`failed to set option ${e} = ${i} from offset ${r}: unknown option`);return}let s=typeof this.globalOptions.metaModel.getMetaOption(e).defaultValue,a=typeof i;if(a!==s){this.tracer.error(()=>`failed to set option ${e} = ${i} from offset ${r}: invalid type ${a}: expected ${s}`);return}this.setLocally(e,i,r)}setLocally(e,t,r){let i=this.areasByOption[e];if(!i){this.tracer.error(()=>`failed to set invalid option ${e} = ${t} from offset ${r}`);return}i[r]=t,this.tracer.debug(()=>`set option ${e} = ${t} from offset ${r}`)}resetLocally(e,t){let r=this.areasByOption[e];if(!r){this.tracer.error(()=>`failed to reset invalid option ${e} from offset ${t}`);return}r[t]=null,this.tracer.debug(()=>`reset option ${e} from offset ${t}`)}setGlobally(e,t){let r=this.globalOptions.setValue(e,t);return this.tracer.debug(()=>`set option ${e} = ${t} globally`),r}getOption(e,t){function r(i,s,a){return a<=t?s:i}return o(r,"lastRelevant"),t===Qy?this.globalOptions.getValue(e):this.areasByOption[e]?.reduce(r,null)??this.globalOptions.getValue(e)}},fd=Yy;o(Yy,"OptionRanges");var Dr=K(require("path"));var Lo=".cdsprettier.json";function md(n,e,t,r){let i=ne().getFileSystem();t=Dr.resolve(Dr.normalize(t??"")),t.endsWith(Dr.sep)&&(t=t.slice(0,-1));let s=Dr.dirname,a=o((p,d)=>{let f=n.emptySet(d);return Object.entries(p).forEach(([g,h])=>Bz(f,g,h)),f},"convertToFormattingOptions"),c=o(p=>{try{if(r.debug(()=>`Checking ${p} for options`),i.existsSync(p)){r.debug(()=>`Reading ${p}`);let d=i.readFileSync(p).toString(),f=JSON.parse(d);return a(f,p)}}catch(d){r.debug(()=>`Could not load options from ${p}: ${d}`)}},"readConfig"),l=[],u=s(e);for(;u.startsWith(t);){l.push(u);let p=s(u);if(u===p)break;u=p}l.push(i.homedir());for(let p of l){let d=Dr.join(p,Lo),f=c(d);if(f)return{formattingOptions:f,filePath:d}}}o(md,"fileOptions");function qD(n,e){let t=n.emptySet("LSP");for(let[r,i]of Object.entries(e))if(i!==void 0)switch(r){case"insertFinalNewline":t.setValue("finalNewline",i);break;default:t.setValue(r,i);break}return t}o(qD,"mapLspOptions");function Bz(n,e,t){switch(e){case"keepAnnotationsInOriginalLine":n.setValue("keepPreAnnotationsInOriginalLine",t),n.setValue("keepPostAnnotationsInOriginalLine",t);break;default:n.setValue(e,t)}return n}o(Bz,"setFormatOptionCompat");var Zy=class{constructor(e,t="_ca_"+e.nextFreeAlignmentId,r=0){this.id=t;this.nMinColumn=r;m(this,"alignmentDone",!1);m(this,"relativeAlignment")}setColumn(e){this.nMinColumn<e&&(this.nMinColumn=e)}getColumn(e){return this.nMinColumn}toString(){return`${this.constructor.name}(${this.id})`}},Me=Zy;o(Zy,"Alignment");var eI=class{constructor(){m(this,"_nextFreeBlockAlignmentId",1);m(this,"_nextFreeAlignmentId",1);m(this,"_knownAlignmentsById",{})}get nextFreeAlignmentId(){return this._nextFreeAlignmentId++}get nextFreeBlockAlignmentId(){return this._nextFreeBlockAlignmentId++}},hd=eI;o(eI,"Alignments");function ia(n){return function(e,t="_ca_"+e.nextFreeAlignmentId){let r=e._knownAlignmentsById[t];return r||(r=n(e,t),e._knownAlignmentsById[t]=r),r}}o(ia,"alignmentForId");function gd(n){return n instanceof Me}o(gd,"isAlignment");var bd=class extends Me{constructor(){super(...arguments);m(this,"relativeColumn",0)}setRelativeAlignment(t,r=0){let i=t;for(;i;){if(i===this)throw new Error("Cycle in relative alignments starting with ID "+this.id);i=i.relativeAlignment}return this.relativeAlignment=t,this.relativeColumn=r,this}getColumn(t){return this.relativeAlignment?Math.max(this.relativeColumn<0?0:this.nMinColumn,this.relativeAlignment.getColumn(t)+this.relativeColumn):this.nMinColumn}toString(){return`IA(${this.id})`}},jc=bd;o(bd,"IndentingAlignment"),m(jc,"forId",ia((t,r)=>new bd(t,r)));var vd=class extends jc{constructor(){super(...arguments);m(this,"ruleNode")}setNode(t){return this.ruleNode=t,this}toString(){return`BA(${this.id})`}},ht=vd;o(vd,"BlockAlignment"),m(ht,"forId",ia((t,r)=>new vd(t,r)));var yd=class extends Me{toString(){return`CA(${this.id})`}},Eo=yd;o(yd,"CustomAlignment"),m(Eo,"forId",ia((e,t)=>new yd(e,t)));var tI=class extends Me{constructor(t,r){super(t,"_fa_"+t.nextFreeAlignmentId);this.firstColumn=r;m(this,"relativeColumns",[0]);m(this,"firstHardenedLineNumber");m(this,"firstHardenedColumn")}toString(){return`FA(${this.id})`}registerFirstHardenedLine(t){(this.firstHardenedLineNumber===void 0||t<this.firstHardenedLineNumber)&&(this.firstHardenedLineNumber=t)}registerFirstHardenedColumn(t,r){t===this.firstHardenedLineNumber&&(this.firstHardenedColumn=r)}setIndentation(t,r){this.relativeColumns[t]=r-this.firstColumn}getColumn(t){if(typeof this.firstHardenedLineNumber!="number")throw new Error("firstHardenedLineNumber not set");if(typeof this.firstHardenedColumn!="number")throw new Error("firstHardenedColumn not set");let r=this.relativeColumns[t-this.firstHardenedLineNumber];if(typeof r!="number")throw new Error("relativeColumn not set");return this.firstHardenedColumn+r}},oa=tI;o(tI,"FacsimileAlignment");var $D={bIgnore:!0},nI=class{constructor(){m(this,"value",$D)}init(){this._setValue($D)}toString(){return this.constructor.name}_setValue(e){this.value=e}atLeast(e){return this._setValue({nAtLeast:e}),this}merge(e){if(e.constructor!==this.constructor)return!1;if(this.value.nAtLeast!==void 0&&e.value.nAtLeast!==void 0&&this.value.nAtLeast*e.value.nAtLeast<0)throw new Error("Cannot merge positive and negative values");return[this,e].sort((r,i)=>{let s=r.value.bIgnore?-1:Math.abs(r.value.nAtLeast??0),a=i.value.bIgnore?-1:Math.abs(i.value.nAtLeast??0);return s-a})[1]===e&&this._setValue(e.value),e.init(),!0}},fn=nI;o(nI,"FormatBase");var Ce="",Te=" ",WD="  ",tn="|",Ge=`
`,Mt=`
+1`,nn=`
=`,lr=`

`;var Id=class extends fn{clone(){let e=new Id;return e.value=this.value,e}_asString(){if(this.value.bIgnore)return"";let e=0;return this.value.nAtLeast!==void 0&&(e=this.value.nAtLeast),`
`.repeat(e+1)}renderArray(e){let t=this._asString();this.init();for(let r of t)e.push([])}toString(){if(this.value.bIgnore)return"-LF-";let e=0;this.value.nAtLeast!==void 0&&(e=this.value.nAtLeast);let t="";for(let r=0;r<e+1;r++)t+="\xB6";return t}},St=Id;o(Id,"LineBreak");var rI=class{constructor(e){this.globalContext=e;m(this,"blockAlignmentStack",[])}lastBlockAlignment(){return this.blockAlignmentStack[this.blockAlignmentStack.length-1]}appendToStream(e){this.globalContext.formattingStream.append(e)}appendBlockAlignment(e){let t=this.blockAlignmentStack;t[t.length-1]!==e&&t.push(e),BD(this.globalContext.tracer,"-> ",t),this.appendToStream(e)}popBlockAlignment(e,t){let i=e?this.blockAlignmentStack.findIndex(s=>s.id===e):o(()=>{let s=this.lastBlockAlignment();return s?this.blockAlignmentStack.indexOf(s):-1},"getLastBlockAlignmentIndex")();if(i<0){this.globalContext.tracer.warn(()=>`Cannot pop block alignment '${e}'; assuming it has already been dropped`);return}t&&i++,this.blockAlignmentStack.length=i,BD(this.globalContext.tracer,"<- ",this.blockAlignmentStack)}newBlockAlignment(e,t,r){let i=this.createBlockAlignment(e,t,r);return this.appendBlockAlignment(i),i}createBlockAlignment(e,t,r,i=!0){let s=ht.forId(this.globalContext.alignments,e),a=!1;return s.ruleNode&&(i?(s=ht.forId(this.globalContext.alignments,`${e}!${this.globalContext.alignments.nextFreeBlockAlignmentId}`),this.globalContext.tracer.verbose(()=>`pp_stack WARN: auto-renamed block alignment to prevent id clash: ${s.id}`)):a=!0),a||(s.setNode(r),s.setRelativeAlignment(this.lastAlignment(),t)),s}lastAlignment(){let e=this.globalContext.formattingStream.stream;for(let t=e.length-1;t>=0;t--){let r=e[t];if(r instanceof St)break;if(r instanceof Me)return r}return this.lastBlockAlignment()}},xd=rI;o(rI,"BlockAlignmentManager");function BD(n,e,t){let r=t.map(i=>i.id);n.verbose(()=>`pp_stack ${e} ${r}`)}o(BD,"traceStack");var Vc=[E.annotationAssignment_atn,E.annotationAssignment_fix,E.annotationAssignment_ll1,E.annotationAssignment_paren,E.annotationAssignment_1];function st(n){return ge(n)&&!n.isComment()||ye(n)&&!Vc.includes(n.ruleName)}o(st,"nonCommentNonAnnotation");function $n(n){return ye(n)&&Vc.includes(n.ruleName)}o($n,"isAnnotation");function Gc(n){if($n(n))return!0;for(let e of mo(n))if(Vc.includes(e.ruleName))return!0;return!1}o(Gc,"isWithinAnnotation");function jD(n,e){return!$n(n)||ur(n,e)!=="pre"||n.getFirstToken().line<(n.getLastToken().getNextToken()?.line??0)?!1:e.formatOptions.getOption("keepPreAnnotationsInOriginalLine",n.startTokenIndex)==="keepLine"}o(jD,"isInlinePreAnnotation");function VD(n,e){return!$n(n)||ur(n,e)!=="pre"?!1:n.getFirstToken().line<(n.getLastToken().getNextToken()?.line??0)?!0:e.formatOptions.getOption("keepPreAnnotationsInOriginalLine",n.startTokenIndex)==="separateLine"}o(VD,"isSeparateLinePreAnnotation");function jz(n,e,t){return t===null||[";","}"].includes(xe(t)??"")?!0:e==="post"||ge(n)&&(["with",")"].includes(xe(n))||n.isIdentifier())||ye(n)&&n.ruleName===E.typeRefOptArgs}o(jz,"isPostAnnotation");function ur(n,e){function t(c){return e.annotationTypes[n.id]=c,c}if(o(t,"memoize"),!n)return null;if(n.id in e.annotationTypes)return e.annotationTypes[n.id];if(!$n(n))return t(null);let r=fo(n,Ht),i=ye(r)&&ur(r,e)||void 0,s=Zt(n,Ht);if(jz(r,i,s))return t("post");let a=r===null||i==="pre"||ge(s)&&(["{","key"].includes(xe(s))||s.isIdentifier())?"pre":"post";return t(a)}o(ur,"getAnnotationType");function GD(n){return!!n?.instructionOrAlignment}o(GD,"isCachedInstruction");var iI=class{constructor(e){this.context=e;m(this,"things",[]);m(this,"isInline");m(this,"hasSeparateLineAnno");m(this,"firstNodeOrToken");this.reset()}reset(){this.things.splice(0),this.isInline=!0,this.hasSeparateLineAnno=!1,this.firstNodeOrToken=null}isEmpty(){return this.things.length===0}add(e){this.things.push(e),this.isInline=this.isInline&&this.thingIsInline(e),this.hasSeparateLineAnno=this.hasSeparateLineAnno||ye(e)&&VD(e,this.context),!this.firstNodeOrToken&&!GD(e)&&(this.firstNodeOrToken=e)}getAll(){return this.things}thingIsInline(e){return GD(e)&&!e.instructionOrAlignment.includes(`
`)||ge(e)&&e.isInlineComment()||ye(e)&&jD(e,this.context)}},Sd=iI;o(iI,"DelayedThings");var oI=class{constructor(e,t){this.context=t;m(this,"enablementSwitch");m(this,"ignoreComments",!0);m(this,"ignoreAnnotations",!0);m(this,"onlyTokenChildren",!1);m(this,"firstTokenIndex");m(this,"parent");m(this,"children",[]);m(this,"ruleName");m(this,"formattingRelevantRuleName");m(this,"_formattingRelevantNode");m(this,"applyAfterCurrentChild",[]);m(this,"applyBeforeNextChild",[]);m(this,"applyAfterNode",[]);m(this,"alignmentIdAliases",new Map);m(this,"ruleNode");this.ruleNode=e,this.ruleName=e.ruleName,this.formattingRelevantRuleName=this.ruleName,this.firstTokenIndex=e.startTokenIndex;let r=e.parent;r&&(this.parent=t.getFormatter(r),this.parent&&!this.parent.children.includes(this)&&this.parent.children.push(this)),t.alignmentIdAliasesSet||(t.alignmentIdAliasesSet=!0,t.alignmentIdAliases.elementKey=(i,s)=>i.getOption("alignAfterKey",s)?void 0:"elementName",t.alignmentIdAliases.exprL=(i,s)=>i.getOption("alignExpressionsAndConditions",s)?void 0:null,t.alignmentIdAliases.op=(i,s)=>i.getOption("alignExpressionsAndConditions",s)?void 0:null,t.alignmentIdAliases.exprR=(i,s)=>i.getOption("alignExpressionsAndConditions",s)?void 0:null,t.alignmentIdAliases.type=(i,s)=>i.getOption("alignTypes",s)?void 0:null,t.alignmentIdAliases[E.mixinElementDef+".type"]=(i,s)=>i.getOption("alignTypesWithinBlock",s)?void 0:"type",t.alignmentIdAliases[E.elementDefInner+".type"]=(i,s)=>i.getOption("alignTypesWithinBlock",s)?void 0:"type",t.alignmentIdAliases[E.selectItemDef+".type"]=(i,s)=>i.getOption("alignTypesWithinBlock",s)?void 0:"type",t.alignmentIdAliases[E.mixinElementDef+".typeColon"]=(i,s)=>i.getOption("alignTypesWithinBlock",s)?void 0:"type",t.alignmentIdAliases[E.elementDefInner+".typeColon"]=(i,s)=>i.getOption("alignTypesWithinBlock",s)?void 0:"type",t.alignmentIdAliases[E.selectItemDef+".typeColon"]=(i,s)=>i.getOption("alignTypesWithinBlock",s)?void 0:"type",t.alignmentIdAliases.selectItemAS=(i,s)=>i.getOption("alignAsInSelectItems",s)?void 0:null,t.alignmentIdAliases.selectItemEffectiveName=(i,s)=>i.getOption("alignAsInSelectItems",s)?void 0:null)}get id(){return this.ruleNode.id}beforeNode(e){try{return this.beforeNodeNoCache(e)}catch(t){return this.context.tracer.error(()=>`formatting failed before node ${e.id}: ${t}`),[]}}beforeNodeNoCache(e){return[]}afterNode(e){if(this.applyAfterNode.length){let t=this.applyAfterNode;return this.applyAfterNode=[],t}else try{return this.afterNodeNoCache(e)}catch(t){return this.context.tracer.error(()=>`formatting failed after node ${e.id}: ${t}`),[]}}afterNodeNoCache(e){return[]}beforeChild(e,t){if(this.applyBeforeNextChild.length){let r=this.applyBeforeNextChild;return this.applyBeforeNextChild=[],r}try{return this.beforeChildNoCache(e,t)}catch(r){return this.context.tracer.error(()=>`formatting failed before child ${t.id}: ${r}`),[]}}beforeChildNoCache(e,t){return[]}afterChild(e,t){if(this.applyAfterCurrentChild.length){let r=this.applyAfterCurrentChild;return this.applyAfterCurrentChild=[],r}else try{return this.afterChildNoCache(e,t)}catch(r){return this.context.tracer.error(()=>`formatting failed after child ${t.id}: ${r}`),[]}}afterChildNoCache(e,t){return[]}destroy(){if(this.parent){let e=this.parent.children.indexOf(this);e>-1&&this.parent.children.splice(e,1),this.parent=void 0}this.children=[],this.ruleNode&&(this.context.discardFormatter(this.ruleNode),this.ruleNode=void 0)}startsWith(e){if(!this.ruleNode)return!1;let t=this.ruleNode.getFirstToken(st);return t?xe(t)===e:!1}resolveGlobalAlignmentIdAliases(e,t){let r=e;for(;r&&r in this.context.alignmentIdAliases;){let i=this.context.alignmentIdAliases[r](this.context.formatOptions,t);if(i===void 0)break;r=i}return r}resolveLocalAlignmentIdAliases(e){for(;e&&this.alignmentIdAliases.has(e);)e=this.alignmentIdAliases.get(e);return e}resolveAlignmentIdAliases(e,t){let r=this.resolveLocalAlignmentIdAliases(e);return r!==e?r:this.resolveGlobalAlignmentIdAliases(e,t)}resolveAlignmentId(e,t,r=!1){let i=e;if(i=this.resolveAlignmentIdAliases(i,t),!!i)return`${this.id}/${i}`}getAlignment(e,t,r){let i=this.resolveAlignmentId(e,t,r);if(i)return Eo.forId(this.context.alignments,i)}getBlockAlignment(e,t){let r=this.resolveAlignmentId(e,t);if(r)return ht.forId(this.context.alignments,r)}getPrependAlignment(e){}get formattingRelevantNode(){if(this._formattingRelevantNode===void 0)if(this.ruleName===this.formattingRelevantRuleName)this._formattingRelevantNode=this.ruleNode;else{let e=ce(this,this.formattingRelevantRuleName);this._formattingRelevantNode=e.ruleNode||null}return this._formattingRelevantNode}isWithinFormattingScope(e,t){let r=this.formattingRelevantNode;return!r||!KC(r,e)?!1:t!=="after"?!0:(ge(e)?e:e.getLastToken())!==r.getLastToken()}},Qe=oI;o(oI,"NodeFormatter");var sI=class extends Qe{constructor(){super(...arguments);m(this,"isTernary",!!this.ruleNode.getFirstToken(t=>xe(t)==="?")&&!!this.ruleNode.getFirstToken(t=>xe(t)===":"))}beforeNodeNoCache(t){return this.isTernary?[]:this.parent?.ruleName===E.queryPrimary?[`
+1`]:[]}afterNodeNoCache(t){if(this.isTernary)return[];let r=this.parent?.ruleName;return!r||r===E.cardinalityAndFilter?[]:[E.queryPrimary,E.tableExpression,E.typeAssociationCont].includes(r)?[`
=`]:[]}},Td=sI;o(sI,"ConditionFormatter");var aI=class extends Qe{constructor(){super(...arguments);m(this,"startsWithExpr",!1);m(this,"startsWithBracket",!1);m(this,"hasFoundExprL",!1);m(this,"hasAlignedOp",!1);m(this,"_ancestor");m(this,"_expressionAncestor");m(this,"alignWithinBlock",this.context.formatOptions.getOption("alignExprAndCondWithinBlock",this.firstTokenIndex))}get ancestor(){if(this._ancestor===void 0){if(this.alignWithinBlock)return this._ancestor=ce(this,E.condition),this._ancestor;if(this._ancestor=ce(this,E.queryPrimary,E.queryExpression),this._ancestor)return this._ancestor;this._ancestor=ce(this,E.typeCompoStruct,E.entityDef)}return this._ancestor}get expressionAncestor(){return this._expressionAncestor===void 0&&(this._expressionAncestor=ce(this,E.expression)),this._expressionAncestor}beforeNodeNoCache(t){let r=!1,i=t.children[0];return ye(i)&&(this.startsWithExpr=i.ruleName===E.expression,this.startsWithBracket=this.startsWithExpr&&i.getFirstToken(st).getLowerLexem()==="(",r=!this.startsWithExpr||this.startsWithBracket),r||!this.ancestor?["\xB0"]:[]}beforeChildNoCache(t,r){if(!this.hasFoundExprL)return this.hasFoundExprL=!0,this.expressionAncestor&&this.expressionAncestor.insideCase?[]:[this.ancestor?.getAlignment("exprL",r.startTokenIndex,!this.alignWithinBlock)];if(!this.hasAlignedOp)return this.hasAlignedOp=!0,[this.ancestor?.getAlignment("op",r.startTokenIndex,!this.alignWithinBlock)];let i=xe(r);return Un(r)===E.expression||i==="null"||i==="all"||i==="some"||i==="any"?[this.ancestor?.getAlignment("exprR",r.startTokenIndex,!this.alignWithinBlock),"\xB0"]:[]}},kd=aI;o(aI,"ConditionTermFormatter");var cI=require("assert");var lI=class extends Qe{constructor(){super(...arguments);m(this,"scopeRules",[E.mixinElementDef,E.elementDefInner,E.selectItemDef]);m(this,"ancestorRules",[E.artifactDefOrExtend,E.typeSpecSemi]);m(this,"disablementAncestorRules",[E.parameterListDef,E.returnTypeSpec])}getComponentAlignment(t,r){if(ce(this.ruleNode,...this.disablementAncestorRules))return;let i=this.parent?.ruleName===E.typeDef?ce(this,E.start):ce(this,...this.ancestorRules);(0,cI.strict)(i,"missing statement ancestor");let s=ce(this,E.typeCompoStruct);if(s)return this.context.formatOptions.getOption("alignTypesWithinBlock",r)?s.getAlignment(t,r):i.getAlignment(`${s.ruleName}.${t}`,r);if(this.context.formatOptions.getOption("alignTypesWithinBlock",r)){(0,cI.strict)(this.ruleName,"no ruleName");let a=ce(this,E.typeStruct)??(this.scopeRules.includes(this.ruleName)?this:ce(this,...this.scopeRules));if(a)return i.getAlignment(`${a.ruleName}.${t}`,r)}return i.getAlignment(t,r)}},sa=lI;o(lI,"GenericColonAndTypeFormatter");var uI=class extends sa{beforeChildNoCache(e,t){let r=o(a=>this.context.formatOptions.getOption("whitespaceAroundAlignedOps",a.tokenIndex)?" ":"","paddingIfAligned"),i,s;if(ye(t))return[];switch(xe(t)){case":":if(!this.context.formatOptions.getOption("alignColonsBeforeTypes",t.tokenIndex))return[];i="typeColon",s=r(t);break;case"array":case"localized":if(!this.context.formatOptions.getOption("alignTypes",t.tokenIndex))return[];i="type";break;case"=":if(!this.context.formatOptions.getOption("alignEqualsAfterTypes",t.tokenIndex))return[];i="typeEquals",s=r(t);break;default:return[]}return s!==void 0&&this.applyAfterCurrentChild.push(s),[s,this.getComponentAlignment(i,t.tokenIndex)]}},Wn=uI;o(uI,"GenericElementComponentsFormatter");var pI=class extends Wn{constructor(){super(...arguments);m(this,"entityDefAncestor",ce(this,E.typeCompoStruct,E.typeStruct,E.entityDef));m(this,"alignName",!0);m(this,"alignedWithName",!1)}beforeNodeNoCache(t){if(!this.entityDefAncestor)return[];if(xe(t.getFirstToken(st))==="key"){let r=[this.entityDefAncestor.getBlockAlignment("elementKey",this.firstTokenIndex)];return this.context.formatOptions.getOption("alignAfterKey",this.firstTokenIndex)||(this.alignName=!1),r}return this.alignedWithName=!0,[this.entityDefAncestor.getBlockAlignment("elementName",this.firstTokenIndex)]}beforeChildNoCache(t,r){let i=super.beforeChildNoCache(t,r);return i.length?i:["virtual","key","masked","element"].includes(xe(r))?[]:this.alignName&&!this.alignedWithName?(this.alignedWithName=!0,[this.entityDefAncestor?.getBlockAlignment("elementName",r.startTokenIndex)]):[]}getPrependAlignment(t){return this.entityDefAncestor?.getBlockAlignment("elementName",t.startTokenIndex)}},Cd=pI;o(pI,"ElementDefInnerFormatter");var dI=class extends Wn{afterChildNoCache(e,t){if(ye(t)&&[E.typeAssociationCont,E.typeAssociationElementCont].includes(Un(t))){let r=t.getFirstToken(st);return xe(r)==="on"?["=","\xB0"]:["\xB0"]}return[]}},Pd=dI;o(dI,"ElementTypeFormatter");var fI=class extends Qe{constructor(e,t){super(e,t),this.enablementSwitch="alignAsInEntities",this.onlyTokenChildren=!0}beforeChildNoCache(e,t){if(ye(t)||t.getLowerLexem()!=="as")return[];let i=ce(this,E.contextDef,E.extendContext,E.start)?.getAlignment("entityAS",t.tokenIndex);return i?[i,"\xB0"]:[]}},Rd=fI;o(fI,"EntityDefFormatter");var mI=class extends Qe{constructor(){super(...arguments);m(this,"startsWithBracket");m(this,"startsWithCase");m(this,"insideCase",!1);m(this,"isTernary");m(this,"conditionAncestor",Zu(this,E.condition));m(this,"partOfCondition",this.parent.ruleName===E.conditionTerm);m(this,"partOfSelectItemInlineList",this.parent.ruleName===E.selectItemInlineList);m(this,"whenThenIndented",!1);m(this,"bracketedTokens");m(this,"_queryAncestor");m(this,"_skipNodeAlignment")}get queryAncestor(){return this._queryAncestor===void 0&&(this._queryAncestor=ce(this,E.queryPrimary)),this._queryAncestor}get skipNodeAlignment(){return this._skipNodeAlignment===void 0&&(this._skipNodeAlignment=this.partOfCondition||!(this.queryAncestor||this.conditionAncestor)||this.queryAncestor&&!this.queryAncestor.state.groupBy),this._skipNodeAlignment}beforeNodeNoCache(t){let r=t.getFirstToken(st),i=xe(r);if(this.startsWithBracket=i==="(",this.startsWithBracket){let a=Zt(r,st);this.isTernary=ye(a)&&a.ruleName==="condition"&&this.context.getFormatter(a)?.isTernary}else this.isTernary=!1;if(this.startsWithCase=i==="case",this.insideCase=this.insideCase||this.startsWithCase,!this.insideCase){let a=[this];for(let c of mo(this,l=>l.ruleName===E.expression))if(a.push(c),c.startsWithCase){a.forEach(l=>l.insideCase=!0);break}}if(this.startsWithCase)return[this.getBlockAlignment("case",this.firstTokenIndex)];if(this.startsWithBracket&&this.conditionAncestor){let a=Ai(this.ruleNode,st);return["when","and","or","in"].includes(xe(a))?[" "]:[]}if(this.skipNodeAlignment||!this.queryAncestor)return[];let s=this.context.formatOptions.getOption("alignExprAndCondWithinBlock",this.firstTokenIndex);return[`
+1`,this.queryAncestor.getAlignment("exprL",this.firstTokenIndex,!s)]}afterNodeNoCache(t){return this.skipNodeAlignment?[]:this.queryAncestor?[`
=`]:[]}beforeChildNoCache(t,r){switch(xe(r)){case"when":return this.whenThenIndented?[`
=`]:(this.whenThenIndented=!0,[`
+1`]);case")":{let i=this.isTernary||this.bracketedTokens<2||Un(fo(r,st))===E.queryExpression;return this.bracketedTokens=void 0,i?[]:[`
`,"="]}}return[]}afterChildNoCache(t,r){let i=xe(r);if(i==="(")return this.isTernary?[]:Un(Zt(r,st))===E.queryExpression?[`
`,!this.queryAncestor||this.queryAncestor.state.selectItemsFinished?void 0:this.queryAncestor.getBlockAlignment("selectItem",r.startTokenIndex),"+1"]:(this.bracketedTokens=JC(t,r,")"),this.bracketedTokens<2?[]:[`
`,"+1"]);if(Un(r)===E.queryExpression)return[`
=`];if(ge(r))switch(i){case"-":if(r.isOperator()&&r!==t.getFirstToken(st))return[" "];break;case"end":return["="];case",":if(this.partOfSelectItemInlineList)return[`
`];break}return[]}},Ad=mI;o(mI,"ExpressionFormatter");var hI=class extends Qe{constructor(e,t){super(e,t)}beforeColon(e,t,r){let i=this.context.formatOptions.getOption("alignColonsInAnnotations",t.tokenIndex)&&Gc(e),s=this.context.formatOptions.getOption("whitespaceBeforeColonInAnnotation",t.tokenIndex),a=this.context.formatOptions.getOption("whitespaceAfterColonInAnnotation",t.tokenIndex),c=[],l;s&&c.push(" ");let u=ur(e,this.context);if(i){l=Li(e);let p=r?.getAlignment(`colon-${u}-${l}`,t.tokenIndex);p&&c.push(p)}if(a&&this.applyAfterCurrentChild.push(" "),!r)return c;if(this.context.formatOptions.getOption("alignValuesInAnnotations",t.tokenIndex)){l??(l=Li(e));let p=r.getAlignment(`value-${u}-${l}`,t.tokenIndex);p&&this.applyBeforeNextChild.push(p)}return this.applyBeforeNextChild.push("\xB0"),c}},aa=hI;o(hI,"ColonAndValueFormatter");var gI=class extends aa{constructor(t,r,...i){super(t,r);m(this,"alignmentScopes");this.alignmentScopes=i}beforeChildNoCache(t,r){return ge(r)&&r.getLowerLexem()===":"&&ce(this,...Vc)?this.beforeColon(t,r,ce(this,...this.alignmentScopes)):[]}},ca=gI;o(gI,"GenericNamedValueFormatter");var bI=class extends ca{constructor(e,t){super(e,t,E.annoValue)}},Ld=bI;o(bI,"FlattenedValueFormatter");var HD=require("assert");var vI=class extends Qe{constructor(e,t){super(e,t),this.enablementSwitch="alignActionNames"}beforeChildNoCache(e,t){if(["action","function"].includes(xe(t))){let r=this.ruleName===E.actionFunctionMainDef?ce(this,E.serviceDef,E.contextDef):ce(this,E.artifactDefOrExtend);(0,HD.strict)(r,"missing scope ancestor"),this.applyBeforeNextChild.push(r.getAlignment("actionName",t.startTokenIndex))}return[]}},Hc=vI;o(vI,"GenericActionFunctionFormatter");var zD=require("assert");var yI=class extends aa{constructor(t,r){super(t,r);m(this,"alignmentScopes",[E.annotationAssignment_paren,E.typeCompoStruct,E.entityDef,E.viewDef,E.typeDef,E.artifactDefOrExtend]);m(this,"_scopeAncestor")}get scopeAncestor(){return this._scopeAncestor===void 0&&(this._scopeAncestor=ce(this,...this.alignmentScopes)),this._scopeAncestor}beforeNodeNoCache(t){if(t.ruleName===E.annotationAssignment_1)return[];if((0,zD.strict)(this.scopeAncestor,"missing scope ancestor"),ur(t,this.context)==="pre"){if(this.context.formatOptions.getOption("alignPreAnnotations",this.firstTokenIndex))return[this.scopeAncestor.getAlignment("annoAt-pre-"+Li(t),this.firstTokenIndex)]}else{let r=[" "];if(this.context.formatOptions.getOption("alignPostAnnotations",this.firstTokenIndex)){let i=(this.parent?.ruleName===E.artifactDefOrExtend?"annoAt-post-artif-":"annoAt-post-")+Li(t);r.push(this.scopeAncestor.getAlignment(i,this.firstTokenIndex))}return r}return[]}beforeChildNoCache(t,r){return xe(r)!==":"?[]:this.beforeColon(t,r,this.scopeAncestor)}},wo=yI;o(yI,"GenericAnnotationAssignmentFormatter");var II=class extends Qe{constructor(t,r){super(t,r);m(this,"_ancestor");this.enablementSwitch="alignAsInUsing",this.onlyTokenChildren=!0}get ancestor(){return this._ancestor===void 0&&(this._ancestor=ce(this,E.usingDeclaration)),this._ancestor}beforeChildNoCache(t,r){if(xe(r)==="as")return[this.ancestor?.getAlignment("usingAS",r.startTokenIndex)];let i=Zt(r,st);return!i||[",","."].includes(xe(i))?[this.ancestor?.getAlignment("usingEffectiveName",r.startTokenIndex),"\xB0"]:[]}},Ed=II;o(II,"InnerUsingFormatter");var xI=require("assert");var SI=class extends Wn{constructor(){super(...arguments);m(this,"queryAncestor",ce(this,E.queryPrimary))}beforeNodeNoCache(t){return(0,xI.strict)(this.queryAncestor,"missing query ancestor"),(0,xI.strict)(!this.queryAncestor.lateFrom,"unexpected state: late FROM"),[this.queryAncestor.getAlignment("mixinL",this.firstTokenIndex)]}},wd=SI;o(SI,"MixinElementDefFormatter");var TI=class extends ca{constructor(e,t){super(e,t,E.annoSubValue)}},Fd=TI;o(TI,"NamedValueFormatter");var kI=require("assert");var CI=class extends Qe{constructor(){super(...arguments);m(this,"_queryAncestor")}get queryAncestor(){return this._queryAncestor===void 0&&(this._queryAncestor=ce(this,E.queryExpression)),this._queryAncestor}beforeChildNoCache(t,r){if(ye(r)){let s=r.ruleName;(0,kI.strict)(s===E.expression,`unexpected child rule: ${s}`);let a=this.context.formatOptions.getOption("alignExprAndCondWithinBlock",r.startTokenIndex);return[`
`,this.queryAncestor.getAlignment("exprL",r.startTokenIndex,!a)]}let i=r.getLowerLexem();return i==="asc"||i==="desc"?[this.queryAncestor.getAlignment("sortOrder",r.tokenIndex)]:((0,kI.strict)(i==="nulls",`unexpected lexem: ${i}`),[this.queryAncestor.getAlignment("nulls",r.tokenIndex),"\xB0"])}},Dd=CI;o(CI,"OrderBySpecFormatter");var PI=class extends Qe{beforeNodeNoCache(e){let t=ce(this,E.queryPrimary);return t?[`
`,t.getAlignment("excluding",this.firstTokenIndex)]:["\xB0"]}afterNodeNoCache(e){return[`
`]}},Nd=PI;o(PI,"ProjectionExclusionFormatter");var QD=require("assert");function Vz(){let n=" ";return function(e){if(e<=0)return"";for(;e>n.length;)n+=n;return n.slice(0,e)}}o(Vz,"Blanks");var Fo=Vz();var la=class extends fn{renderString(e,t){if(this.value.nAtLeast===0){if(!e)return" ";let r=`${e.precedingText}\xB0${e.succeedingText}`,i=e.precedingToken?.tokenIndex??0;return!la.blankForbidden.test(r)&&(la.blankRequired.test(r)||t&&Object.entries(la.blankRequiredIfUserOption).some(([a,c])=>t.formatOptions.getOption(a,i)&&c.test(r)))?" ":""}if(this.value.nAtLeast!==void 0)return Fo(this.value.nAtLeast);if(this.value.bIgnore)return"";throw new Error("unexpected state")}toString(){if(this.value.bIgnore)return"-WS-";let e=0;this.value.nAtLeast!==void 0&&(e=this.value.nAtLeast);let t="";for(let r=0;r<e;r++)t+="\xB7";return t}},Ut=la;o(la,"Whitespace"),m(Ut,"blankRequired",/\w°[$\w@'"]|[)}\]']°\w|[\w)']°{|\[°!\[|]°]/),m(Ut,"blankRequiredIfUserOption",{whitespaceWithinBrackets:/[{([]°|°[})\]]/}),m(Ut,"blankForbidden",/(x|date|time(stamp?))°'/i);var XD=require("assert");var AI=class{constructor(e,t){this.globalContext=e;this.blockAlignmentManager=t;m(this,"nextRemovableNewline")}processFormatting(e,t,r,i,s=!1){let a=this.globalContext.tracer,c;function l(p,d){a.debug(()=>{let f=JSON.stringify(p instanceof fn?p.toString():p),g=JSON.stringify(`
\u22650`).length,h=o(()=>" ".repeat(Math.max(0,g-f.length)),"spaces"),T=t?ge(t)&&t.isBlockComment()&&!t.isInlineComment()?JSON.stringify(t.id):t.id:"?";return`format	${f}${h()}	${r==="before"?"->":"<-"}  ( ${T} )${d?` [${d}]`:""}${i?` \xAB ${i}`:""}`}),c=!0}if(o(l,"logInstructions"),Array.isArray(e)){e.forEach(p=>this.processFormatting(p,t,r,i,s));return}let u=e;if(gd(u)){l(u instanceof ht?"[BA]":"[A]",u.id),u instanceof ht?this.globalContext.blockAlignmentManager.appendBlockAlignment(u):this.appendToStream(u);return}if(typeof u=="string"){let p=u;if([void 0,null].includes(p))return;if(!this.globalContext.delayedThings.isEmpty()&&!s){this.globalContext.delayedThings.add({trigger:r,formattedObject:t,instructionOrAlignment:p});return}if(["","|"].includes(p)){l(p),p==="|"?this.appendToStream(RI()):this.appendToStream(RI(0));return}let d=o((f,g)=>`Unsupported formatting instruction for ${f}: ${g}`,"unsupportedError");for(let f=0;f<p.length;f++){c=!1;let g=p[f];switch([">","+","/","-"," ",`
`].includes(g)||l(g),g){case">":case"+":case"/":{let h=g,T=h===">"?1:this.globalContext.formatOptions.getOption("tabSize",t.startTokenIndex),S=h==="/",C=t.parent;if(!C)throw new Error(d(t,p));let L="";for(;f+1<p.length&&p[f+1]>="0"&&p[f+1]<="9";)f++,L+=p[f];let A=parseInt(L,10)*T;if(KD(t)){c=!0;break}if(l(h+A),S){let W=this.globalContext.instructionsDelayedTillNewline.get(t)||[];W.push("+"+L),this.globalContext.instructionsDelayedTillNewline.set(t,W)}else this.blockAlignmentManager.newBlockAlignment(`${C.id}+${A}#${this.globalContext.alignments.nextFreeBlockAlignmentId}`,A,C);break}case"-":{let h=t.parent;if(h){let T="";for(;f+1<p.length&&p[f+1]>="0"&&p[f+1]<="9";)f++,T+=p[f];let S=parseInt(T,10)*this.globalContext.formatOptions.getOption("tabSize",t.startTokenIndex);l(`-${S}`),this.blockAlignmentManager.newBlockAlignment(`${h.id}-${S}#${this.globalContext.alignments.nextFreeBlockAlignmentId}`,-S,h);break}throw new Error(d(t,p))}case"=":{if(t.parent){if(c=!0,KD(t))break;this.blockAlignmentManager.popBlockAlignment();break}throw new Error(d(t,p))}case" ":{let h=1;for(;f+1<p.length&&p[f+1]===" ";)f++,h++;l(" ".repeat(h)),this.appendToStream(RI(h));break}case`
`:{this.nextRemovableNewline===this.globalContext.formattingStream.stream.length&&this.globalContext.removableNewlines.set(this.nextRemovableNewline,t);let h=0;for(;f+1<p.length&&p[f+1]===`
`;)f++,h++;if(l(`
\u2265`+h),this.appendToStream(new St().atLeast(h)),this.globalContext.instructionsDelayedTillNewline.size)for(let[T,S]of this.globalContext.instructionsDelayedTillNewline){let C=ye(T)?T:T.parent;this.globalContext.getFormatter(C).isWithinFormattingScope(t,r)&&this.processFormatting(S,t,r,"delayed",s),this.globalContext.instructionsDelayedTillNewline.delete(T)}break}case"^":this.nextRemovableNewline=this.globalContext.formattingStream.stream.length;break;case"\xB0":break;default:throw new Error("Unsupported formatting instruction: "+g)}(0,XD.strict)(c,`formatting instruction not logged: ${g}`)}return}u instanceof fn&&l(u),this.appendToStream(u)}appendToStream(e){if(ge(e)){if(this.globalContext.formatOptions.getOption("keepOriginalEmptyLines",e.tokenIndex)){let t=this.globalContext.lastProcessedToken?Math.min(e.line-this.globalContext.lastProcessedToken.endLine,this.globalContext.formatOptions.getOption("maxKeepEmptyLines",e.tokenIndex)+1):0;t>1&&this.processFormatting(`
`.repeat(t),e,"before","emptyLines",!0)}this.globalContext.lastProcessedToken=e}this.globalContext.formattingStream.append(e)}},_d=AI;o(AI,"FormattingProcessor");function RI(n){return n===void 0?new Ut().atLeast(0):new Ut().atLeast(n)}o(RI,"whitespace");function KD(n){if(!ge(n))return!1;switch(n?.text){case"{":return n.getNextToken()?.text==="}";case"}":return n.getPreviousToken()?.text==="{"}return!1}o(KD,"isEmptyPair");var EI=class{constructor(){m(this,"node");m(this,"child",{})}},LI=EI;o(EI,"RenderingFinished");var wI=class{constructor(e,t){this.blockRenderOptions=e;this.globalContext=t;m(this,"_processor");m(this,"delayedUnindent");this._processor=new _d(t,this.globalContext.blockAlignmentManager)}ejectToken(e,t=!1){let r=xe(e),i=o(h=>!!h&&["{","[","("].includes(h.text),"isOpeningBracket"),s=o(h=>!!h&&["}","]",")"].includes(h.text),"isClosingBracket"),a=o(h=>["{","}"].includes(h.text)?"curly":["[","]"].includes(h.text)?"square":["(",")"].includes(h.text)?"round":"none","bracketType"),c,l,u=this.globalContext.formatOptions.getOption("keepEmptyBracketsTogether",e.tokenIndex)&&s(e)&&i(c=e.getPreviousToken())&&a(e)===a(c)?Ce:this.getFormattingInstructions("before",this.globalContext.formatOptions,e)[r],p=this.globalContext.formattingStream.stream,d=u===void 0&&!(p[p.length-1]instanceof Me);this._processor.processFormatting(d?tn:u,e,"before","token",!0),t||this.prependDelayedThings(e),this._processor.appendToStream(e);let f=e.getFollowUpLineEndComment(),g=this.globalContext.formatOptions.getOption("keepEmptyBracketsTogether",e.tokenIndex)&&i(e)&&s(l=e.getNextToken())&&a(e)===a(l)?Ce:this.getFormattingInstructions("after",this.globalContext.formatOptions,e)[r];if(g===void 0)this._processor.processFormatting(tn,e,"after","token",!0);else if(f){let h=g.indexOf(`
`);h>=0?(this._processor.processFormatting(g.slice(0,h),e,"after","token",!0),this.onToken(f,!0),this._processor.processFormatting(g.slice(h),e,"after","token",!0)):this._processor.processFormatting([g,tn],e,"after","token",!0)}else this._processor.processFormatting(g,e,"after","token",!0)}prependDelayedThings(e){let t=this.globalContext.delayedThings;if(t.isEmpty())return;let r=["elementDef"],i,s;t.isInline||(t.hasSeparateLineAnno&&fo(ce(e,...r),c=>ye(c)&&!$n(c))&&this._processor.processFormatting(`

`,t.firstNodeOrToken,"before","delayed",!0),s=this.globalContext.blockAlignmentManager.lastAlignment(),i=this.globalContext.getFormatter(e?.parent)?.getPrependAlignment(e),!i&&!(s instanceof ht)&&(i=new ht(this.globalContext.alignments,"_eq:"+(s?s.id:"?")),i.setRelativeAlignment(s,0)),i&&this._processor.processFormatting(i,e,"before","delayed",!0)),t.getAll().forEach(a=>{ge(a)?this.onToken(a,!0):ye(a)?this.onBlock(a,!0):this._processor.processFormatting(a.instructionOrAlignment,a.formattedObject,a.trigger,"delayed",!0)}),t.reset(),i&&(i instanceof ht&&this.globalContext.blockAlignmentManager.popBlockAlignment(i.id),this._processor.processFormatting(s,e,"before","delayed",!0)),this._processor.processFormatting(tn,e,"before","delayed",!0)}onCommentToken(e){function t(l){let u=e.text.match(un(/@formatter\s+/).and(un(/([^:\s]+)/).capture("setting")).and(/\s*:\s*/).and(un(/((\S*)(?=\*\/)|(\S*))/).capture("value")));if(!u)return!1;let p=u.groups.setting,d=u.groups.value;switch(d){case"":return l.tracer.error(()=>`invalid formatter setting: value missing: ${e.text}`),!1;case"reset":l.formatOptions.resetLocally(p,e.tokenIndex);break;default:l.formatOptions.setLocallyFromString(p,d,e.tokenIndex)}return!0}o(t,"processLocalFormatOption");function r(l){let u=e.text.match(/@formatter\s*:\s*(on|off)?/);if(!u)return;let p=u[1];if(!p){l.tracer.error(()=>`invalid formatter enablement: ${e.text}`);return}l.formattingEnablements.push({token:e,enabled:p==="on"})}o(r,"checkLocalFormatterEnablement");let i=e.getPreviousToken(),s=e.getNextToken(),a=i?Math.max(0,e.line-i.endLine-1):void 0,c=s?Math.max(0,s.line-e.endLine-1):void 0;if(e.isComment()&&!t(this.globalContext)&&r(this.globalContext),!e.ejected)try{if(a){let u=1+Math.min(a,this.globalContext.formatOptions.getOption("maxKeepEmptyLines",e.tokenIndex));this._processor.processFormatting(`
`.repeat(u),e,"before","comment",!0)}this._processor.processFormatting(e.isFollowUpComment()?Te:Ge,e,"before","comment",!0);let l=e.isInlineComment();if(e.isBlockComment()&&!l?(e.isDocComment()&&(e=Gz(e,this.globalContext.formatOptions.getOption("maxDocCommentLine",e.tokenIndex))),this.renderTokensAsIs([e])):this._processor.appendToStream(e),l){s&&s.isOperator()||this._processor.processFormatting(Te,e,"after","comment",!0);return}this._processor.processFormatting(`
`,e,"after","comment",!0)}finally{if(e.ejected=!0,c){let l=1+Math.min(c,this.globalContext.formatOptions.getOption("maxKeepEmptyLines",e.tokenIndex));this._processor.processFormatting(`
`.repeat(l),e,"after","comment",!0)}}}renderTokensAsIs(e){let t=o((l,u)=>{let p=0;for(let d of l)p+=d==="	"?u-p%u:1;return p},"calculateEffectiveStartColumn"),r=e.reduce((l,u)=>{let p=this.globalContext.originalSourceLines[u.line],d=this.globalContext.formatOptions.getOption("tabSize",u.tokenIndex);if(u=u.clone({character:t(p.slice(0,u.character),d)}),u.isComment()){let f=dc(u.text),g=u.startOffset;for(let h=0;h<f.lineCount;h++){let T=f.leftTrimmedLines[h],S=u.clone({text:T,line:u.line+h,character:h===0?u.character:f.firstCharacterOffsets[h],startOffset:g});l.push(S),g+=f.lines[h].length+f.lineBreaks[h].length}}else l.push(u);return l},[]),i,s,a,c=o(()=>{},"align");for(let l=0;l<r.length;l++){let u=r[l],p=r[l-1];if(l===0){i=u.line,s=u.character;let d=u.tokenIndex===0;a=new oa(this.globalContext.alignments,s);let f=[a],g=this.globalContext.blockAlignmentManager.lastBlockAlignment();g&&f.unshift(g),c=o(()=>f.forEach(h=>this._processor.processFormatting(h,u,"before","asIs",!0)),"align"),c(),d&&s>0&&this._processor.processFormatting(Fo(s),u,"before","asIs",!0)}if(p){let d=u.line-p.endLine,f=null;d>0?(a.setIndentation(u.line-i,u.character),this._processor.processFormatting(new St().atLeast(d-1),u,"before","asIs",!0),c()):(f=Fo(u.character-(p.character+p.text.length)),this._processor.processFormatting(f,u,"before","asIs",!0))}this._processor.appendToStream(u)}}formatAroundChild(e,t,r,i,s,a,c){let l=(r==="before"?s.beforeChild(e,t):s.afterChild(e,t))||null;l?.length&&($n(t)&&!c?l.forEach(u=>this.globalContext.delayedThings.add({trigger:r,formattedObject:t,instructionOrAlignment:u})):this._processor.processFormatting(l,t,r,i,c),a.child[r]=l.includes("\xB0"))}renderNode(e,t=!1){let r=new LI,i=this.globalContext.getFormatter(e);if(i){let a=i.beforeNode(e);this._processor.processFormatting(a,e,"before","node",t),r.node=a.includes("\xB0")}for(let a of e.children){let c=i&&!r.node&&!(i.onlyTokenChildren&&ye(a))&&!(i.ignoreComments&&ge(a)&&a.isComment())&&!(i.ignoreAnnotations&&$n(a));c&&!r.child.before&&this.formatAroundChild(e,a,"before","child",i,r,t),ge(a)?this.onToken(a,t):this.onBlock(a,t),c&&!r.child.after&&this.formatAroundChild(e,a,"after","child",i,r,t)}t||this.prependDelayedThings(void 0),i&&(r.node||this._processor.processFormatting(i.afterNode(e),e,"after","node",t),i.destroy());let s=e.parent;for(;s;)s.data.streamIndexFrom=s.data.streamIndexFrom===-1||e.data.streamIndexFrom===-1?e.data.streamIndexFrom===-1?s.data.streamIndexFrom:e.data.streamIndexFrom:Math.min(s.data.streamIndexFrom,e.data.streamIndexFrom),s.data.streamIndexTo=Math.max(s.data.streamIndexTo,e.data.streamIndexTo),s=s.parent}onToken(e,t=!1){e.isComment()?t||e.isFollowUpComment()&&e.isSingleLined()&&this.globalContext.delayedThings.isEmpty()?this.onCommentToken(e):e.ejected||this.globalContext.delayedThings.add(e):this.ejectToken(e,t)}onBlock(e,t=!1){let r=ur(e,this.globalContext);this.globalContext.annotationTypes[e.id]=r,r==="pre"&&!t?this.globalContext.delayedThings.add(e):this.globalContext.format(e,t)}beginBlock(e,t=!1){function r(l){let u,p;for(p=l.length-1;p>=0&&(u=l[p],!(u instanceof St||!(u instanceof Me)));p--);return u instanceof St?{lineBreak:u.clone(),index:p}:void 0}o(r,"findPrecedingLineBreak");let i=this.blockRenderOptions.beforeBlock,s,a=fo(e),c="before";if(a&&ye(a))if(a.ruleName!==e.ruleName)i=this.blockRenderOptions.beforeBlockGroup;else{c="between";let u=this.isSingleLined(a)&&this.globalContext.formatOptions.getOption("keepSingleLinedBlocksTogether",e.startTokenIndex),p;u&&(p=r(this.globalContext.formattingStream.stream)),i=this.blockRenderOptions.betweenBlocks,s=p}if(this.delayedUnindent=0,this.blockRenderOptions.forceUnindentBlock){let l=/\+([0-9]+)/g.exec(i)?.reduce((u,p,d)=>u+(d===0?0:Number(p)),0);this.delayedUnindent=l}return this._processor.processFormatting(i,e,c,"beginBlock",t),s}endBlock(e,t,r=!1){t&&this.isSingleLined(e)&&(this.globalContext.tracer.debug(()=>"Reverting newline after "+e.id),this.globalContext.formattingStream.stream.splice(t.index,1,t.lineBreak));let i=this.blockRenderOptions.afterBlock,s=Zt(e);if(s&&ye(s)&&s.ruleName!==e.ruleName&&(i=this.blockRenderOptions.afterBlockGroup),i=i??"",this.delayedUnindent){let a=i.split("=").length-1;a<this.delayedUnindent&&(i+="=".repeat(this.delayedUnindent-a)),this.delayedUnindent=0}this._processor.processFormatting(i,e,"after","endBlock",r)}isSingleLined(e){return this.globalContext.formattingStream.stream.slice(e.data.streamIndexFrom,e.data.streamIndexTo+1).find((t,r,i)=>{if(t instanceof St){let s=i[r-1];return!(ge(s)&&s.isComment())}return!1})===void 0}static replaceNewlineWithWhitespace(e,t){if(!t.removableNewlines.has(e))return;t.removableNewlines.delete(e);let r=t.formattingStream.stream,i=r[e-1],s=new Ut().atLeast(0);i instanceof Ut?(i.merge(s),r.splice(e,1,new Ut)):r.splice(e,1,s)}getFormattingInstructions(e,t,r){let i=r.tokenIndex,s=r.parent,a=t.getOption("whitespaceAroundBinaryOps",i),c=s.ruleName;function l(f,g,h){let T={[E.annoSubValue]:[E.namedValue,E.annoSubValue],[E.annoValue]:[E.flattenedValue,E.annoSubValue],[E.selectItemInlineList]:[E.expression,"as"]},S=gc(s,...T[g]??[])>=2;h==="before"?S?(f["}"]=nn,f["]"]=nn):(f["}"]=tn,f["]"]=tn):S?(f["{"]=Mt,f["["]=Mt):(f["{"]=tn,f["["]=tn)}o(l,"bracketWhitespacing");function u(){return["typeRefOptArgs","tableExpression"].includes(c)}o(u,"isScopeDelimiter");let p=c==="condition"&&this.globalContext.getFormatter(s).isTernary,d;switch(e){case"before":switch(d={"#":Te,".":Ce,",":Ce,";":Ce,"(":[E.typeRefArgs,E.typeNamedArgList].includes(c)&&Un(Zt(r,Ht))===E.typeNamedArg?Te:Ce,")":tn,"{":t.getOption("openingBraceInNewLine",i)?Ge:tn,"}":nn,":":p?Te:t.getOption("whitespaceBeforeColon",i)&&!u()&&!Gc(r)?Te:Ce,"?":p?Te:Ce,"::":Ce,"+":a?Te:Ce,"-":a?Te:Ce,"*":a&&r.getPreviousToken()?.text!=="."?Te:Ce,"/":a?Te:Ce,"=":a?Te:Ce,"||":a?Te:Ce,"<":a?Te:Ce,">":a?Te:Ce,"<=":a?Te:Ce,">=":a?Te:Ce,"<>":a?Te:Ce,"!=":a?Te:Ce},c){case E.annotationAssignment_1:s.children.length>1&&(d["]"]=nn);break;case E.annotationAssignment_paren:gc(s,E.annotationAssignment_1)>1&&(d[")"]=nn);break;case E.artifactDefOrExtend:d.betweenBlocks=lr;break;case E.annoSubValue:l(d,c,e),gc(s,E.namedValue,E.annoSubValue)<2?(d["}"]=tn,d["]"]=tn):(d["}"]=nn,d["]"]=nn);break;case E.condition:d.and=Ge,d.or=Ge;break;case E.expression:d.then=nn,d.else=nn,d.end=`
==`;break;case E.queryExpression:d.order=Ge,d.limit=Ge,d.offset=Ge,d[")"]=nn;break;case E.queryPrimary:d.mixin=Ge,d.into=Ge,d.top=Ge,d.excluding=Ge,d.where=Ge,d.group=Ge,d.having=Ge,d[")"]=nn,d["*"]=r.getPreviousToken()?.text==="*"?void 0:Te;break;case E.selectItemInlineList:l(d,c,e);break;case E.tableExpression:d["("]=Te,d[")"]=nn,d.on=Mt;break;case E.typeAssociationCont:case E.typeAssociationElementCont:d.on=Mt;break;case E.usingDeclaration:this.globalContext.countDescendants(s,E.usingProxy)<2&&delete d["}"];break;case E.annoValue:l(d,c,e);break;case E.viewDef:d.order=Ge;break}return d;case"after":switch(d={"#":Ce,".":Ce,",":t.getOption("whitespaceAfterComma",i)?Te:Ce,"(":tn,";":Ge,"{":Mt,"@":Ce,":":p?Te:t.getOption("whitespaceAfterColon",i)&&!u()&&!Gc(r)?Te:Ce,"?":p?Te:Ce,"::":Ce,"+":a?Te:Ce,"-":tn,"*":a&&c!==E.queryPrimary&&!",*".includes(r.getNextToken()?.text)?Te:tn,"/":a?Te:Ce,"=":a?Te:Ce,"||":a?Te:Ce,"<":a?Te:Ce,">":a?Te:Ce,"<=":a?Te:Ce,">=":a?Te:Ce,"<>":a?Te:Ce,"!=":a?Te:Ce},c){case E.annotationAssignment_1:s.children.length>1&&(d["["]=Mt);break;case E.annotationAssignment_paren:gc(s,E.annotationAssignment_1)>1&&(d["("]=Mt);break;case E.annoSubValue:l(d,c,e);break;case E.artifactDefOrExtend:d.betweenBlocks=lr,d.with=Te;break;case E.elementDefOrExtend:d.with=Te;break;case E.expression:d.when=Mt,d.then=Mt,d.else=Mt;break;case E.queryExpression:d["("]=Mt;break;case E.queryPrimary:d["("]=Mt;break;case E.selectItemDef:d.key=Te;break;case E.selectItemInlineList:l(d,c,e),d[","]=Ge;break;case E.tableExpression:d["("]=Mt,d[","]=Ge;break;case E.typeAssociationCont:case E.typeAssociationElementCont:d.on=Te;break;case E.usingDeclaration:this.globalContext.countDescendants(s,E.usingProxy)<2&&delete d["{"];break;case E.annoValue:l(d,c,e);break}return d;default:return}}},ua=wI;o(wI,"GenericRuleRenderer");function Gz(n,e){return n.isDocComment()&&(n=n.clone({text:dd(n.text,n.character,e)})),n}o(Gz,"formatDocCommentToken");var Md=class{static hasKeyElement(e){return e.children.reduce((t,r)=>t||xe(r)==="key",!1)}static parseQuery(e){let t,r=!1;function i(p){return p.openingBraceForSelectItemsInFirstLine!==!1&&(p.openingBraceForSelectItemsInFirstLine=!t&&!r&&p.selectItemsAndAsterisks>0),p}o(i,"complete");let s={fromInline:void 0,lateFrom:void 0,lateFromInline:void 0,lateFromNewLine:void 0,hasSelectItemWithKey:!1,selectItemsAndAsterisks:0,openingBraceForSelectItemsInFirstLine:void 0,lastSelectItem:void 0},a=0,c,l,u;for(let p of e.children)if(c=p,!(ge(p)&&p.isComment()||$n(p))){switch(u=l,l=xe(p),l){case"*":s.selectItemsAndAsterisks++;continue;case"}":if(s.selectItemsAndAsterisks)return s.lastSelectItem=c,i(s);continue;case"from":{t=u!=="select",s.lateFrom=t;let d=s.selectItemsAndAsterisks<2&&a<2;if(s.fromInline=!t||d,s.lateFromInline=t&&d,s.lateFromNewLine=t&&!d,t)return s.openingBraceForSelectItemsInFirstLine=!1,s.lastSelectItem=c,i(s);continue}case"mixin":case"top":case"all":case"distinct":s.openingBraceForSelectItemsInFirstLine=!1}if(ye(p))switch(p.ruleName){case E.selectItemDef:a++,s.selectItemsAndAsterisks++,Md.hasKeyElement(p)&&(s.hasSelectItemWithKey=!0);break;case E.tableExpression:r=p.containedTokens.some(d=>["join","("].includes(xe(d)))}}return i(s)}},Od=Md;o(Md,"QueryParser");var FI=class extends Qe{constructor(t,r,i){super(t,r);this.topLevelQuery=i;m(this,"startsWithBracket");m(this,"state",{selectFound:!1,selectItemsFinished:!1,groupBy:void 0,newlineBeforeChild:void 0,lateFromMultipleSelectItems:void 0});m(this,"firstSelectToken");m(this,"_firstIndentWidth");m(this,"_hasUnindent");m(this,"fromInline");m(this,"lastSelectItem");m(this,"lateFrom");m(this,"lateFromInline");m(this,"lateFromNewLine");m(this,"openingBraceForSelectItemsInFirstLine");this.topLevelQuery=i||Zu(this,E.queryExpression)||this,this.startsWithBracket=this.startsWith("("),this.formattingRelevantRuleName=E.queryExpression}get hasUnindent(){if(this._hasUnindent===void 0){let t=ce(this,E.queryExpression);this._hasUnindent=t.ruleNode.containedTokens.some(Ud)}return this._hasUnindent}get firstIndentWidth(){return this._firstIndentWidth||(this._firstIndentWidth=this.hasUnindent?2:1),this._firstIndentWidth}resolveLocalAlignmentIdAliases(t){for(;t&&this.topLevelQuery.alignmentIdAliases.has(t);)t=this.topLevelQuery.alignmentIdAliases.get(t);return t}resolveAlignmentId(t,r,i=!1){if(t=this.resolveAlignmentIdAliases(t,r),!t)return;let s=this.id;return i&&(s=s.replace(/^[^@]+/,"query")),`${s}/${t}`}beforeNodeNoCache(t){let r=Od.parseQuery(t);return this.fromInline=r.fromInline,this.lateFrom=r.lateFrom,this.lateFromInline=r.lateFromInline,this.lateFromNewLine=r.lateFromNewLine,this.openingBraceForSelectItemsInFirstLine=r.openingBraceForSelectItemsInFirstLine,this.lastSelectItem=r.lastSelectItem,this.lastSelectItem||(this.state.selectItemsFinished=!0),this.ruleName===E.queryPrimary&&!r.hasSelectItemWithKey&&this.alignmentIdAliases.set("selectItemKey",void 0),[]}afterNodeNoCache(t){if(this.firstSelectToken&&!Hz(t.data.streamIndexFrom,t.data.streamIndexTo,this.context.formattingStream)){let r=this.context.removableNewlines;for(let i of r.entries())if(i[1]===this.firstSelectToken){ua.replaceNewlineWithWhitespace(i[0],this.context);break}}return[]}beforeChildNoCache(t,r){if(r===this.lastSelectItem&&(this.state.selectItemsFinished=!0),ye(r))return[];if(!r.isKeyword())return[];this.state.groupBy&&(this.state.groupBy=!1);let i=xe(r);if(i==="top")return this.state.newlineBeforeChild=Zt(Zt(r,st),st),[];if(r===this.state.newlineBeforeChild)return this.state.newlineBeforeChild=void 0,[`
`];if(Ud(r))return[`
-1`];switch(i){case"select":{let s=!this.topLevelQuery.state.selectFound;this.topLevelQuery.state.selectFound=!0;let a=ce(this,E.queryPrimary);if(s)return a&&a.startsWithBracket?[`
`]:this.context.formatOptions.getOption("selectInNewLine",r.tokenIndex)?(this.topLevelQuery.firstSelectToken=r,["^",`
`,"+"+this.firstIndentWidth]):this.openingBraceForSelectItemsInFirstLine&&!this.hasUnindent?[]:["/"+this.firstIndentWidth];break}case"from":return this.fromInline?[]:((0,QD.strict)(this.state.lateFromMultipleSelectItems,"unexpected state: FROM in new line with single SELECT item"),[`
=`]);case"into":this.state.newlineBeforeChild=Zt(r,st);break}return[]}afterChildNoCache(t,r){let i=[];if(ye(r))return i;let s=r.getNextToken(),a=xe(r);if(r.isKeyword()){let c=Ai(r,st);if(a==="by"){let l=xe(c);return this.state.groupBy=l==="group",i}(Ud(r)&&!JD(s)||JD(r)&&Ud(c))&&(this.context.formatOptions.getOption("selectInNewLine",r.tokenIndex)&&i.push(`
`),i.push("="))}else a==="*"&&ge(s)&&!s.isOperator()&&i.push(" ");return i}},zc=FI;o(FI,"QueryFormatter");var DI=class extends zc{},qd=DI;o(DI,"QueryExpressionFormatter");var NI=class extends zc{},$d=NI;o(NI,"QueryTermFormatter");var _I=class extends zc{},Wd=_I;o(_I,"QueryPrimaryFormatter");function Ud(n){return ge(n)&&n.isKeyword()?["union","except","minus","intersect"].includes(xe(n)):!1}o(Ud,"startsSetOperation");function JD(n){return ge(n)&&n.isKeyword()?["distinct","all"].includes(xe(n)):!1}o(JD,"finishesSetOperation");function Hz(n,e,t){let r=t.stream;for(let i=n;i<=e;i++)if(r[i]instanceof St)return r[i]}o(Hz,"firstLineBreakBetween");var YD=require("assert");var OI=class extends sa{beforeNodeNoCache(e){if(!this.context.formatOptions.getOption("alignTypes",this.firstTokenIndex))return[];let t=this.getComponentAlignment("type",this.firstTokenIndex);return t?[t]:[]}},_i=OI;o(OI,"GenericTypeFormatter");var MI=class extends _i{constructor(e,t){super(e,t),this.enablementSwitch="alignActionReturns"}beforeNodeNoCache(e){let t=this.parent?.ruleName===E.actionFunctionMainDef?ce(this,E.serviceDef,E.contextDef):ce(this,E.artifactDefOrExtend);(0,YD.strict)(t,"missing scope ancestor");let r=t.getAlignment("returnType",this.firstTokenIndex);return r?[r]:[]}},Bd=MI;o(MI,"ReturnTypeSpecFormatter");var ZD=require("assert");var UI=class extends Wn{constructor(){super(...arguments);m(this,"expressionFound",!1);m(this,"queryAncestor",ce(this,E.queryPrimary,E.projectionSpec,E.extendProjection,E.extendArtifact))}beforeNodeNoCache(t){return(0,ZD.strict)(this.queryAncestor,"missing query ancestor"),this.queryAncestor.lateFromInline?[" "]:!this.queryAncestor.lateFrom||this.queryAncestor.state.lateFromMultipleSelectItems?[`
`]:(this.queryAncestor.state.lateFromMultipleSelectItems=!0,[`
+1`])}afterNodeNoCache(t){return t.getLastToken()?.getNextToken()?.text==="*"?[]:this.queryAncestor.lateFromInline?[" "]:[`
`]}beforeChildNoCache(t,r){let i=super.beforeChildNoCache(t,r);if(i.length)return i;switch(xe(r)){case"key":return[this.queryAncestor.getAlignment("selectItemKey",r.startTokenIndex)];case"as":return this.applyBeforeNextChild=[this.queryAncestor.getAlignment("selectItemEffectiveName",r.startTokenIndex)],[this.queryAncestor.getAlignment("selectItemAS",r.startTokenIndex)]}return this.expressionFound?[]:(this.expressionFound=!0,this.queryAncestor.lateFromInline?[]:(this.applyAfterCurrentChild.push("="),[this.queryAncestor.getBlockAlignment("selectItem",r.startTokenIndex)]))}getPrependAlignment(t){return t.getLowerLexem()==="key"?this.queryAncestor.getBlockAlignment("selectItem",t.tokenIndex):void 0}},jd=UI;o(UI,"SelectItemDefFormatter");var qI=class extends Qe{constructor(e,t){super(e,t),this.onlyTokenChildren=!0}beforeChildNoCache(e,t){function r(i){return i.isKeyword()?["join","inner","outer","left","right","full","cross"].includes(xe(i)):!1}return o(r,"isJoinKeyword"),r(t)&&!r(Ai(t,st))?[`
`]:[]}},Vd=qI;o(qI,"TableExpressionFormatter");var $I=class extends _i{constructor(){super(...arguments);m(this,"alignToRight",!1)}beforeNodeNoCache(t){let r=Zt(t,s=>ye(s)),i=!!r&&r.ruleName===E.typeCompoStruct;return this.alignToRight=!i||this.context.formatOptions.getOption("alignCompositionStructToRight",this.firstTokenIndex),super.beforeNodeNoCache(t)}beforeChildNoCache(t,r){return this.alignToRight?(this.parent?.applyAfterNode.push("="),[new ht(this.context.alignments),"\xB0"]):["\xB0"]}},Gd=$I;o($I,"TypeAssociationBaseFormatter");var WI=class extends _i{},Hd=WI;o(WI,"TypeRefOptArgsFormatter");var BI=class extends Wn{constructor(e,t){super(e,t),this.enablementSwitch="alignTypes"}},zd=BI;o(BI,"TypeSpecSemiFormatter");var jI=class extends Qe{},Kc=jI;o(jI,"NopFormatter");var VI=class{constructor(){m(this,"_ruleNameToFormatterCtor",{actionFunctionDef:Hc,actionFunctionMainDef:Hc,annotationAssignment_1:wo,annotationAssignment_atn:wo,annotationAssignment_fix:wo,annotationAssignment_ll1:wo,condition:Td,conditionTerm:kd,elementDefInner:Cd,elementType:Pd,entityDef:Rd,expression:Ad,usingProxy:Ed,mixinElementDef:wd,namedValue:Fd,flattenedValue:Ld,orderBySpec:Dd,projectionExclusion:Nd,queryExpression:qd,queryPrimary:Wd,queryTerm:$d,returnTypeSpec:Bd,selectItemDef:jd,tableExpression:Vd,typeAssociationBase:Gd,typeRefOptArgs:Hd,typeSpecSemi:zd,viewDef:Kc})}createFormatter(e,t){let r=e.ruleName,i=this._ruleNameToFormatterCtor[r];if(i){let s=new i(e,t);return s.enablementSwitch&&!t.formatOptions.getOption(s.enablementSwitch,e.startTokenIndex)?new Kc(e,t):s}return new Kc(e,t)}},Kd=VI;o(VI,"NodeFormatterFactory");var ot={block:$t.italic,category:$t.fg.lightgray,token:$t.fg.purple,errorToken:$t.fg.red,commentToken:$t.fg.yellow,rule:$t.fg.green};var GI=fn,HI=class{constructor(e){this.globalContext=e;m(this,"stream",[]);m(this,"lineNumber",0);m(this,"currentLineStartsAtIndex",0);m(this,"alignments",{});m(this,"hasTokens",!1);m(this,"hasAlignments",!1);m(this,"allAlignments",{})}append(e){if(!e)return;let t=this.stream,r=this.globalContext.blockAlignmentManager.blockAlignmentStack,i=this,{tracer:s}=this.globalContext;function a(c){function l(d){!i.hasTokens&&(typeof d=="string"||ge(d))&&(i.hasTokens=!0);try{if(d instanceof Me){if(i.alignments[d.id]){let T=t.slice(i.currentLineStartsAtIndex),S=eN(T);s.warn(()=>`Push: Same alignment twice in line ${i.lineNumber}', ignoring last one: ${d}${S}`);return}i.alignments[d.id]=d;let f=d;for(;f instanceof ht;)i.alignments[f.id]=f,f=f.relativeAlignment;i.hasAlignments=!0;let g=i.allAlignments[d.id];g||(g=i.allAlignments[d.id]={});let h=Object.values(i.alignments);for(let T of h){if(T===d)continue;let S=i.allAlignments[T.id];if(S&&S[d.id]){let C=t.slice(i.currentLineStartsAtIndex),L=eN(C);s.error(()=>`Push: Deadlock in line ${i.lineNumber}', for prevention ignoring last one: ${d}${L}`);return}g[T.id]=T}}}catch(f){s.error(()=>`${f}`)}if(ge(d)){let f=d.parent;f.data.streamIndexFrom===-1&&(f.data.streamIndexFrom=t.length),f.data.streamIndexTo=Math.max(f.data.streamIndexTo,t.length)}t.push(d),d instanceof St&&(i.hasTokens=!1,i.hasAlignments=!1,i.alignments={},i.lineNumber++,i.currentLineStartsAtIndex=t.length)}o(l,"push");function u(){let d=t.length-1;for(;d>0;){let f=t[d],g=d>0?t[d-1]:null,h={};if(g instanceof Me){let T=!1,S=g.relativeAlignment;for(;S;){if(h[S.id]=!0,S===f){T=!0;break}if(S=S.relativeAlignment,S&&h[S.id])throw new Error(`cycle in: ${S.id} at ~${d-1}`)}if(T&&(s.verbose(()=>`pp swapping: ${f.id} with: ${g.id} at ${d}`),t[d]=g,t[d-1]=f,--d>0))continue}break}}o(u,"preventAlignmentConflicts");let p=t[t.length-1];if(!(p instanceof GI&&p.constructor===c.constructor&&c instanceof fn&&p.merge(c))){if(p instanceof Me){if(c===p){s.info(()=>`Line ${i.lineNumber}: ignoring duplicate (directly) previous alignment: ${c}`);return}if(c instanceof GI){let d=null;for(let f=2;f<t.length;f++){let g=t[t.length-f];if(!(g instanceof Me)){d=g;break}}if(d&&d instanceof GI&&d.constructor===c.constructor){c instanceof St&&s.warn(()=>`Line ${i.lineNumber}: merging '${c}' over alignment: ${p}`),d.merge(c);return}else if(c instanceof Ut){s.debug(()=>`Line ${i.lineNumber}: swapping ${JSON.stringify(p)} and ${JSON.stringify(c)}`),t.splice(t.length-1,1,c,p);return}}}if(!i.hasTokens&&!i.hasAlignments&&(typeof c=="string"||c instanceof Me||ge(c))){let d=r[r.length-1];d&&d!==c&&l(d)}l(c),c instanceof Me&&p instanceof Me&&u()}}o(a,"mergedPush"),!(e instanceof Ut&&!i.hasTokens)&&a(e)}trace(){let{tracer:e}=this.globalContext;e.verbose(()=>"pp_stream ~~~~~~~~~~ FormattingStream ~~~~~~~~~~");let t="";this.stream.forEach(r=>{r===`
`||r instanceof St?(r===`
`?t+=ot.category("\\n"):t+=ot.category(r),t+=`
`):r instanceof ht?t+=$t.fg.green(r):r instanceof Me?t+=$t.fg.petrol(r):r instanceof Ut?t+=ot.category(r):ge(r)&&r.isComment()?t+=ot.commentToken(r):t+=ot.token(r)}),e.verbose(()=>`pp_stream ${t}`)}},Xd=HI;o(HI,"FormattingStream");function eN(n){let t=n.length,r=`
`;for(let i=0;i<t;i++){r+=" ";let s=n[i];s instanceof Me?s=ot.rule(s):s instanceof fn?s=ot.category(s):s=ot.token(s),r+=s}return r}o(eN,"context");var zI=class{constructor(e,t,r){this.originalSource=e;this.tracer=r;m(this,"originalSourceLines");m(this,"formattingStream",null);m(this,"outputLines",[[]]);m(this,"lineNumbersForAlignmentId",new Map);m(this,"lastProcessedToken",null);m(this,"alignments");m(this,"formattingEnablements",[]);m(this,"instructionsDelayedTillNewline",new Map);m(this,"removableNewlines",new Map);m(this,"delayedThings",new Sd(this));m(this,"annotationTypes",{});m(this,"formatOptions");m(this,"alignmentIdAliases",{});m(this,"alignmentIdAliasesSet",!1);m(this,"blockAlignmentManager");m(this,"formatterFactory",new Kd);m(this,"_descendantCounts",new Map);this.originalSourceLines=dc(e).lines,this.formatOptions=new fd(t,r),this.alignments=new hd,this.formattingStream=new Xd(this),this.blockAlignmentManager=new xd({tracer:this.tracer,alignments:this.alignments,formattingStream:this.formattingStream})}getFormatter(e){if(e)return e.data.formatter??(e.data.formatter=this.formatterFactory.createFormatter(e,this))}discardFormatter(e){e.data.formatter=void 0}format(e,t=!1){let r=this.getRuleRenderer(e),i=r.blockRenderOptions.blockAlignment,s=r.beginBlock(e,t);i&&this.blockAlignmentManager.newBlockAlignment(e.id,0,e),r.renderNode(e,t),i&&this.blockAlignmentManager.popBlockAlignment(e.id),r.endBlock(e,s,t)}getRuleRenderer(e){return e.data.ruleRenderer??(e.data.ruleRenderer=new ua(this.getBlockRenderOptions(this.formatOptions,e),this))}getBlockRenderOptions(e,t){let r={blockAlignment:!0,beforeBlock:Ge,beforeBlockGroup:Ge,afterBlock:Ge,afterBlockGroup:lr,betweenBlocks:void 0},i={blockAlignment:!1,beforeBlock:Ge,beforeBlockGroup:Ge,afterBlock:Ge,afterBlockGroup:Ge,betweenBlocks:void 0},s={blockAlignment:!1,beforeBlock:Mt,beforeBlockGroup:Mt,afterBlock:nn,afterBlockGroup:nn,betweenBlocks:Mt},a={blockAlignment:!1,beforeBlock:void 0,beforeBlockGroup:void 0,afterBlock:void 0,afterBlockGroup:void 0,betweenBlocks:void 0},l={annotateElement:r,annotationAssignment_paren:a,annotationDef:r,annoValue:a,condition:a,elementDef:r,elementDefOrExtend:r,expression:a,extendContext:a,mixinElementDef:i,namespaceDeclaration:r,orderBySpec:s,projectionExclusion:i,queryExpression:a,queryPrimary:a,selectItemDef:a,tableExpression:a,typeAssociationCont:a,typeAssociationElementCont:a,typeCompoStruct:a,typeStruct:a,typeDef:r,usingDeclaration:r}[t.ruleName];if(l)return l;switch(t.ruleName){case E.annotationAssignment_ll1:case E.annotationAssignment_atn:{let u=t.containedTokens.filter(z=>!z.isComment()),p=u[0],d=p.getPreviousToken(),f=!d||d.end.line===p.line,g=u.at(-1),h=g.getNextToken(),T=h?.getLowerLexem()==="{",S=!h||g.end.line===h.line,C=!1,L=ur(t,this),A=L==="pre"&&e.getOption("keepPreAnnotationsInOriginalLine",t.startTokenIndex)==="keepLine"||L==="post"&&e.getOption("keepPostAnnotationsInOriginalLine",t.startTokenIndex)==="keepLine",W=!(f&&A),O=!(S&&A)&&!(T&&!e.getOption("openingBraceInNewLine",t.startTokenIndex));if(!W){let z=t.parent.children.filter(M=>$n(M));if(z.length>1){let M=z.indexOf(t),B=z[M-1];if(B?.getLastToken().end.line===p.line)zC(t,Li(B)+1),C=!0;else{let Y=z[M+1];C=g.line===Y?.getFirstToken().line}}}let j=C?WD:Te,J=W?Ge:j,ie=O?Ge:j;return{beforeBlock:J,beforeBlockGroup:J,betweenBlocks:J,afterBlock:ie,afterBlockGroup:ie}}case E.annotationAssignment_1:{let u=ce(t,E.annotationAssignment_paren);return this.countDescendants(u,E.annotationAssignment_1)>1?r:a}case E.artifactDefOrExtend:return r.betweenBlocks=lr,r;case E.annoSubValue:{let u=ce(t,E.annoValue,E.annoSubValue,E.namedValue);return u&&this.countDescendants(u,E.annoSubValue)>1?r:a}case E.contextDef:return r.betweenBlocks=lr,r;case E.serviceDef:return r.betweenBlocks=lr,r;case E.entityDef:return r.betweenBlocks=lr,r;case E.usingProxy:{let u=ce(t,E.usingDeclaration);return this.countDescendants(u,E.usingProxy)<2?a:r}case E.flattenedValue:{let u=ce(t,E.annoValue,E.annoSubValue);return u&&this.countDescendants(u,E.flattenedValue)>1?r:a}case E.namedValue:{let u=ce(t,E.annoSubValue);return u&&this.countDescendants(u,E.namedValue)>1?r:a}case E.viewDef:return r.afterBlock=Ge,r.afterBlockGroup=lr,r.betweenBlocks=lr,r}return a}countDescendants(e,t){let r=this._descendantCounts.get(e);r||(r=new Map,this._descendantCounts.set(e,r));let i=r.get(t);return i===void 0&&(i=Lb(e,t),r.set(t,i)),i}},Jd=zI;o(zI,"GlobalContext");function tN(n,e){let t=[],r,i=!0;return e.forEach(s=>{s.enabled?!i&&r&&(r.endToken=s.token,i=!0):i&&(i=!1,r={startToken:s.token,endToken:void 0,includingWhitespaceBefore:!1,includingWhitespaceAfter:!1},t.push(r))}),r&&!r.endToken&&(r.endToken=n[n.length-1]),t}o(tN,"calculateExclusionRanges");function nN(n,e,t){if(n.length===0)return[];t=t||{startToken:n[0],endToken:n[n.length-1],includingWhitespaceBefore:!0,includingWhitespaceAfter:!0};let r=Array(n.length).fill(!0,t.startToken.tokenIndex,t.endToken.tokenIndex+1);e.forEach(s=>{r.fill(!1,s.startToken.tokenIndex,s.endToken.tokenIndex+1)});let i=[];for(let s=0;s<r.length;s++)if(r[s]){let c=s;for(;r[s];)s++;let l=s-1;i.push({startToken:n[c],endToken:n[l],includingWhitespaceBefore:c===t.startToken.tokenIndex?t.includingWhitespaceBefore:!0,includingWhitespaceAfter:l===t.endToken.tokenIndex?t.includingWhitespaceAfter:!0})}return i}o(nN,"calculateInclusionRanges");function zz(n){return n.completedLine!==void 0}o(zz,"isHardenedLine");var Qd="#";function Kz(n,e,t,r,i){let s=/^\s*$/,a="",c=[],l,u="",p;for(let d=0;d<t.length;d++){if(l=t[d],l instanceof oa&&(r===Qd?l.registerFirstHardenedLine(t.lineNumber):l.registerFirstHardenedColumn(t.lineNumber,a.length)),l instanceof Me)if(r===l.id){l.alignmentDone=!0;let f=l.getColumn(t.lineNumber);KI(e,ot.rule,`Aligned at ${t.lineNumber}:${f}: ${l.id} --${t}`);let g=f-a.length;g<0&&s.test(a.slice(f))?a=a.slice(0,f):a+=Fo(g);continue}else{for(l.setColumn(a.length),gd(l)&&l instanceof ht&&l.relativeAlignment&&!l.relativeAlignment.alignmentDone&&i&&i(l,l.relativeAlignment),c.push(a),c.push(l);++d<t.length;){let f=t[d];if(f instanceof Me)if(l===f){e.warn(()=>`Hardening: Same alignment twice in line ${t.lineNumber}, ignoring last: ${f.id}`),t[d]=new Eo(n.alignments,`duplicate disabled: ${l.id} ${new Date}`);continue}else i&&i(f,l);f&&c.push(f)}return{nextOutstandingAlignment:l,outstandingLineItems:c}}if(ge(l))a+=l.text,u=l.text,p=l;else if(typeof l=="string")a+=l,u=l;else if(l instanceof Ut){if(d===t.length-1||d===t.length-2&&t[t.length-1]instanceof St)break;let f=t.slice(d+1).find(g=>typeof g=="string"||ge(g))??"";a+=l.renderString({precedingText:u,succeedingText:ge(f)?f.text:f,precedingToken:p},n)}}return a&&(a=a.trimEnd()),{completedLine:a}}o(Kz,"hardenLine");function rN(n,e){let{tracer:t}=n.globalContext,r=n.lineNumbersToBeHardened.size,i=n.mPreformattedIdToLineNumbers.size,s=n.mPreformattedIdToLineNumbers.get(e);if(s.forEach((a,c)=>{let l=n.globalContext.outputLines[c];l.lineNumber=c;let u=Kz(n.globalContext,t,l,e,(p,d)=>{let f=p.id;n.obscuredAlignmentIds.set(f,{obscuredBy:d,inLine:l.lineNumber,id:`Line ${l.lineNumber}: ${d.id}`}),n.mPreformattedIdToLineNumbers.delete(f)});if(zz(u))n.hardenedLines[c]=u.completedLine,s.delete(c),n.lineNumbersToBeHardened.delete(c);else{n.globalContext.outputLines[c]=u.outstandingLineItems;let p=u.nextOutstandingAlignment;if(!n.obscuredAlignmentIds.get(p.id)){let d=n.mPreformattedIdToLineNumbers.get(p.id);d||(d=new Set,n.mPreformattedIdToLineNumbers.set(p.id,d)),d.add(c)}}}),n.mPreformattedIdToLineNumbers.delete(e),e===Qd){let a=n.lineNumbersToBeHardened.size,c=n.mPreformattedIdToLineNumbers.size;if(KI(t,ot.token,`preformat: pending[${r} -> ${a}] headingAlignments[${i-1} -> ${c}]`),r===a&&i-1===c){let l="",u;try{u=Jz(n),n.lineNumbersToBeHardened.forEach(d=>{l+=Xz(n,d,u)})}catch(d){t.error(()=>`${d}`)}let p=`Deadlock during alignment detected.
Dependency chain:
${u.map(d=>`${d.inLine}:${Ne.error(d.obscuredBy.id)} -> `)}
Pending Lines:${l}`;if(n.globalContext.formatOptions.getOption("cancelFormattingOnAlignmentDeadlocks",Qy))throw new Error(p);t.error(()=>p),t.info(()=>"Trying to break deadlock by ignoring last found circular dependency...");for(let d of u){let f=d.id.match(/: (.*)/)[1],g=n.globalContext.outputLines[d.inLine],h=g.findIndex(T=>T instanceof Me&&T.id===f);if(h>=0){t.info(()=>`Ignoring alignment ${f} in line ${d.inLine}`),g[h]="";break}}}}else KI(t,ot.token,`hardenSpecificLines(${e}): pending[${r} -> ${n.lineNumbersToBeHardened.size}] headingAlignments[${i} -> ${n.mPreformattedIdToLineNumbers.size}]`)}o(rN,"hardenSpecificLines");function Xz(n,e,t){let i=n.globalContext.outputLines[e].reduce((s,a)=>{if(a instanceof Me){let c=t.find(l=>l.obscuredBy.id===a.id&&l.inLine===e);s+=(c?Ne.error:ot.rule)(a)}else s+=(a instanceof fn?ot.category:ot.token)(a);return s+", "},"");return`
	${e}: ${i}`}o(Xz,"_printLine");function iN(n,e,t,r){let i=t.obscuredAlignmentIds.get(e);return r.push(i),n[e]?r:(n[e]=!0,iN(n,i.obscuredBy.id,t,r))}o(iN,"_collectCycle");function Jz(n){let e=n.obscuredAlignmentIds.keys().next().value;return iN({},e,n,[])}o(Jz,"_findDeadlock");function Qz(n,e){e.mPreformattedIdToLineNumbers.set(Qd,e.lineNumbersToBeHardened),rN(e,Qd)}o(Qz,"preformat");function oN(n){let e=new Set;for(let r=0;r<n.outputLines.length;r++)e.add(r);let t={globalContext:n,lineNumbersToBeHardened:e,mPreformattedIdToLineNumbers:new Map,obscuredAlignmentIds:new Map,hardenedLines:[""]};for(;t.lineNumbersToBeHardened.size>0;){Qz(n,t);for(let[r]of t.mPreformattedIdToLineNumbers)rN(t,r);t.obscuredAlignmentIds=new Map}return t.hardenedLines}o(oN,"hardenLines");function KI(n,e,t){n.verbose(()=>`pp ${e(t)}`)}o(KI,"trace");var XI=class{format(e,t,r,i){let s={formatted:"",exclusionRanges:[]},a=new Jd(r,t,i);a.format(e),a.formattingStream.trace(),a.formattingStream.stream.forEach(u=>{if(u instanceof St)u.renderArray(a.outputLines);else{let p=a.outputLines.length-1;if(u instanceof Me){let d=a.lineNumbersForAlignmentId,f=d.get(u.id);f||(f=[],d.set(u.id,f)),f.push(p)}a.outputLines[p].push(u)}});let c=e.context.ruleTokens;if(!c.length){if(r.trim()!=="")throw new Error(`No tokens for source: ${r.slice(0,100)}`);return s}s.exclusionRanges=tN(c,a.formattingEnablements);let l=oN(a);{for(;l.length>0&&l[0].trim()==="";)l=l.slice(1);for(;l.length>0&&l[l.length-1].trim()==="";)l=l.slice(0,l.length-1);t.getValue("finalNewline")&&l.push(""),s.formatted=l.join(`
`)}return a.tracer.verbose(()=>`pp 
${ot.token(s.formatted)}
`),s}},Xc=XI;o(XI,"PpFormatter");function sN(n,e,t,r){let i;if(t?i=e2(n,t,r):e&&(i=Yz(n,e)),i&&i.startToken&&i.endToken&&i.endToken.tokenIndex>=i.startToken.tokenIndex)return i}o(sN,"determineRangeTokens");function Yz(n,e){if(e.start.line=Yd(e.start.line),e.start.character=Yd(e.start.character),e.end.line=Yd(e.end.line),e.end.character=Yd(e.end.character),e.start.line>e.end.line||e.start.line===e.end.line&&e.start.character>e.end.character)throw new Error(`Start position must not be after end position: [${e.start.line}/${e.start.character}, ${e.end.line}/${e.end.character}`);let t=!1,r=!1,i=n.find(a=>{switch(a.relativeToCursor(e.start)){case"tokenAfterCursor":return t=!0,!0;case"tokenStartsAtCursor":case"tokenContainsCursor":return!0;case"tokenEndsWithCursor":case"tokenBeforeCursor":return!1}}),s=Eb(n,a=>{switch(a.relativeToCursor(e.end)){case"tokenBeforeCursor":return r=!0,!0;case"tokenEndsWithCursor":case"tokenContainsCursor":return!0;case"tokenStartsAtCursor":case"tokenAfterCursor":return!1}});return{startToken:i,endToken:s,includingWhitespaceBefore:t,includingWhitespaceAfter:r}}o(Yz,"rangeToContextRange");function Zz(n){let e=n.parent,t=[E.annotationAssignment_1,E.annotationAssignment_ll1,E.annotationAssignment_fix,E.artifactDefOrExtend,E.elementDef,E.elementDefOrExtend,E.usingDeclaration,E.namespaceDeclaration,E.start];for(;e&&!t.includes(e.ruleName);)e=e.parent;return e}o(Zz,"getRelevantScopeForFormatOnTyping");function e2(n,e,t){let r=["tokenBeforeCursor","tokenEndsWithCursor"],i=Eb(n,s=>r.includes(s.relativeToCursor(e)));if(i.text===","&&i.parent.ruleName===E.annotationAssignment_paren&&(i=i.getPreviousToken()),i){let s=!1,a=Zz(i),c=a.getFirstToken();c&&c.tokenIndex>=0&&(s=!0);let l=a.getLastToken();if(t===`
`&&(l!==i||e.line-1!==l.line))throw new Error("Format-on-type by LF supported only at end of block in same line");return{startToken:c,endToken:l,includingWhitespaceBefore:s,includingWhitespaceAfter:!1}}throw new Error(`Failed to determine token for given position ${e.line}:${e.character} in given ${n.length} tokens`)}o(e2,"positionToContextRange");function t2(n){return n===+n&&n===(n||0)}o(t2,"isInteger");function Yd(n){if(n===void 0)throw new Error("Value is undefined");if(!t2(n))throw new Error("Value must be integer: "+n);if(n>=0)return n;if(n===-1)return Number.MAX_VALUE;throw new Error("Value must not be negative: "+n)}o(Yd,"validatePositionNumber");var n2=o(n=>String(n),"uncolored");var r2=new Map([[7,Ne.warn],[2,ot.token],[8,$t.fg.lightgreen],[3,ot.errorToken],[6,Ne.error],[4,ot.commentToken],[0,ot.block],[5,ot.rule],[1,ot.category]]),JI=class{get(e){return r2.get(e)??n2}},Do=JI;o(JI,"AnsiColorProvider");var QI=class{reduceTree(e){this.fixTree(e),e.children=aN(e.children),this.ensureCorrectParent(e)}ensureCorrectParent(e){e.children.forEach(t=>{t.parent=e,ye(t)&&this.ensureCorrectParent(t)})}fixTree(e){let t=o(s=>s.parent.children.findIndex(a=>a===s),"indexOfParent"),r=o(s=>{let a=t(s);s.parent.children.splice(a,1)},"removeItem"),i=[];for(let s of e.children)if(ye(s)&&this.fixTree(s),ge(s))switch(xe(s)){case"define":{let a=GC(s,Ht);a&&i.push(()=>{let c=e.context.ruleTokens.slice(s.tokenIndex,a.tokenIndex);c.forEach(u=>r(u));let l=t(a);a.parent.children.splice(l,0,...c)});break}case",":case";":{if(s.parent.ruleName!==E.selectItemInlineList){let a=Ai(s,Ht);a&&i.push(()=>{let c=s.getFollowUpLineEndComment()||s,l=e.context.ruleTokens.slice(a.tokenIndex+1,c.tokenIndex+1);l.forEach(p=>r(p)),l.forEach(p=>p.parent=a.parent);let u=t(a);a.parent.children.splice(u+1,0,...l)})}break}}i.forEach(s=>s())}},Zd=QI;o(QI,"TreeFixer");function i2(n,e){return ye(e)&&(e.children=aN(e.children),!o2(e))?(n.push(...e.children),n):(n.push(e),n)}o(i2,"flattenIrrelevantRuleNodes");function aN(n){return n.reduce(i2,[])}o(aN,"reduceChildren");function o2(n){let e=n.ruleName;return HC(e)}o(o2,"isRequiredForFormatting");var YI=class{debugPrint(e,t,r=0){let i=Wu(3*r);i+=t.get(0)(t.get(5)(e.toString()))+`
`,r++;let s=!0;for(let a of e.children)if(ge(a)){let c=a.isComment();c?(i.slice(-1)!==`
`&&(i+=`
`),i+=Wu(3*r)):i+=s?Wu(3*r):" ",i+=this.printToken(a,t),c&&(i+=`
`),s=c}else i.slice(-1)!==`
`&&(i+=`
`),i+=this.debugPrint(a,t,r),s=!0;return i.slice(-1)!==`
`&&(i+=`
`),i}printToken(e,t){let r=e.isComment(),s=(e.isErrorToken?t.get(3):r?t.get(4):t.get(2))(e.text);return s+=t.get(1)(`[#${e.tokenIndex} ${e.category}]`),s}},pa=YI;o(YI,"TreePrinter");var ZI=class{constructor(e){this.tracer=e;m(this,"parser",s2())}getRuleTree(e,t){let{rootNode:r}=this.parser.parse(e,"___.cds",t),i=new pa;return this.tracer.verbose(()=>"====== Grammar Tree ====="),this.tracer.verbose(()=>i.debugPrint(r,new Do,0)),new Zd().reduceTree(r),this.tracer.verbose(()=>"====== Fixed Reduced Tree ====="),this.tracer.verbose(()=>i.debugPrint(r,new Do,0)),r}},ef=ZI;o(ZI,"RuleTree");function s2(){let n=ne();return vt()?.compiler??n.createCompiler(n.createOptions(),n.getModuleLoader())}o(s2,"getCompiler");function cN(n,e){let t=Math.max(0,e-10),r=Math.min(n.length,e+10),i="";for(let s=t;s<r;s++)s===e?i+=`>>${n[s]}<<`:i+=n[s],i+=" ";return i}o(cN,"tokenContext");function lN(n){return n.isComment()?n.isDocComment()?Wy(n.text).replace(/^\s*\d+\./gm,"1.").replace(/\s+/gm," ").replace(/[\W]/gm,"_").replace(/_+/gm," ").trim():n.text.split(/[\s]+/).filter(e=>e.length>0).join(" "):n.isKeyword()?n.text.toLowerCase():n.text}o(lN,"canonicalText");function a2(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=lN(n[r]),s=lN(e[r]);if(i!==s)throw new Error(`Tokens differ at token index ${r}.
Original : ${cN(n,r)}
Formatted: ${cN(e,r)}
            
Canonical:
Original : ${i}                
Formatted: ${s}`)}if(e.length!==n.length)throw new Error(`Number of tokens has changed! Original ${n.length}, formatted ${e.length}`)}o(a2,"verifyTokens");var ex=class{constructor(e,t=new Wc(e)){this.tracer=e;this.formatOptionsMetaModel=t}getCommandLineOptions(){let e=this.formatOptionsMetaModel.emptySet("CmdlineOptions");return process.argv.forEach(t=>{let r=t.match(/^-+([-\w]+)([:=](["'\w]+))?/);r&&r.length>1&&r[3]!==void 0&&e.setValue(wC(r[1]),PP(r[3]))}),e}getDefaultOptions(){return this.formatOptionsMetaModel.defaultSet()}getEffectiveFormattingOptions(e,t,r){let i=this.getDefaultOptions();return i.overlayWith(qD(this.formatOptionsMetaModel,e)),i.overlayWith(md(this.formatOptionsMetaModel,t,r,this.tracer)?.formattingOptions),i.overlayWith(this.getCommandLineOptions()),i}beautifyWithLayeredOptions(e,t,r,i){this.tracer.info(()=>"Assembling formatting options");let s=this.getEffectiveFormattingOptions(t,r,i);return this.beautifyWithEffectiveOptions(e,s,r)}beautifyWithEffectiveOptions(e,t,r){this.tracer.info(()=>`Beautifying ${r}  

,d88b.d88b,
88888888888
\`Y8888888Y'
  \`Y888Y'  
    \`Y'
`);let i=new ef(this.tracer);try{let s={streamIndexFrom:-1,streamIndexTo:-1,ruleRenderer:void 0,formatter:void 0},a=i.getRuleTree(e,s);a.allTokens.forEach(f=>{this.adjustTokenCasing(f,t.getValue("cqlKeywordCapitalization"))});let{formatted:c,exclusionRanges:l}=new Xc().format(a,t,e,this.tracer),u=a.allTokens,{rootNode:p}=i.parser.parse(c,void 0),d=p.context.ruleTokens;return a2(u,d),{originalContent:e,formattedContent:c,originalTokens:u,formattedTokens:d,exclusionRanges:l}}catch(s){throw this.tracer.warn(()=>"Beautify impossible:"),this.tracer.warn(()=>s.stack||s),s}}adjustTokenCasing(e,t){let r=o(()=>{if(!e.isKeyword())return"as-is";switch(e.text.toLowerCase()){case"association":case"composition":return"title"}return e.isCqlKeyword()?t||"as-is":"lower"},"getTargetCasing"),i=o(()=>{switch(r()){case"lower":return e.text.toLowerCase();case"upper":return e.text.toUpperCase();case"title":return c2(e.text);default:return e.text}},"caseLexeme");e.text=i()}},Nr=ex;o(ex,"CdsPrettyPrint"),x([F("format",{argumentsRenderer:n=>`sourcePath=${n[1]}  workspaceRoot=${n[2]}`,resultRenderer:R.nothing}),Q({fallback:()=>new Wc().defaultSet()})],Nr.prototype,"getEffectiveFormattingOptions",1),x([F("format",{argumentsRenderer:R.nothing,resultRenderer:R.nothing})],Nr.prototype,"beautifyWithLayeredOptions",1);function c2(n){return n.toLowerCase().replaceAll(/(?:^|\s)\w/g,e=>e.toUpperCase())}o(c2,"toTitleCase");var dN=K(require("path"));var tx=Symbol("indexContextSymbol");function Oi(n=he().requestScope){let e=n[tx];return e||(e={},n[tx]=e),e}o(Oi,"getIndexContext");function Mi(n=he().requestScope,e){n[tx]=e}o(Mi,"setIndexContext");var nx=class{constructor(e,t="requests"){m(this,"tracer");m(this,"languageServer");this.languageServer=e,this.tracer=G().tracer(t)}},we=nx;o(nx,"AbstractRequest");var rx=class extends we{},_r=rx;o(rx,"CustomRequest"),m(_r,"REQUEST_NAME");var ix=class extends we{async fetchWorkspaceFolderAndIndex(e){let t=this.languageServer.workspaceService.getWorkspaceFolder(e),r=await t.fetchFileIndex(e);return[t,r]}async fetchAllDefinitions(e,t,r){let i=this.languageServer.options.getUserSetting("cds.whereused.showGenericAnnotations"),s=Ns(t.definitions);if(!s.size)return;let a=await this.fetchIndexes(e);for(let c of s)for(let l of a){let u=_t(e.workspaceSnapshot.correspondingDefinition(c));Pt(c)&&(u=u.concat(...l.redefinitionsFor(c))),Ns(u).forEach(p=>{(!vc(p)||i)&&r(p,l)})}return a}async fetchIndexes(e){let{requestScope:t}=he();Ot(t).progress(void 0,"Indexing");let r=[],i=[...e.workspaceSnapshot.streamFiles(qn,void 0,kr)],s=e.workspaceSnapshot.sortByRank(i);for(let a of s){let c=await this._fetchFileIndexForUri(e,a);c&&r.push(c)}return Ot(t).progress(void 0," "),r}async _fetchFileIndexForUri(e,t){return e.fetchFileIndex(t)}async fromAnnotationHandler(e,t,r,i){if(!this.languageServer.options.getUserSetting("cds.contributions.enablement.odata"))return[];let s=[],a=await t.fetchToken(r.textDocument.uri,r.position,!1);if(a&&!a.text.startsWith("$")){let c=await t.fetchToken(r.textDocument.uri,r.position,!0);if(c){let l=await t.fetchAst(r.textDocument.uri),u=e==="fetchReferences"?sP(i??await this.fetchIndexes(t)):await t.fetchTransitiveIndex(r.textDocument.uri);for(let p of await this.languageServer.fetchAnnotationHandlers()){let d=await p[e]({cursorPosition:r,annotation:c,index:u,ast:l});s.push(..._t(d))}}}return s}},At=ix;o(ix,"AbstractWhereUsedRequest"),x([F("workspace",{argumentsRenderer:R.nothing,resultRenderer:R.nothing})],At.prototype,"fetchAllDefinitions",1),x([F("workspace",{argumentsRenderer:R.nothing,resultRenderer:R.nothing})],At.prototype,"fetchIndexes",1),x([Q({fallback:re,errorTrace:(n,e)=>`for URI: ${e[1]}`})],At.prototype,"_fetchFileIndexForUri",1),x([F("contribution",{argumentsRenderer:R.nothing}),Q({fallback:Ee,traceComponent:"contribution",traceLevel:6})],At.prototype,"fromAnnotationHandler",1);function uN(n,e){return(t,r,i)=>{let s=i.value;return i.value=o(async function(...c){let l=he().requestScope,u=Oi(l),p=l.name;l.name+=`.${n}`,Mi(l,e);try{return await s.call(this,...c)}finally{let d=he().requestScope;Mi(l,u),Mi(d,u),l.name=p,d.name=p}},"IndexContextDecorator"),i}}o(uN,"IndexContext");var No=(r=>(r[r.Operating=1]="Operating",r[r.Shutdown=2]="Shutdown",r[r.Ignore=3]="Ignore",r))(No||{}),tf=o((n,e)=>e[0],"FIRST_ARGUMENT"),Jc=2;function l2(n,e=1,t=1){e!==3&&e!==Jc&&G().tracer("requests").warn(()=>`Method ${n} was unexpectedly called even server is currently ${No[Jc]}`),t!==Jc&&(G().conditionalTrace("requests",2,()=>`Changing operating state from ${No[Jc]} to ${No[t]}`),Jc=t)}o(l2,"processState");var pN=Date.now();function oe(n){function e(t){let r=Date.now();if(r-pN>t){let i=G();i.tracer("requests").isTracing(2)&&i.doTraceToFile("".padEnd(120,"-"))}pN=r}return o(e,"paintDivider"),(t,r,i)=>{Q({fallback:n.onErrorReturn})(t,r,i);let a=i.value;return i.value=o(function(...l){e(2e3);let u=n.methodName??r,p=ss(u),d=u2(this.languageServer,l?.[0]??{},n);n.indexContext?.singleFile&&(n.indexContext.uri=l[0]?.textDocument?.uri);let f=he();Mi(f.requestScope,n.indexContext),p2(f,this.languageServer);let g=f.appScope.trace,h=g.tracer("requests");l2(u,n.expectedState,n.newState);let T=g.traceLevel("requests"),S={startScope:$l+u,endScope:Wr+u,argumentsRenderer:W=>n.paramsRenderer(W[0]),resultRenderer:W=>{let O=Mu();return`${O.compilations?`{${O.dirtyModels} dirty model(s), ${O.compilations} compilation(s), ${O.compiledFiles} file(s), ${O.compiledSourceLength} bytes of sources, ${Mg(O.compilationElapsedNanos)} compilation time}`:""} ${Array.isArray(W)?`(${W.length} items): `:""}${n.resultRenderer(W,T)}`},trackMemory:n.trackMemory!==void 0?n.trackMemory:!0},L=h.footprint(t,a.bind(this),l,S),A=o(W=>(d&&Dt(d.then(O=>O.done())),ST(p)(),W),"finallyDo");return L?.then?L.then(A):A(L)},"RequestMethodDecorator"),i}}o(oe,"RequestMethod");function u2(n,e,t){let r;if(t.withProgress&&n.options.getClientCapability("capabilities.window.workDoneProgress",!1)&&n.connection){let s=e.workDoneToken,{window:a}=n.connection;r=s?Promise.resolve(a.attachWorkDoneProgress(s)):a.createWorkDoneProgress(),Ot().setProgressReporter(r),G().tracer("util").verbose(()=>`PROGRESS: ${t.withProgress}`),Dt(r.then(c=>c.begin(`${t.withProgress}`,0)))}return r}o(u2,"startProgressReporting");function p2(n,e){n.requestScope.snapshots=new Map(e.workspaceService.workspaceFolders().map(t=>[t.workspaceUri,t.lastRequestIndependentWorkspaceSnapshot]))}o(p2,"setupActiveSnapshot");var ox=class extends At{constructor(){super(...arguments);m(this,"_cache",[void 0,void 0]);m(this,"QUERY_SWITCHES","/([gifnc]+)$")}async onWorkspaceSymbol(t){return this.cached(t.query,()=>this.calculateSymbols(t.query))}async cached(t,r){let i=this.calculateHash(t);if(this._cache[0]===i)return this.tracer.verbose(()=>"Taking workspace symbols from cache"),this._cache[1];let s=await r();return this._cache=[i,s],s}calculateHash(t){let r=t;for(let i of this.languageServer.workspaceService.workspaceFolders())r+=`
${i.workspaceUri} %${i.workspaceSnapshot.workspaceVersion}`;return r}async calculateSymbols(t){let r=await this._fetchDefinitions(t);r.sort((l,u)=>Fb(l,u));let i=o((l,u)=>Ic(l)&&Ic(u)&&l.absoluteName===u.absoluteName,"sameImplicit"),s=o((l,u)=>Pt(l)&&Pt(u)&&!co(l.location,u.location)&&l.symbolName===u.symbolName,"sameExplicit"),a=o((l,u)=>!i(l,u)&&!s(l,u),"removeSameLocationAndName");r=r.filter((l,u,p)=>u===0||a(l,p[u-1]));let c=t.match(/^(.*):/)?.[0];return r.map(jb(!!c))}async fetchDefinitions(t){return this._fetchDefinitions(t)}async _fetchDefinitions(t){let r=[],i=he().requestScope;Mi(i,{onlyDefinitions:!0});for(let s of this.languageServer.workspaceService.workspaceFolders())await s.ensureScanned(),r.push(...await this.calculateDefinitions(s,t));return r}async calculateDefinitions(t,r){let i=[],s=r.match(this.QUERY_SWITCHES)?.[1].includes("g"),a=r.match(this.QUERY_SWITCHES)?.[1].includes("c"),c=s?"OpenEditorsDirectSourcesAndDirectDependencies":"OpenEditorsAndDirectSources",l=o(f=>s?!0:!dN.relative(t.workspaceUri,f.uri).includes("node_modules")||a&&f.uri.endsWith("sap/cds/common.cds"),"justDirectSources"),u=[...t.workspaceSnapshot.streamFiles(mv(qn,l),c,kr)],p=0,{requestScope:d}=he();for(let f of u){p++,Ot(d).progress(100*p/u.length);let g=await this._fetchDefinitionsForUri({workspaceFolder:t,uri:f,query:r});i.push(...g)}return i}async _fetchDefinitionsForUri({workspaceFolder:t,uri:r,query:i}){let s=await t.fetchFileIndex(r);return await this.fetchDefinitionsOfFile(s,i)}async fetchDefinitionsOfFile(t,r){let i=t.definitions,s=!1,a=!1,c=!1,l=this.languageServer.options.getUserSetting("cds.workspaceSymbols.caseInsensitive");if(r.match(this.QUERY_SWITCHES)){let T=r.slice(r.lastIndexOf("/")+1);s=T.indexOf("g")>=0,a=T.indexOf("f")>=0,c=T.indexOf("n")>=0,l||(l=T.indexOf("i")>=0),r=r.slice(0,r.lastIndexOf("/"))}c&&i.push(...Object.values(t._implicitDefinitions.implicitNamespaces));let u=this.languageServer.options.getUserSetting("cds.workspaceSymbols.lazy"),p=[],d=o(function(T){let S="";return T.split("").forEach(C=>{S+=C,u&&(S+=".*")}),new RegExp(S,l?"i":void 0)},"queryRegex"),f=o(function(T,S,C){if(S)S.startsWith(C)&&p.push(L=>L.kind===S&&d(T).test(vo(L)));else{let L=o(A=>{let W=d(T);return W.test(vo(A))?!0:a&&W.test(A.symbolName)},"matchesQuery");p.push(L)}},"addFilter");if(r.split(" ").forEach(T=>{let[S,C]=T.split(/[:=]/);C===void 0?f(S):(f(C,"action",S),f(C,"annotate",S),f(C,"context",S),f(C,"element",S),f(C,"entity",S),f(C,"enum",S),f(C,"event",S),f(C,"function",S),f(C,"namespace",S),f(C,"param",S),f(C,"service",S),f(C,"type",S),f(C,"view",S))}),!s){let T=o(L=>L.includes("node_modules")&&!L.endsWith("/@sap/cds/common.cds"),"isDependent"),S=o(L=>T(L.nameLocation.uri),"isFullyDependentImplicitNamespace"),C=o(L=>T(L.nameLocation.uri),"isDependentExplicitDefinition");i=i.filter(L=>Pt(L)?!C(L):!S(L))}return p.length>0&&(i=i.filter(T=>p.find(S=>S(T))!==void 0)),i}},Ln=ox;o(ox,"WorkspaceSymbol"),x([oe({paramsRenderer:R.wsSymbol,resultRenderer:R.symbolInfos_Uri,onErrorReturn:Ee,indexContext:{onlyDefinitions:!0},withProgress:"Collecting workspace symbols"})],Ln.prototype,"onWorkspaceSymbol",1),x([F("workspace",{resultRenderer:R.nothing})],Ln.prototype,"calculateSymbols",1),x([uN("WorkspaceSymbols",{onlyDefinitions:!0})],Ln.prototype,"fetchDefinitions",1),x([F("workspace",{argumentsRenderer:R.nothing,resultRenderer:R.nothing})],Ln.prototype,"calculateDefinitions",1),x([Q({fallback:Ee,errorTrace:(n,e)=>`for URI: ${e[0].uri}`})],Ln.prototype,"_fetchDefinitionsForUri",1);var sx=class{constructor(e){this.lspServer=e;m(this,"tracer",G().tracer("command"))}},Bn=sx;o(sx,"QuickFixHandler");var fN=o(n=>!n.isComment(),"removeCommentTokens"),cx=class extends Bn{constructor(){super(...arguments);m(this,"id","import-artifact")}calculateDiagnostics(t,r){return[]}async createCodeActions(t){if(!this.lspServer.options.getUserSetting("cds.quickfix.importArtifact"))return[];let r=t.context.diagnostics.filter(f=>f.code==="ref-undefined-art"),{uri:i}=t.textDocument,s=[],a=this.lspServer.workspaceService.getWorkspaceFolder(i),c=await a.fetchFileIndex(i),l=["entity","extend","type","annotation","service","context","namespace"],u=o(f=>{let g=l.indexOf(f);return g>=0?g:100},"order"),p=o(f=>f.split(ze).length,"closeness"),d=o(f=>(g,h)=>{let T=p(this.relativePath(a,f,g.nameLocation.uri))-p(this.relativePath(a,f,h.nameLocation.uri));return T||u(g.kind)-u(h.kind)},"orderDefs");for(let f of r)await this.calculatingQuickfixCommandsForDiagnostic({index:c,diag:f,orderDefs:d,uri:i,workspaceFolder:a,codeActions:s});return s}async calculatingQuickfixCommandsForDiagnostic({index:t,diag:r,orderDefs:i,uri:s,workspaceFolder:a,codeActions:c}){let u=t.identifierAt(r.range.start).text,d=this.lspServer.options.getUserSetting("cds.workspace.scanDependentModules")?"/gc":"/c",f=await this.lspServer.request(Ln).fetchDefinitions(u+d),g=o(T=>T.split(".").pop(),"lastSegment"),h=f.filter(T=>g(T.symbolName)===u&&T.kind!=="element");h.sort(i(s)),h.filter(T=>T.location.uri!==s).forEach(T=>{let S={command:"import-artifact",title:`Use ${T.kind} '${u}' from model '${T.location.uri.slice(a.workspaceUri.length+1)}'`,arguments:[{uri:s,importUri:T.nameLocation.uri,fqn:T.symbolName,kind:T.kind}]};c.push({title:S.title,diagnostics:[r],kind:mN.CodeActionKind.QuickFix,command:S})})}async execute(t){let{uri:r,importUri:i,fqn:s,kind:a}=t.arguments[0],c=this.lspServer.workspaceService.getWorkspaceFolder(r),l=this.relativePath(c,r,i),u=[];u.push(await this.calculateTextEdit(r,i,s)),await this.lspServer.applyWorkspaceEdits({label:`Use ${a} "${s}" from model '${l}'`,edit:{changes:{[r]:u}}})}async calculateTextEdit(t,r,i){let s=this.lspServer.workspaceService.getWorkspaceFolder(t),a=d2(this.relativePath(s,t,r)),c=this.getUsingNode(t,a),l=`using { ${i} } from '${a}';`;if(c.reuseNode)return this.changeExistingNode(c.reuseNode,t,i);if(c.insertAfterNode){let u={line:c.insertAfterNode.getLastToken().endLine,character:c.insertAfterNode.getLastToken().endCharacter};return{range:{start:u,end:u},newText:`
${l}`}}else if(c.insertBeforeNode){let u={line:c.insertBeforeNode.getFirstToken().line,character:c.insertBeforeNode.getFirstToken().character};return{range:{start:u,end:u},newText:`${l}
`}}else{let p=(await s.fetchFileIndex(t,{singleFile:!0,uri:t})).definitions.find(f=>f.kind==="namespace"),d=p?p.location.range.start.line+1:0;return{range:{start:{line:d,character:0},end:{line:d,character:0}},newText:`${l}
`}}}changeExistingNode(t,r,i){let s=this.lspServer.workspaceService.getWorkspaceFolder(r),a=t.containedTokens,c=a.map(W=>W.text),l=c.indexOf("using")+1,u=c.lastIndexOf("from")-1,p=a.slice(l,u+1).filter(W=>!["{","}"].includes(W.text)),d=[];d.push(p.reduce((W,O)=>(O.text===","?(d.push(W),W=[]):W.push(O),W),[]));let f=s.getContent(r);yC(f);let g=new On(f),h=o(W=>{let O=W.filter(fN);return g.getText({start:O[0].start,end:je(O).end})},"clusterText"),T=d.find(W=>h(W).localeCompare(i)>0),S={range:{start:a[0].start,end:je(a).end},newText:""};T?T[0].text=`${i}, ${T[0].text}`:je(p).text+=`, ${i}`,a[l].text!=="{"&&(a[u].text+=" }",a[l].text=`{ ${a[l].text}`);let L=a.map(W=>W.isLineComment()?W.text+`
`:W.text).join(" "),A=this.beginFormat(r,s.workspaceRoot,L);return S.newText=A,S}beginFormat(t,r,i){let s=this.lspServer.workspaceService.getWorkspaceFolder(t);return new Nr(this.tracer).beautifyWithLayeredOptions(i,{},s.adapter.toLocalPath(t),r).formattedContent.trim()}getUsingNode(t,r){let i=this.getUsingDeclarationNodes(t),s=o(p=>{let d=p.containedTokens.filter(fN);for(let f=d.length-1;f>=0;f--){let g=d[f];if(g.text.match(/^'.*'$/))return g}},"findImportPathToken"),a=`'${r}'`,c,l;return{reuseNode:i.find(p=>{let d=s(p);!l&&d.text.localeCompare(a)>0&&(l=p);let f=d.text===a;return!f&&!l&&(c=p),f}),insertAfterNode:c,insertBeforeNode:l}}getUsingDeclarationNodes(t){let r=this.lspServer.workspaceService.getWorkspaceFolder(t),i=r.getContent(t);if(i===pe)return[];let{rootNode:s}=this.lspServer.compiler.parse(i,r.adapter.toLocalPath(t));return s.children.filter(a=>ye(a)&&a.ruleName===E.usingDeclaration)}relativePath(t,r,i){let s=da.relative(da.dirname(t.adapter.toLocalPath(r)),t.adapter.toLocalPath(i)),a=s.slice(0,-da.extname(s).length).replaceAll(xn,ze);return a.startsWith(".")?a:`./${a}`}},Ui=cx;o(cx,"ImportArtifactQuickFix"),x([F("command",{traceLevel:6,argumentsRenderer:bt,resultRenderer:R.diags})],Ui.prototype,"calculateDiagnostics",1),x([Q({fallback:re,errorTrace:(n,e)=>`for diagnostic ${e[0].diag}`})],Ui.prototype,"calculatingQuickfixCommandsForDiagnostic",1);function d2(n){return o(r=>{let i=r.match(/^[./]+node_modules\/(.*)/);return i?i[1]:r},"simplifyModuleImport")(o(r=>{let i=un("/index").optional(),s=Pn.or(".cds",".csn",".json").optional(),a=r.match(Pn.and(/(.+?)/,i,s,/$/));return a?a[1]:r},"stripOptionalFileEnding")(n))}o(d2,"simplifyImportPath");var lx=class extends en{async fetchList(e){let t=await super.fetchList(e),r=this.completionRequest.languageServer.options.getUserSetting("cds.completion.workspaceSymbols.maxProposals");return r>=0&&t.items.length>r&&(t.items.sort((i,s)=>i.sortText.localeCompare(s.sortText)),t.items.length=r,t.isIncomplete=!0),t}async fetchProposals(e){if(!e.identifierExpected)return[];let t=this.completionRequest.languageServer.options.getUserSetting("cds.completion.workspaceSymbols.minPrefixLength");if(t<0||e.prefix.length<t)return[];let r=this.completionRequest.languageServer,i=await r.request(Ln).fetchDefinitions(e.fullPrefix+"/gfn"),s=r.workspaceService.getWorkspaceFolder(e.triggerUri);i=i.filter(c=>c.kind!=="element").filter(c=>c.nameLocation.uri!==e.triggerUri).filter(c=>c.location.uri.startsWith(s.workspaceUri));let a=Jr(e.prefix,e.suffix,!0,e.position);return i.map(c=>{let l=Ds(c);return{filterText:c.symbolName,label:vo(c),sortText:"8)"+l.name,kind:cC(l.kind),textEdit:hN.TextEdit.replace(a,l.name),additionalTextEdits:[],commitCharacters:["."],data:{providerName:this.name,uri:e.triggerUri,importUri:c.nameLocation.uri,line:c.nameLocation.range.start.line,character:c.nameLocation.range.start.character}}})}async resolve(e){let t=this.completionRequest.languageServer.quickFixes.get("import-artifact");lC(t,Ui);let r=e.data,i=await t.calculateTextEdit(r.uri,r.importUri,e.filterText);e.additionalTextEdits=[i]}},nf=lx;o(lx,"GlobalIdentifierProposals");var rn=K(Xe());var rf=K(Xe());var ux=class{constructor(e){this.completionRequest=e;m(this,"tracer",G().tracer("completion"))}async getSnippetItems(e,t,r,i){let s=[];if(this.completionRequest.languageServer.options.getClientCapability("capabilities.textDocument.completion.completionItem.snippetSupport",!1)){let c=o((l,u)=>({label:l+ep,sortText:"3)"+e,kind:rf.CompletionItemKind.Snippet,insertText:u,insertTextFormat:rf.InsertTextFormat.Snippet}),"snippet");switch(e){case"@":if(i&&!r.has("entity")){let l=c("title & description",`@(
	title: '{i18n>$1}',
	description: '{i18n>$2}'
)$0`);l.documentation="Add title and description",s.push(l)}else{let l=c("title & description",`@title: '{i18n>$1}'
@description: '{i18n>$2}'$0`);l.documentation="Add title and description",s.push(l);let u=c("doc",`/**
 * $0
 */`);u.documentation=`Add documentation in markdown format
e.g. shown when hovering or as details at code completion`,s.push(u)}break;case"annotate":{let l=c("doc_annotate",`annotate \${1:Foo} with @(
	cds.doc: '$2'
);
$0`);l.documentation=`Add documentation via separate annotate
e.g. shown at code completion or when hovering`,s.push(l),s.push(c("annotate","annotate ${1:Foo} with $0;\n"))}break;case"association":s.push(c("Association to","Association ${1|to ,to one ,to many |}"));break;case"composition":s.push(c("Composition of","Composition ${1|of ,of one ,of many |}"));break;case"context":s.push(c("context",`context \${1:$TM_FILENAME_BASE} {
	$0
}`));break;case"element":s.push(c("element","${1:key }${2:ElementName} : $3;\n$0"));break;case"entity":s.push(c("entity","entity ${1:Foo} : ${2:cuid} {\n	$0\n}")),s.push(c("entity projection","entity ${1:Foo} as projection on ${2:Bar};"));break;case"extend":s.push(c("extend Foo with Bar","extend ${1:Foo} with ${2:Bar};\n$0")),s.push(c("extend Foo with @annotation","extend ${1:Foo} with @${2:title:'Foo'};\n$0")),s.push(c("extend Foo with element",`extend \${1:Foo} with {
	\${2:bar : Integer @(baz)}
};
$0`));break;case"namespace":{let l=t.slice(this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(t).workspaceUri.length).split(ze).slice(0,-1).filter(u=>u).join(".")||"com.sample";s.push(c("namespace",`namespace \${1:${l}};

$0`));break}case"service":s.push(c("service",`service \${1:MyService} {

	$0

}`));break;case"type":r.has("entity")&&(s.push(c("enum","type ${1:Color} : ${2:String} enum {\n	${3:black;}\n	${4:white;}\n};\n$0")),s.push(c("type","type ${1:Name} : ${2:String(${3:20})};\n$0")),s.push(c("structured type","type ${1:Named} : {\n	${2:Name} : ${3:String(${4:20})};\n	$0\n};\n")));break;case"using":{let l=await this.fetchDefaultSuggestedPathForUsingSnippet(t);s.push(c("using",`using { $2 } from '$1${l}';
$0`));break}}}return s}async fetchDefaultSuggestedPathForUsingSnippet(e){let t=this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(e);await t.ensureScanned();let r=hT(t.workspaceSnapshot.streamFiles(s=>this.completionRequest.languageServer.fileSystem.isPackageJsonFile(s.uri),"OpenEditorsAndDirectSources"),(s,a)=>s.set(a.uri,a.content),new Map),i=e.split(ze);for(;i.length;)if(i=i.slice(0,-1),this.checkPath(r,i))return this.tracer.verbose(()=>"Found dependencies to '@sap/cds'. Suggesting '@sap/cds/common' as default using path"),"@sap/cds/common";return""}checkPath(e,t){let r=[...t,"package.json"].join(ze);this.tracer.verbose(()=>`Checking for path '${r}'`);let i=e.get(r);if(!i||i===pe)return!1;let s=Xt(i);return this.tracer.verbose(()=>`Found '${r}'. Checking dependencies for '@sap/cds'`),!!s?.dependencies?.["@sap/cds"]}},Qc=ux;o(ux,"SnippetProposals"),x([Q({fallback:()=>!1,traceComponent:"completion",traceLevel:4})],Qc.prototype,"checkPath",1);var px=class extends en{constructor(t){super(t);m(this,"snippetProposals");this.snippetProposals=new Qc(t)}async fetchProposals(t){let r=[];function i(a,c,l,u=c,p=rn.InsertTextFormat.PlainText,d=p===rn.InsertTextFormat.PlainText?rn.CompletionItemKind.Keyword:rn.CompletionItemKind.Snippet){r.push({label:c,sortText:l,insertTextFormat:p,kind:rn.CompletionItemKind.Keyword,textEdit:rn.TextEdit.replace(t.keywordMap[a]?rn.Range.create(t.position.line,t.position.character,t.position.line,t.position.character):Jr(t.prefix,t.suffix,!0,t.position),u)})}o(i,"pushItem");let s=new Set(Object.keys(t.keywordMap));this.handleIdentifierCase(t,s);for(let a of s)if(this.completionRequest.matchesPrefix(!0,t.prefix,a)){if(!t.suffix.length){let u=await this.snippetProposals.getSnippetItems(a,t.triggerUri,s,t.isEndOfStatement);r=r.concat(u)}let c=a.trimStart(),l="4)"+c;switch(c){case"boolean":i(a,"true",l+"_true"),i(a,"false",l+"_false");break;case"string":i(a,"<string>",l,`'\${1:${t.prefix}${t.suffix}}'$0`,rn.InsertTextFormat.Snippet);break;case"quotedliteral":break;case"number":{t.textLines.getText({start:{line:t.position.line,character:Math.max(t.position.character-1,0)},end:{line:t.position.line,character:t.position.character+1}}).match(/\d/)||i(a,"<number>",l,"${1:1}",rn.InsertTextFormat.Snippet);break}case"array":i(a,"array",l,"array of ");break;case"association":i(a,"Association","3)"+c,"Association to ");break;case"composition":i(a,"Composition","3)"+c,"Composition of ");break;case"extract":i(a,"extract",l,"extract (${1|year,month,day,hour,minute,second|} from $2)$0",rn.InsertTextFormat.Snippet);break;case"cast":i(a,"cast",l,"cast ($1 as $2)$0",rn.InsertTextFormat.Snippet);break;case"trim":i(a,"trim",l,"trim ($1)$0",rn.InsertTextFormat.Snippet);break;default:i(a,c,l,a);break}}return r}handleIdentifierCase(t,r){if(!t.identifierExpected)return;let i=["tokenStartsAtCursor","tokenContainsCursor","tokenEndsWithCursor","tokenAfterCursor"],s=t.parseAst.tokens,a=s.find(u=>i.includes(u.relativeToCursor(t.position))),c=a?.tokenIndex?s[a.tokenIndex-1]:void 0;a&&a.relativeToCursor(t.position)==="tokenAfterCursor"&&c?.isIdentifier()&&t.parseAst.options.messages.filter(p=>t.parseAst.toolbox.filterMessagesInScope(a.start,p,0)).map(p=>p.expectedTokens??[]).flatMap(p=>p).forEach(p=>r.add(f2(p)))}},of=px;o(px,"KeywordProposals");function f2(n){return n.startsWith("'")&&n.endsWith("'")?n.slice(1,-1):n}o(f2,"stripSurroundingQuotes");var ai=K(Xe());var m2="{i18n>",sf="i18n>",dx=class extends en{async fetchProposals(e){let t=e.textLines.getLines()[e.position.line],r=e.position.character,s=/'.{0,40}i18n>(\w*)/.exec(t);if(s&&s.length>1){let l=s.index+s[0].length,u=s.index;if(r>u&&r<=l){let d=t.slice(t.indexOf(sf)+sf.length,r);return this.getAllTranslationIds(e,d,u+1,l-1,!s[1])}}let c=/(title|description)\s*:\s*'([^']*)'/.exec(t);if(c&&c.length>2){let l=t.indexOf("'",c.index),u=c.index+c[0].length;if(r>l&&r<=u){let d=t.slice(l+1,r);return d===m2&&(d=""),this.getAllTranslationIds(e,d,l+1,u-1,!0)}}return[]}getAllTranslationIds(e,t,r,i,s=!1){let a=e.position.line,c=e.textLines.getLines()[a],l=e.position.character,u="${1:define translation id}",p={label:"Add localized text"+ep,kind:ai.CompletionItemKind.Snippet,sortText:"7)",insertText:`{i18n>${u}}`,insertTextFormat:ai.InsertTextFormat.Snippet};c.slice(l-sf.length,l).startsWith(sf)&&(p.insertText=u);let d=s?[p]:[],g=this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(e.triggerUri).translationBroker.getAllTranslations(e.triggerUri);return g.length?d.concat(g.filter(h=>!t||h.id&&h.id.startsWith(t)).map(h=>({label:`${h.id}`,filterText:`{i18n>${h.id}}`,kind:ai.CompletionItemKind.Enum,sortText:"7)"+h.id,documentation:h.text,textEdit:ai.TextEdit.replace(ai.Range.create(a,r,a,i),`{i18n>${h.id}}`)}))):d}},af=dx;o(dx,"TranslationReferenceProposals");var mn=K(require("path")),cf=K(Xe());var fx=void 0;function gN(n,e){for(let t of e)if(n.endsWith(t))return n.slice(0,-t.length);return n}o(gN,"stripIfEndsWith");function h2(n){return n=gN(n,["/index.cds","/index.csn","/index.json"]),n=gN(n,[".cds",".csn",".json"]),n}o(h2,"stripIndexAndExtension");function bN(n){return ne().getPlatformTester().isWindows()?n.replaceAll(/\\/g,"/"):n}o(bN,"toForwardSlashed");var fa=class extends en{async fetchProposals(e){await e.workspaceFolder.ensureScanned();let t=e.textLines.getLines()[e.position.line],r=fa.usingFromRegex.exec(t);if(r===null)return[];delete e.keywordMap.string;let s=r[1].length,a=e.position.character;if(a<s)return[];let l=r[2].length>0,u,p=!1,d;l&&(u=t.indexOf("'"),p=u<a,d=t.indexOf("'",u+1),d===-1&&(d=void 0));let f=u&&u<a?u+1:s,g=t.slice(f,a);!p&&/^\s+$/.test(g)&&(g="");let h=t.slice(a,d),T=Jr(g,h,!1,e.position),S=fa.getSurroundingClutter(s,p,d,a),C=new Map;await e.workspaceFolder.ensureScanned();function L(ie,z,M,B,Y,ae){if(p&&!z.startsWith(Y))return;let de=fa.createMatchingUsingPathProposal(ie,z,M,B,ae,S);C.set(de.label,de)}o(L,"addMatchingUsingPathProposal");let A=Ou(e.localTriggerPath);function W(){let ie=e.workspaceFolder.workspaceRoot;return mn.relative(ie,e.localTriggerPath).includes("node_modules")&&A?mn.join(A.nodeModulesPath,"node_modules",A.npmModule):ie}o(W,"getSourceModuleRoot");let O=o(ie=>this.completionRequest.languageServer.workspaceService.getWorkspaceFolder(ie).adapter.toLocalPath(ie),"toLocalPath"),j=o((ie,z,M)=>{let B=e.workspaceFolder.npmPackages.getPackageRootFolder(z),Y=Ou(z),ae=B?.name??Y.npmModule;if(g.startsWith(ae+ze)){let de=ae.length+1,He=(M??Y.importPath).slice(de),Je=g.slice(de),_=Jr(Je,h,!1,e.position);L(ie,He,He,!0,Je,_)}else L(ie,ae,ae,!0,g,T)},"simplifiedPackageImport"),J=ne().getFileSystem();for(let ie of e.workspaceFolder.workspaceSnapshot.streamFiles(z=>z.uri!==e.triggerUri&&J.isCdsFile(z.uri,z.content),"OpenEditorsDirectSourcesAndDirectDependencies",kr)){let z=O(ie),M=this.getUsingPath(e.localTriggerPath,z,W(),A,e.workspaceFolder);M&&(M.startsWith(".")?L(ie,M,M,!M.startsWith("."),g,T):j(ie,z,M))}return Array.from(C.values())}static createMatchingUsingPathProposal(e,t,r,i,s,a){t=h2(t);let c=0;if(!i){let f=t.split("/").length;t.startsWith("./")?c=f:c=1e3+100*t.split("../").length+f}let l=i?"6)":"5)"+(c+":").padStart(4,"0"),u=a.labelStart+r+a.labelEnd,p=t.replace(/\.(cds|json)$/,""),d=a.start+p+a.end;return{label:u,sortText:l+u,kind:cf.CompletionItemKind.File,textEdit:cf.TextEdit.replace(s,d),data:{targetUri:e}}}static getSurroundingClutter(e,t,r,i){let s="",a="";return i===e&&(s=" ",a="'"),s+=t?"":"'",{start:s,end:r?"":"';",labelStart:a,labelEnd:a}}getPlatformSpecificImportPathUsingMetaData(e,t,r,i){if(r.name===i.name&&r.packageJsonFolderPath===i.packageJsonFolderPath){let s=mn.dirname(e),a=mn.relative(s,t);return a.startsWith("..")?a:"./"+a}if(r.dependencies[i.name]||r.devDependencies[i.name])return i.name+"/"+bN(mn.relative(i.packageJsonFolderPath,t))}getPlatformSpecificImportPath(e,t,r,i,s){let a=s.npmPackages.getPackageRootFolder(e),c=s.npmPackages.getPackageRootFolder(t);if(a&&c)return this.getPlatformSpecificImportPathUsingMetaData(e,t,a,c);this.tracer.warn(()=>`OLD LOGIC: ${e} -> ${t}`);let l=mn.dirname(e),u=mn.relative(l,t),p=u.match(/^((?:\.\.[/\\])+)(node_modules)?/),d=u.startsWith(`node_modules${mn.sep}`),f=p?.[2]||d;if(!p&&!d)return`.${mn.sep}${u}`;let g=ob(u);function h(){return Ou(t)?.importPath}if(o(h,"handleNpmImport"),i&&!g){let T=i.nodeModulesPath,S=mn.relative(T,t);return ob(S)===1?h():fx}return g?f&&g===1?h():fx:p&&mn.join(l,p[1]).startsWith(r)&&g===0?u:fx}getUsingPath(e,t,r,i,s){let a=this.getPlatformSpecificImportPath(e,t,r,i,s);if(a)return bN(a)}},_o=fa;o(fa,"UsingPathProposals"),m(_o,"usingFromRegex",/^(\s*using\b.*\bfrom)\s*('([^']*).*|$)/),x([F("completion",{traceLevel:7,onlyTraceEnd:!0,resultRenderer:n=>n.map(e=>e.label+" -> "+e.textEdit?.newText)})],_o.prototype,"fetchProposals",1),x([F("completion",{traceLevel:7,onlyTraceEnd:!0,resultRenderer:(n,e)=>`${e[0]} -> ${e[1]} = ${n}`})],_o.prototype,"getUsingPath",1);var mx=class extends we{constructor(t){super(t,"completion");m(this,"documentationProposals");m(this,"proposalProviders",new Map);this.documentationProposals=new Bs(this);let r=[Tr,nf,Pc,_o,af,wp,of];for(let i of r){let s=new i(this);this.proposalProviders.set(s.name,s)}}matchesPrefix(t,r,...i){for(let s of i){let a=t?s.toLowerCase():s,c=t?r.toLowerCase():r;if(a.startsWith(c))return!0}return!1}},ma=mx;o(mx,"AbstractCompletionRequest");var hx=class extends we{},jn=hx;o(hx,"AbstractDocumentLifecycleRequest");var gx=class extends we{constructor(e){super(e,"format")}beautify(e,t,r,i,s){let a=this.languageServer.workspaceService.getWorkspaceFolder(e),c=a.getContent(e);if(c===pe)return[];let l=this.languageServer.prettyPrinter.beautifyWithLayeredOptions(c,t,a.adapter.toLocalPath(e),a.workspaceRoot);return this.getTextEdits(l,r,i,s)}getTextEdits(e,t,r,i){let s=[],{originalTokens:a,formattedTokens:c}=e,l=sN(a,t,r,i),u=nN(a,e.exclusionRanges,l);a.length!==c.length&&this.tracer.error(()=>`Failed to beautify: token length have changed (${a.length} => ${c.length}) `);let p=o((h,T)=>({start:h.end,end:T.start}),"betweenRange"),d=o(h=>{let T=a[h],S=c[h];T.originalText!==S.text&&s.push({range:{start:T.start,end:T.end},newText:S.text})},"handleToken"),f=o((h,T)=>{if(h===-1){let S=e.originalContent.slice(0,a[0].startOffset),C=e.formattedContent.slice(0,c[0].startOffset);S!==C&&s.push({range:{start:{line:0,character:0},end:a[0].start},newText:C});return}if(T===-1){let S=e.originalContent.slice(je(a).endOffset+1),C=e.formattedContent.slice(je(c).endOffset+1);if(S!==C){let L=je(a),A=L.end,O=e.originalContent.slice(L.endOffset+1).split(Nt),J=je(O).length+(O.length===1?A.character:0);s.push({range:{start:A,end:{line:A.line+O.length-1,character:J}},newText:C})}return}{let S=a[T],C=c[T],L=a[h],A=c[h],W=e.originalContent.slice(L.endOffset+1,S.startOffset),O=e.formattedContent.slice(A.endOffset+1,C.startOffset);W!==O&&s.push({range:p(L,S),newText:O})}},"handleWhitespace"),g=o(h=>{let T=o(()=>{let{startToken:A,includingWhitespaceBefore:W}=h;return this.tracer.info(()=>`Formatting from token #${A.tokenIndex} (${A.text})${W?" including whitespace before":""}`),{index:A.tokenIndex,includingWhitespaceBefore:W}},"getStart"),S=o(()=>{let{endToken:A,includingWhitespaceAfter:W}=h;return this.tracer.info(()=>`Formatting to token #${A.tokenIndex} (${A.text})${W?" including whitespace after":""}`),{index:A.tokenIndex,includingWhitespaceAfter:W}},"getEnd"),C=T(),L=S();L.includingWhitespaceAfter&&f(L.index,L.index+1===a.length?-1:L.index+1);for(let A=L.index;A>C.index;A--)d(A),f(A-1,A);d(C.index),C.includingWhitespaceBefore&&f(C.index===0?-1:C.index-1,C.index)},"processInclusionRange");return u.reverse(),u.forEach(g),s}},qi=gx;o(gx,"AbstractFormattingRequest");var bx=class extends we{async onCodeAction(e){let t=[];for(let r of this.languageServer.quickFixes.values())this.tracer.verbose(()=>`${r.constructor.name}`),t.push(...await this._createCodeActions({quickFix:r,params:e}));return t}async _createCodeActions({quickFix:e,params:t}){return e.createCodeActions(t)}},ha=bx;o(bx,"CodeAction"),x([oe({paramsRenderer:R.codeAction,resultRenderer:R.codeActions,onErrorReturn:Ee,indexContext:{singleFile:!0,debounce:!0}})],ha.prototype,"onCodeAction",1),x([Q({fallback:Ee,errorTrace:(n,e)=>`for type ${typeof e[0].quickFix}`})],ha.prototype,"_createCodeActions",1);var vx=class extends we{async onCodeLens(e){let{uri:t}=e.textDocument,s=(await this.languageServer.workspaceService.getWorkspaceFolder(t).fetchFileIndex(t))._statistics.toString();return[{range:{start:{line:0,character:0},end:{line:0,character:0}},command:{title:s,command:void 0}}]}},Yc=vx;o(vx,"CodeLens"),x([oe({paramsRenderer:n=>n.textDocument.uri,resultRenderer:R.asIs,onErrorReturn:Ee,indexContext:{singleFile:!0,debounce:!0}})],Yc.prototype,"onCodeLens",1);var ga=K(require("path")),vN=K(Ws());var En=class extends ma{constructor(){super(...arguments);m(this,"keywordErrorProvoker","\u2260")}async onCompletion(t){let r=this.getCompletionContext(t);if(this.tracer.isTracing(6)){let T=r.textLines.clone().insert("<<<coco>>>",t.position).getLines()[t.position.line];this.tracer.verbose(()=>`Completions for line: ${T}`)}let i=G().tracer("model"),{rootNode:s,parseAst:a}=this.languageServer.compiler.parse(r.originalContent,r.localTriggerPath,{});i.debug(()=>"====== Grammar Tree ====="),i.debug(()=>new pa().debugPrint(s,new Do,0));let c={...r,parseAst:a,parseTree:s},{keywordMap:l,isEndOfStatement:u}=this.getPossibleKeywords(c),p={...c,isEndOfStatement:u,keywordMap:l,identifierExpected:l.identifier!==void 0},d=!1,f=[];if(t.context?.triggerCharacter==="/"){let T=p.parseTree.allTokens.find(S=>S.relativeToCursor(p.position)==="tokenContainsCursor");if(!T||T.isComment())return this.tracer.verbose(()=>"Completion was triggered via '/' trigger character outside an identifier or string literal => Ignoring request"),{items:f,isIncomplete:d}}lf.hasErrors(a)&&lf.sanitizeIncompleteAnnotations(p,this.languageServer.compiler);let g=o(T=>{T.data||(T.data={}),T.data.position={...p.position},T.data.url=p.triggerUri},"attachCursorPosition");for(let T of this.proposalProviders.values()){let S=o(L=>L.data?L.data.providerName=T.name:void 0,"attachProviderName"),C=await this._fetchProposalsForProvider(T,p);C.items.forEach(S),C.items.forEach(g),f.push(...C.items),d=d||C.isIncomplete}f=this.removeAntiCompletionItems(f);let h=o(T=>T.sortText||"zzz","sortText");return f.sort((T,S)=>T.label.localeCompare(S.label)||h(T).localeCompare(h(S),"en-US",{sensitivity:"base"})),f=f.filter((T,S,C)=>T.label!==C[S-1]?.label||!h(T).startsWith("8)")),f.sort((T,S)=>h(T).localeCompare(h(S),"en-US",{sensitivity:"base"})),{items:f,isIncomplete:d}}async _fetchProposalsForProvider(t,r){return t.fetchList(r)}removeAntiCompletionItems(t){let r=[],i=new Set(t.filter(s=>s instanceof ko).map(s=>s.label));return t.forEach(s=>{i.has(s.label)||r.push(s)}),r}getPossibleKeywords(t){let{textLines:r,position:i,prefix:s,suffix:a}=t,l=r.getLines()[i.line].slice(i.character).split(" ").filter(h=>h!==""),u=l.length>0?l[0]:"",p={isEndOfStatement:!1,keywordMap:Ve(),nextToken:u},d=this.makeHandleParseMessage(t,p);this.parseAtBeginningOfPrefix(t,d),s.length&&!a.length&&this.parseAfterPrefix(t,d);let{isEndOfStatement:f,keywordMap:g}=p;if(g.cast!==void 0&&g.extract===void 0)for(let h of this.getSpecialKeywordsFromCompiler())g[h]=g.cast;return{isEndOfStatement:f,keywordMap:g}}getSpecialKeywordsFromCompiler(){return ar.instance.getSpecialFunctions?.()??["extract","trim"]}parseAtBeginningOfPrefix(t,r){let i=-t.prefix.length,s=this.languageServer.compiler.parse(En.prepareContent(t,this.keywordErrorProvoker,i),t.localTriggerPath),a=s.parseAst.options.messages;a=a.filter(c=>s.parseAst.toolbox.filterMessagesInScope(t.position,c,i)),a.forEach(c=>{r(c)})}parseAfterPrefix(t,r){let s=this.languageServer.compiler.parse(En.prepareContent(t,this.keywordErrorProvoker,0),t.localTriggerPath),a=s.parseAst.options.messages;a=a.filter(c=>s.parseAst.toolbox.filterMessagesInScope(t.position,c,0)),a.forEach(c=>{r(c,!0)})}makeHandleParseMessage(t,r){return(i,s=!1)=>{i.expectedTokens&&(this.tracer.verbose(()=>`Raw suggestions for ${s?"insert":"replace"}: ${i.expectedTokens}`),i.expectedTokens.forEach(a=>{let c=a.replaceAll(IT,"");if(c=c.toLowerCase(),c!=="<eof>"){if(c===";"&&(r.isEndOfStatement=!0),t.prefix!==""&&r.nextToken.startsWith(c)){this.tracer.info(()=>`Removing next suggested token: ${c}`);return}!s&&t.prefix.length&&!En.isIdentifierSegment(c)||s&&En.isIdentifierSegment(c)||(r.keywordMap[c]=s)}}))}}getCompletionContext(t){let r=t.textDocument.uri,i=this.languageServer.workspaceService.getWorkspaceFolder(r),s=i.adapter.toLocalPath(r);ga.isAbsolute(s)||(s=ga.join(process.cwd(),s));let a=ga.dirname(s),c=i.workspaceSnapshot,l=c.getContent(r),u=l===pe?"":l,p=t.position,d=new On(u),{prefix:f,suffix:g,fullPrefix:h}=En.getPrefixAndSuffix(d,t.position);return{compile:(T,S="",C)=>this.compileWithInlay(T,S,C),triggerUri:r,workspaceFolder:i,localTriggerPath:s,localTriggerDir:a,originalSnapshot:c,originalContent:u,position:p,textLines:d,prefix:f,suffix:g,fullPrefix:h}}async compileWithInlay(t,r,i=-t.prefix.length){let s=t.originalSnapshot.change(void 0,{[t.triggerUri]:En.prepareContent(t,r,i)},!0);t.effectiveSnapshot=s;let a=t.workspaceFolder.getCdsEnv(),c=a&&a.cdsc||{};return c.fallbackParser="cds",c.attachValidNames=!0,this.languageServer.compiler.compile(t.localTriggerPath,t.workspaceFolder.workspaceRoot,mi.create(s,!1),c)}static isIdentifierSegment(t){return RegExp(`^${this.identifierRule}$`).test(t)}static getPrefixAndSuffix(t,r){let i=t.getLines()[r.line],a=i.slice(0,r.character).match(new RegExp(En.dottedIdentifier+"\\.?$","gim")),c=a?.length?je(a):"",l=c+i.slice(r.character),u=l.match(new RegExp(En.dottedIdentifier,"gim")),p=u?.length&&l.indexOf(lb(u))===0?lb(u).slice(c.length):"",d=c.lastIndexOf(".")+1,f=c;return d>0&&(f=f.substring(d)),{prefix:f,suffix:p,fullPrefix:c}}static prepareContent({textLines:t,position:r},i,s){return t.clone().insert(i,{line:r.line,character:r.character+s}).getText()}},Or=En;o(En,"Completion"),m(Or,"identifierRule",'(([$_a-zA-Z][$_a-zA-Z0-9]*)|("[^\\u0022\\n\\r\\u2028\\u2029]*")+)'),m(Or,"dottedIdentifier",`${En.identifierRule}(\\.${En.identifierRule})*`),x([oe({paramsRenderer:R.textPos,resultRenderer:R.completionList,onErrorReturn:(n,e,t)=>({isIncomplete:!1,items:[]}),indexContext:{singleFile:!0}})],Or.prototype,"onCompletion",1),x([Q({fallback:()=>({items:[],isIncomplete:!1}),traceComponent:"completion",traceLevel:4,errorTrace:(n,e)=>`for provider '${e[0].name}'`})],Or.prototype,"_fetchProposalsForProvider",1),x([F("completion",{argumentsRenderer:R.nothing})],Or.prototype,"parseAtBeginningOfPrefix",1),x([F("completion",{argumentsRenderer:R.nothing})],Or.prototype,"parseAfterPrefix",1);var yx=class{static hasErrors(e){return e.options.messages.length>0?e.options.messages.map(t=>t.severity==="Error").includes(!0):!1}static sanitizeIncompleteAnnotations(e,t){let{messages:r}=e.parseAst.options;r.reverse();for(let i=0,s=r.length;i<s;i++){let c=r[i].$location,l={line:c.line-1,character:c.col+1};if(kn(e.position,l)===-1){let{text:p,startOffsetCursor:d}=this.getTextBetweenCursorAndError(e,l);if(p.match(/^[.:]\s/)){let{hasAnnotationOperator:f,annotationToken:g}=this.getAnnotation(e);if(f){let h=this.repairText(e,g.startOffset,d),{rootNode:T,parseAst:S}=t.parse(h,e.localTriggerPath);e.parseAst=S,e.parseTree=T;break}}}}}static getTextBetweenCursorAndError(e,t){let r=vN.TextDocument.create(e.triggerUri,"cds",0,e.originalContent),i=r.offsetAt(e.position),s=r.offsetAt(t);return{text:e.originalContent.substring(i-1,s),startOffsetCursor:i}}static getAnnotation(e){let i=e.parseTree.allTokens.find(s=>s.relativeToCursor(e.position)==="tokenEndsWithCursor").getPreviousToken().getPreviousToken(s=>s.originalText==="@");return{hasAnnotationOperator:!!i,annotationToken:i?.getNextToken()}}static repairText(e,t,r){let i=e.originalContent;return i.substring(0,t-1)+`@(${i.substring(t,r-1)})`+i.substring(r)}},lf=yx;o(yx,"AnnotationSanitizer");var uf=K(Xe()),yN=K(Ws());var Ix=class extends ma{async onCompletionResolve(e){return this.languageServer.options.getClientCapability("capabilities.textDocument.completion.completionItem.documentationFormat",[]).includes(uf.MarkupKind.Markdown)&&this.languageServer.options.getUserSetting("cds.completion.showDocumentation")&&await this.documentationProposals.attachDocumentation(e,this.languageServer.workspaceService),QC(e)&&await this.proposalProviders.get(e.data.providerName).resolve(e),this.formatAfterwardsIfSnippet(e),e}formatAfterwardsIfSnippet(e){if(this.languageServer.options.getUserSetting("cds.completion.formatSnippets")&&e.insertTextFormat===uf.InsertTextFormat.Snippet){if(e.command){this.tracer.warn(()=>`Cannot apply formatting after snippet insertion. There is already a command defined: ${e.command}`);return}if(!e.insertText){this.tracer.warn(()=>`Cannot apply formatting after snippet insertion. Snippet must be defined as insertionText: ${e}`);return}let t=e?.data?.position,r=e?.data?.url,i=this.languageServer.workspaceService.getWorkspaceFolder(r).getContent(r),s=i===pe?"":i,c=yN.TextDocument.create(r,"cds",0,s).offsetAt(t);for(;c<s.length-1&&s[c]===" ";)c++;let l=s.length-c,u="format-range";e.command={command:u,title:"Format Snippet",arguments:[{position:t,offsetFromEnd:l,uri:r}]}}}},Zc=Ix;o(Ix,"CompletionResolve"),x([oe({paramsRenderer:R.completionItem,resultRenderer:R.completionItem,onErrorReturn:tf})],Zc.prototype,"onCompletionResolve",1);var IN=K(Xe());var xx=class extends At{async onDefinition(e){let t=await this.fetchTranslation(e);if(t){let[l]=t;return[{uri:l.uri,range:{start:{line:l.line,character:l.character},end:{line:l.line,character:l.character+(l.text?l.text.length:0)}}}]}let r=e.textDocument.uri,i=e.position,s=this.languageServer.workspaceService.getWorkspaceFolder(r),a=await s.fetchToken(r,i),c=await this.fromAnnotationHandler("fetchDefinition",s,e);if(hp(a)){let l=this.languageServer.options.getUserSetting("cds.whereused.showGenericAnnotations"),u=ap(a.definitions);if((Pt(u)||Ic(u))&&(!vc(u)||l)){let p={targetUri:u.location.uri,targetRange:u.location.range,targetSelectionRange:u.nameLocation.range};c.push(p)}}return go(c,l=>IN.LocationLink.is(l)?{uri:l.targetUri,range:l.targetSelectionRange}:l)}async fetchTranslation(e){let t=e.textDocument.uri,r=this.languageServer.workspaceService.getWorkspaceFolder(t),s=(await r.fetchFileIndex(t))?.stringAt(e.position);if(s&&s.translationId){let a=s.translationId,c=r.translationBroker.getTranslation(t,a);if(c)return[c,s]}}},el=xx;o(xx,"Definition"),x([oe({paramsRenderer:R.textPos,resultRenderer:R.locations,onErrorReturn:Ee,indexContext:{singleFile:!0}})],el.prototype,"onDefinition",1);var CN=K(require("path"));var Mo=K(require("path"));var xN="@cap-js/cds-typer",kx=class extends Error{constructor(e){super(e),this.name=this.constructor.name}},nl=kx;o(kx,"TypeGeneratorError");var Cx=class extends nl{},Sx=Cx;o(Cx,"TyperNotInstalledError");var Px=class extends nl{},df=Px;o(Px,"CDSError");var Rx=class extends nl{},Tx=Rx;o(Rx,"ProjectRootNotResolvableError");function $me(){Oo.unload()}o($me,"unloadTyper");var Ax=class{constructor(){m(this,"rootCache",{})}resolveRootDirectory(e){if(e in this.rootCache)return this.rootCache[e];let t=ne().getFileSystem(),r=o(s=>t.readdirSync(s).find(a=>["package.json","build.gradle",".git","srv","db","app"].includes(a)),"isRoot");do e=Mo.dirname(e);while(!t.isFileSystemRoot(e)&&!r(e));let i=t.isFileSystemRoot(e)&&!r(e)?void 0:e;return i&&(this.rootCache[e]=i),i}resolveTyperBinary(e){let t=this.resolveRootDirectory(e);if(!t)throw new Tx(`No project root could be determined for the CDS file ${e}, therefore no destination for the generated types was determined. Consider adding a package.json to your project's root`);try{let r=Mo.dirname(require.resolve(xN,{paths:[t]})),{bin:i}=require(Mo.join(r,"package.json")),[s]=Object.values(i);return Mo.join(r,s)}catch{throw new Sx(`Will not attempt to generate types as the type generator is not installed in your CDS project. Install ${xN} as peer dependency of your project to enable type generation for this project`)}}},pf=Ax;o(Ax,"RootResolver"),x([Pe()],pf.prototype,"resolveTyperBinary",1);var Lx=class{constructor(e){this.languageServer=e;m(this,"tracer",G().tracer("files"))}sendTyperStatus(e,t){let r=this.languageServer.userInterface,[i,s]=e==="error"?['Error during type generation. See "CDS" output channel',5e3]:["CDS type generation successful",1e3];r.statusMessage(i,s),r.userOutput(t)}async attemptTypeGeneration(e){try{let t=this.languageServer.workspaceService.getWorkspaceFolder(e),r=t.adapter.toLocalPath(e),i=Oo.getInstance(this.languageServer.options);await i.enqueueAndRun(r,t),i.enabled&&this.sendTyperStatus("info",`Generated type information for CDS model into '${i.outputPath}'`)}catch(t){let r=t instanceof df?"warn":"error";this.tracer[r](()=>t.toString()),this.sendTyperStatus("error",t.toString())}}},tl=Lx;o(Lx,"TyperOnSaveHandler"),x([F("files")],tl.prototype,"attemptTypeGeneration",1);var $i=class{constructor(e,t){m(this,"queue",[]);m(this,"running");m(this,"rootResolver");m(this,"deactivated",new Set);m(this,"outputPath");m(this,"enabled");this.outputPath=e,this.enabled=t,this.rootResolver=new pf}static unload(){$i.instance=void 0}static getInstance(e){return $i.instance||($i.instance=new $i(e.getUserSetting("cds.typeGenerator.outputPath"),e.getUserSetting("cds.typeGenerator.enabled"))),$i.instance}async run({typerBinary:e,originalFile:t,targetFile:r,outputDir:i,spawnOptions:s,workspace:a}){let c=o(l=>`"${l}"`,"enquote");try{await Vt.run(e,[c(r),"--outputDirectory",c(i)],{...s,failIfNonZeroExit:!0})}catch(l){let{message:u}=l;throw new df(`Could not (re)generate types for model. Could not read file content of ${r}: ${u}`)}}scheduleFullRun(e,t){let r=this.rootResolver.resolveRootDirectory(e),i=this.rootResolver.resolveTyperBinary(e);this.queue.push({typerBinary:i,targetFile:"*",originalFile:e,workspace:t.workspaceRoot,outputDir:Mo.join(r,this.outputPath),spawnOptions:{cwd:r}})}async enqueueAndRun(e,t){if(this.enabled!==!1&&!this.deactivated.has(t.workspaceRoot)&&!this.queue.some(({targetFile:r,originalFile:i,workspace:s})=>i===e||t.workspaceRoot===s&&r==="*")&&(this.scheduleFullRun(e,t),!this.running))try{for(this.running=!0;this.queue.length>0;){let r=this.queue.shift();try{await this.run(r)}catch(i){if(i?.message.search("MODEL_NOT_FOUND")>-1)r.targetFile=r.originalFile,await this.run(r);else throw i}}}finally{this.running=!1}}},Oo=$i;o($i,"CDSTyperWrapper"),m(Oo,"instance");var SN=K(require("path")),TN=K(wx());function g2(n){let e=n[0];return`${e?.name??"<undefined>"}: ${e?.uri??"<undefined>"}`}o(g2,"renderWorkspaceFolderConfig");var kN=o(n=>n.kind==="outsider","isOutsider");var Uo=o(n=>n.kind==="normal","isNormalWorkspaceFolder"),Fx=class extends TN.TypedEmitter{constructor(t){super();this.lspServer=t;m(this,"_workspaceFolders",new Map);m(this,"tracer");m(this,"uriToWorkspaceFolder",new Map);m(this,"_isWindows");this.tracer=G().tracer("workspace"),this._isWindows=t.platformTester.isWindows();let r=ne();this._addWorkspaceFolder(r.createWorkspace("untitled",t)),this._addWorkspaceFolder(r.createWorkspace("outsider",t))}workspaceFolders(t=()=>!0){let r=[];for(let i of this._workspaceFolders.values())t(i)&&r.push(i);return r}_addWorkspaceFolder(t,r=t.workspaceUri){this._workspaceFolders.set(r,t)}addWorkspaceFolder(t){let r=this._workspaceFolders.get(t.uri);if(r){r.name=t.name;return}let i=ne(),s=i.createWorkspace("normal",this.lspServer,t.name,i.createPathAdapter(t.uri));return wt.logLater(()=>new wt().workspaceFolderStats(s.name,s.workspaceRoot,s.adapter.clientRootUri)),this._addWorkspaceFolder(s),this.emit("onWorkspaceFolderAdded",s),s}removeWorkspaceFolder(t){let r=this._workspaceFolders.get(t);if(r){r.diagnostics.cleanDiagnostics(r.name),this._workspaceFolders.delete(t);let i=[];for(let[s,a]of this.uriToWorkspaceFolder.entries())a===r&&i.push(s);for(let s of i)this.uriToWorkspaceFolder.delete(s)}}getWorkspaceFolder(t){let r=this.uriToWorkspaceFolder.get(t);return r||(r=o(()=>{let s={folder:void 0,score:-100};for(let a of this.workspaceFolders()){let c=this.getResponsibilityScore(a,t);c>s.score&&(s={folder:a,score:c})}return s.folder},"selectBest")(),this.tracer.debug(()=>`File ${t} is handled by workspace folder ${r&&r.workspaceUri}`),this.uriToWorkspaceFolder.set(t,r)),r}getResponsibilityScore(t,r){let i=t.workspaceUri;return this._isWindows&&([r,i]=[r,i].map(s=>s.toLowerCase())),r.startsWith(i)?t.workspaceUri.length:0}getWorkspaceSettingsPath(){return this.workspaceFolders(Uo).map(t=>SN.join(t.workspaceRoot,".cds-lsp",".settings.json")).find(t=>this.lspServer.fileSystem.existsSync(t))}},ba=Fx;o(Fx,"WorkspaceService"),x([F("workspace",{argumentsRenderer:g2,resultRenderer:R.nothing}),Q({fallback:re})],ba.prototype,"addWorkspaceFolder",1),x([F("workspace",{argumentsRenderer:bt,resultRenderer:R.nothing}),Q({fallback:re})],ba.prototype,"removeWorkspaceFolder",1);var Dx=class extends we{async onDidChangeConfiguration(e){let t=this.getEffectiveSettings(e);Oo.unload(),this.tracer.isTracing(6)||this.languageServer.trace.conditionalTrace("requests",2,()=>`New user settings: ${R.asIs(t)}`);let r=this.updateSettings(t,["cds.workspaceValidationMode","cds.diagnosticsSeverity","cds.workspace.scanCsn","cds.workspace.scanDependentModules"]);if(this.languageServer.trace.configure({components:this.languageServer.options.getUserSetting("cds.trace.components"),logfileCount:this.languageServer.options.getUserSetting("cds.trace.logfiles.count"),logfileSize:this.languageServer.options.getUserSetting("cds.trace.logfiles.maxSize")}),r.hasValidationRelevantChanges())for(let i of this.languageServer.workspaceService.workspaceFolders(Uo))(r.hasChangedTo("cds.workspaceValidationMode",["OpenEditorsAndDirectSources","OpenEditorsDirectSourcesAndDirectDependencies"])||r.hasChangedTo("cds.workspace.scanCsn",["ByFileExtension","InspectJson"])||r.hasChangedTo("cds.workspace.scanDependentModules",[!0]))&&await i.ensureScanned(),await i.triggerRevalidation()}getEffectiveSettings(e){let t=o((i,s)=>(s&&wt.log(new wt().genericStats(i,s)),{source:i,params:s}),"settingsFor"),r=o((i,s)=>t(`${i}: ${s}`,this.readSettings(s)),"fromFile");return this.mergeConfigParams(r("Optional config file from cds-lsp",this.getLspSettingsPath()),t("From client via language server protocol i.e. User Settings",e),r("Optional config file in 1st workspace",this.languageServer.workspaceService.getWorkspaceSettingsPath()))}updateSettings(e,t){let r=new class extends Map{hasValidationRelevantChanges(){return[...this.values()].some(([i,s])=>i!==s)}hasChangedTo(i,s){let[,a]=r.get(i)??[];return s.includes(a)}};for(let i of t){let s=this.languageServer.options.getUserSetting(i);r.set(i,[s,void 0])}this.languageServer.options.userSettings=e;for(let i of t){let s=this.languageServer.options.getUserSetting(i),a=r.get(i);a[1]=s}return r}mergeConfigParams(...e){let t={settings:{}};for(let{source:r,params:i}of e){if(!i){this.tracer.info(()=>`Overlaying settings: skipping, no params for '${r}'`);continue}this.tracer.info(()=>`Overlaying settings with '${r}'`),Jg(t,i,void 0,this.tracer)}return t}getLspSettingsPath(){return CN.join(Ft,".cds-lsp/.settings.json")}readSettings(e){let t=this.languageServer.fileSystem;if(t.existsSync(e)){let r=t.readFileSync(e);return Xt(r)}}},ci=Dx;o(Dx,"DidChangeConfiguration"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re,withProgress:"Initializing"})],ci.prototype,"onDidChangeConfiguration",1),x([F("util")],ci.prototype,"getEffectiveSettings",1),x([Q({fallback:re,errorTrace:(n,e)=>`Local settings file ${e[0]} exists, but is not a valid JSON`})],ci.prototype,"readSettings",1);var PN=K(Xe()),Nx=K(Ws());var _x=class extends jn{async onDidChangeTextDocument(e){let{uri:t}=e.textDocument;if(!this.languageServer.fileSystem.isCdsFile(t))return[];let r=this.languageServer.workspaceService.getWorkspaceFolder(t),i=this.getUpdatedContent(e,r.workspaceSnapshot);return r.progressSnapshot(void 0,{[t]:i}),(await r.triggerRevalidation([t]))[t]||[]}getUpdatedContent(e,t){let{uri:r}=e.textDocument;if(e.contentChanges.length===1&&PN.TextDocumentContentChangeEvent.isFull(e.contentChanges[0]))return e.contentChanges[0].text;let i=t.getContent(r);if(i===pe)throw new Error(`Cannot delta-update non existing file ${r}`);let s=Nx.TextDocument.create(r,"cds",0,i);return Nx.TextDocument.update(s,e.contentChanges,1).getText()}},rl=_x;o(_x,"DidChangeTextDocument"),x([oe({paramsRenderer:R.changeTextDoc,resultRenderer:R.diags,onErrorReturn:Ee,indexContext:{singleFile:!0,debounce:!0}})],rl.prototype,"onDidChangeTextDocument",1);var Ox=K(Xe());var Mx=class extends jn{async onDidChangeWatchedFiles(e){this.invalidateCacheMissesIfNewFileWasCreated(e);let t=this.distributeToWorkspaceFolders(e),r=[];for(let[i,s]of t){let a=s.reduce((l,u)=>(l.set(u.uri,u),l),new Map),c=this.progressSnapshot(i,[...a.values()]);c.length&&r.push([i,c])}for(let[i,s]of r)await i.onDidChangeWatchedFiles({changes:s})}invalidateCacheMissesIfNewFileWasCreated(e){let t=e.changes.find(r=>r.type===Ox.FileChangeType.Created);t&&(this.tracer.warn(()=>`New file was created, wiping cacheMisses: ${t.uri}`),this.languageServer.compiler.invalidateCacheMisses())}progressSnapshot(e,t){let r=this.readUpdatedContents(e,t),{formerSnapshot:i,updatedSnapshot:s}=e.progressSnapshot(r),a=o(({uri:c})=>i.getContent(c)!==s.getContent(c),"contentHasChanged");return t.filter(a)}distributeToWorkspaceFolders(e){let t=new Map;return e.changes.forEach(r=>{let i=r.uri;if(!i.startsWith("file:")||i.startsWith("untitled:"))return;let s=this.languageServer.workspaceService.getWorkspaceFolder(i),a=s.getCdsEnv(),c=this.languageServer.fileSystem;if(!(c.isCdsFile(i)||c.isTranslationFile(a,i)||c.isCdsEnvFile(i)||c.isIgnoreFile(i)))return;let u=t.get(s);u||(u=[],t.set(s,u)),u.push(r)}),t}readUpdatedContents(e,t){let r=Ve();return t.forEach(i=>{let s=i.uri;if(!s.startsWith("file:")&&!s.startsWith("untitled:")){this.tracer.info(()=>`Skipping unsupported URI scheme ${s}`);return}r[s]=i.type===Ox.FileChangeType.Deleted?pe:e.readContent(s)}),r}},va=Mx;o(Mx,"DidChangeWatchedFiles"),x([oe({paramsRenderer:R.changeWatched,resultRenderer:R.asIs,onErrorReturn:re,indexContext:{}})],va.prototype,"onDidChangeWatchedFiles",1),x([F("workspace",{traceLevel:6,argumentsRenderer:n=>`${R.asIs(n[1])}`,resultRenderer:R.nothing})],va.prototype,"readUpdatedContents",1);var Ux=class extends we{async onDidChangeWorkspaceFolders(e){this.tracer.info(()=>`Workspace folders changed: ${R.asIs(e)}`);let{workspaceService:t}=this.languageServer;for(let r of e.added)await t.addWorkspaceFolder(r)?.triggerRevalidation();e.removed.forEach(r=>{t.removeWorkspaceFolder(r.uri)})}},il=Ux;o(Ux,"DidChangeWorkspaceFolders"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re})],il.prototype,"onDidChangeWorkspaceFolders",1);var b2=new Map([["ActiveEditorOnly",-1],["OpenEditorsOnly",-1],["OpenEditorsAndDirectSources",0],["OpenEditorsDirectSourcesAndDirectDependencies",1]]),qx=class extends jn{async onDidCloseTextDocument(e){let{uri:t}=e.textDocument,r=this.languageServer.workspaceService.getWorkspaceFolder(t),{updatedSnapshot:i}=r.progressSnapshot(void 0,{[t]:pe});i.activeEditor===t&&(i.activeEditor=void 0);let s=r.dependencyLevel(t),a=this.languageServer.options.getUserSetting("cds.workspaceValidationMode"),c=b2.get(a),l=o(()=>i.isIgnored(t),"isIgnoredFile");(s>c||l())&&this.languageServer.clientProblems.updateFile(t,null)}},ol=qx;o(qx,"DidCloseTextDocument"),x([oe({paramsRenderer:R.docClosed,resultRenderer:R.asIs,onErrorReturn:re,indexContext:{singleFile:!0}})],ol.prototype,"onDidCloseTextDocument",1);var $x=class extends jn{async onDidOpenTextDocument(e){let{uri:t}=e.textDocument;if(!this.languageServer.fileSystem.isCdsFile(t,e.textDocument.text))return[];let r=this.languageServer.workspaceService.getWorkspaceFolder(t);return r.workspaceSnapshot.activeEditor=t,r.progressSnapshot(void 0,{[t]:e.textDocument.text}),(await r.triggerRevalidation([t]))?.[t]??[]}},sl=$x;o($x,"DidOpenTextDocument"),x([oe({paramsRenderer:R.docOpened,resultRenderer:()=>"",onErrorReturn:Ee,indexContext:{singleFile:!0}})],sl.prototype,"onDidOpenTextDocument",1);var Wx=class extends jn{async progressWorkspaceAndTriggerRevalidation(e){let{uri:t}=e.textDocument,r=e.text??void 0;if(r!==void 0){let i=this.languageServer.workspaceService.getWorkspaceFolder(t),{formerSnapshot:s,updatedSnapshot:a}=i.progressSnapshot({[t]:r},{[t]:r});if(s.getContent(t)!==a.getContent(t))return(await i.triggerRevalidation([t]))[t]||[]}return[]}async onDidSaveTextDocument(e){let{uri:t}=e.textDocument;if(!this.languageServer.fileSystem.isCdsFile(t,e.text))return[];this.tracer.info(()=>`** saved editor file ${t}`);let r=await this.progressWorkspaceAndTriggerRevalidation(e);return await this.callInterestedPlayers(t),r}async callInterestedPlayers(e){await new tl(this.languageServer).attemptTypeGeneration(e)}},qo=Wx;o(Wx,"DidSaveTextDocument"),x([F("files")],qo.prototype,"progressWorkspaceAndTriggerRevalidation",1),x([oe({paramsRenderer:R.docSaved,resultRenderer:R.asIs,onErrorReturn:re,indexContext:{singleFile:!0}})],qo.prototype,"onDidSaveTextDocument",1),x([Q({fallback:re})],qo.prototype,"callInterestedPlayers",1);var Bx=class extends qi{async onDocumentFormatting(e){return this.beautify(e.textDocument.uri,e.options)}},al=Bx;o(Bx,"DocumentFormatting"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.textEdits,onErrorReturn:re,indexContext:{singleFile:!0}})],al.prototype,"onDocumentFormatting",1);var jx=K(Xe());var Vx=class extends At{async onDocumentHighlight(e){let{uri:t}=e.textDocument,i=await this.languageServer.workspaceService.getWorkspaceFolder(t).fetchFileIndex(t),s=[],a=i?.identifierAt(e.position);if(a){let c=Ns(a.definitions);_t(a.definitions).forEach(l=>{for(let u of i.redefinitionsFor(l))c.add(u)}),c.forEach(l=>{Pt(l)&&l.nameLocation.uri===t&&s.push({range:l.nameLocation.range,kind:jx.DocumentHighlightKind.Write});for(let u of i.referencesFor(l))s.push({range:u.range,kind:jx.DocumentHighlightKind.Read})})}return go(s,c=>({uri:t,range:c.range}))}},cl=Vx;o(Vx,"DocumentHighlight"),x([oe({paramsRenderer:R.textPos,resultRenderer:R.docHighlights,onErrorReturn:Ee,indexContext:{singleFile:!0,debounce:!0}})],cl.prototype,"onDocumentHighlight",1);var Gx=class extends At{async onDocumentLinkResolve(e){let t=e.data;Oi().uri=t;let[r,i]=await this.fetchWorkspaceFolderAndIndex(t),s=e.range.start,c=i.stringAt(s).text.slice(1,-1);return e.target=this.languageServer.usingPathResolver.resolveUsingPath(t,c,r),e}},ll=Gx;o(Gx,"DocumentLinkResolve"),x([oe({paramsRenderer:R.documentLink,resultRenderer:R.documentLink,onErrorReturn:tf,indexContext:{singleFile:!0,debounce:!0}})],ll.prototype,"onDocumentLinkResolve",1);var Hx=class extends At{async onDocumentLinks(e){let{uri:t}=e.textDocument,[,r]=await this.fetchWorkspaceFolderAndIndex(t),i=o(s=>({start:{line:s.start.line,character:s.start.character+1},end:{line:s.end.line,character:s.end.character-1}}),"stripSurroundingQuotes");return r.plainStringTokens.filter(s=>s.isUsingPath).map(s=>({range:i(s.range),data:t}))}},ul=Hx;o(Hx,"DocumentLinks"),x([oe({paramsRenderer:R.documentLinkParams,resultRenderer:R.documentLinks,onErrorReturn:Ee,indexContext:{singleFile:!0,debounce:!0}})],ul.prototype,"onDocumentLinks",1);var zx=class extends qi{async onDocumentOnTypeFormatting(e){return this.beautify(e.textDocument.uri,e.options,void 0,e.position,e.ch)}},pl=zx;o(zx,"DocumentOnTypeFormatting"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.textEdits,onErrorReturn:re,indexContext:{singleFile:!0}})],pl.prototype,"onDocumentOnTypeFormatting",1);var Kx=class extends qi{async onDocumentRangeFormatting(e){return this.beautify(e.textDocument.uri,e.options,e.range)}},$o=Kx;o(Kx,"DocumentRangeFormatting"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.textEdits,onErrorReturn:re,indexContext:{singleFile:!0}})],$o.prototype,"onDocumentRangeFormatting",1);var RN=K(Ws());var Jx=class{constructor(){m(this,"rangeMap",new Map)}_getKey(e){return R.range(e)}add(e){let t=this._getKey(e);return this.rangeMap.set(t,e)}dump(){let e=[...this.rangeMap.values()];return this.rangeMap.clear(),e}},Xx=Jx;o(Jx,"RangeMap");var Qx=class extends we{constructor(){super(...arguments);m(this,"ranges",new Xx)}async onSelectionRanges(t){let r=this.languageServer.workspaceService.getWorkspaceFolder(t.textDocument.uri),i=r.getContent(t.textDocument.uri);if(i===pe)return[];let{rootNode:s}=this.languageServer.compiler.parse(i,r.adapter.toLocalPath(t.textDocument.uri)),a=RN.TextDocument.create(t.textDocument.uri,"cds",0,i),c=/\s/;return t.positions.forEach(l=>{let u=s.context.ruleTokens,p,d=!1,f=a.offsetAt(l);if(c.test(i[f])&&(f===0||c.test(i[f-1]))){d=!0;let h=i.slice(0,f).trimEnd().length;h===0?p=u[0]:l=a.positionAt(h)}if(p=p??Rn(u,l),p){let h={start:{line:p.line,character:p.character},end:{line:p.endLine,character:p.endCharacter}};d||this.ranges.add(h),this.addRanges(p.parent,d,a)}let g={start:{line:0,character:0},end:{line:a.lineCount,character:i.length}};this.ranges.add(g)}),this.ranges.dump()}addRanges(t,r,i){let s={start:{line:t.getFirstToken().line,character:t.getFirstToken().character},end:{line:t.getLastToken().endLine,character:t.getLastToken().endCharacter}};t.parent&&(r||(this.ranges.add(s),r=!1),this.addRanges(t.parent,r,i))}},dl=Qx;o(Qx,"DocumentRangeSelection"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re})],dl.prototype,"onSelectionRanges",1);var Yx=class extends At{async onDocumentSymbol(e){let{uri:t}=e.textDocument,[,r]=await this.fetchWorkspaceFolderAndIndex(t);return this.languageServer.options.getUserSetting("cds.outline.semantical")?this.getSemanticalSymbols(r):this.getFlatSymbols(r)}getFlatSymbols(e){let t=o((r,i)=>co(r.location,i.location),"bySymbolLocation");return e.definitions.filter(r=>r.kind!=="qualifiedAnnotation").map(Ds).sort(t)}getSemanticalSymbols(e){let t=[];e.definitions.filter(s=>s.kind!=="qualifiedAnnotation").forEach(s=>t.push([s.absoluteName,s])),t.sort((s,a)=>s[0].localeCompare(a[0]));let r=new Map,i=[];return t.forEach(([s,a])=>{let c=s;if(r.has(s))return;let l;for(let d of Vb(s))if(l=r.get(d),l){c=s.slice(d.length+1);break}let u={name:l?c:s,range:a.location.range,selectionRange:a.nameLocation.range,kind:Au(a.kind),detail:Pt(a)?[a.isExtend?"(extend)":void 0,a.docComment].filter(d=>!!d).join(`

---
`):void 0,children:[]};r.set(s,u),(l?.children??i).push(u)}),i}},fl=Yx;o(Yx,"DocumentSymbol"),x([oe({paramsRenderer:R.docSymbolParams,resultRenderer:R.docSymbolResult,onErrorReturn:Ee,indexContext:{singleFile:!0,onlyDefinitions:!0,debounce:!0}})],fl.prototype,"onDocumentSymbol",1);var Zx=class extends we{async onExecuteCommand(e){return(this.languageServer.quickFixes.get(e.command)||this.languageServer.commands.get(e.command))?.execute(e)}},ml=Zx;o(Zx,"ExecuteCommand"),x([oe({paramsRenderer:R.execCmd,resultRenderer:R.asIs,onErrorReturn:re})],ml.prototype,"onExecuteCommand",1);var eS=class extends we{onExit(){G().conditionalTrace("requests",2,()=>"This is the end..."),process.exit(0)}},hl=eS;o(eS,"Exit"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re,expectedState:3,newState:2})],hl.prototype,"onExit",1);var tS=class extends we{async onHover(e){let{uri:t}=e.textDocument,r=[],i=this.languageServer.workspaceService.getWorkspaceFolder(t),s=await i.fetchToken(t,e.position,!0),a=o(c=>{if(c)for(let l of i.documentationProvider.fetchTokenDocumentation(c))r.push({domain:l.domain,hover:{contents:l.content,range:c.range}})},"handleToken");if(s){let c=await i.fetchTransitiveIndex(t);for(let l of await this.languageServer.fetchAnnotationHandlers()){let u=await l.fetchHover({cursorPosition:e,annotation:s,index:c});if(u){let p={...u,range:u.range||s.range};r.push({domain:"annotation domain",hover:p,source:l.name})}}a(s)}{let c=await i.fetchToken(t,e.position);a(c)}return Lp(r)}},gl=tS;o(tS,"Hover"),x([oe({paramsRenderer:R.textPos,resultRenderer:R.hov,onErrorReturn:re,indexContext:{singleFile:!0}})],gl.prototype,"onHover",1);var vl=K(require("path")),AN=K(Xe());var nS=class extends we{onInitialize(e){this.languageServer.options.clientCapabilities=e;let t=new wt;wt.log(t.genericStats("Client Capabilities (LSP)",e));let r=this.getWorkspaceFoldersConfig(e);this.createWorkspaceFolders(r),this.languageServer.options.userSettings=this.languageServer.request(ci).getEffectiveSettings({settings:{cds:e.initializationOptions??{}}});let i=o(()=>{let c=this.languageServer.workspaceService.getWorkspaceSettingsPath();return c?vl.join(vl.dirname(c),"logs"):void 0},"getLogFolder"),s=o(()=>{switch(r.length){case 0:return"(no-workspace)";case 1:return this.languageServer.workspaceService.getWorkspaceFolder(r[0].uri).adapter.toLocalPath(r[0].uri);default:return r.map(c=>c.name).join("_+_")}},"getLogFileName");this.languageServer.trace.configure({name:s(),folder:i(),components:this.languageServer.options.getUserSetting("cds.trace.components")});let a=this.serverCapabilities(e);return wt.log(t.genericStats("Server Capabilities (LSP)",a)),wt.logLater(()=>t.capStats()),wt.logLater(()=>t.npmStats()),a}createWorkspaceFolders(e){for(let t of e)try{this.languageServer.workspaceService.addWorkspaceFolder(t)}catch(r){this.languageServer.userInterface.userPopup("Warning",`Specified workspace folder '${t.name}' could not be opened:
${r}`),this.tracer.error(()=>`Failed to add workspace folder '${t.name}' with URI ${t.uri}: ${R.exception(r)}`)}}serverCapabilities(e){let t=this.languageServer.fileSystem,r=Xt(t.readFileSync(vl.join(Ft,"package.json"))),i=o(()=>e.capabilities?.window?.workDoneProgress?{workDoneProgress:!0}:!0,"supportedWithOptionalProgress");return{serverInfo:{name:r.name,version:r.version},capabilities:{codeActionProvider:!0,completionProvider:{resolveProvider:!0,triggerCharacters:[".","@","/"]},definitionProvider:!0,documentFormattingProvider:!0,documentRangeFormattingProvider:!0,documentOnTypeFormattingProvider:{firstTriggerCharacter:"}",moreTriggerCharacter:[";"]},documentHighlightProvider:!0,documentLinkProvider:{resolveProvider:!0},documentSymbolProvider:{label:"CDS"},executeCommandProvider:{commands:[...Object.values(hr),...mT]},hoverProvider:!0,referencesProvider:i(),selectionRangeProvider:{documentSelector:[{language:"cds",pattern:"**/*.cds"}]},textDocumentSync:AN.TextDocumentSyncKind.Full,workspaceSymbolProvider:i(),workspace:{workspaceFolders:{supported:!0,changeNotifications:!0}}}}}getWorkspaceFoldersConfig(e){let t=[],r=e.rootUri,i=e.rootPath,s=o(()=>{let a=r||(i?Jt(i).toString():null);a&&(t=[{name:"(rootUri)",uri:a}])},"handleDeprecatedWorkspaceInit");return e.workspaceFolders!==void 0?(this.tracer.info(()=>`Client supports workspace folders: ${R.asIs(e.workspaceFolders)}`),e.workspaceFolders?.length?t=e.workspaceFolders:(this.tracer.info(()=>`No workspace folders set, trying deprecated rootUri/rootPath: ${r||i}`),s())):(this.tracer.info(()=>`Client supports rootUri/rootPath: ${r||i}`),s()),t}},bl=nS;o(nS,"Initialize"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:()=>Ve(),expectedState:2,newState:1})],bl.prototype,"onInitialize",1);var wN=K(require("util")),Mr=K(Xe());var LN=K(require("vscode-languageserver")),EN=require("vscode-languageserver"),on=K(Xe());var v2=new Map([["namespace",on.SemanticTokenTypes.namespace],["context",on.SemanticTokenTypes.namespace],["service",on.SemanticTokenTypes.namespace],["type",on.SemanticTokenTypes.type],["entity",on.SemanticTokenTypes.class],["view",on.SemanticTokenTypes.class],["aspect",on.SemanticTokenTypes.class],["element",on.SemanticTokenTypes.property],["annotation",on.SemanticTokenTypes.typeParameter]]),rS=class extends we{constructor(t){super(t,"requests");m(this,"legendTypesMap",new Map);m(this,"legendModifiersMap",new Map)}initialize(t){let r=o((p,d)=>new Set([...p].filter(f=>d.has(f))),"intersect"),i=new Set(Object.values(on.SemanticTokenTypes)),s=new Set(t.tokenTypes),a=[...r(i,s).values()],c=new Set(Object.values(on.SemanticTokenModifiers)),l=new Set(t.tokenModifiers),u=[...r(c,l).values()];return this.legendTypesMap=new Map(a.map((p,d)=>[p,d])),this.legendModifiersMap=new Map(u.map((p,d)=>[p,1<<d])),{tokenTypes:a,tokenModifiers:u}}async on(t){let r=new Map,i=o(l=>{let u=`${l.line}:${l.character}`;r.has(u)||r.set(u,l)},"onSemanticToken"),{uri:s}=t.textDocument,c=await this.languageServer.workspaceService.getWorkspaceFolder(s).fetchTransitiveIndex(s);return await this.fetchAnnotationSemanticTokens({uri:s,index:c},i),this.calculateCdlSemanticTokens(c.forUri(s).idTokens,i),this.encodeSemanticTokens([...r.values()])}adaptSemanticTokenType(t){let r=_t(t.definitions);if(!r.length)return;let i=r[0],s=v2.get(i.kind);if(!s)return;let a=this.extractModifiers(i,t);return{line:t.line,character:t.character,length:t.text.length,tokenType:s,tokenModifiers:a}}extractModifiers(t,r){let i=t.kind,s=[];if(aP(t)&&s.push(EN.SemanticTokenModifiers.static),Pt(t)){let{start:a}=t.nameLocation.range;a.line===r.line&&a.character===r.character&&s.push(on.SemanticTokenModifiers.definition),t.nameLocation.uri.endsWith("@sap/cds/common.cds")&&s.push(on.SemanticTokenModifiers.defaultLibrary)}return i==="aspect"&&s.push(on.SemanticTokenModifiers.abstract),s}encodeSemanticTokens(t){let r=new LN.SemanticTokensBuilder;for(let i of t.sort(y2)){let s=this.legendTypesMap.get(i.tokenType);if(s===void 0)continue;let a=i.tokenModifiers.reduce((c,l)=>c+(this.legendModifiersMap.get(l)??0),0);r.push(i.line,i.character,i.length,s,a)}return r.build()}async fetchAnnotationSemanticTokens(t,r){for(let i of await this.languageServer.fetchAnnotationHandlers())(await i.fetchSemanticTokens(t)).forEach(r)}calculateCdlSemanticTokens(t,r){let i=o(a=>this.adaptSemanticTokenType(a),"toSemanticToken"),s=o(a=>!!a,"exists");t.map(i).filter(s).forEach(r)}},Wo=rS;o(rS,"SemanticTokens"),x([oe({methodName:"onSemanticTokens/full",paramsRenderer:R.nothing,resultRenderer:R.nothing,onErrorReturn:()=>null,indexContext:{singleFile:!0}})],Wo.prototype,"on",1);function y2(n,e){return n.line-e.line||n.character-e.character}o(y2,"sortTokenByPosition");var iS=class extends we{constructor(){super(...arguments);m(this,"registrations",new Map)}async onInitialized(){this.registerDidChangeWorkspaceFolders(),this.updateWatchRegistration(),await this.registerDynamicRequests(),this.languageServer.telemetry.addTelemetry({type:"initialization completed"})}async registerDynamicRequests(){await this.registerSemanticTokensLegend(),await this.registerCodeLens()}async registerSemanticTokensLegend(){let t=this.languageServer.options.getClientCapability("capabilities.textDocument.semanticTokens",void 0);if(!t||!await this.fetchUserSettingEnabled("cds.semanticHighlighting.enabled"))return!1;let r=this.languageServer.request(Wo),{tokenTypes:i,tokenModifiers:s}=r.initialize(t),a={documentSelector:[{scheme:"file",language:"cds"}],legend:{tokenTypes:i,tokenModifiers:s},full:!0};return await this.registerOnClient(Mr.SemanticTokensRegistrationType.type,a),!0}registerOnClient(t,r){return this.languageServer.connection?.client.register(t,r)}async registerCodeLens(){if(!this.languageServer.options.getClientCapability("capabilities.textDocument.codeLens",void 0)||!await this.fetchUserSettingEnabled("cds.codeLensStatistics.enabled"))return!1;let r={documentSelector:[{scheme:"file",language:"cds"}]};return await this.registerOnClient(Mr.CodeLensRequest.type,r),!0}async fetchUserSettingEnabled(t){return this.languageServer.options.getClientCapability("capabilities.workspace.configuration",!1)?this.languageServer.connection?.workspace?.getConfiguration(t):!1}registerDidChangeWorkspaceFolders(){let t=this.languageServer.requests.createAndCache(il);this.languageServer.connection?.workspace?.onDidChangeWorkspaceFolders(r=>t.onDidChangeWorkspaceFolders(r))}updateWatchRegistration(){if(!this.languageServer.options.getClientCapability("capabilities.workspace.didChangeWatchedFiles.dynamicRegistration",!1)){this.tracer.warn(()=>"Client DOES NOT support dynamic registration");return}let t=this.languageServer.options.getClientCapability("clientInfo.name",void 0)??this.languageServer.options.getClientCapability("clientName","?");if(t.includes("vscode")||t.includes("Eclipse")){this.tracer.warn(()=>`File system watch is configured client-side for ${t}`);return}let r=o((a,c,l)=>{if(!this.registrations.get(a)){this.tracer.info(()=>`Registering ${a} with ${wN.inspect(l)}`);let u=this.languageServer.connection.client.register(c,l);this.registrations.set(a,u),u.then(()=>this.tracer.info(()=>`${a} REGISTERED`))}},"register");this.tracer.verbose(()=>"Client supports dynamic registration"),this.tracer.info(()=>"Enabling file-system change reporting for CDS relevant files");let i=[],s=Mr.WatchKind.Create+Mr.WatchKind.Change+Mr.WatchKind.Delete;i.push({kind:s,globPattern:gn}),i.push({kind:s,globPattern:"{.git,.cds}ignore"}),i.push({kind:s,globPattern:".cdsrc.json"});for(let a of this.languageServer.workspaceService.workspaceFolders(Uo)){let c=a.getCdsEnv(),l=`**/{${c.i18n.folders.join(",")}}/${c.i18n.file}{*.properties,*.json,*.csv}`;i.push({kind:s,globPattern:l})}r("DidChangeWatchedFilesNotification",Mr.DidChangeWatchedFilesNotification.type,{watchers:i})}},Vn=iS;o(iS,"Initialized"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re,withProgress:"Initializing"})],Vn.prototype,"onInitialized",1),x([F("util")],Vn.prototype,"registerDynamicRequests",1),x([F("util")],Vn.prototype,"registerSemanticTokensLegend",1),x([F("util")],Vn.prototype,"registerOnClient",1),x([F("util")],Vn.prototype,"registerCodeLens",1),x([F("util")],Vn.prototype,"fetchUserSettingEnabled",1),x([Q({fallback:re,traceLevel:2})],Vn.prototype,"registerDidChangeWorkspaceFolders",1),x([F("requests")],Vn.prototype,"updateWatchRegistration",1);var oS=class extends _r{async onMemoryUsage(e){return e.gc&&(global.gc&&(G().conditionalTrace("util",2,()=>"Triggering GC"),global.gc(),global.gc.call(global,!0)),e.sleep&&await nC(e.sleep)),process.memoryUsage()}},ya=oS;o(oS,"MemoryUsage"),m(ya,"REQUEST_NAME","cds/memoryUsage"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re})],ya.prototype,"onMemoryUsage",1);var sS=class extends At{async onReferences(e){for(let u of this.languageServer.workspaceService.workspaceFolders())await u.ensureScanned();let t=e.context?.includeDeclaration??!0,r=[],i=e.textDocument.uri,[s,a]=await this.fetchWorkspaceFolderAndIndex(i),c=this.languageServer.options.getUserSetting("cds.whereused.showStringConstants"),l=o(async(u,p)=>{if(!p)return;let d,f=p.identifierAt(e.position);if(f)d=await this.fetchAllDefinitions(u,f,(g,h)=>{t&&Pt(g)&&r.push(g.nameLocation);for(let T of h.referencesFor(g))r.push(T.location)});else{let g=p.stringAt(e.position);if(g&&c){let h=d=await this.fetchIndexes(u);for(let T of h){let S=T.correspondingStringTokens(g.text),C=o(L=>L.location,"tokenToLocation");r.push(...S.map(C))}}}r.push(...await this.fromAnnotationHandler("fetchReferences",s,e,d))},"collectLocations");if(kN(s))for(let u of this.languageServer.workspaceService.workspaceFolders(Uo)){let p=await u.fetchFileIndex(i,{uri:i});await l(u,p)}else await l(s,a);return go(r,u=>u)}},yl=sS;o(sS,"References"),x([oe({paramsRenderer:R.ref,resultRenderer:R.locations,onErrorReturn:Ee,withProgress:"Collecting references"})],yl.prototype,"onReferences",1);var aS=class extends _r{async onProperties(e){switch(e.name){case"logfilePath":return this.languageServer.trace.logfilename;default:return}}},Ia=aS;o(aS,"CdsLspProperties"),m(Ia,"REQUEST_NAME","cds/lspProperties"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re})],Ia.prototype,"onProperties",1);var cS=class extends _r{async onFormatContent(e){return e.command==="format"?this.format(e):this.getConfig(e)}format(e){let t=this.languageServer.prettyPrinter,r=t.getDefaultOptions();for(let[s,a]of Object.entries(e.formattingOptions))r.setValue(s,a);return t.beautifyWithEffectiveOptions(e.content,r,"CustomFormat").formattedContent}getConfig(e){let t=this.languageServer.prettyPrinter;return md(t.formatOptionsMetaModel,e.sourcePath,e.projectPath,this.tracer).filePath}},Wi=cS;o(cS,"FormatContent"),m(Wi,"REQUEST_NAME","cds/formatContent"),x([oe({paramsRenderer:n=>`${n.command} ${n.command==="format"?R.asIs(n.formattingOptions):""}`,resultRenderer:R.nothing,onErrorReturn:re})],Wi.prototype,"onFormatContent",1),x([F("format",{argumentsRenderer:R.nothing,resultRenderer:R.nothing})],Wi.prototype,"format",1),x([F("format")],Wi.prototype,"getConfig",1);var lS=class extends we{onShutdown(){}},Il=lS;o(lS,"Shutdown"),x([oe({paramsRenderer:R.asIs,resultRenderer:R.asIs,onErrorReturn:re,newState:2})],Il.prototype,"onShutdown",1);var uS=class extends Map{constructor(t){super();this.languageServer=t;m(this,"tracer");m(this,"pendingRegistrations",[]);this.tracer=G().tracer("requests");let r=o((c,l,u)=>{let p=this.createAndCache(c);this.pendingRegistrations.push(d=>{this.tracer.verbose(()=>`registering ${l}`),u(d)[l](p[l].bind(p))})},"prepare"),i=o((c,l)=>r(c,l,u=>u),"onConnection"),s=o((c,l)=>r(c,l,u=>u.languages.semanticTokens),"onSemanticTokens"),a=o((c,l)=>{let u=c.REQUEST_NAME,p=new c(this.languageServer);this.set(c,p),this.pendingRegistrations.push(d=>{this.tracer.verbose(()=>`registering '${u}' => ${c.name}.${l}`),d.onRequest(u,f=>p[l](f))})},"onCustomRequest");i(ha,"onCodeAction"),i(Yc,"onCodeLens"),i(Or,"onCompletion"),i(Zc,"onCompletionResolve"),i(el,"onDefinition"),i(ci,"onDidChangeConfiguration"),i(rl,"onDidChangeTextDocument"),i(va,"onDidChangeWatchedFiles"),i(ol,"onDidCloseTextDocument"),i(sl,"onDidOpenTextDocument"),i(qo,"onDidSaveTextDocument"),i(al,"onDocumentFormatting"),i(cl,"onDocumentHighlight"),i(ll,"onDocumentLinkResolve"),i(ul,"onDocumentLinks"),i(pl,"onDocumentOnTypeFormatting"),i($o,"onDocumentRangeFormatting"),i(fl,"onDocumentSymbol"),i(ml,"onExecuteCommand"),i(hl,"onExit"),i(gl,"onHover"),i(bl,"onInitialize"),i(Vn,"onInitialized"),i(yl,"onReferences"),i(dl,"onSelectionRanges"),i(Il,"onShutdown"),i(Ln,"onWorkspaceSymbol"),s(Wo,"on"),a(Ia,"onProperties"),a(Wi,"onFormatContent"),a(ya,"onMemoryUsage")}get(t){return super.get(t)}createAndCache(t){let r=new t(this.languageServer);return this.set(t,r),r}registerHandlers(t){for(let r of this.pendingRegistrations)r(t)}},xl=uS;o(uS,"Requests"),x([F("requests",{argumentsRenderer:R.nothing}),Q({fallback:re,traceComponent:"requests"})],xl.prototype,"registerHandlers",1);var pS=class extends Pi{constructor(){super(...arguments);m(this,"id","format-range")}async execute(t){let r=t.arguments[0],{uri:i,position:s,offsetFromEnd:a}=r,l=this.languageServer.workspaceService.getWorkspaceFolder(i).getContent(i);if(l===pe){this.languageServer.trace.tracer("format").error(()=>`Cannot format range. File does not exist: ${i}`);return}let u=FN.TextDocument.create(i,"cds",0,l),p=u.positionAt(l.length-a),d={start:s,end:p},f={},g=await this.languageServer.request($o).onDocumentRangeFormatting({textDocument:{uri:i},range:d,options:f});await this.languageServer.applyWorkspaceEdits({label:`Formatting range: ${u.getText(d)}`,edit:{changes:{[i]:g}}})}},ff=pS;o(pS,"FormatRangeCommand");var dS=class extends Map{constructor(t){super();this.languageServer=t;this.add(ff),this.add(Pp),this.add(zu)}add(t){let r=new t(this.languageServer);this.set(r.id,r)}},mf=dS;o(dS,"CommandHandlers");var fS=class{constructor(){m(this,"stats",new uo)}register(e){e.on("internalCompilerError",t=>{let r=this.stats.healthStats();r.type="internal compiler error",r.stack=t,vt().telemetry.addTelemetry(r)}),e.on("compilerChanged",t=>{this.stats.lastUsedCompiler=t,vt().userInterface.statusMessage(`Editor compiling CDS with v${t.version()} (${t.__logicalLocation})`)})}},hf=fS;o(fS,"CompilerEventHandler");var mS=class extends Bn{constructor(){super(...arguments);m(this,"id","custom-annotation-quickfix")}calculateDiagnostics(t,r){return[]}async createCodeActions(t){let r={...t};r.context={...t.context},r.context.diagnostics=t.context.diagnostics.filter(s=>s.source==="CDS (annotations)");let i=[];for(let s of await this.lspServer.fetchAnnotationHandlers())i.push(...await s.fetchQuickfixes(r));return i}async execute(t){throw new Error("AnnotationContributionQuickFix must not have a command and thus cannot be executed")}},xa=mS;o(mS,"AnnotationContributionQuickFix"),x([F("model",{traceLevel:6,argumentsRenderer:bt,resultRenderer:R.diags})],xa.prototype,"calculateDiagnostics",1),x([F("command",{traceLevel:6,argumentsRenderer:Kt("0.textDocument.uri")})],xa.prototype,"createCodeActions",1);var Ta=K(Xe());var I2=o((n="",e=4)=>{let t="",r=n.trim().split(" "),i=Math.min(e,r.length);for(let s=0;i>s;s++){let a=r[s];if(s===0)t+=a.toLowerCase();else{let c=a.charAt(0).toUpperCase(),l=a.slice(1).toLowerCase();t+=`${c}${l}`}}return t},"convertToCamelCase"),hS=class extends Bn{constructor(){super(...arguments);m(this,"id","maintain-translation")}calculateDiagnostics(t,r){if(!this.lspServer.options.getUserSetting("cds.compiler.markMissingI18nDefault"))return[];let i=[],s=r.i18nStringTokens;if(s.length){let{translationBroker:a}=this.lspServer.workspaceService.getWorkspaceFolder(t);for(let c of s){let l=c.translationId;if(a.getTranslation(t,l)===void 0){let p=0,d=c.text.length;l&&(p=c.text.indexOf(l),d=p+l.length);let f={start:{line:c.line,character:c.character+p},end:{line:c.line,character:c.character+d}},g="",h=Rn(r.idTokens,c.tokenIndex-2);switch(h&&h.text){case"title":case"description":g="/"+h.text;break}i.push({message:l?`Text for translation ID '${l}' not defined`:"Missing translation ID. Please add an ID",code:`${"no-translation-text"}${g}`,severity:Ta.DiagnosticSeverity.Warning,range:f,source:"CDS (language server)"})}}}return i}async handleMaintainTranslation(t){let{translationFileUri:r,sourceFileUri:i,replaceTextWithTranslationKey:s,tID:a,text:c,range:l,translationType:u,doCreateTranslationFile:p}=t.arguments[0],d=[],f=this.lspServer.workspaceService.getWorkspaceFolder(r),g=f.translationBroker.getTranslationIndex(r);if(!g.getEntry(a)){if(p){let C={uri:r,kind:"create",options:{ignoreIfExists:!0,overwrite:!1}};d.push(C)}let h=f.getCdsEnv(),T=g.createEntry(h,a,u,`<<<${c}>>>`),S={textDocument:{uri:r,version:0},edits:T};d.push(S)}s&&d.push(Ta.TextDocumentEdit.create({uri:i,version:0},[{newText:`{i18n>${a}}`,range:l}])),await this.lspServer.applyWorkspaceEdits({label:`Maintain translation for '${a}'`,edit:{documentChanges:d}})}async createCodeActions(t){let r=this.lspServer.fileSystem,i=t.context.diagnostics.filter(f=>f.code?.toString().startsWith("no-translation-text"));if(!i.length)return[];let s=t.textDocument.uri,a=this.lspServer.workspaceService.getWorkspaceFolder(s),c=a.getContent(s);if(c===pe)return this.tracer.error(()=>`No MaintainTranslation code action for non existing file: ${s}`),[];let l=c.split(Nt);if(!this.lspServer.options.getClientCapability("capabilities.workspace.workspaceEdit.documentChanges",!1))return[];let u=[],p=this.lspServer.workspaceService.getWorkspaceFolder(s).translationBroker.getMostRelevantTranslationFileUri(s);if(!p)return[];let d=o(f=>{switch(f.code.toString().slice("no-translation-text".length+1)){case"title":return"XTIT";case"description":return"XTOL";default:return"XMSG"}},"getTranslationType");return u.push(...i.map(f=>{let g=d(f),h=f.range.start.line,T=l[h],S=T.slice(T.lastIndexOf("{",f.range.start.character)),C=Ri(S),L=o((j,J,ie)=>({sourceFileUri:s,translationFileUri:p,tID:j,text:J,range:f.range,replaceTextWithTranslationKey:ie,translationType:g,doCreateTranslationFile:!r.existsSync(a.adapter.toLocalPath(p))}),"createArg"),A=[];if(C||f.source==="CDS (language server)")A.push(L(C,fT,!1));else if(f.source==="CDS (annotations)"){let j=T.slice(f.range.start.character,f.range.end.character),J=I2(j);A.push(L(J,j,!0))}let W={arguments:A,command:"maintain-translation",title:`Maintain translation text for ID '${A[0].tID}'`};return{kind:Ta.CodeActionKind.QuickFix,title:W.title,command:W,diagnostics:[f],isPreferred:!0}}).filter(f=>f.command.arguments[0].tID)),u}async execute(t){return this.handleMaintainTranslation(t)}},Sa=hS;o(hS,"MaintainTranslationQuickFix"),x([F("docs",{traceLevel:6,argumentsRenderer:bt,resultRenderer:R.diags})],Sa.prototype,"calculateDiagnostics",1),x([F("command",{traceLevel:6,argumentsRenderer:Kt("0.textDocument.uri")})],Sa.prototype,"createCodeActions",1);var DN=K(require("util")),NN=K(Xe());var gS=class extends Bn{constructor(){super(...arguments);m(this,"id","migrate-deprecated-delimiter")}calculateDiagnostics(t,r){return[]}async createCodeActions(t){let r=t.context.diagnostics.filter(a=>a.code==="syntax-deprecated-ident"),i=o(a=>({command:"migrate-deprecated-delimiter",title:"Convert to new identifier style",arguments:[{uri:t.textDocument.uri,diagnostic:a}]}),"toCommand"),s=o(a=>{let c=i(a);return{title:c.title,kind:NN.CodeActionKind.QuickFix,diagnostics:[a],isPreferred:!0,command:c}},"toCodeAction");return r.map(s)}async execute(t){x2(t);let r=t.arguments[0],{uri:i}=r,s=[],c=this.lspServer.workspaceService.getWorkspaceFolder(i).getContent(i);if(c===pe){this.tracer.error(()=>`Cannot migrate deprecated delimiter. File does not exist: ${i}`);return}let{range:l}=r.diagnostic,p=new On(c).getText(l),d=S2(p);s.push({range:l,newText:d}),await this.lspServer.applyWorkspaceEdits({label:"Convert deprecated identifier syntax to recommended one",edit:{changes:{[i]:s}}})}},ka=gS;o(gS,"MigrateDeprecatedDelimiterQuickFix"),x([F("model",{traceLevel:6,argumentsRenderer:bt,resultRenderer:R.diags})],ka.prototype,"calculateDiagnostics",1),x([F("command",{traceLevel:6,argumentsRenderer:Kt("0.textDocument.uri")})],ka.prototype,"createCodeActions",1);function x2(n){if(n.command!=="migrate-deprecated-delimiter")throw new Error(`Unexpected params: ${DN.inspect(n)}`)}o(x2,"assertsIsMigrateCommand");function S2(n){let e=n.slice(1,n.length-1);return e=e.replace('""','"'),e=e.replace("]","]]"),`![${e}]`}o(S2,"toNewIdentifierStyle");var _N=K(require("util")),gf=K(Xe());var bS=class extends Bn{constructor(){super(...arguments);m(this,"id","migrate-to-doccomment")}calculateDiagnostics(t,r){let i=[];for(let s of r.annotationAssignments)o((c,l)=>{if(s.text.startsWith(c)){let{line:u,character:p}=s;i.push({message:l,code:"prefer-doc-comments",severity:gf.DiagnosticSeverity.Information,range:{start:{line:u,character:p},end:{line:u,character:p+c.length}},source:"CDS (language server)"})}},"handle")("description","In case the description is for design-time only you may prefer using doc comments which support multi-line and markdown");return i}async createCodeActions(t){let r=t.context.diagnostics.filter(a=>a.code==="prefer-doc-comments"),i=o(a=>({command:"migrate-to-doccomment",title:"Convert to doc comment",arguments:[{uri:t.textDocument.uri,diagnostic:a}]}),"toCommand"),s=o(a=>{let c=i(a);return{title:c.title,kind:gf.CodeActionKind.QuickFix,diagnostics:[a],command:c}},"toCodeAction");return r.map(s)}async execute(t){T2(t);let r=t.arguments[0],i=r.uri,s=[],a=this.lspServer.workspaceService.getWorkspaceFolder(i),c=await a.fetchFileIndex(i),l=o((u,p)=>{switch(Xr(u.range,p.range.start)){case"tokenStartsAtCursor":case"tokenContainsCursor":case"tokenEndsWithCursor":return!0}return!1},"annotationCoversDiag");for(let u of c.annotationAssignments)if(l(u,r.diagnostic)){let{line:p,character:d}=u,g=u.text.match(/:\s*'([^']*)'/)?.[1],T=this.lspServer.prettyPrinter.getEffectiveFormattingOptions({},a.adapter.toLocalPath(i),a.workspaceRoot).getValue("maxDocCommentLine"),S=dd(`/** ${g} */`,u.character-1,T);s.push({newText:`${S}`,range:{start:{line:p,character:d-1},end:{line:p,character:d+u.text.length}}});break}await this.lspServer.applyWorkspaceEdits({label:"Convert comment annotation to doc comment",edit:{changes:{[i]:s}}})}},Ca=bS;o(bS,"MigrateToDocCommentQuickFix"),x([F("docs",{traceLevel:6,argumentsRenderer:bt,resultRenderer:R.diags})],Ca.prototype,"calculateDiagnostics",1),x([F("command",{traceLevel:6,argumentsRenderer:Kt("0.textDocument.uri")})],Ca.prototype,"createCodeActions",1);function T2(n){if(n.command!=="migrate-to-doccomment")throw new Error(`Unexpected params: ${_N.inspect(n)}`)}o(T2,"assertsIsDocCommentCommand");var vS=class extends Map{constructor(t){super();this.languageServer=t;this.add(Ui),this.add(Sa),this.add(Ca),this.add(ka),this.add(xa)}add(t){let r=new t(this.languageServer);this.set(r.id,r)}},bf=vS;o(vS,"QuickFixes");var ON="<clean>",Tl=class{constructor(e={sendDiagnostics:async()=>{}}){this.sendDiagnosticsProvider=e;m(this,"tracer",G().tracer("workspace"));m(this,"fs",ne().getFileSystem());m(this,"diagnosticStates",new Map)}updateFile(e,t,r){if(!this.fs.isCdsSourceFile(e))return null;let i=this.getNewHash(e,t);if(!i)return null;try{this.tracer.verbose(()=>`new hash [${e}]: ${i}`);let s={uri:e,diagnostics:t?.diagnostics??[]};return Dt(this.sendDiagnosticsProvider.sendDiagnostics(s)),s}finally{this.diagnosticStates.set(e,t)}}cleanDiagnostics(){let e=Ve();for(let t of this.diagnosticStates.keys()){let r=this.updateFile(t,null);r&&(e[r.uri]=r.diagnostics)}return e}getNewHash(e,t){let r=this.diagnosticStates.get(e);if(r&&t&&r.workspaceVersion>t.workspaceVersion)return this.tracer.warn(()=>`updateFile( ${e} %${t.workspaceVersion} ) outdated. Already processed %${r.workspaceVersion}`),null;let i=Tl.hashFor(t);return i===Tl.hashFor(r)?null:i}static hashFor(e){if(!e)return ON;if(!e.diagnosticsHash){let{diagnostics:t}=e;e.diagnosticsHash=t.length?Su(JSON.stringify(t)):ON}return e.diagnosticsHash}},Sl=Tl;o(Tl,"ClientProblems"),x([F("workspace",{argumentsRenderer:(n,e,t)=>`${n[0]}, ${k2(n[1],e.tracer.isTracing(7))}`,resultRenderer:n=>n?"{...}":""})],Sl.prototype,"updateFile",1);function k2(n,e){return n?`{
	diagsHash: ${n.diagnosticsHash}${n.diagnostics.length?`
	diags: `+R.diagsWithIndent(n.diagnostics,"	"):""}
}`:""}o(k2,"renderCompiledFile");var wn=K(require("path"));var MN=o((n,e)=>`${n}->${e}?`,"cacheKey"),yS=class{constructor(e){this.languageServer=e;m(this,"pathResolver",vt().moduleLoader.resolver);m(this,"tracer");m(this,"cache",new Map);m(this,"extensions",[".cds","",".csn.json",".json",wn.sep+"index.cds",".csn",wn.sep+"index.csn",wn.sep+"index.json"]);this.tracer=G().tracer("util")}resolveUsingPath(e,t,r=this.languageServer.workspaceService.getWorkspaceFolder(e)){let i=wn.dirname(r.adapter.toLocalPath(e)),s=this.noTrailingSlash(t),a=this.fromCache(i,s);if(a||(a=this.fromWorkspace(i,s,r)??this.viaRequireResolve(i,s)??this.viaGlobalSapCds(s),a&&this.cache.set(MN(i,s),a)),a)return r.adapter.toUri(a);this.tracer.warn(()=>`Could not resolve usingPath ${t} in file ${e}`)}fromCache(e,t){let r=MN(e,t),i=this.cache.get(r);return i&&this.tracer.debug(()=>`resolveUsingPath(${t}, ${e}) => ${i} (from cache)`),i}fromWorkspace(e,t,r){let i=[...r.workspaceSnapshot.streamFiles(qn,void 0,c=>r.adapter.toLocalPath(c.uri))],a=/^[./]+\//.test(t)?this.checkFileExtensions(wn.resolve(e,t),i):this.resolveModulePath(t,e,i);return a&&this.tracer.debug(()=>`resolveUsingPath(${t}, ${e}) => ${a} (from workspace)`),a}viaRequireResolve(e,t){for(let r of this.extensions){let i=t+r,s=this.pathResolver.resolveId(i,e);if(s&&this.languageServer.fileSystem.isCdsFile(s))return this.tracer.debug(()=>`resolveUsingPath(${i}, ${e}) => ${s} ${Ne.warn("(via require/path.resolve)")}`),s}}viaGlobalSapCds(e){if(e.startsWith("@sap/cds/common")){let t=this.languageServer.moduleLoader.getGlobalCdsHome();if(t)return wn.join(t,"common.cds")}}resolveModulePath(e,t,r){for(let i of this.paths4(t)){let s=this.checkFileExtensions(wn.resolve(i,"node_modules",e),r);if(s)return s}}*paths4(e){for(let t=wn.dirname(e);t!==e;e=t,t=wn.dirname(t))yield e}checkFileExtensions(e,t){let r=this.noTrailingSlash(e);for(let i of this.extensions){let s=r+i;if(t.includes(s))return s}}noTrailingSlash(e){return e.endsWith(ze)?e.slice(0,-1):e}},vf=yS;o(yS,"UsingPathResolver");var yf=K(Xe());var IS=class{constructor(e){this.languageServer=e;m(this,"tracer",G().tracer("util"))}userOutput(e,t=!1){if(!this.languageServer.connection)return;this.tracer.info(()=>`userOutput: ${e}`);let{options:r}=this.languageServer;if(!r.getClientCapability("capabilities.window.cds.userOutput")){this.tracer.info(()=>`Notification NOT send. Client '${r.getClientCapability("clientInfo.name")??r.getClientCapability("clientName")} ${r.getClientCapability("clientInfo.version")??""}' does not support '${jf}' notification`);return}Dt(this.languageServer.connection.sendNotification(jf,{message:e,reveaOutputWindowlIfHidden:t}))}statusMessage(e,t=5e3){if(!this.languageServer.connection)return;this.tracer.info(()=>`statusMessage: ${e}`);let{options:r}=this.languageServer;if(!r.getClientCapability("capabilities.window.cds.statusMessage")){this.tracer.info(()=>`Notification NOT send. Client '${r.getClientCapability("clientInfo.name")??r.getClientCapability("clientName")} ${r.getClientCapability("clientInfo.version")??""}' does not support '${Vf}' notification`);return}Dt(this.languageServer.connection.sendNotification(Vf,{message:e,millisToShow:t}))}userNotification(e,t=yf.MessageType.Info){this.languageServer.connection&&(this.tracer.info(()=>`userNotification: ${e}`),Dt(this.languageServer.connection.sendNotification(yf.ShowMessageNotification.type,{message:e,type:t})))}async userPopup(e,t,...r){if(!this.languageServer.connection)return"";let i=`show${e}Message`;this.tracer.info(()=>`userPopup/${i}: ${t}`);let s=r.map(c=>(this.languageServer.trace.conditionalTrace("util",6,()=>`map button: ${c}`),{title:c}));return(await this.languageServer.connection.window[i](t,...s))?.title??"?"}},kl=IS;o(IS,"UserInterface"),x([Q({fallback:()=>""})],kl.prototype,"userPopup",1);var xS=class{constructor(){m(this,"connection");m(this,"workspaceService");m(this,"options");m(this,"usingPathResolver");m(this,"compiler");m(this,"trace",G());m(this,"telemetry",{addTelemetry(e){}});m(this,"userInterface",new kl(this));m(this,"platformTester");m(this,"requestTracer");m(this,"clientProblems");m(this,"fileSystem",ne().getFileSystem());m(this,"quickFixes");m(this,"commands");m(this,"requests");m(this,"prettyPrinter");m(this,"moduleLoader");m(this,"annotationHandlerProvider");m(this,"initializedHandlers");mC(this);let e=ne();this.options=e.createOptions(),this.platformTester=e.getPlatformTester(),this.annotationHandlerProvider=e.createAnnotationHandlerProvider(this),this.moduleLoader=e.getModuleLoader(),this.compiler=e.createCompiler(this.options,this.moduleLoader),this.requestTracer=this.trace.tracer("requests"),this.quickFixes=new bf(this),this.commands=new mf(this),this.workspaceService=e.createService(this),this.prettyPrinter=new Nr(this.trace.tracer("format")),this.requests=new xl(this),this.usingPathResolver=new vf(this),this.clientProblems=new Sl(this),new hf().register(this.compiler)}request(e){return this.requests.get(e)}registerRequestHandlers(e){this.connection=e,this.requests.registerHandlers(e),this.telemetry=ne().createTelemetry(e)}async fetchAnnotationHandlers(){if(!this.initializedHandlers){if(this.initializedHandlers=this.annotationHandlerProvider.getAnnotationHandlers(),!this.initializedHandlers)return[];let e=this,t={trace:G().tracer("contribution"),translation:{resolve(r,i){return e.workspaceService.getWorkspaceFolder(r)?.translationBroker.getTranslation(r,i)}},settings:{get(r){switch(r){case"cds.compiler.markMissingI18nDefault":return e.options.getUserSetting("cds.compiler.markMissingI18nDefault");case"cds.completion.annotations.omitRedundantTypesInSnippets":return e.options.getUserSetting("cds.completion.annotations.omitRedundantTypesInSnippets")}}}};for(let r of this.initializedHandlers)await r.initialize(t)}return this.initializedHandlers.filter(e=>e.name!=="@sap/ux-cds-odata-language-server-extension"||this.options.getUserSetting("cds.contributions.enablement.odata"))}async sendDiagnostics(e){if(this.connection)return this.requestTracer.info(()=>`${Wr}sendDiagnostics ${e.uri}`),this.requestTracer.verbose(()=>`${e.uri} ${R.diags(e.diagnostics)}`),this.connection.sendDiagnostics(e)}async applyWorkspaceEdits(e){if(this.connection)return this.requestTracer.info(()=>`${Wr}applyEdit`),this.requestTracer.verbose(()=>`${e.label} ${R.asIs(e.edit)}`),this.connection.workspace.applyEdit(e)}},If=xS;o(xS,"CdsLanguageServer");var qN=K(wx()),$N=K(require("util"));var UN=K(require("path"));function C2(n,e=[]){return e.map(t=>new Ls(t,As(t,n)))}o(C2,"convertTokens");var TS=class{constructor(e){this.selectedRelativeFilePathForTree=e;m(this,"stateByPath",new Map);m(this,"currentRelativeFilePath");m(this,"rootNodeForSelectedFile")}cleanup(){this.rootNodeForSelectedFile=void 0,this.stateByPath.clear(),this.currentRelativeFilePath=void 0}},SS=TS;o(TS,"$MultiParserState");var kS=class extends Gs{constructor(t,r=new SS(t)){super();this.multiParserState=r;m(this,"ruleTreeBuildingParseListener")}enterEveryRule(t){this.isRootNode(t)&&this.enterRootNode(t),this.ruleTreeBuildingParseListener?.enterEveryRule(t)}enterRootNode(t){let r=this.multiParserState;r.currentRelativeFilePath=t.parser.filename,this.ruleTreeBuildingParseListener=r.currentRelativeFilePath===r.selectedRelativeFilePathForTree?new Hs(r.currentRelativeFilePath):void 0;let i=new Rc(r.currentRelativeFilePath);this.currentFileState=i,r.stateByPath.set(r.currentRelativeFilePath,i),i.copyRawTokens(t)}exitEveryRule(t){this.ruleTreeBuildingParseListener?.exitEveryRule(t),this.isRootNode(t)&&this.exitRootNode(t.parser)}exitRootNode(t){this.currentFileState.tokens=C2(t,WC(this.currentFileState.rawTokens)),this.ruleTreeBuildingParseListener&&(this.multiParserState.rootNodeForSelectedFile=this.ruleTreeBuildingParseListener.finalize()),this.currentFileState.cleanup(),this.currentFileState=void 0,this.multiParserState.currentRelativeFilePath=void 0}visitTerminal(t){this.ruleTreeBuildingParseListener?.visitTerminal(t)}visitErrorNode(t){this.ruleTreeBuildingParseListener?.visitErrorNode(t)}finalize(t){this.attachTokensAndTree(t);let r=this.multiParserState.rootNodeForSelectedFile;return this.cleanup(),r}cleanup(){this.multiParserState.cleanup(),this.currentFileState=void 0,this.multiParserState=void 0}attachTokensAndTree(t){if(!t)return;let r=this.multiParserState,i=o(s=>UN.join(t.workspaceRoot,s),"fullPath");for(let[s,a]of r.stateByPath.entries()){let c=t.toolbox.sourcesOf(t)?.[i(s)];c&&(c.tokens=a.tokens,s===this.multiParserState.selectedRelativeFilePathForTree&&(c.ruleTree=this.multiParserState.rootNodeForSelectedFile))}}},xf=kS;o(kS,"$MultiFileParserListener");function P2(n){return n?`AST(${Object.keys(n.toolbox.sourcesOf(n)).length} model files)`:"null"}o(P2,"renderAstQuickly");var CS=class extends qN.TypedEmitter{constructor(t,r){super();this.options=t;this.moduleLoader=r;m(this,"tracer",G().tracer("model"));m(this,"cacheMisses",new Map);m(this,"_isWindows",ne().getPlatformTester().isWindows());m(this,"lastCompiler");this.tracer=G().tracer("compiler")}async compile(t,r,i=Ve(),s=Ve(),a){s={...s};let c=he(),l=Mu(c.requestScope);l.compilations++,this.tracer.debug(()=>`Compiling with files map: ${Object.keys(i).reduce((T,S)=>T.concat(`
`+S),"")}`);let u=new Set,p=this.createStatisticsProxy(i,u,a),d=new xi,f;this.ensureCdsIsLoaded(r);let g=new xf(t.slice(r.length+1)),h;try{s.fallbackParser="cds",s.parseListener=g,s.docComment=!0,s.attachValidNames=!0,s.messages=[],this.tracer.verbose(()=>`Effective compile options: ${$N.inspect(s,{depth:0})}`),f=this.loadCdsCompiler(r),h=await G().noTraceDuring(()=>f.compile([t],r,s,p))}catch(T){let S=T;h=S.model,this.traceCompileException(S)}finally{h&&this.enrichAst(h,f,r),g.finalize(h),l.compilationElapsedNanos+=d.elapsedNanos;for(let T of u){let S=i[T];S&&(l.compiledFiles++,l.compiledSourceLength+=S.length)}}return h}enrichAst(t,r,i){t.workspaceRoot=i,t.compilerVersion=r.version(),t.compiler=r,t.toolbox=r.createToolbox()}traceCompileException(t){if(!t.model)this.tracer.error(()=>`failed to compile model: ${R.asIs(t.messages||t.errors||R.exception(t))}`),this.options.getUserSetting("cds.compiler.showInternalErrors")&&this.emit("internalCompilerError",R.exception(t));else{let r=t.errors||t.messages;r?.length&&this.tracer.verbose(()=>`${r.length} messages: 
	${r.map(i=>i.message).join(`
	`)}`)}}invalidateCacheMisses(){this.cacheMisses.clear()}ensureCdsIsLoaded(t){try{let r=this.moduleLoader.loadCds(t);this.tracer.info(()=>`loaded CDS from ${r.__loadedFrom}`),this.tracer.info(()=>`CDS home: ${global.cds.home}`)}catch{this.tracer.error(()=>`No @sap/cds installed. Neither globally nor for '${t}'`)}}createStatisticsProxy(t,r,i){let{tracer:s}=this,a=o(p=>p===!1||p instanceof Error||p instanceof Buffer||typeof p=="string","isCacheMiss"),c=o((p,d)=>{typeof d=="string"&&i?.onNewCacheEntry(p,d)||a(d)&&this.cacheMisses.set(p,d)},"cache"),l=o(p=>this.cacheMisses.get(p),"previouslyMissed"),u=o(p=>t[p]??(this._isWindows?t[Lu(p.charAt(0))+p.slice(1)]:void 0)??l(p),"contentFor");return new Proxy(t,{get(p,d){let f=u(d);return typeof f=="string"&&!d.endsWith("package.json")?(r.add(d),s.debug(()=>`+ ${d}: ${R.content(f)}`)):f?s.debug(()=>`> ${d}`):s.debug(()=>`- ${d}`),f},set(p,d,f,g){return s.debug(()=>`SET /  ${String(d)} = ${typeof f}`),c(d.toString(),f),Reflect.set(p,d,f,g)}})}parse(t,r,i){let s=ar.instance;return new Np(s).parse(t,r,this.defaultOptions,i)}get defaultOptions(){return{fallbackParser:"cds",parseOnly:!0,lintMode:!0,attachTokens:!0,messages:[]}}loadCdsCompiler(t){let r=this.moduleLoader.loadCompiler(t);return r!==this.lastCompiler&&(this.tracer.info(()=>`Compiler changed to ${r.version()??"unversioned"} located at ${r.__loadedFrom??"nowhere"}`),this.lastCompiler=r,this.emit("compilerChanged",r)),r}},Bi=CS;o(CS,"Compiler"),x([F("compiler",{traceLevel:6,argumentsRenderer:n=>`${n[0]}`,resultRenderer:P2,trackMemory:!0})],Bi.prototype,"compile",1),x([F("files")],Bi.prototype,"invalidateCacheMisses",1),x([F("compiler",{argumentsRenderer:n=>`${n[1]} - ${n[0]?n[0].length:0} bytes`,resultRenderer:R.nothing})],Bi.prototype,"parse",1),x([F("compiler",{traceLevel:6,resultRenderer:n=>n?`${n.version()} ${n.__logicalLocation} - ${n.__loadedFrom}`:"undefined"})],Bi.prototype,"loadCdsCompiler",1);var jN=K(require("util"));var Cl="~lsp_isImplicit";function sn(n){return n?Array.isArray(n)?n:[n]:[]}o(sn,"flatten");var PS=class{constructor(e,t,r,i){this.model=e;this.indexer=t;this.tags=r;this.compiler=i;m(this,"exceptions",[]);m(this,"tracer");m(this,"tracerModelTodos");m(this,"toolbox",this.model.toolbox);this.tracer=G().tracer("model"),this.tracerModelTodos=G().tracer("model-todos")}tryCatch(e){try{e()}catch(t){this.exceptions.push(t)}}},Gn=PS;o(PS,"XsnCrawler");function pr(n,e=!1){return n?e?Object.getOwnPropertyNames(n).map(t=>[t,n[t]]):Object.entries(n):[]}o(pr,"entries");var RS=class{constructor(){m(this,"_visited",new Map)}isAlreadyVisited(e){return!e||this._visited.has(e)}markVisited(e){this._visited.set(e,!0)}},Sf=RS;o(RS,"Tags");var AS=K(require("util"));var LS=class extends Gn{constructor(){super(...arguments);m(this,"_definitionsToProcess",new Map)}crawl(){let t=this.extractNamespacesAndGetFilteredDefinitions();return this.collectExtensionDefinitions(),this.collectDefinitionArtifacts("",t,!0),this.collectDefinitionArtifacts("",this.model.vocabularies,!0),this.tryCatch(()=>{for(let{def:r,fqn:i}of this.collectedDefinitions())this.indexer.onDefinitionFound({thing:r,fullyQualifiedName:i,toolbox:this.toolbox,consumed:!1,compiler:this.compiler})}),this.exceptions}extractNamespacesAndGetFilteredDefinitions(){let t=this.extractNamespacesViaExplicitNamespaceStatements(),r=new Set;t.forEach(s=>{let a=this.compiler.getArtifactName(s).absolute;r.add(a),this.handleDefinitionThing(a,s)});let i=Ve();for(let[s,a]of pr(this.model.definitions,!0))if(a.kind==="namespace"){let c=this.compiler.getArtifactName(a);!r.has(c.absolute)&&(a[Cl]=!0,this.handleDefinitionThing(s,a))}else i[s]=a;return i}extractNamespacesViaExplicitNamespaceStatements(){let t=[];for(let r of Object.values(this.toolbox.sourcesOf(this.model)))t.push(...this.extractNamespacesViaExplicitNamespaceStatement(r));return t}extractNamespacesViaExplicitNamespaceStatement(t){let{namespace:r}=t,i=[];if(!r)return i;let{toolbox:s}=this,a=t.tokens,c={start:this.findStartLocationOfNamespace(r,a),end:this.findEndLocationOfNamespace(r,a)};return r.path.forEach((l,u,p)=>{let d=p.slice(0,u+1).map(g=>g.id).join("."),f=s.locationOf(l);i.push({kind:"namespace",name:{absolute:d,location:f},location:{file:f.file,line:c.start.line+1,col:c.start.character+1,endLine:c.end.line+1,endCol:c.end.character+1},[Cl]:u!==p.length-1})}),i}*collectedDefinitions(){let{toolbox:t}=this,r=this._definitionsToProcess;function i(a,c){let l=sn(t.resolve(a));for(let u of l)if(u!==a&&r.has(u))return!1;return!0}o(i,"canHandle");let s;for(;r.size>0;){s=r.size;for(let[a,c]of r)i(a,c)&&(r.delete(a),yield{def:a,fqn:c});r.size===s&&(yield*this.traceAndStreamPendingDefs(r))}}*traceAndStreamPendingDefs(t){this.tracer.error(()=>"Pending unprocessed definitions - potential circular. Reference resolution may fail");for(let[r,i]of t)t.delete(r),yield{def:r,fqn:i}}collectExtensionDefinitions(){let{compiler:t}=this;function r(a,c,l=[]){for(let u of l){let p=t.getArtifactName(u);if(p?.path&&u?.kind==="extend"){let d=p.path.map(g=>g.id).join("."),f=Bo(c,d);a.handleDefinitionThing(f,u,!0),a.extractDefinitionElements(f,u.elements)}}}o(r,"crawlExtensions");function i(a,c,l=Object.create(null)){for(let[u,p]of pr(l))s(a,p,c,u)}o(i,"crawlArtifacts");function s(a,c,l,u){let p=o(f=>f.namespace?a.toolbox.fullyQualifiedNameOf(f.namespace):"","namespaceFqn"),d=c.kind==="source"?p(c):Bo(l,u);for(let f of sn(c))r(a,d,f.extensions),i(a,d,f.artifacts),i(a,d,f.vocabularies)}o(s,"crawlArtifact"),i(this,"",this.toolbox.sourcesOf(this.model))}collectDefinitionArtifacts(t,r=Object.create(null),i=!1){this.tryCatch(()=>{for(let[s,a]of pr(r,i)){let c=Bo(t,s);this.extractDefinitionArtifact(c,a)}})}extractDefinitionArtifact(t,r){for(let i of sn(r)){if(this.tags.isAlreadyVisited(i)||this.toolbox.isLocalizedInferred(i)||i.builtin===!0&&this.compiler.getArtifactName(i)?.absolute==="localized")continue;this.handleDefinitionThing(t,i),(Array.isArray(i.$duplicates)?i.$duplicates:[]).forEach(a=>this.extractDefinitionArtifact(t,a)),this.extractDefinitionElements(t,i.elements),this.extractDefinitionElements(t,i.enum),this.extractDefinitionElements(t,i.actions),this.collectDefinitionArtifacts(t,i.artifacts),this.collectDefinitionArtifacts(t,i.vocabularies),this.extractDefinitionQueries(t,this.toolbox.queriesOf(i)),this.extractDefinitionMap(t,i.params),i.returns&&this.handleDefinitionThing(t+":returns",i.returns)}}onDefinitionFound(t,r,i=!1){this.tryCatch(()=>{this.tags.isAlreadyVisited(t)||(this.tags.markVisited(t),this._definitionsToProcess.set(t,r))})}extractDefinitionQueries(t,r=[]){this.tryCatch(()=>{let i=sn(r);for(let s=0;s<i.length;s++){let a=i[s],c=Bo(t,`<query${s}>`);if(a.mixin){let l=Bo(c,"<mixin>");this.extractDefinitionElements(l,a.mixin)}this.extractDefinitionQueries(c,this.toolbox.queriesOf(a))}})}extractDefinitionMap(t,r){for(let[i,s]of pr(r)){let a=Bo(t,i);this.handleDefinitionThing(a,s)}}extractDefinitionElements(t,r=Object.create(null)){for(let[i,s]of pr(r))this.extractDefinitionElement(t,i,s)}extractDefinitionElement(t,r,i){if(!r){this.tracerModelTodos.isTracing(6)&&this.tracerModelTodos.warn(()=>`extractDefinitionElements: element without id: ${AS.inspect(i,!0,3)}`);return}let s=sn(i),a=Bo(t,r);for(let c of s)this.handleElement(c,a,t,r)}handleElement(t,r,i,s){if(!this.tags.isAlreadyVisited(t)){switch(this.handleDefinitionThing(r,t),t.kind){case"element":case"enum":{if(this.toolbox.isLocalizedInferred(t))return;["*","include","proxy","expand-element","query"].includes(t.$inferred)||(t.$inferred&&this.tracerModelTodos.isTracing(6)&&this.tracerModelTodos.warn(()=>`Unknown $inferred value ${R.asIs(t.$inferred)}`),this.onDefinitionFound(t,r))}break;case"action":case"function":["*","include","proxy","localized","localized-texts"].includes(t.$inferred)||this.extractDefinitionElements(r,t.params);break}this.extractDefinitionElements(r,t.elements),this.extractDefinitionElements(r,t.enum)}}handleDefinitionThing(t,r,i=!1){if(this.toolbox.isLocalizedInferred(r))return;sn(r).forEach(a=>{if(a._artifact||a.extern||this.toolbox.originOf(a)&&a.kind!=="entity"){this.tracerModelTodos.isTracing(7)?this.tracerModelTodos.warn(()=>`Definition with resolvable properties: ${R.asIs(a)}`):this.tracerModelTodos.isTracing(6)&&this.tracerModelTodos.warn(()=>`Definition with resolvable properties: ${AS.inspect(a,{depth:2})}`);return}this.tryCatch(()=>{this.onDefinitionFound(a,t,i)})})}findStartLocationOfNamespace(t,r){let i=oc(this.toolbox.locationOf(t.path[0])).start;if(!r)return i;let s=r.find(a=>a.relativeToCursor(i)==="tokenStartsAtCursor");if(s)for(let a=s.tokenIndex-1;a>=0;a--){let c=r[a];if(c.text==="namespace")return c.start}return i}findEndLocationOfNamespace(t,r){let i=oc(this.toolbox.locationOf(t.path[t.path.length-1])).end;if(!r)return i;let s=r.find(a=>a.relativeToCursor(i)==="tokenEndsWithCursor");if(s)for(let a=s.tokenIndex+1;a<r.length;a++){let c=r[a];if(c.text===";")return c.end}return i}},Tf=LS;o(LS,"XsnDefinitionCrawler");function Bo(n,e){return n?`${n}.${e}`:e}o(Bo,"getFqn");var ES=class extends Gn{crawl(){return this.extractDependentFiles(),this.exceptions}extractDependentFiles(){this.tryCatch(()=>{Object.entries(this.toolbox.sourcesOf(this.model)).forEach(([e,t])=>{let r=(t.dependencies??[]).filter(i=>i.realname).map(i=>i.realname);this.indexer.onDirectDependenciesFound(e,r)})})}},kf=ES;o(ES,"XsnDependencyCrawler");var wS=class extends Gn{crawl(){return this.extractMessages(),this.exceptions}extractMessages(){this.tryCatch(()=>{let e=new Map,{toolbox:t}=this;function r(i){i.forEach(s=>{let c=t.locationOf(s).file;if(c){let l=e.get(c);l||(l=new Set,e.set(c,l)),l.add(s)}})}o(r,"addMessages"),r(this.model.options.messages);for(let[i,s]of e.entries())this.indexer.onMessagesFound(this.model,i,[...s])})}},Cf=wS;o(wS,"XsnMessageCrawler");var FS=class{constructor(e,t,r){this.model=e;this.toolbox=t;this.handleThing=r}extractAnnotationAssignmentsV3(e){for(let t of e.$annotations??[])this.handleThing({location:this.toolbox.locationOf(t),carrier:e},"annotationAssignment"),this.extractAnnotationAssignmentV3(e,t.value)}extractAnnotationValue(e){switch(e.literal){case"array":case"struct":return;case"enum":return e.sym;case"string":default:return e.val}}extractAnnotationAssignmentV3(e,t,r=""){let i=o((s,a,c)=>{let l=s?.path??[];for(let u=0;u<l.length;u++){let p=l[u],d=(a?a+".":"")+l.slice(0,u+1).map(g=>g.id).join("."),f=u===l.length-1;this.handleThing({location:this.toolbox.locationOf(s),name:{location:this.toolbox.locationOf(p)},absolute:d,value:f?c:void 0,carrier:e},"annotation")}return(r?r+".":"")+BN(s)},"handlePath");if(R2(t)){let s=i(t.name,r);for(let a of t.$flatten)this.extractAnnotationAssignmentV3(e,a,s)}else{let a=o(l=>{let u=l?.absolute;if(!u)return r;let p=BN(l);return u.endsWith(p)?u.slice(0,-(p.length+1)):u},"getPrefix")(t.name),c=this.extractAnnotationValue(t);switch(i(t.name,a,c),t.literal){case"array":for(let l of t.val)this.extractAnnotationAssignmentV3(e,l,a||t.name.absolute);break;case"struct":for(let[,l]of Object.entries(t.struct))this.extractAnnotationAssignmentV3(e,l,a);break;case"enum":break;case void 0:break;case"string":default:}}}},Pf=FS;o(FS,"XsnAnnotationCrawlerV3");function R2(n){return n.$flatten}o(R2,"isNonLeafAnnotartionValue");function WN(n){return(n??[]).map(t=>t.id).join(".")}o(WN,"expandPath");function BN(n){let e=n?.variant?"#"+WN(n.variant.path):"";return WN(n?.path)+e}o(BN,"getFullPath");var DS=class extends Gn{constructor(){super(...arguments);m(this,"annotationsV3",new Pf(this.model,this.toolbox,this.handleThing.bind(this)))}crawl(){return this.extractModelReferences(),this.indexer.onReferencesDone({compiler:this.compiler,consumed:!1,toolbox:this.toolbox}),this.exceptions}extractModelReferences(){for(let[,t]of pr(this.toolbox.sourcesOf(this.model)))this.extractSource(t)}extractSource(t){this.extractUsings(t.usings),this.extractExtensions(t.extensions),this.extractArtifacts(t.artifacts),this.extractArtifacts(t.vocabularies)}extractUsings(t=[]){for(let r of t)this.handleThing(r),this.extractAnnotationAssignments(r),r.extern&&this.extractPath(r.extern.path),this.extractUsings(r.usings)}extractExtensions(t=[]){for(let r of t){this.handleThing(r),this.extractAnnotationAssignments(r),this.extractArtifact(r),this.extractArtifacts(r.artifacts),this.extractElements(r.elements);let i=this.compiler.getArtifactName(r);i&&this.extractPath(i.path)}}extractArtifacts(t=Object.create(null)){for(let[,r]of pr(t))for(let i of sn(r))this.extractArtifact(i)}extractArtifact(t){this.handleThing(t);let r=this.compiler.getArtifactName(t);r?.path&&this.extractPath(r.path),this.extractExtensions(t.extensions),this.extractAnnotationAssignments(t),this.extractElements(t.elements,t.kind),this.extractArtifacts(t.artifacts),this.extractIncludes(t.includes),this.extractQueries(this.toolbox.queriesOf(t)),this.extractElements(t.params),this.extractElements(t.actions,t.kind),this.extractType(t.returns),this.extractType(t)}extractIncludes(t=[]){t??(t=[]);for(let r of t)this.extractPath(r.path)}extractPath(t){t??(t=[]);for(let r=0;r<t.length;r++)this.tryCatch(()=>{let i=t[r];if(i._artifact)this.handleThing(i);else for(let s=r-1;s>=0&&!this.extractPathSegment(t,i,r,s);s--);})}extractPathSegment(t,r,i,s){t??(t=[]);let a=t[s];if(a._artifact){let c=this.toolbox.resolve(a._artifact);for(let l of c){let u=l;for(let p=s+1;p<=i;p++){let d=A2(t[p]);if(u.elements&&u.elements[d]){u=u.elements[d];continue}if(u.artifacts&&u.artifacts[d]){u=u.artifacts[d];continue}u=null;break}u&&(r._artifact=u,r._artifact&&this.handleThing(r))}return!0}return!1}extractThisTypeValue(t){this.handleThing(t),this.extractType(t.type),this.extractConditionArgs(t.value)}extractQueries(t){t??(t=[]);for(let r of t){this.handleThing(r),this.extractElements(r.mixin),this.extractElements(r.elements),this.extractConditionArgs(r.from),this.extractConditionArgs(r.$from),this.extractConditionArgs(r._from),this.extractConditionArgs(r.on),this.extractConditionArgs(r.where),this.extractArray(r.groupBy),this.extractConditionArgs(r.having),this.extractConditionArgs(r.args),sn(r.columns).forEach(s=>this.extractThisTypeValue(s)),this.extractArray(sn(r.orderBy).map(this.toolbox.orderBys));let i=this.toolbox.excludesOf(r);if(i){for(let[s,a]of pr(i))if(!a._artifact&&r.from){for(let c of sn(r.from))if(c._artifact&&c._artifact.elements&&c._artifact.elements[s]){a._artifact=c._artifact.elements[s];break}}this.extractElements(i)}this.extractQueries(this.toolbox.queriesOf(r))}}extractConditionArgs(t){t??(t=[]);for(let r of sn(t))for(let i of sn(r))this.handleThing(i),this.extractPath(i.path),this.extractConditionArgs(i.args),this.extractConditionArgs(i.on)}extractArray(t){t??(t=[]);for(let r of t)r&&(this.handleThing(r),this.extractPath(r.path))}handleThing(t,r){this.tryCatch(()=>{t&&(this.tags.isAlreadyVisited(t)||(this.tags.markVisited(t),this.indexer.onReferenceFound({thing:t,toolbox:this.toolbox,hint:r,consumed:!1,compiler:this.compiler,model:this.model})))})}extractElements(t=Object.create(null),r){for(let[,i]of pr(t))this.extractElement(i,r)}extractElement(t,r){if(t){if(this.toolbox.isLocalizedInferred(t))return;t.$inferred!=="*"&&t.$inferred!=="include"&&t.$inferred!=="proxy"&&this.handleThing(t,r),this.extractAnnotationAssignments(t),this.extractType(t.returns),this.extractElements(t.elements,r),this.extractType(t),this.extractConditionArgs(t.onCond?.args??t.onCond),this.extractConditionArgs(t.on?.args??t.on),this.extractElement(t.targetAspect),this.extractElements(t.params),t.value&&t.$inferred!=="*"&&(this.handleThing(t.value),t.value.args&&this.extractArray(t.value.args))}}extractType(t){this.tryCatch(()=>{if(!t)return;t.items&&this.extractType(t.items);let r=o(i=>{i&&(i.path?this.extractPath(i.path):this.handleThing(i))},"withType");r(t.type),r(t.targetAspect),t.target&&this.toolbox.locationOf(t.target)&&t.target.$inferred!=="rewrite"&&r(t.target)})}extractAnnotationAssignments(t){t.$inferred!=="*"&&this.annotationsV3.extractAnnotationAssignmentsV3(t)}},Pl=DS;o(DS,"XsnReferenceCrawler"),x([F("model",{traceLevel:7,argumentsRenderer:n=>`${n[0]?.location?.file}`})],Pl.prototype,"extractSource",1);function A2(n){return n.id}o(A2,"getSegmentName");var NS=class extends Gn{crawl(){for(let[e,t]of Object.entries(this.toolbox.sourcesOf(this.model)))this.tryCatch(()=>this.indexer.onTokensFound(e,e.endsWith(".cds")?t.tokens:[],this.model.compilerVersion));return this.exceptions}},Rf=NS;o(NS,"XsnTokenCrawler");var _S=class{static extract(e,t){let r=[Rf,Cf,Tf,Pl,kf],i=new Sf;return r.map(s=>new s(e,t,i,e.compiler).crawl()).reduce((s,a)=>s.concat(a))}},Af=_S;o(_S,"XsnExtractor");var OS=class{constructor(e){this.compiler=e;m(this,"thingToResolved",new Map);m(this,"nameLocationViaSubArtifacts",o(e=>{let t=1,r=e;for(;r._subArtifacts;){let a=Object.values(r._subArtifacts)[0];if(!a||(r=a,t++,this.compiler.getArtifactName(r)?.path?.length>=t))break}if(!r)return;let i=this.compiler.getArtifactName(r).path??[],s=i[i.length-t];return this.locationOf(s)},"nameLocationViaSubArtifacts"))}extract(e,t){return Af.extract(e,t)}isImplicitNamespace(e){return!!e[Cl]}isLocalizedInferred(e){let t=e?.$inferred??"";return t.startsWith("localized")||t==="LOCALIZED-VERTICAL"?!0:e?.localized?.$inferred==="localized"}isAutoexposed(e){return e?.$inferred==="autoexposed"}locationOf(e){return e?.location||e?.$location}absoluteNameOf(e){let t=this.compiler.getArtifactName(e);if(t){if(this.isReturnsCarrier(e))return t.absolute+":returns";if(typeof t.absolute=="string"){let r=[t.absolute],i=t.element??t.action;return i&&r.push(i),t.param&&r.push(t.param),r.join(".")}}}originOf(e){return e&&(e._origin||e.origin)}getKind(e){return e.kind}expectedKindOf(e){let t=e;for(;t&&this.getKind(t)==="extend";)t=this.compiler.getArtifactName(t)?._artifact;let r=t?this.getKind(t):void 0;if(r==="entity"&&t.projection)r="view";else if(r==="type"&&e.$syntax==="aspect")r="aspect";else if(e.expectedKind?.val)return e.expectedKind.val;return r||e.expectedKind}fullyQualifiedNameOf(e){let t=e,r="";if(!t)return r;t.extern&&(t=t.extern),t=this.originOf(t)||t;let i;return t._artifact?i=t._artifact.name:t.name&&(i=t.name),i&&!i.absolute&&i._artifact&&(i=i._artifact.name),i&&(r=i.absolute||"",i.element&&(r+="."+i.element),r||(t=i,i=void 0)),!i&&t.path?t.path.map(s=>s.id).join("."):r}resolve(e,t={step:"ToDefinition"}){return e._effectiveType===0?[e]:this.resolveLoop(e,t)}resolveLoop(e,t={step:"ToDefinition"}){if(e._effectiveType===0)return[e];let r=this.thingToResolved.get(e);if(r)return r;let i=this._resolveNext(e),s=[];for(let a of i)a!==e?s.push(...this.resolveLoop(a)):a.kind==="element"&&a.name?.id==="up_"&&a.target?._artifact?s.push(...this.resolveLoop(a.target?._artifact)):s.push(a);return this.thingToResolved.set(e,s),s}_resolveNext(e){let t=[];this.handleDuplicates(e);let r=this.searchArtifact(e);r.length||t.push(this.resolveViaName(e));for(let i of r)i&&t.push(i);return t}handleDuplicates(e){if(Array.isArray(e.$duplicates))for(let t of e.$duplicates)this.thingToResolved.set(t,[e])}searchArtifact(e){let t=e._artifact??this.resolveViaOrigin(e)??this.resolveViaExtern(e);return sn(t)}isReturnsCarrier(e){return!1}resolveViaOrigin(e){if(this.originOf(e))return this.originOf(e)}resolveViaExtern(e){if(e.extern&&e.kind==="using")return e.extern}resolveViaName(e){let t=this.compiler.getArtifactName(e);if(t){if(t._artifact)return t._artifact;if(t.path&&t.path.length){let r=t.path[t.path.length-1];if(r._artifact)return r._artifact}}return e}name(e){return this.compiler.getArtifactName(e)}nameLocation(e){let t=this.name(e);if(!t)return this.locationOf(e);if(t.path){let r=je(t.path),i=this.locationOf(r);if(i)return i}return this.nameLocationOf(e)}nameLocationOf(e){if(e)return this.nameLocationViaSubArtifacts(e)??this.locationOf(this.compiler.getArtifactName(e))}filterMessagesInScope(e,t,r){return t&&this.isInRange(this.locationOf(t),{line:e.line,character:e.character+r})}queriesOf(e){return e&&(e.$queries||e.queries)}excludesOf(e){return e.excludingDict}orderBys(e){return e?.value??e}sourcesOf(e){return e.sources??e.$sources??{}}isInRange(e,t){let r=yr.adapt(e),i=r.start,s=r.end;if(i.line===t.line){let a=s.line>i.line?1/0:s.character;return i.character<=t.character&&t.character<=a}return!1}},jo=OS;o(OS,"XsnToolbox"),x([Q({fallback:(n,e)=>[e[0]],errorTrace:(n,e)=>`Unexpected exception during resolution '${n.message}' for: ${jN.inspect(e[0],{depth:10})}`})],jo.prototype,"resolve",1),x([Q({fallback:()=>!1,traceLevel:6,errorTrace:R.exception})],jo.prototype,"isInRange",1);var MS=class extends jo{resolveViaOrigin(e){if(e.kind==="element")return this.originOf(e)}},Rl=MS;o(MS,"XsnToolbox363");var US=class extends Rl{isReturnsCarrier(e){return e._parent?.returns===e}},Lf=US;o(US,"XsnToolbox400");var vn=K(require("path")),VN=K(require("util"));var Al="contributions ready",qS=class{constructor(){m(this,"tracer",G().tracer("contribution"));m(this,"fs",this.getLanguageServer().fileSystem);m(this,"_active");m(this,"installTriggered",!1)}getLanguageServer(){return vt()}getRegistry(){return this.getLanguageServer().options.getUserSetting("cds.contributions.registry")}getAnnotationHandlerNpmPackageNames(){return Object.keys(this.getPackageJson()?.dependencies)}getPackageJson(){return Xt(this.fs.readFileSync(vn.join(this.getTemplateRoot(),gn)))}getContributionsRoot(){return vn.join(Ft,"contributions")}getTemplateRoot(){return vn.join(this.getContributionsRoot(),"template")}getExtensionRoot(){let e=this.active;if(e!==void 0)return vn.join(this.getContributionsRoot(),e)}get active(){if(this._active===void 0){let e=vn.join(this.getContributionsRoot(),"active"),t=this.fs.existsSync(e)?this.fs.readFileSync(e):"<none>";switch(t){case"blue":case"green":this._active=t;break;case"<none>":break;default:this.tracer.error(()=>`Unknown active annotation folder: ${t}`)}}return this._active}loadAnnotationHandlers(e){if(!this.installTriggered)if(this.installTriggered=!0,this.active===void 0){this.install("blue").then(e).catch(t=>this.tracer.error(()=>`afterInstallation handler failed:
${t}`));return}else Dt(this.updateIfAvailable());if(this.active!==void 0){let r=this.getAnnotationHandlerNpmPackageNames().map(i=>this.loadAnnotationHandler(i)).filter(i=>!!i);return this.traceHandlers(r),r.length&&this.telemetry.addTelemetry({type:Al,status:"installed"}),r}else return}traceHandlers(e){for(let t of e){let r={statName:`Contribution "${t.name}"`,stats:{description:t.description,version:t.version}};wt.log(r)}}async install(e){try{let t=this.getContributionsRoot(),r=vn.join(t,e);await this.fs.rmdir(r),await this.fs.mkdir(r),await this.fs.copyFile(vn.join(t,"template/package.json"),vn.join(r,gn));let i=await this.execAndGetResult("npm",["install","--legacy-peer-deps","--registry",this.getRegistry()],r);if(!this.fs.existsSync(vn.join(r,"node_modules")))throw new Error(`Installation did not install anything in ${r}:
${i}`);return this.fs.writeFileSync(vn.join(t,"active"),e),this._active=e,this.tracer.info(()=>`Installed (${e})
${i}`),this.telemetry.addTelemetry({type:Al,status:"installed"}),{status:"installed"}}catch(t){return this.telemetry.addTelemetry({type:Al,status:"installation failed"}),{status:"installation failed",reason:`${t.message}
    stdout: ${t.stdout?.toString()}
    stderr: ${t.stderr?.toString()}`}}}get telemetry(){return this.getLanguageServer().telemetry}async execAndGetResult(e,t,r){return(await Vt.run(e,t,{cwd:r})).stdout}async updateIfAvailable(){try{let e=await this.execAndGetResult("npm",["outdated","--registry",this.getRegistry()],this.getExtensionRoot());return this.tracer.info(()=>`stdout => ${e}`),this.telemetry.addTelemetry({type:Al,status:"updated"}),{status:"up-to-date"}}catch(e){return this.telemetry.addTelemetry({type:Al,status:"update failed"}),this.tracer.info(()=>VN.inspect(e)),this.tracer.info(()=>"Updating..."),this.install(this.active==="blue"?"green":"blue")}}loadAnnotationHandler(e){let t=this.getInstalledPackageJson(e);if(!t)return;let r=this.resolve(e),i=require(r);return new Yt(this.getLanguageServer(),t.name,t.description,i,t.version,vn.dirname(this.resolve(e,gn)))}resolve(...e){return require.resolve(vn.join(...e),{paths:[this.getExtensionRoot()]})}getInstalledPackageJson(e){let t=o(a=>{let c=a.cdsLspContributionKind;return c==="annotation@2"?!0:(this.tracer.warn(()=>`Package name '${e}' is not a valid annotation contribution. cdsContributionKind is '${c}' (expected: 'annotation@2')`),!1)},"isPotentialAnnotationExtension");if(!this.getExtensionRoot())return;let i=this.resolve(e,gn),s=require(i);if(t(s))return s}},bn=qS;o(qS,"ContributionLoader"),x([F("contribution")],bn.prototype,"getAnnotationHandlerNpmPackageNames",1),x([F("contribution")],bn.prototype,"getPackageJson",1),x([F("contribution")],bn.prototype,"getContributionsRoot",1),x([F("contribution")],bn.prototype,"getTemplateRoot",1),x([F("contribution")],bn.prototype,"getExtensionRoot",1),x([F("contribution",{resultRenderer:R.nothing}),Q({fallback:re,traceComponent:"contribution"})],bn.prototype,"loadAnnotationHandlers",1),x([F("contribution")],bn.prototype,"install",1),x([F("contribution")],bn.prototype,"execAndGetResult",1),x([F("contribution")],bn.prototype,"updateIfAvailable",1),x([F("contribution",{resultRenderer:R.nothing}),Q({fallback:re,traceComponent:"contribution"})],bn.prototype,"loadAnnotationHandler",1);var Vo=class{constructor(e,t){this.uri=e;this.compiler=t;m(this,"usedPaths",Vo.NONE);m(this,"directUsedUris",Vo.NONE);m(this,"transitiveUsedUris")}onFileChanged(e){let t=this.calculateUsedPaths(e);return L2(this.usedPaths,t)?!1:(this.usedPaths=t,this.directUsedUris=this.calculateUsedUris(t),!0)}invalidateTransitiveUsedUrisIfCovering(e){return e===this.uri||this.transitiveUsedUris?.has(e)?(this.transitiveUsedUris=void 0,!0):!1}calculateUsedPaths(e){try{let t=this.compiler.parse(e,Cn(this.uri),{fallbackParser:"cds",parseOnly:!0,lintMode:!0,attachTokens:!1,messages:[]});return t.dependencies?new Set(t.dependencies.map(r=>r.val)):Vo.NONE}catch{return Vo.NONE}}calculateUsedUris(e){let t=new Set,r=vt(),i=r.workspaceService.getWorkspaceFolder(this.uri);for(let s of e){if(!s)continue;let a=r.usingPathResolver.resolveUsingPath(this.uri,s,i);a&&t.add(a)}return t}},Pa=Vo;o(Vo,"DependencyInfo"),m(Pa,"NONE",new Set),x([F("workspace",{traceLevel:6,argumentsRenderer:(n,e)=>`${e.uri} with ${n[0].size} using paths`,resultRenderer:n=>`${n.size} resolved`})],Pa.prototype,"calculateUsedUris",1);function L2(n,e){if(n.size!==e.size)return!1;for(let t of n)if(!e.has(t))return!1;return!0}o(L2,"compareSets");var Go=class{constructor(e){m(this,"dependencies",new Map);m(this,"compiler");m(this,"fs",ne().getFileSystem());this.compiler=ne().getModuleLoader().loadCompiler(e)}initFiles(e){this.dependencies.clear();for(let t of e)this.fs.isCdsSourceFile(t.uri)&&this.getInfo(t.uri).onFileChanged(t.content)}transitiveDependenciesFor(e){let t=this.getInfo(e,!1);return t?t.transitiveUsedUris??this.calculateTransitiveDependencies(e):Go.NONE}onFileChanged(e,t){return this.fs.isCdsSourceFile(e)?t===pe?this.onFileDeleted(e):this.getInfo(e).onFileChanged(t)?this.invalidateUsers(e):Go.NONE:Go.NONE}getInfo(e,t=!0){let r=this.dependencies.get(e);return!r&&t&&(r=new Pa(e,this.compiler),this.dependencies.set(e,r)),r}onFileDeleted(e){let t=this.invalidateUsers(e);return this.dependencies.delete(e),t}invalidateUsers(e){let t=new Set;for(let[r,i]of this.dependencies.entries())i.invalidateTransitiveUsedUrisIfCovering(e)&&t.add(r);return t}*allPotentialUsers(e){for(let t of this.dependencies.keys())this.transitiveDependenciesFor(t).has(e)&&(yield t)}calculateTransitiveDependencies(e){return this.recalculateMissingTransitiveDependencies(),this.dependencies.get(e).transitiveUsedUris}recalculateMissingTransitiveDependencies(){let{dependencies:e}=this,t=new Mn({getDirectDependencies(i){return e.get(i)?.directUsedUris??Go.NONE}}),r=0;for(let[i,s]of this.dependencies.entries())s.transitiveUsedUris||(r++,s.transitiveUsedUris=t.getTransitiveDependencies(i));return`Calculated for ${r} model files`}},ji=Go;o(Go,"DependencyNet"),m(ji,"NONE",new Set),x([F("files",{argumentsRenderer:R.nothing,resultRenderer:(n,e,t)=>`${t.dependencies.size} files initialized`})],ji.prototype,"initFiles",1),x([F("files",{argumentsRenderer:n=>n[0],resultRenderer:n=>`${n.size} dependents invalidated`})],ji.prototype,"onFileChanged",1),x([F("workspace")],ji.prototype,"recalculateMissingTransitiveDependencies",1);var ZN=K(require("path"));var Of=K(Xe());var Ef=K(require("path"));var $S=class{constructor(e){this.workspaceFolder=e;m(this,"knownPackageRootPaths",new Map)}ensureIndexed(){if(!this.workspaceFolder.workspaceSnapshot.isScanned())throw new Error;let e=ne().getFileSystem();for(let t of this.workspaceFolder.workspaceSnapshot.streamFiles(r=>e.isPackageJsonFile(r.uri),"OpenEditorsDirectSourcesAndDirectDependencies")){let r=this.workspaceFolder.adapter.toLocalPath(t.uri),i=Ef.dirname(r),s=e.realpathSync(i),a=this.parsePackageJson(t.content);if(!a)continue;let{name:c,dependencies:l,devDependencies:u,version:p}=a,d=this.knownPackageRootPaths.get(s);d||(d={packageJsonFolderPath:i,name:c,dependencies:this.resolveDependencies(l,i),devDependencies:this.resolveDependencies(this.addSapCdsDependency(u??{}),i),version:p},this.knownPackageRootPaths.set(i,d))}}parsePackageJson(e){return JSON.parse(e)}addSapCdsDependency(e){return e["@sap/cds"]||(e["@sap/cds"]="latest"),e}getPackageRootFolder(e){let t=Ef.dirname(e);return this.findPackageRoot(t)}findPackageRoot(e){this.ensureIndexed();let t=ne().getFileSystem(),r=e;for(;!t.isFileSystemRoot(r);){let i=this.knownPackageRootPaths.get(r);if(i)return i;r=Ef.dirname(r)}}resolveDependencies(e={},t){let r=vt().moduleLoader.resolver;return Object.keys(e).forEach(i=>{e[i]=r.resolveId(i+"/package.json",t)}),e}},Ho=$S;o($S,"NpmPackages"),x([Pe()],Ho.prototype,"ensureIndexed",1),x([Q({fallback:re})],Ho.prototype,"parsePackageJson",1),x([Pe()],Ho.prototype,"findPackageRoot",1);var GN=o(n=>n instanceof yt,"isExplicitDefinition"),WS=class{constructor(e){this.translationBroker=e}*fetchTokenDocumentation(e){if(!e)return;if(e instanceof Es){let r=e.translationId,i=this.translateToMarkdown(e.uri,r);if(i){yield{domain:"translation",content:i};return}}if(!hp(e))return;let t=_t(e.definitions);for(let r of this.streamDefinitionDocumentations(e.uri,t))yield r}*streamDefinitionDocumentations(e,t){t=t.filter(l=>!!l);function*r(l){for(let u of t)if(GN(u)){let p=_t(u.annotation(l)).reverse();for(let d of p)if(d.annotationValue){let f=d.annotationValue.replaceAll(xn+"n",_l);yield l==="title"?FC(f):f}}}o(r,"streamTags");let i=this;function*s(l){for(let u of l)yield i.translateToMarkdown(e,Ri(u),u)}o(s,"streamTranslation");function*a(){for(let l of dT)for(let u of s(r(l)))yield{domain:l,content:u}}o(a,"allTagDocs");let c=t.filter(GN).find(l=>l.docComment)?.docComment;c&&(yield{domain:"documentation",content:{kind:"markdown",value:c}});for(let l of a())yield l}translateToMarkdown(e,t,r=""){let i={kind:"markdown",value:r};if(t){let s=this.translationBroker.getTranslation(e,t);s&&(i.value=DC(s.text))}return i}},Ra=WS;o(WS,"DocumentationProvider"),x([F("docs",{argumentsRenderer:R.nothing})],Ra.prototype,"fetchTokenDocumentation",1),x([F("docs",{argumentsRenderer:R.nothing})],Ra.prototype,"streamDefinitionDocumentations",1);var Ur=K(require("path"));var BS=class{constructor(e){this.uri=e;m(this,"map",new Map);m(this,"content","")}get entries(){return this.map.values()}getEntry(e){return this.map.get(e)}},Vi=BS;o(BS,"I18nIndex");var HN="\uFEFF",jS=class extends Vi{constructor(){super(...arguments);m(this,"separator",";");m(this,"defLangIndex");m(this,"fallbackLangIndex");m(this,"nLanguages",0)}index(t,r){let i=this.map;i.clear();try{let[s,...a]=this.parse(r);if(this.nLanguages=s?s.length-1:0,!s)return;this.defLangIndex=zN(i,this.uri,t.i18n.default_language,s,a),this.fallbackLangIndex=zN(i,this.uri,t.i18n.fallback_bundle,s,a)}finally{this.content=r}}createEntry(t,r,i,s){let c=o(()=>{for(let[,g]of this.map.entries())if(r.localeCompare(g.id)<0)return g.line;return 999999},"findInsertionLine"),l=this.nLanguages?this.map.get(r)?.line:void 0,u=l!==void 0;l=l??c();let p=this.fallbackLangIndex??this.defLangIndex??1;if(u){let g=this.map.get(r);return[{newText:s,range:{start:{line:g.line,character:g.character},end:{line:g.line,character:g.character}}}]}let d=r,f=this.nLanguages;f===0&&(d=`${HN}ID${this.separator}${t.i18n.fallback_bundle}
`+d,f=1);for(let g=0;g<f;g++)d+=this.separator,g+1===p&&(d+=s);return d+=`
`,l===999999&&this.nLanguages&&!this.content.endsWith(`
`)&&(d=`
`+d),[{newText:d,range:{start:{line:l,character:0},end:{line:l,character:0}}}]}parse(t){let r=[];return t[0]===HN&&(t=t.slice(1)),this.separator=t.match(/([,;\t])/)?.[1]??";",t.split(/\r?\n/).map(i=>i.trimEnd()).forEach((i,s)=>{let a=[],c="",l=0,u;for(let p=0;p<i.length;)if(u=i[p++],u===this.separator)a.push({position:{line:s,character:l},value:c}),l=p,c="";else if(u==='"')if(i[p]==='"')c+=i[p++];else for(;p<i.length;){let d=i[p++];if(d==='"')if(i[p]==='"')c+=i[p++];else break;else d==="\\"?c+="\\\\":c+=d}else u==="\\"?c+="\\\\":c+=u;(c||u===this.separator)&&a.push({position:{line:s,character:l},value:c}),a.length>0&&r.push(a)}),r}},Ll=jS;o(jS,"CsvIndex"),x([F("docs",{argumentsRenderer:(n,e)=>e.uri,resultRenderer:(n,e,t)=>`${t.map.size} entries`})],Ll.prototype,"index",1);function zN(n,e,t,r,i){let s=o(c=>r.findIndex(l=>l.value===c),"getLangIndex"),a=s(t);if(a<0&&(a=s((t.match(/[a-zA-Z]+/)||[])[0])),a>0)for(let c of i){let l=c[a];if(l){let u=c[0].value;(l.value||!n.get(u)?.text)&&n.set(u,{text:l.value,id:u,line:l.position.line,character:l.position.character,uri:e})}}return a>0?a:void 0}o(zN,"collectEntries");var QN=K(XN());function JN(n,e){let t=n.pos.key??n.pos.value,r=e.slice(t.pos).indexOf("{")+1;return{line:t.line,column:t.column+r,pos:t.pos+r}}o(JN,"afterStart");var Nf=class{constructor(e,t,r,i){this.id=e;this.data=t;this.jsonNodePath=r;this.pointers=i}get pos(){return this.pointers[this.jsonNodePath]}createSubNode(e){return new Nf(e,this.data?.[e],`${this.jsonNodePath}/${e}`,this.pointers)}*subNodes(){for(let e of Object.keys(this.data||{}))yield this.createSubNode(e)}},Df=Nf;o(Nf,"JsonNodeX");var HS=class extends Vi{constructor(){super(...arguments);m(this,"parsed",{data:{},pointers:{}})}index(t,r){let i=this.map;if(i.clear(),this.content=r,r){this.parsed=(0,QN.parse)(r);let s=new Df("<ROOT>",this.parsed.data,"",this.parsed.pointers),a=o(c=>{let l=s.createSubNode(c);for(let u of l.subNodes()){let{line:p,column:d}=u.pos.value;i.set(u.id,{uri:this.uri,line:p,character:d+1,id:u.id,text:u.data})}},"collectEntries");a(t.i18n.default_language),a(t.i18n.fallback_bundle)}}wrap(t,r,i,s){let a=this.content[t.pos-1],c=this.content[t.pos],l=a===`
`||a==="\r",u=c===`
`||c==="\r";return i.startsWith(`
`)&&l&&(i=i.slice(1)),s.endsWith(`
`)&&u&&(s=s.slice(0,-1)),`${i}${r}${s}`}injectInExistingEntries(t,r,i){let s=o((c,l,u)=>({position:c,newText:this.wrap(c,r,l,u)}),"result"),a;for(let c of i.subNodes())if(a=c,c.id.localeCompare(t)>0)return s(c.pos.key,"",`,
    `);return a?s(a.pos.valueEnd,`,
    `,""):s(JN(i,this.content),`
    `,`
`)}createEntry(t,r,i,s){let a=new Df("<ROOT>",this.parsed.data,"",this.parsed.pointers),c=o(g=>{let h=a.createSubNode(g);return h.data?h:void 0},"getLangNode"),l=c(t.i18n.fallback_bundle)??c(t.i18n.default_language),u=Ii(a.data)[0]?.[0],p=u&&c(u),d=o((g,h)=>[{newText:g,range:{start:{line:h.line,character:h.column},end:{line:h.line,character:h.column}}}],"result"),f=`"${r}": "${s}"`;if(l){let g=this.injectInExistingEntries(r,f,l);return d(g.newText,g.position)}else{if(f=`"${t.i18n.fallback_bundle}": {
    ${f}
  }`,p)return d(f+`,
  `,p.pos.key);if(Object.entries(a.pointers).length){let g=JN(a,this.content);return d(this.wrap(g,f,`
  `,`
`),g)}}return d(`{
  ${f}
}`,{line:0,column:0,pos:0})}},El=HS;o(HS,"JsonIndex"),x([F("docs",{argumentsRenderer:(n,e)=>e.uri,resultRenderer:(n,e,t)=>`${t.map.size} entries`})],El.prototype,"index",1);var zS=class extends Vi{index(e,t){this.content=t;let r=o(i=>i.replaceAll(/\\u[\dA-F]{4}/gi,s=>String.fromCharCode(parseInt(s.replaceAll(xn+"u",""),16))),"compileUnicode");this.map.clear(),t&&t.split(Nt).forEach((i,s)=>{let a=i.trim();if(a.length&&!a.startsWith("#")){let[c,l]=a.split("=").map(u=>u.trim());c&&l&&this.map.set(c,{id:c,text:r(l),uri:this.uri,line:s,character:i.indexOf("=")+1})}})}createEntry(e,t,r,i){let s=this.content.split(Nt),c=o(()=>{for(let p of this.entries)if(p.id.localeCompare(t)>0){let d=p.line;return d>0&&s[d-1].trim().startsWith("#")?d-1:d}return s.length},"findInsertionLine")(),l=s[c]!==void 0?"":`
`,u=0;return[{range:{start:{line:c,character:u},end:{line:c,character:u}},newText:`${l}#${r}
${t}=${i}

`}]}},wl=zS;o(zS,"PropertiesIndex"),x([F("docs",{argumentsRenderer:(n,e)=>e.uri,resultRenderer:(n,e,t)=>`${t.map.size} entries`})],wl.prototype,"index",1);var KS=class{constructor(e){this.workspaceFolder=e;m(this,"tracer",G().tracer("docs"));m(this,"fs",ne().getFileSystem());m(this,"fileExtensionToIndexType",{".properties":wl,".json":El,".csv":Ll})}resetTranslations(){Pe.clear(this)}onTranslationFileChanged(e,t){this.resetTranslations()}getTranslation(e,t){if(this.getCdsEnv())for(let r of this.indexes4(e)){let i=r.getEntry(t);if(i)return i}}getCdsEnv(){return this.workspaceFolder.getCdsEnv()}getAllTranslations(e){let t=new Map;if(this.getCdsEnv())for(let r of this.indexes4(e))for(let i of r.entries)t.set(i.id,i);return[...t.values()]}getMostRelevantTranslationFileUri(e){if(mt.isUntitledFile(e))return;let t=this.getCdsEnv(),r=je([...this.translationFiles4(e)]);if(r)return this.workspaceFolder.adapter.toUri(r);if(!e.startsWith(this.workspaceFolder.workspaceUri))return;let i=je(this.translationFolders4(e));i||(i=Ur.join(this.workspaceFolder.workspaceRoot,t.i18n.folders[0]??"i18n"));let s=Ur.join(i,`${t.i18n.file}${t.i18n.fallback_bundle?"_"+t.i18n.fallback_bundle:""}.properties`);return this.workspaceFolder.adapter.toUri(s)}getTranslationIndex(e){return this.createIndex(e,this.getContent(this.workspaceFolder.adapter.toLocalPath(e)))}createIndex(e,t){let r=Ur.extname(e),i=new this.fileExtensionToIndexType[r](e);return i.index(this.getCdsEnv(),t!==pe?t:""),Pe.set(this,"getTranslationIndex",e,i),i}indexes4(e){return[...this.calculateIndexes4(e)]}*calculateIndexes4(e){for(let t of this.translationFiles4(e))try{let r=this.getContent(t),i=this.workspaceFolder.adapter.toUri(t);yield this.createIndex(i,r)}catch(r){this.tracer.error(()=>R.exception(r))}}translationFiles4(e){return[...this.calculateTranslationFiles4(e)]}*calculateTranslationFiles4(e){let t=this.getCdsEnv(),r=[t.i18n.default_language,t.i18n.fallback_bundle];for(let i of this.translationFolders4(e))for(let s of r){let a=s===""?"":"_"+s,c=Ur.join(i,t.i18n.file),l=o(p=>this.existsFile(p)?p:void 0,"pathIfExisting"),u=l(c+".json")||l(c+a.replace("-","_")+".properties")||l(c+a.match(/\w+/)+".properties")||l(c+".csv");u&&(yield u)}}translationFolders4(e){let t=this.workspaceFolder.workspaceSnapshot.fileIndexFor(e),r=[];for(let i of[e,...t?.directDependentUris??[]]){if(mt.isUntitledFile(i))continue;let s=this.workspaceFolder.adapter.toLocalPath(i),a=this.translationFolder4(Ur.dirname(s));!a||r.includes(a)||r.push(a)}return r.reverse(),r}translationFolder4(e){let t=this,r=this.getCdsEnv();return i(e)??s(e);function i(a){for(let c of r.i18n.folders){let l=Ur.join(a,c);if(t.existsFolder(l))return l}}function s(a){let c=Ur.dirname(a);return!c||c===a?null:t.translationFolder4(c)}}existsFile(e){return this.getContentFromCache(e)!==pe||this.fs.existsSync(e)}existsFolder(e){let t=this.getCdsEnv();for(let r of this.workspaceFolder.workspaceSnapshot.streamFiles(i=>this.fs.isTranslationFile(t,i.uri),"OpenEditorsDirectSourcesAndDirectDependencies",i=>i.uri))if(this.workspaceFolder.adapter.toLocalPath(r).startsWith(e))return!0;return this.fs.existsSync(e)}getContent(e){let t=this.getContentFromCache(e);return t!==pe?t:this.fs.existsSync(e)?this.fs.readFileSync(e):pe}getContentFromCache(e){return this.workspaceFolder.getContent(this.workspaceFolder.adapter.toUri(e))}},yn=KS;o(KS,"TranslationBroker"),x([F("docs")],yn.prototype,"resetTranslations",1),x([F("docs",{argumentsRenderer:n=>`${n[1]?"<update> ":"<delete> "}${n[0]}`})],yn.prototype,"onTranslationFileChanged",1),x([F("docs",{traceLevel:6})],yn.prototype,"getMostRelevantTranslationFileUri",1),x([Pe()],yn.prototype,"getTranslationIndex",1),x([Pe()],yn.prototype,"indexes4",1),x([F("docs",{resultRenderer:R.nothing})],yn.prototype,"calculateIndexes4",1),x([Pe()],yn.prototype,"translationFiles4",1),x([F("docs",{resultRenderer:R.nothing})],yn.prototype,"calculateTranslationFiles4",1),x([F("docs"),Pe()],yn.prototype,"translationFolders4",1),x([F("docs"),Pe()],yn.prototype,"translationFolder4",1);var YN=K(Xe());var _f=class{constructor(e,t=[]){this.languageServer=e;this.quickFixHandlers=t;m(this,"modelTracer");this.modelTracer=e.trace.tracer("model")}async calculateAnnotationDiagnostics(e,t,r){let i=new Map;for(let s of await this.languageServer.fetchAnnotationHandlers()){let a=await s.fetchDiagnostics({uris:t,index:e,ast:r});for(let[c,l]of a.entries())_f.setDiagnosticSource(l),i.set(c,l.concat(i.get(c)??[]))}return i}static setDiagnosticSource(e){e.forEach(t=>t.source="CDS (annotations)")}calculateDiagnostics(e,t,r){let i=Si.adapt(this.languageServer.options.getUserSetting("cds.diagnosticsSeverity")),s=t.compilerMessages.concat(t._annotationDiagnostics).concat(...r).filter(a=>!!a&&(a.severity??YN.DiagnosticSeverity.Hint)<=i);return{uri:e,diagnostics:s,workspaceVersion:t.workspaceVersion}}async calculateCombinedDiagnosticsAndSend(e,t,r){t.workspaceVersion!==r&&this.modelTracer.warn(()=>`index.version=${t.workspaceVersion} != workspaceVersion=${r}`);let i=this.quickFixHandlers.map(a=>(this.modelTracer.verbose(()=>`${a.constructor.name}`),a.calculateDiagnostics(e,t))).reduce((a,c)=>a.concat(c),[]),s=this.calculateDiagnostics(e,t,i);return this.languageServer.clientProblems.updateFile(e,s,r)}cleanDiagnostics(e){return this.languageServer.clientProblems.cleanDiagnostics()}},li=_f;o(_f,"WorkspaceDiagnostics"),x([F("workspace",{argumentsRenderer:R.nothing,traceLevel:6})],li.prototype,"calculateAnnotationDiagnostics",1),x([F("workspace",{argumentsRenderer:bt,traceLevel:6})],li.prototype,"calculateDiagnostics",1),x([F("workspace",{argumentsRenderer:n=>`${n[0]} %${n[2]}`,traceLevel:6})],li.prototype,"calculateCombinedDiagnosticsAndSend",1),x([F("workspace",{traceLevel:6,argumentsRenderer:bt})],li.prototype,"cleanDiagnostics",1);var Aa=class{constructor(e,t,r,i,s=0,a=!1){this.uri=e;this.content=t;this.isOpen=r;this.fileIndex=i;this._fileVersion=s;this.isOutsider=a}static create(e,t,r=!1){return new Aa(e,t,r,void 0)}progress(e,t){if(this.content===e)return this.isOpen=t,this;let r=this.fileIndex?.clone();return r?.staleContent(),new Aa(this.uri,e,t,r,this._fileVersion+1)}static outsiderIndex(e,t,r){return new Aa(e,r,!1,t,0,!0)}},zo=Aa;o(Aa,"WorkspaceFileVersion");var XS=class{constructor(e,t,r){this.languageServer=e;this.name=t;this.adapter=r;m(this,"fileTracer");m(this,"tracer");m(this,"translationBroker",new yn(this));m(this,"diagnostics");m(this,"documentationProvider",new Ra(this.translationBroker));m(this,"npmPackages",new Ho(this));m(this,"_lastRequestIndependentWorkspaceSnapshot");m(this,"_cdsEnv");m(this,"_isWindows");m(this,"_taskManager",new fc);let i=G();this.tracer=i.tracer("workspace"),this.fileTracer=i.tracer("files"),this._isWindows=e.platformTester.isWindows(),this._cdsEnv=new hc(this.languageServer.moduleLoader),this.tracer.info(()=>`WorkspaceFolder ${t}: workspaceUri=${this.workspaceUri} workspaceRoot=${this.workspaceRoot}`),this.checkRootExists(),this.diagnostics=new li(this.languageServer,[...this.languageServer.quickFixes.values()]),this.lastRequestIndependentWorkspaceSnapshot=this.createWorkspaceState(this.getStateContext())}get kind(){return"normal"}get lastRequestIndependentWorkspaceSnapshot(){return this._lastRequestIndependentWorkspaceSnapshot}set lastRequestIndependentWorkspaceSnapshot(e){this._lastRequestIndependentWorkspaceSnapshot=e}get workspaceSnapshot(){return he().requestScope.snapshots.get(this.workspaceUri)??this.lastRequestIndependentWorkspaceSnapshot}get workspaceUri(){return this.adapter.clientRootUri}get workspaceRoot(){return this.adapter.localRootPath}createWorkspaceState(e){return ne().createSnapshot(e,!0)}async ensureScanned(){let e=this.getCdsEnv();return this.workspaceSnapshot.ensureScanned(e)}getStateContext(){return{adapter:this.adapter,options:this.languageServer.options,getCdsEnv:()=>this.getCdsEnv(),beforeRescan:()=>{this.translationBroker.resetTranslations()},dependencyLevel:t=>this.dependencyLevel(t)}}progressSnapshot(e,t,r=!0){let i=!e&&!t,s=this.lastRequestIndependentWorkspaceSnapshot,a=i?s.reset():s.change(e,t);return this.lastRequestIndependentWorkspaceSnapshot=a,r&&this.setSnapshotForCurrentRequest(a),{formerSnapshot:s,updatedSnapshot:a}}setSnapshotForCurrentRequest(e){he().requestScope.snapshots.set(this.workspaceUri,e)}calculateUrisToValidate(e){let t=this.languageServer.options.getUserSetting("cds.workspaceValidationMode");e.length===0&&(this.tracer.warn(()=>`FULL BUILD is being prepared: ${new Error().stack}`),e=[...this.workspaceSnapshot.streamFiles(qn,t,kr)]);let r=this.workspaceSnapshot;if(t==="ActiveEditorOnly")return r.activeEditor?[r.activeEditor]:[];let i=Oi(),s=o(c=>r.isIndexDirty(c,i),"isDirty"),a=new Set(e);return e.forEach(c=>{for(let l of r.dependencyNet.allPotentialUsers(c))t==="OpenEditorsOnly"&&!r.files.get(l)?.isOpen||s(l)&&a.add(l)}),[...a]}dependencyLevel(e){if(!e.startsWith(this.workspaceUri))return this.tracer.warn(()=>`Given file ${e} not part of workspace ${this.workspaceUri} => assuming first level dependency`),1;let t=e.slice(this.workspaceUri.length),r=o((i,s)=>i+(s==="node_modules"?1:0),"countNodeModuleSegments");return t.split(ze).reduce(r,0)}readContent(e){let t=this.adapter.toLocalPath(e);return this.languageServer.fileSystem.readFileSync(t)}checkRootExists(){if(!this.languageServer.fileSystem.existsSync(this.workspaceRoot))throw new Error("Given workspace root does not exist locally: "+this.workspaceRoot)}async rebuildDirtyIndexes(e){let t=this.workspaceSnapshot,r=t.workspaceVersion,i=t.findDirtyUris(e),a=e.debounce&&this.languageServer.options.getUserSetting("cds.workspace.debounceFastChanges")?"...":r;i.sort();let c=i.join(`
`);return this._taskManager.enqueue(`rebuildDirtyIndexes:${this.workspaceUri}%${a}
${c}`,r,async()=>{this.tracer.verbose(()=>`Rebuild indexes for %${r}`);let{requestScope:l}=he();Ot(l).progress(void 0,"Indexing"),i=t.sortByRank(i),this.tracer.verbose(()=>`URIs to rebuild: (${i.length>4&&!this.tracer.isTracing(7)?i.length:R.uris(i)})`);let u=o((d,f,g)=>{this.tracer.verbose(()=>`Setting index for ${f} - mainUri ${g}`);let h=t.files.get(f);if(h)h.fileIndex=d.forUri(f);else{let T=this.languageServer.workspaceService.getWorkspaceFolder(f).readContent(f);t.files.set(f,zo.outsiderIndex(f,d.forUri(f),T!==pe?T:""))}},"onIndexBuild"),p=o(async d=>{if(t.isIndexDirty(d,e)){let f=await this.buildIndex(d,t);f.builtUris.forEach(g=>u(f,g,d))}},"refreshIndex");for(let d of i)await p(d);return Ot(l).progress(void 0," "),this.tracer.verbose(()=>`Done: Rebuild indexes for %${r}`),t})}getUrisForAnnotationValidation(e){let t=e.builtUris,r=new Set;switch(this.languageServer.options.getUserSetting("cds.workspaceValidationMode")){case"OpenEditorsOnly":r=new Set,this.workspaceSnapshot.files.forEach(s=>{s.isOpen&&r.add(s.uri)});case"ActiveEditorOnly":{let s=this.workspaceSnapshot.activeEditor;s&&r.add(s);break}default:r=new Set(e.builtUris);break}for(let s of r)t.includes(s)||r.delete(s);return r}async buildIndex(e,t){let r=await this.fetchAst(e,t),i=mp(e,mi.create(t),r,t.workspaceVersion,this.getAdapter(e));return await this.indexAndValidateAnnotations(i,r),i}async indexAndValidateAnnotations(e,t){let r=this.getUrisForAnnotationValidation(e),i=this.workspaceSnapshot,s=await this.languageServer.fetchAnnotationHandlers();for(let a of s){let c=await a.indexAndValidate({uris:e.builtUris,index:e,ast:t});if(c===ju)c=await this.legacyIndexAndValidate(a,e,t,r);else for(let l of c.diagnostics.values())li.setDiagnosticSource(l);this.integrateAnnotationIndex(c,e,i),this.attachAnnotationDiagnostics(e,r,c)}s.length||this.attachAnnotationDiagnostics(e,r,ju)}attachAnnotationDiagnostics(e,t,r){for(let i of e.builtUris)e.forUri(i)._annotationDiagnostics=t.has(i)?r.diagnostics.get(i)??[]:fp}integrateAnnotationIndex(e,t,r){for(let i of e.annotationIndex)this.indexAnnotationWhereUsedEntry(i,t,r)}async legacyIndexAndValidate(e,t,r,i){let s=await e.indexAnnotationIdentifiers({uris:t.builtUris,index:t,ast:r}),a=i.size?await this.diagnostics.calculateAnnotationDiagnostics(t,[...i],r):new Map;return{annotationIndex:s,diagnostics:a}}indexAnnotationWhereUsedEntry(e,t,r){let i=e.definition;if(!this.isFileUri(i.uri))return;let s=t.forUri(i.uri,"create"),a=s.definitionAt(i.range.start);if(!a){a=new yt(e.absoluteName,"qualifiedAnnotation",i,i),s._definitions.addOccurrence(a,a.nameLocation.range.start);let c=a.nameLocation.range.start,l=s.idTokens.find(u=>!u.compare(c));l instanceof cr?l.addDefinition(a):this.tracer.warn(()=>`Could not find definition token at ${i}`)}for(let c of e.references){if(!this.isFileUri(c.uri))continue;let l=t.forUri(c.uri),u=l.idTokens.find(p=>!p.compare(c.range.start))??this.createPartialStringIdentifierToken(l,c);u?(l.addReference(u,a),u.addDefinition(a)):this.tracer.warn(()=>`Could not find reference token at ${c}`)}}isFileUri(e){return e.startsWith("file:/")?!0:(this.tracer.error(()=>`Ignoring invalid URI from annotation contribution: ${e}`),!1)}createPartialStringIdentifierToken(e,t){let{start:r}=t.range,i=e.stringAt(r);if(!i)return;let s=r.character-i.character,a=s+(t.range.end.character-r.character),c=i.text.slice(s,a),l=new cr({text:c,tokenIndex:i.tokenIndex,...r},e.uri),u=e.idTokens.findIndex(p=>p.tokenIndex>l.tokenIndex)-1;return u<0&&(u=e.idTokens.length),e.idTokens.splice(u,0,l),l}getAdapter(e){return this.adapter}getCdsEnv(){return this._getCdsEnv()}_getCdsEnv(){return this._cdsEnv.getEnv(this.workspaceRoot)}async fetchToken(e,t,r){let i=await this.fetchFileIndex(e);return i?r?o(()=>{for(let a of i.annotationAssignments)if(a.compare(t)===0)return a},"findAnnotationToken")():Rn(i.idTokens,t)||Rn(i.i18nStringTokens,t)||Rn(i.plainStringTokens,t):void 0}async fetchFileIndex(e,t=Oi()){let r=this.workspaceSnapshot;return r.isIndexDirty(e,t)?(this.tracer.verbose(()=>`Recalculating index for ${e}`),r=await this.rebuildDirtyIndexes(t),this.setSnapshotForCurrentRequest(r)):this.tracer.verbose(()=>`Index from cache for ${e}`),r.fileIndexFor(e)}async fetchTransitiveIndex(e,t=Oi()){let r=this.workspaceSnapshot;if(r.isIndexDirty(e,t)){this.tracer.verbose(()=>`Recalculating index for ${e}`);let i=await this.rebuildDirtyIndexes(t);return this.setSnapshotForCurrentRequest(i),this.compilationIndexFor(i,e)}else this.tracer.verbose(()=>`Index from cache for ${e}`);return this.compilationIndexFor(r,e)}compilationIndexFor(e,t){if(!e.fileIndexFor(t))return;let r=new Rs(t,e.workspaceVersion),i=new Set,s=this.tracer;function a(c){if(i.has(c))return;i.add(c);let l=e.fileIndexFor(c);l?(r._fileIndexes[c]=l,l.directDependentUris.forEach(a)):s.error(()=>`No FileIndex for ${c}`)}return o(a,"addUri"),a(t),r}async fetchAst(e,t=this.workspaceSnapshot){let r=this.languageServer.workspaceService.getWorkspaceFolder(e),i={};uC(t.files.values(),qn).forEach(f=>i[f.uri]=f.content);let s=r.adapter.toLocalPath(e);this.tracer.verbose(()=>`Compiling workspace %${t.workspaceVersion}`);let a=Ve();Ii(i).forEach(([f,g])=>{let h=this.adapter.toLocalPath(f);a[h]=g,this._isWindows&&(a[Lu(h.charAt(0))+h.slice(1)]=g)});let c=this.getCdsEnv(),l=c&&c.cdsc,u=this.languageServer.fileSystem,p={},d={onNewCacheEntry(f,g){let h=u.isCdsFile(f);return h?p[f]=g:G().tracer("files").verbose(()=>`Non-CDS-file not cached: ${f}`),h}};return this.languageServer.compiler.compile(s,this.getWorkspaceRoot(s),a,l,d).finally(()=>{Object.keys(p).length&&this.progressSnapshotForFilesReadByCompiler(t,p)})}progressSnapshotForFilesReadByCompiler(e,t){let r=e.files;for(let[i,s]of Object.entries(t)){let a=Jt(i).toString(),c=this.languageServer.workspaceService.getWorkspaceFolder(a),l=c.adapter.toUri(i);r.set(l,e.context.adapter.localRootPath===c.workspaceRoot?ne().createFile(l,s):zo.outsiderIndex(l,void 0,s))}}getWorkspaceRoot(e){return this.workspaceRoot}async onDidChangeWatchedFiles(e){let t=this.workspaceSnapshot,r=[],i=[],s=!1,a=!1,c=e.changes.find(u=>this.languageServer.fileSystem.isCdsEnvFile(u.uri));if(c){this.tracer.info(()=>`potential cdsenv relevant change (${c.uri} - ${c.type})`);let u=this.getCdsEnv();Pe.clear(this,"getCdsEnv");let p=this.getCdsEnv();Qg(u,p)&&(this.tracer.info(()=>"cdsenv changed relevantly, prepare workspace rescan"),this.progressSnapshot(),a=!0)}let l=this.getCdsEnv();for(let u of e.changes){let p=u.uri,d=u.type===Of.FileChangeType.Deleted,f=t.getContent(p),g=this.languageServer.fileSystem.typeofFile(p,l,()=>f);if(g!=="Unrelated"){if(g===".cdsrc.json"){this.translationBroker.resetTranslations(),s=!0;continue}if(g==="TranslationDefinitions"){this.translationBroker.onTranslationFileChanged(u.uri,f),s=!0;continue}if(d)g==="PackageJson"||(a=!0);else switch(g){case"CsnFile":case"CdsSource":r.push(u);break;case"IgnoreFile":a=!0;break;case"PackageJson":i.push(u);break}u.type===Of.FileChangeType.Created&&(a=!0)}}try{if(i.length&&(a=!0),a){await this.triggerRevalidation(),s=!1;return}if(r.length){await this.triggerRevalidation(r.filter(u=>u.type!==Of.FileChangeType.Deleted).map(u=>u.uri));return}}finally{if(s){let u=this.languageServer.options.getUserSetting("cds.workspaceValidationMode")==="ActiveEditorOnly",p=[...t.streamFiles(kp,void 0,kr)],d=1;for(let f of p)if(this.languageServer.fileSystem.isCdsSourceFile(f)){let g=t.fileIndexFor(f);if(g?.i18nStringTokens.length){if(u&&f!==t.activeEditor){g.staleContent();continue}await this.validateFile(f,d++,p.length)}}}}}async triggerRevalidation(e=[]){this.tracer.info(()=>`WorkspaceFolder '${this.name}': ${this.workspaceRoot}`);let t=this.workspaceSnapshot,r=e.length===0;r&&(t.files.forEach(a=>a.fileIndex=void 0),t.dependencyNet.initFiles(t.files.values()));let i=t.sortByRank(this.calculateUrisToValidate(e)),s=r?this.diagnostics.cleanDiagnostics(this.name):Ve();return await this.validateFiles(i,s),s}async validateFiles(e,t){Ot().progress(void 0,`Validating file${e.length!==1?"s":""}`),e.length>1&&this.tracer.warn(()=>`Validating multiple files (${e.length}). Workspace is not optimized.
${e.join(`
`)}`);let r=he().frameScope.indentLevel,i=e.length,s=0;for(let a of e){s++,he().frameScope.indentLevel=r;let c=await this.validateFile(a,s,i);c&&(t[c.uri]=c.diagnostics)}Ot().progress(void 0," ")}async validateFile(e,t,r){let i=this.languageServer.options.getUserSetting("cds.workspaceValidationMode"),s=i==="OpenEditorsOnly",a=i==="ActiveEditorOnly",c=this.workspaceSnapshot.fileIndexFor(e);c?._annotationDiagnostics===fp&&(this.tracer.warn(()=>`Recompiling to get AST for annotation diagnostics for ${e}`),c.staleContent());let u=await this.fetchFileIndex(e,{considerOnlyOpenFiles:s,considerOnlyActiveFile:a,uri:e,debounce:!0});return this.diagnostics.calculateCombinedDiagnosticsAndSend(e,u,this.workspaceSnapshot.workspaceVersion)}getContent(e){return this.workspaceSnapshot.getContent(e)}},gt=XS;o(XS,"WorkspaceFolder"),x([F("workspace",{argumentsRenderer:(n,e)=>e.workspaceUri})],gt.prototype,"ensureScanned",1),x([F("files",{traceLevel:7,resultRenderer:n=>`${typeof n=="string"?n.length:"-1"} bytes read`}),Q({fallback:Sp,traceLevel:8})],gt.prototype,"readContent",1),x([F("workspace",{resultRenderer:n=>`snapshot for %${n.workspaceVersion}`})],gt.prototype,"rebuildDirtyIndexes",1),x([F("contribution",{argumentsRenderer:R.nothing}),Q({fallback:re})],gt.prototype,"indexAndValidateAnnotations",1),x([Q({fallback:re})],gt.prototype,"indexAnnotationWhereUsedEntry",1),x([Pe()],gt.prototype,"getCdsEnv",1),x([F("workspace",{resultRenderer:R.asIs}),Q({fallback:()=>Kr(),traceComponent:"workspace"})],gt.prototype,"_getCdsEnv",1),x([F("model",{resultRenderer:n=>n?`#${n._workspaceVersion}`:'"<undefined>"',trackMemory:!0})],gt.prototype,"fetchTransitiveIndex",1),x([F("model",{argumentsRenderer:bt,resultRenderer:(n,e)=>`${e[0]} ${e[1]}`})],gt.prototype,"fetchAst",1),x([F("files",{argumentsRenderer:n=>`${Object.keys(n[0]).join(`
`)}`}),Q({fallback:re,traceComponent:"files"})],gt.prototype,"progressSnapshotForFilesReadByCompiler",1),x([F("workspace"),Q({fallback:re,traceComponent:"workspace"})],gt.prototype,"onDidChangeWatchedFiles",1),x([F("workspace",{argumentsRenderer:n=>n[0]?Lt([...n[0]]):"all files to be recompiled",resultRenderer:R.nothing,trackMemory:!0})],gt.prototype,"triggerRevalidation",1),x([F("workspace",{argumentsRenderer:n=>`Validating ${n[0].length} files`,resultRenderer:R.nothing})],gt.prototype,"validateFiles",1),x([F("workspace",{argumentsRenderer:n=>`${n[1]}/${n[2]}: ${n[0]}`,resultRenderer:R.nothing}),Q({fallback:re,traceComponent:"workspace"})],gt.prototype,"validateFile",1);var JS=class extends gt{get kind(){return"outsider"}constructor(e){super(e,"(Outsiders)",ne().createPathAdapter(Jt(ZN.resolve("/")).toString()))}createWorkspaceState(e){return ne().createSnapshot(e,!1)}checkRootExists(){}_getCdsEnv(){return Kr()}async fetchTransitiveIndex(e,t){return super.fetchTransitiveIndex(e,this.contextFor(e))}async fetchFileIndex(e,t){return super.fetchFileIndex(e,this.contextFor(e))}contextFor(e){return{singleFile:!0,uri:e}}},Fl=JS;o(JS,"OutsiderWorkspaceFolder"),x([F("cdsenv",{resultRenderer:R.asIs})],Fl.prototype,"_getCdsEnv",1);var YS=K(require("path"));var QS=class extends ks{constructor(){super(mt.UNTITLED_ROOT_URI,mt.UNTITLED_ROOT)}_toLocalPath(e){let t=Cn(mt.toDiskUri(e));return t.endsWith(".cds")||(t+=".cds"),t}_toUri(e){return this.ensureUntitledUri(Jt(e).toString())}ensureUntitledUri(e){return e.startsWith(mt.UNTITLED_ROOT_URI_ONDISK)?(e.endsWith(".cds")&&(e=e.slice(0,-4)),e.replace(mt.UNTITLED_ROOT_URI_ONDISK,mt.UNTITLED_ROOT_URI)):e}},Mf=QS;o(QS,"UntitledPathAdapter");var ZS=class extends gt{get kind(){return"untitled"}constructor(e){super(e,"(Untitled)",new Mf)}createWorkspaceState(e){return ne().createSnapshot(e,!1)}checkRootExists(){}readContent(e){return pe}_getCdsEnv(){return Kr()}dependencyLevel(e){return 2}getWorkspaceRoot(e){return YS.dirname(e)}getAdapter(e){return mt.isUntitledFile(e)?this.adapter:ne().createPathAdapter(YS.dirname(e))}},La=ZS;o(ZS,"UntitledWorkspaceFolder"),x([F("files",{traceLevel:7,resultRenderer:()=>"Untitled files cannot be read from disk"})],La.prototype,"readContent",1),x([F("cdsenv",{resultRenderer:R.asIs})],La.prototype,"_getCdsEnv",1);var eT=class{constructor(e="(default)"){this.id=e}createServer(){return new If}createService(e){return new ba(e)}createWorkspace(e,t,r,i){switch(e){case"normal":return new gt(t,r,i);case"untitled":return new La(t);case"outsider":return new Fl(t);default:return Fu(`Unknown workspace folder kind '${e}'`)}}createSnapshot(e,t){return t?dn.create(e):Cp.create(e)}createFile(e,t,r){return zo.create(e,t,r)}getModuleLoader(e){return new Gt(e)}createPathAdapter(e,t){return new ks(e,t)}getPlatformTester(){return new ic}createOptions(){return new ki}getTrace(){let e=new Cu;return e.logFile.appendRaw(uo.initialStats(/^(NODE|CDS)/)),e.extendedStatsLogFile.appendRaw(uo.initialStats(/./)),e}getEmergencyHooks(){return new sc(this.getTrace())}createAnnotationHandlerProvider(e){let t=o(()=>{for(let r of e.workspaceService.workspaceFolders())Dt(r.triggerRevalidation())},"thenRebuildWorkspace");return{getAnnotationHandlers:()=>ne().getContributionLoader().loadAnnotationHandlers(t)}}createCompiler(e,t){return new Bi(e,t)}createToolbox(e){return e_(Uf(e.version()),Uf("4.0.0"))>=0?new Lf(e):e_(Uf(e.version()),Uf("3.6.3"))>=0?new Rl(e):new jo(e)}createTelemetry(e){return new _u(e)}getContributionLoader(){return new bn}createDependencyNet(e){return new ji(e)}createFileIndex(e,t,r){return new Io(e,t,r)}getFileSystem(){return new $e}},In=eT;o(eT,"Factory"),x([Pe()],In.prototype,"getModuleLoader",1),x([Pe()],In.prototype,"getPlatformTester",1),x([Pe()],In.prototype,"getTrace",1),x([Pe()],In.prototype,"getEmergencyHooks",1),x([Pe()],In.prototype,"getContributionLoader",1),x([Pe()],In.prototype,"getFileSystem",1);function Uf(n){let e=un(/(?<major>\d+)/),t=un(".").and(/(?<minor>\d+)/).optional(),r=un(".").and(/(?<patch>\d+)/).optional(),i=e.and(t).and(r),s=n.match(i);return s?[s.groups.major,s.groups.minor??"0",s.groups.patch??"0"].map(a=>parseInt(a,10)):[0,0,0]}o(Uf,"semVer");function e_(n,e){for(let t=0;t<n.length;t++){if(n[t]<e[t])return-1;if(n[t]>e[t])return 1}return 0}o(e_,"compareVersions");async function $2(n){let e=new class extends In{createAnnotationHandlerProvider(){let i=vt();return{getAnnotationHandlers:()=>n.map(({name:s,description:a,version:c,handler:l})=>new Yt(i,s,a,l,c))}}};Ss(e);let t=e.createServer(),r={listen:i=>{t.registerRequestHandlers(i)}};return r.server=t,r}o($2,"createCdsLanguageTestServer");var t_=require("vscode-languageserver/node");var qf=class{constructor(e){this.factory=e;m(this,"tracer");let t=e.getTrace();this.tracer=t.tracer("util"),this.tracer.conditionalTrace(2,()=>`@@@@@ requiring cds-lsp took ${global.___requiredMs}ms`),this.installEmergencyHooks(),this.setupGlobalCdsHomePath()}static start(e=new In("ServerStarter")){Ss(e),ss("BOOTSTRAP");let t=this.createStarter(e);this.assertRequiredNodeVersion(),t.connect()}static createStarter(e){return new qf(e)}static assertRequiredNodeVersion(){try{new Uu().assertNodeVersion(Ft)}catch(e){G().tracer("util").error(()=>String(e)),process.exit(72)}}connect(){let e=this.createConnection();this.factory.createTelemetry(e),this.tracer.info(()=>"Creating server"),this.factory.createServer().registerRequestHandlers(e),this.tracer.info(()=>"Start listening"),e.listen()}setupGlobalCdsHomePath(){let e=process.argv.find(r=>r.startsWith(Gt.GLOBAL_CDS_HOME_ARG))?.slice(Gt.GLOBAL_CDS_HOME_ARG.length);if(ne().getFileSystem().existsSync(e)){this.tracer.info(()=>`Global @sap/cds found in ${e}`);let r=this.factory.getModuleLoader();r._resolvedGlobalSapCdsHome=e}else this.tracer.warn(()=>"No global @sap/cds home provided as command-line arguments")}installEmergencyHooks(){ne().getEmergencyHooks().install()}createConnection(){return this.tracer.info(()=>"Creating connection"),(0,t_.createConnection)()}},Dl=qf;o(qf,"ServerStarter"),x([F("util")],Dl,"assertRequiredNodeVersion",1);var Ea=K(require("fs")),iT=K(require("path"));var n_=K(require("path"));var ui=n_.basename(process.argv[1],".mjs"),W2=o(n=>n.replaceAll(/\n# ([^\n]*)\n/g,`
\x1B[1m$1\x1B[0m
`).replaceAll(/\*\*(.*?)\*\*/g,"\x1B[1m$1\x1B[0m").replaceAll(/ _([^_]+)_/g," \x1B[4m$1\x1B[0m"),"mdToAnsi"),dr=o(n=>console.log(W2(n)),"log"),B2=[],qt={cwd:process.cwd(),args:process.argv,backup:!0,silent:!1,log:dr,commands:B2};function r_(n,e){qt.cwd=n,qt.args=e,qt.backup=!0,qt.silent=!1}o(r_,"initGlobals");var tT=80;function o_(n,e){return n.reduce((t,r)=>Math.max(t,e(r)),0)}o(o_,"maxLength");function $f(n){return`**${n}**`}o($f,"bold");function j2(...n){return new RegExp(n.map(e=>`(${e.source})`).join("|"))}o(j2,"anyRegex");function V2(n){let i=j2(/(?<= )\*\*.+?\*\*/,/(?<= )_.+?_/,/\s+/);return n.split(i).filter(s=>!!s)}o(V2,"parseWords");function G2(n){return V2(n).map(t=>t.match(/^\*\*.*\*\*$/)?{word:t.slice(2,-2),bold:!0}:t.match(/^_.*_$/)?{word:t.slice(1,-1),underlined:!0}:{word:t})}o(G2,"buildMarkups");function i_(n){return n.bold?`\x1B[1m${n.word}\x1B[0m`:n.underlined?`\x1B[4m${n.word}\x1B[0m`:n.word}o(i_,"toAnsi");function nT(n,e,t=100){let r=n.split(/\r?\n/),i=[];return r.forEach(s=>{let a=G2(s),c=e,l=e.length;for(let u=0;u<a.length;u++){let p=a[u],d=a[u+1]?.word,f=!!d?.match(/^\W/),g=f?p.word.length+d.trimEnd().length:p.word.length;l+g>t?(i.push(c.trimEnd()),c=e,l=e.length,c+=i_(p).trimStart(),l+=p.word.trimStart().length):(c+=i_(p),l+=p.word.length),f&&(c+=d,l+=d.length,u++)}i.push(c.trimEnd())}),i.join(`
`)}o(nT,"format");function H2(n){return n.allowedEnumValues}o(H2,"possibleValues");var z2={options:["-h","--help"],help:"Show this help",handler:n=>{dr(K2(n)),process.exit(0)}};function K2(n){return[X2(),J2(n),Q2(),Y2()].join("")}o(K2,"assembleHelpText");function X2(){let n=`If no files or folders are specified the current folder will be used as filespec i.e. all CDS source files of the project will be formatted.

Each file is formatted according a set of formatting options derived by taking the default options, overlayed with options specified in the nearest _${Lo}_ file found, starting from the folder the file is located in up to the root folder ('/').`;return`
# SYNOPSIS

    **${ui}** [filespec [, filespec]*] [<options>]

    Formats the specified CDS files.
    
${nT(n,"    ",tT)}`}o(X2,"assembleMainHelp");function J2(n){let e=`


# GENERAL OPTIONS`,t=n.commands.map(i=>({command:i,formatted:`${$f(i.options.join(" "))}`})),r=4+o_(t,i=>i.formatted.length);return t.forEach(({command:i,formatted:s})=>{e+=`
                
    ${s.padEnd(r)}${nT(i.help,"".padEnd(r),tT).slice(r)}`}),e}o(J2,"assembleGeneralOptions");function Q2(){let n=`


# FORMATTING OPTIONS

    For all formatting options use: **--<option name>=<value>**
`,e=Bc,t=Object.keys(e),r=4+o_(t,s=>s.length),i=`${"".padEnd(r)}`;for(let s of t){let a=e[s];if(!a.description)continue;let c=H2(a),l=nT(a.description,i,tT).slice(i.length);n+=`

    ${$f("--"+s).padEnd(r)}${l}
    
${i}default: ${$f(""+a.defaultValue)}
${c?`${i}one of:  ${c.map($f).join(" ")}`:""}`}return n}o(Q2,"assembleFormattingOptions");function Y2(){return`
            
            
# EXAMPLES

    **${ui}** -h
    **${ui}** --init
    **${ui}** 
    **${ui}** src test/demo.cds -f 
    **${ui}** src --tabSize=4 --alignAs=false  
`}o(Y2,"assembleExamples");var s_=z2;var Wf=K(require("fs")),a_=K(require("path"));var Z2={options:["-i","--init"],help:"Generates a _.cdsprettier.json_ file with default formatting options in the current folder. Use **--force** if the file already exists",handler:n=>{let e=Bc,t=o(i=>{let s=i.defaultValue;switch(typeof s){case"boolean":case"number":return`${s}`;default:return`"${s}"`}},"renderDefault"),r=a_.join(n.cwd,Lo);Wf.existsSync(r)&&n.backup&&(dr(`${Lo} already exists`),process.exit(1)),Wf.writeFileSync(r,`{
${Object.entries(e).filter(([,i])=>i.description).map(([i,s])=>`  "${i}": ${t(s)}`).join(`,
`)}
}`),dr(`${Lo} created successfully`),process.exit(0)}},c_=Z2;qt.commands.push(s_,c_,{options:["-f","--force"],help:"Forces to overwrite the original source file. No backup is created.",handler:n=>n.backup=!1},{options:["--silent"],help:"Do not show processed files",handler:n=>n.silent=!0},{options:["-v"],help:"Show version",handler:n=>{dr(`${ui} ${cc}`),process.exit(0)}});var l_={};qt.commands.forEach(n=>n.options.forEach(e=>l_[e]=n.handler));function u_(){for(let n=2;n<qt.args.length;n++){let[e]=qt.args[n].split(/[:=]/),t=l_[e];t&&t(qt,n)}}o(u_,"dispatchOptions");var rT=K(require("fs")),Bf=K(require("path"));function eK(n){let e=new Map;for(let t of n)if(!t.startsWith("-"))try{let r=Bf.isAbsolute(t)?t:Bf.join(qt.cwd,t),i=rT.statSync(r);(i.isFile()&&r.endsWith(".cds")||i.isDirectory())&&e.set(r,i)}catch(r){if(r.code!=="ENOENT")throw r}return e.size?e:void 0}o(eK,"findCommandLineRoots");function tK(){let{cwd:n}=qt;return new Map([[n,rT.statSync(n)]])}o(tK,"findCwdRoot");function p_(){return eK(qt.args.slice(2))??tK()}o(p_,"findRoots");var aT=class{constructor(){m(this,"prettyPrint",new Nr(this.startTrace()))}async formatCli(e=process.argv,t=process.cwd()){r_(t,e),u_();let r=p_();for(let[i,s]of r.entries())s.isDirectory()?await this.processDirectory(i):s.isFile()&&await this.processFile(i)}startTrace(){let e=new In("formatterCli"),t=e.getTrace();return Ss(e),ss("cds-format"),t.tracer("format")}async processFile(e){if(!e.endsWith(".cds"))return;let t=await Ea.promises.readFile(e,"utf8"),{formattedContent:r}=this.prettyPrint.beautifyWithLayeredOptions(t,{},e);t===r?qt.silent||dr(`unchanged ${e}`):(qt.silent||dr(`formatted ${e}`),qt.backup&&Ea.renameSync(e,e+".bak"),await Ea.promises.writeFile(e,r))}async processDirectory(e){let t=await Ea.promises.readdir(e,{withFileTypes:!0});for(let r of t){let i=r.name.toLowerCase();if(r.isDirectory()){if(["node_modules",".git"].includes(i))continue;await this.processDirectory(iT.join(e,r.name))}else r.isFile()&&await this.processFile(iT.join(e,r.name))}}},oT=aT;o(aT,"FormatCli");async function sT(n=process.argv,e=process.cwd()){return new oT().formatCli(n,e)}o(sT,"formatCli");var nK=Date.now(),rK=Date.now();global.___requiredMs=rK-nK;0&&(module.exports={ServerStarter,createCdsLanguageTestServer,formatCli,lspRoot,ruleName});
/*! Bundled license information:

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

repeat-string/index.js:
  (*!
   * repeat-string <https://github.com/jonschlinkert/repeat-string>
   *
   * Copyright (c) 2014-2015, Jon Schlinkert.
   * Licensed under the MIT License.
   *)
*/
//# sourceMappingURL=bundle.js.map
